# 核心库模块 (Core Library)

## 概述

`app/lib` 目录包含应用的核心库功能，这些功能是系统的基础组件，提供特定领域的业务逻辑和功能实现。

## 职责范围

这个目录的主要职责是：

1. **数据库访问层**：提供数据库连接和操作接口
2. **认证系统**：用户认证、授权和会话管理
3. **存储系统**：文件存储、管理和访问控制
4. **API层**：API客户端实现和服务端接口
5. **错误处理**：特定领域的错误处理机制
6. **中间件**：应用中间件和请求处理管道
7. **配置管理**：应用配置和环境设置
8. **安全机制**：特定领域的安全功能实现
9. **表单处理**：高级表单处理和验证逻辑

## 使用指南

从lib导入功能时，应该使用特定的子模块路径，而不是通过根模块导入：

```typescript
// 推荐方式
import { prisma } from '@/app/lib/database';
import { fileApi } from '@/app/lib/api/file-api';

// 不推荐方式
import { database, api } from '@/app/lib';
```

## 与app/utils的区别

- **app/lib**：提供核心库功能，包含业务逻辑和系统核心组件
- **app/utils**：提供通用工具函数，不依赖于特定业务逻辑

具体区别：

1. **lib**：高级别、特定领域、可能有状态的库功能
2. **utils**：低级别、通用、无状态的工具函数

例如，文件存储系统是核心库功能（lib），而文件类型判断是通用工具（utils）。

## 依赖关系管理

为保持清晰的依赖结构，请遵循以下原则：

1. **app/lib 可以依赖的模块**：
   - app/utils（通用工具函数）
   - 其他 app/lib 子模块
   - 第三方库
   - app/types（类型定义）
   - app/constants（常量定义）

2. **app/lib 应谨慎依赖的模块**：
   - app/services（业务服务）：仅在必要时依赖，避免循环依赖
   - app/hooks（业务钩子）：应避免依赖，保持库的独立性

3. **app/lib 不应依赖的模块**：
   - app/components（UI组件）
   - app/store（状态管理）
   - app/pages 或 app/routes（页面组件）

4. **依赖优化原则**：
   - 如果 app/lib 中的功能被多个模块使用，保留在 lib 中
   - 如果功能是通用的、无状态的，考虑移至 app/utils
   - 如果出现循环依赖，考虑重构代码结构或创建共享基础模块 