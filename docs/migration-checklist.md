# 项目结构优化迁移检查清单

## 使用指南

1. 在开始每个迁移任务前，查阅[目录结构规范](./directory-structure.md)和[迁移计划](./migration-plan.md)
2. 完成任务后，将相应的检查项标记为已完成
3. 记录任何遇到的问题和解决方案
4. 定期更新迁移进度

## 阶段1：文件处理逻辑整合

### 分析任务

- [ ] 分析 `app/lib/file/fileUtils.ts` 内容和职责
- [ ] 分析 `app/utils/file/*` 内容和职责
- [ ] 分析 `app/lib/storage/file-handling/*` 内容和职责
- [ ] 识别功能重叠点
- [ ] 确定新的职责分配方案

### 代码迁移任务

- [ ] 更新/创建 `app/utils/file` 相关文件
  - [ ] 移动纯函数到此目录
  - [ ] 更新导出
  - [ ] 更新引用

- [ ] 更新/创建 `app/lib/file` 相关文件
  - [ ] 移动IO操作和核心功能到此目录
  - [ ] 更新导出
  - [ ] 更新引用

- [ ] 重构 `app/lib/storage/file-handling`
  - [ ] 移动相关功能到正确位置
  - [ ] 更新或移除此目录

### 测试验证

- [ ] 单元测试通过
- [ ] 文件上传功能正常
- [ ] 文件下载功能正常
- [ ] 文件操作相关功能正常

### 文档更新

- [ ] 更新相关文档
- [ ] 记录架构变更

## 阶段2：中间件整合

### 分析任务

- [ ] 分析根目录 `middleware.ts` 功能
- [ ] 分析 `app/middleware/*` 功能
- [ ] 确定整合方案

### 代码迁移任务

- [ ] 迁移根目录中间件功能到 `app/middleware`
- [ ] 更新中间件引用
- [ ] 移除冗余代码

### 测试验证

- [ ] 所有中间件功能正常
- [ ] API路由正确应用中间件
- [ ] 认证功能正常

## 阶段3：存储功能重构

### 分析任务

- [ ] 分析 `app/lib/storage/*` 内容和职责
- [ ] 分析 `app/services/storage/*` 内容和职责 
- [ ] 分析 `app/api/storage/*` 内容和职责
- [ ] 确定三层架构的明确职责划分

### 代码迁移任务

- [ ] 重构 `app/lib/storage` 相关文件
  - [ ] 保留核心存储功能
  - [ ] 移除业务逻辑
  
- [ ] 重构 `app/services/storage` 相关文件
  - [ ] 确保包含所有业务逻辑
  - [ ] 确保调用 lib 层功能而非直接实现
  
- [ ] 检查 `app/api/storage` 相关文件
  - [ ] 确保仅处理请求和调用 services 层
  - [ ] 移除任何直接调用 lib 层的代码

### 测试验证

- [ ] 文件存储功能正常
- [ ] 文件管理功能正常
- [ ] 权限控制正常
- [ ] API端点正常

## 阶段4：类型定义集中

### 分析任务

- [ ] 收集分散在各处的类型定义
- [ ] 按功能域分类
- [ ] 设计类型组织结构

### 代码迁移任务

- [ ] 整理 `app/types` 目录结构
- [ ] 移动/合并类型定义
- [ ] 更新类型引用

### 测试验证

- [ ] 类型检查通过
- [ ] 没有类型错误
- [ ] 应用正常运行

## 阶段5：utils与lib职责明确

### 分析任务

- [ ] 审查 `app/utils/*` 内容和职责 
- [ ] 审查 `app/lib/*` 内容和职责
- [ ] 确定需要调整的内容

### 代码迁移任务

- [ ] 纯函数移至 `utils`
- [ ] 有状态/IO操作移至 `lib`
- [ ] 更新引用

### 测试验证

- [ ] 所有功能正常
- [ ] 代码结构符合规范

## 最终验收检查

- [ ] 所有代码都位于正确的目录中
- [ ] 没有功能重复的代码
- [ ] 所有引用路径正确
- [ ] 所有测试通过
- [ ] 项目结构符合规范文档
- [ ] 文档已更新

## 问题记录

| 日期 | 问题描述 | 解决方案 | 状态 |
|------|---------|---------|------| 