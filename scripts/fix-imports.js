/**
 * è‡ªåŠ¨ä¿®å¤å¯¼å…¥è·¯å¾„è„šæœ¬
 * ç”±rename-helper.jsè‡ªåŠ¨ç”Ÿæˆ
 */

const fs = require('fs');
const path = require('path');
const { promisify } = require('util');
const writeFile = promisify(fs.writeFile);

// éœ€è¦ä¿®å¤çš„æ–‡ä»¶
const filesToFix = [
  {
    "path": "app\\api\\user\\avatar\\route.ts",
    "newContent": "import { NextRequest, NextResponse } from 'next/server';\r\nimport { getServerSession } from 'next-auth';\r\nimport { prisma } from '@/app/lib/database';\r\nimport { authOptions } from '@/app/lib/auth';\r\nimport { writeFile, mkdir, unlink } from 'fs/promises';\r\nimport { join } from 'path';\r\nimport crypto from 'crypto';\r\nimport fs from 'fs';\r\n\r\n// ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨\r\nconst ensureUploadDir = async () => {\r\n  const uploadDir = join(process.cwd(), 'public', 'uploads', 'avatars');\r\n  if (!fs.existsSync(uploadDir)) {\r\n    console.log('åˆ›å»ºå¤´åƒä¸Šä¼ ç›®å½•:', uploadDir);\r\n    await mkdir(uploadDir, { recursive: true });\r\n  }\r\n  return uploadDir;\r\n};\r\n\r\n// è·å–ç”¨æˆ·å½“å‰å¤´åƒæ–‡ä»¶è·¯å¾„\r\nconst getUserAvatarPath = async (userId: string) => {\r\n  const user = await prisma.user-profile.findUnique({\r\n    where: { userId },\r\n    select: { avatarUrl: true }\r\n  });\r\n  \r\n  if (!user?.avatarUrl) return null;\r\n  \r\n  // ä»URLæå–æ–‡ä»¶å\r\n  const fileName = user.avatarUrl.split('/').pop();\r\n  if (!fileName) return null;\r\n  \r\n  return join(process.cwd(), 'public', 'uploads', 'avatars', fileName);\r\n};\r\n\r\n// è·å–ç”¨æˆ·å½“å‰å¤´åƒ\r\nexport async function GET() {\r\n  try {\r\n    const session = await getServerSession(authOptions);\r\n    \r\n    if (!session?.user?.email) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const user = await prisma.user.findUnique({\r\n      where: { email: session.user.email },\r\n      include: { profile: true }\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      avatarUrl: user.profile?.avatarUrl || session.user.image || null\r\n    });\r\n  } catch (error) {\r\n    console.error('è·å–å¤´åƒå¤±è´¥:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'è·å–å¤´åƒå¤±è´¥' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// ä¸Šä¼ ç”¨æˆ·å¤´åƒ\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const session = await getServerSession(authOptions);\r\n    \r\n    if (!session?.user?.email) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    // è·å–ç”¨æˆ·ID\r\n    const user = await prisma.user.findUnique({\r\n      where: { email: session.user.email },\r\n      select: { id: true }\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // å¤„ç†è¡¨å•æ•°æ®\r\n    const formData = await request.formData();\r\n    const file = formData.get('avatar') as File;\r\n    \r\n    if (!file) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'æœªæä¾›å¤´åƒæ–‡ä»¶' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // éªŒè¯æ–‡ä»¶ç±»å‹\r\n    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\r\n    if (!validTypes.includes(file.type)) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œè¯·ä¸Šä¼ JPEGã€PNGã€GIFæˆ–WEBPå›¾ç‰‡' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§2MBï¼‰\r\n    const maxSize = 2 * 1024 * 1024; // 2MB\r\n    if (file.size > maxSize) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆæœ€å¤§2MBï¼‰' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å\r\n    const fileExt = file.name.split('.').pop() || 'jpg';\r\n    const fileName = `${crypto.randomUUID()}.${fileExt}`;\r\n    \r\n    // ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨\r\n    const uploadDir = await ensureUploadDir();\r\n    const filePath = join(uploadDir, fileName);\r\n    const fileUrl = `/uploads/avatars/${fileName}`;\r\n\r\n    console.log('å‡†å¤‡å†™å…¥æ–‡ä»¶:', filePath);\r\n    console.log('å¯¹åº”çš„URL:', fileUrl);\r\n\r\n    // è¯»å–æ–‡ä»¶å†…å®¹\r\n    const buffer = Buffer.from(await file.arrayBuffer());\r\n    \r\n    // åˆ é™¤æ—§å¤´åƒæ–‡ä»¶\r\n    try {\r\n      const oldAvatarPath = await getUserAvatarPath(user.id);\r\n      if (oldAvatarPath && fs.existsSync(oldAvatarPath)) {\r\n        console.log('åˆ é™¤æ—§å¤´åƒæ–‡ä»¶:', oldAvatarPath);\r\n        await unlink(oldAvatarPath);\r\n      }\r\n    } catch (deleteError) {\r\n      console.error('åˆ é™¤æ—§å¤´åƒæ–‡ä»¶å¤±è´¥', deleteError);\r\n      // ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­ä¸Šä¼ æµç¨‹\r\n    }\r\n    \r\n    // å†™å…¥æ–‡ä»¶\r\n    try {\r\n      await writeFile(filePath, buffer);\r\n      console.log('æ–‡ä»¶å†™å…¥æˆåŠŸ:', filePath);\r\n    } catch (writeError) {\r\n      console.error('æ–‡ä»¶å†™å…¥å¤±è´¥:', writeError);\r\n      return NextResponse.json(\r\n        { success: false, error: 'æ–‡ä»¶ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•' },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // æ›´æ–°ç”¨æˆ·èµ„æ–™\r\n    await prisma.user-profile.upsert({\r\n      where: { userId: user.id },\r\n      update: { avatarUrl: fileUrl },\r\n      create: {\r\n        userId: user.id,\r\n        avatarUrl: fileUrl,\r\n        displayName: session.user.name || ''\r\n      }\r\n    });\r\n\r\n    return NextResponse.json({ \r\n      success: true,\r\n      avatarUrl: fileUrl\r\n    });\r\n  } catch (error) {\r\n    console.error('å¤´åƒä¸Šä¼ å¤±è´¥:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'å¤´åƒä¸Šä¼ å¤±è´¥' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// åˆ é™¤è‡ªå®šä¹‰å¤´åƒï¼Œæ¢å¤é»˜è®¤å¤´åƒ\r\nexport async function DELETE() {\r\n  try {\r\n    const session = await getServerSession(authOptions);\r\n    \r\n    if (!session?.user?.email) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const user = await prisma.user.findUnique({\r\n      where: { email: session.user.email },\r\n      select: { id: true }\r\n    });\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\r\n        { status: 404 }\r\n      );\r\n    }\r\n    \r\n    // åˆ é™¤å¤´åƒæ–‡ä»¶\r\n    try {\r\n      const avatarPath = await getUserAvatarPath(user.id);\r\n      if (avatarPath && fs.existsSync(avatarPath)) {\r\n        console.log('åˆ é™¤å¤´åƒæ–‡ä»¶:', avatarPath);\r\n        await unlink(avatarPath);\r\n      }\r\n    } catch (deleteError) {\r\n      console.error('åˆ é™¤å¤´åƒæ–‡ä»¶å¤±è´¥:', deleteError);\r\n      // ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­åˆ é™¤æµç¨‹\r\n    }\r\n\r\n    // æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼Œåˆ é™¤è‡ªå®šä¹‰å¤´åƒ\r\n    await prisma.user-profile.update({\r\n      where: { userId: user.id },\r\n      data: { avatarUrl: null }\r\n    });\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      avatarUrl: session.user.image || null\r\n    });\r\n  } catch (error) {\r\n    console.error('åˆ é™¤å¤´åƒå¤±è´¥:', error);\r\n    return NextResponse.json(\r\n      { success: false, error: 'åˆ é™¤å¤´åƒå¤±è´¥' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n} \r\n"
  },
  {
    "path": "app\\api\\user\\profile\\route.ts",
    "newContent": "import { NextRequest, NextResponse } from 'next/server'\r\nimport { getServerSession } from 'next-auth'\r\nimport { prisma } from '@/app/lib/database'\r\n\r\n// è·å–å½“å‰è®¤è¯é…ç½®\r\nimport { authOptions } from '@/app/lib/auth'\r\n\r\n// ä»å‰ç«¯è·å–çš„ç”¨æˆ·èµ„æ–™æ¥å£\r\ninterface UserProfileInput {\r\n  displayName?: string\r\n  bio?: string\r\n  location?: string\r\n  website?: string\r\n  company?: string\r\n  avatarUrl?: string\r\n  theme?: string\r\n}\r\n\r\n// è¿”å›ç»™å‰ç«¯çš„ç”¨æˆ·èµ„æ–™æ¥å£\r\ninterface UserProfileResponse {\r\n  id: string\r\n  email: string\r\n  name: string | null\r\n  avatarUrl?: string | null\r\n  theme?: string | null\r\n  bio?: string | null\r\n  location?: string | null\r\n  website?: string | null\r\n  company?: string | null\r\n  storageUsed: number\r\n  storageLimit: number\r\n  createdAt: string\r\n  updatedAt: string\r\n}\r\n\r\n// è·å–ç”¨æˆ·èµ„æ–™\r\nexport async function GET() {\r\n  console.log('GET /api/user/profile è¯·æ±‚å¼€å§‹')\r\n  try {\r\n    const session = await getServerSession(authOptions)\r\n    console.log('è·å–åˆ°ç”¨æˆ·ä¼šè¯:', session ? 'æˆåŠŸ' : 'å¤±è´¥')\r\n    \r\n    if (!session?.user?.email) {\r\n      console.log('æœªæˆæƒè®¿é—®: æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·é‚®ç®±')\r\n      return NextResponse.json(\r\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    console.log('æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œé‚®ç®±:', session.user.email)\r\n    // æŸ¥è¯¢ç”¨æˆ·ï¼Œå¹¶åŒ…å«ç”¨æˆ·èµ„æ–™\r\n    const user = await prisma.user.findUnique({\r\n      where: {\r\n        email: session.user.email\r\n      },\r\n      include: {\r\n        profile: true\r\n      }\r\n    })\r\n\r\n    if (!user) {\r\n      console.log('ç”¨æˆ·ä¸å­˜åœ¨:', session.user.email)\r\n      return NextResponse.json(\r\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    // æ„å»ºç”¨æˆ·èµ„æ–™å“åº”\r\n    const user-profile: UserProfileResponse = {\r\n      id: user.id,\r\n      email: user.email,\r\n      name: user.name,\r\n      avatarUrl: user.profile?.avatarUrl || null, \r\n      theme: user.profile?.theme || null,\r\n      bio: user.profile?.bio || null,\r\n      location: user.profile?.location || null,\r\n      website: user.profile?.website || null,\r\n      company: user.profile?.company || null,\r\n      storageUsed: user.storageUsed,\r\n      storageLimit: user.storageLimit,\r\n      createdAt: user.createdAt.toISOString(),\r\n      updatedAt: user.updatedAt.toISOString()\r\n    }\r\n\r\n    console.log('æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯:', user.id)\r\n    return NextResponse.json({\r\n      success: true,\r\n      profile: user-profile\r\n    })\r\n  } catch (error) {\r\n    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// æ›´æ–°ç”¨æˆ·èµ„æ–™\r\nexport async function PUT(request: NextRequest) {\r\n  console.log('PUT /api/user/profile è¯·æ±‚å¼€å§‹')\r\n  try {\r\n    const session = await getServerSession(authOptions)\r\n    console.log('è·å–åˆ°ç”¨æˆ·ä¼šè¯:', session ? 'æˆåŠŸ' : 'å¤±è´¥')\r\n    \r\n    if (!session?.user?.email) {\r\n      console.log('æœªæˆæƒè®¿é—®: æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·é‚®ç®±')\r\n      return NextResponse.json(\r\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const data = await request.json() as UserProfileInput\r\n    console.log('æ¥æ”¶åˆ°çš„æ•°æ®:', data)\r\n\r\n    // è·å–ç”¨æˆ·\r\n    const user = await prisma.user.findUnique({\r\n      where: {\r\n        email: session.user.email\r\n      },\r\n      include: {\r\n        profile: true\r\n      }\r\n    })\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    // æ›´æ–°ç”¨æˆ·åç§°\r\n    const updatedUser = await prisma.user.update({\r\n      where: {\r\n        id: user.id\r\n      },\r\n      data: {\r\n        name: data.displayName || user.name\r\n      }\r\n    })\r\n\r\n    // æ›´æ–°æˆ–åˆ›å»ºç”¨æˆ·èµ„æ–™\r\n    console.log('å¼€å§‹æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼Œç”¨æˆ·ID:', user.id);\r\n    console.log('å½“å‰ç”¨æˆ·Profileæ•°æ®:', user.profile || 'æ— ');\r\n    \r\n    const profile = await prisma.user-profile.upsert({\r\n      where: {\r\n        userId: user.id\r\n      },\r\n      update: {\r\n        avatarUrl: data.avatarUrl !== undefined ? data.avatarUrl : user.profile?.avatarUrl,\r\n        theme: data.theme !== undefined ? data.theme : user.profile?.theme,\r\n        displayName: data.displayName || user.profile?.displayName || user.name,\r\n        bio: data.bio !== undefined ? data.bio : user.profile?.bio,\r\n        location: data.location !== undefined ? data.location : user.profile?.location,\r\n        website: data.website !== undefined ? data.website : user.profile?.website,\r\n        company: data.company !== undefined ? data.company : user.profile?.company\r\n      },\r\n      create: {\r\n        userId: user.id,\r\n        displayName: data.displayName || user.name || '',\r\n        avatarUrl: data.avatarUrl,\r\n        theme: data.theme,\r\n        bio: data.bio || '',\r\n        location: data.location || '',\r\n        website: data.website || '',\r\n        company: data.company || ''\r\n      }\r\n    });\r\n    \r\n    console.log('ç”¨æˆ·èµ„æ–™æ›´æ–°/åˆ›å»ºæˆåŠŸ:', profile);\r\n\r\n    // æ„å»ºç”¨æˆ·èµ„æ–™å“åº”\r\n    const user-profile: UserProfileResponse = {\r\n      id: updatedUser.id,\r\n      email: updatedUser.email,\r\n      name: updatedUser.name,\r\n      avatarUrl: profile.avatarUrl,\r\n      theme: profile.theme,\r\n      bio: profile.bio,\r\n      location: profile.location,\r\n      website: profile.website,\r\n      company: profile.company,\r\n      storageUsed: updatedUser.storageUsed,\r\n      storageLimit: updatedUser.storageLimit,\r\n      createdAt: updatedUser.createdAt.toISOString(),\r\n      updatedAt: updatedUser.updatedAt.toISOString()\r\n    }\r\n\r\n    console.log('æˆåŠŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯:', user.id)\r\n    return NextResponse.json({\r\n      success: true,\r\n      profile: user-profile\r\n    })\r\n  } catch (error) {\r\n    console.error('æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\r\n    return NextResponse.json(\r\n      { success: false, error: 'æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n} "
  },
  {
    "path": "app\\api\\user\\theme\\route.ts",
    "newContent": "import { NextRequest, NextResponse } from 'next/server';\nimport { getServerSession } from 'next-auth';\nimport { prisma } from '@/app/lib/database';\nimport { authOptions } from '@/app/lib/auth';\n\n// è·å–ç”¨æˆ·å½“å‰ä¸»é¢˜\nexport async function GET() {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user?.email) {\n      return NextResponse.json(\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\n        { status: 401 }\n      );\n    }\n\n    const user = await prisma.user.findUnique({\n      where: { email: session.user.email },\n      include: { profile: true }\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\n        { status: 404 }\n      );\n    }\n\n    return NextResponse.json({\n      success: true,\n      theme: user.profile?.theme || 'default'\n    });\n  } catch (error) {\n    console.error('è·å–ä¸»é¢˜å¤±è´¥:', error);\n    return NextResponse.json(\n      { success: false, error: 'è·å–ä¸»é¢˜å¤±è´¥' },\n      { status: 500 }\n    );\n  }\n}\n\n// æ›´æ–°ç”¨æˆ·ä¸»é¢˜\nexport async function PUT(request: NextRequest) {\n  try {\n    const session = await getServerSession(authOptions);\n    \n    if (!session?.user?.email) {\n      return NextResponse.json(\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\n        { status: 401 }\n      );\n    }\n\n    // è·å–è¯·æ±‚ä½“\n    const data = await request.json();\n    const { theme } = data;\n    \n    if (!theme) {\n      return NextResponse.json(\n        { success: false, error: 'æœªæä¾›ä¸»é¢˜å‚æ•°' },\n        { status: 400 }\n      );\n    }\n\n    // éªŒè¯ä¸»é¢˜æ˜¯å¦æœ‰æ•ˆ\n    const validThemes = [\n      // åŸºç¡€è‰²å½©ä¸»é¢˜\n      'default', 'violet', 'emerald', 'amber', 'rose',\n      // æ¸å˜ä¸»é¢˜\n      'ocean', 'sunset', 'forest', 'galaxy', \n      // å­£èŠ‚ä¸»é¢˜\n      'spring', 'summer', 'autumn', 'winter',\n      // æŸ”å’Œä¸»é¢˜ - æµ…è‰²ç³»åˆ—\n      'pastel_pink', 'pastel_blue', 'pastel_lavender', 'pastel_mint', \n      'pastel_peach', 'pastel_lemon', 'pastel_teal'\n    ];\n    if (!validThemes.includes(theme)) {\n      return NextResponse.json(\n        { success: false, error: 'æ— æ•ˆçš„ä¸»é¢˜' },\n        { status: 400 }\n      );\n    }\n\n    // è·å–ç”¨æˆ·ID\n    const user = await prisma.user.findUnique({\n      where: { email: session.user.email },\n      select: { id: true }\n    });\n\n    if (!user) {\n      return NextResponse.json(\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\n        { status: 404 }\n      );\n    }\n\n    // æ›´æ–°ç”¨æˆ·ä¸»é¢˜\n    await prisma.user-profile.upsert({\n      where: { userId: user.id },\n      update: { theme },\n      create: {\n        userId: user.id,\n        displayName: session.user.name || '',\n        theme\n      }\n    });\n\n    return NextResponse.json({\n      success: true,\n      theme\n    });\n  } catch (error) {\n    console.error('æ›´æ–°ä¸»é¢˜å¤±è´¥:', error);\n    return NextResponse.json(\n      { success: false, error: 'æ›´æ–°ä¸»é¢˜å¤±è´¥' },\n      { status: 500 }\n    );\n  }\n} \n"
  },
  {
    "path": "app\\components\\features\\file-management\\actionBar\\TopActionBar\\TopActionBar.tsx",
    "newContent": "import React from 'react';\r\nimport { \r\n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \r\n} from 'lucide-react';\r\nimport styles from '@/app/file-management/styles/shared.module.css';\r\nimport { SortDropdown } from '@/app/components/features/file-management/actionBar/SortDropdown';\r\nimport { UploadButton } from '@/app/components/features/file-management/upload/UploadButton';\r\nimport { FileSortInterface } from '@/app/types';\r\n\r\ninterface TopActionBarProps {\r\n  selectedFiles: string[];\r\n  onClearSelection: () => void;\r\n  onDownload: () => void;\r\n  onRename: () => void;\r\n  onMove: () => void;\r\n  onDelete: () => void;\r\n  onClearFilter: () => void;\r\n  onCreateFolder: () => void;\r\n  selectedFileType: string | null;\r\n  showSearchView: boolean;\r\n  isInRootFolder: boolean;\r\n  sortOrder: FileSortInterface;\r\n  setSortOrder: (order: FileSortInterface) => void;\r\n  showUploadDropdown: boolean;\r\n  setShowUploadDropdown: (show: boolean) => void;\r\n  setIsUploadModalOpen: (open: boolean) => void;\r\n  setIsFolderUploadModalOpen: (open: boolean) => void;\r\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\r\n  selectedFiles,\r\n  onClearSelection,\r\n  onDownload,\r\n  onRename,\r\n  onMove,\r\n  onDelete,\r\n  onClearFilter,\r\n  onCreateFolder,\r\n  selectedFileType,\r\n  showSearchView,\r\n  isInRootFolder,\r\n  sortOrder,\r\n  setSortOrder,\r\n  showUploadDropdown,\r\n  setShowUploadDropdown,\r\n  setIsUploadModalOpen,\r\n  setIsFolderUploadModalOpen,\r\n  uploadDropdownRef\r\n}) => {\r\n  return (\r\n    <div className={styles.topBar}>\r\n      <div className={styles.buttonGroup}>\r\n        {selectedFiles.length > 0 ? (\r\n          <>\r\n            <button className={styles.topButton} onClick={onClearSelection}>\r\n              <X className=\"w-4 h-4\" />\r\n              å–æ¶ˆé€‰æ‹©\r\n            </button>\r\n            <button className={styles.topButton} onClick={onDownload}>\r\n              <Download className=\"w-4 h-4\" />\r\n              ä¸‹è½½\r\n            </button>\r\n            <button \r\n              className={styles.topButton}\r\n              onClick={onRename}\r\n            >\r\n              <Edit className=\"w-4 h-4\" />\r\n              é‡å‘½å\r\n            </button>\r\n            <button className={styles.topButton} onClick={onMove}>\r\n              <Move className=\"w-4 h-4\" />\r\n              ç§»åŠ¨\r\n            </button>\r\n            <button className={styles.topButton} onClick={onDelete}>\r\n              <Trash2 className=\"w-4 h-4\" />\r\n              åˆ é™¤\r\n            </button>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <button \r\n              className={styles.topButton}\r\n              onClick={onClearFilter}\r\n              disabled={isInRootFolder}\r\n            >\r\n              <span>ğŸ“</span>\r\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\r\n            </button>\r\n\r\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\r\n            {selectedFileType && (\r\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\r\n                {(() => {\r\n                  switch(selectedFileType) {\r\n                    case 'image': return <ImageIcon className=\"w-4 h-4 mr-2\" />;\r\n                    case 'document': return <FileText className=\"w-4 h-4 mr-2\" />;\r\n                    case 'video': return <Video className=\"w-4 h-4 mr-2\" />;\r\n                    case 'audio': return <Music className=\"w-4 h-4 mr-2\" />;\r\n                    case 'other': return <File className=\"w-4 h-4 mr-2\" />;\r\n                    default: return null;\r\n                  }\r\n                })()}\r\n                å½“å‰æµè§ˆï¼š\r\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\r\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\r\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\r\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\r\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\r\n              </div>\r\n            )}\r\n\r\n            {/* æ’åºä¸‹æ‹‰èœå• */}\r\n            <SortDropdown \r\n              sortOrder={sortOrder}\r\n              onSortChange={setSortOrder}\r\n            />\r\n            \r\n            {/* ä¸Šä¼ æŒ‰é’® */}\r\n            <UploadButton \r\n              showDropdown={showUploadDropdown}\r\n              setShowDropdown={setShowUploadDropdown}\r\n              setIsModalOpen={setIsUploadModalOpen}\r\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\r\n              uploadDropdownRef={uploadDropdownRef}\r\n            />\r\n            \r\n            <button \r\n              className={styles.folderButton} \r\n              onClick={onCreateFolder}\r\n            >\r\n              <FolderUp className=\"w-4 h-4 mr-2\" />\r\n              æ–°å»ºæ–‡ä»¶å¤¹\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TopActionBar; "
  },
  {
    "path": "app\\components\\features\\file-management\\MiniSidebar.tsx",
    "newContent": "/**\r\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\r\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/MiniSidebar ç»„ä»¶ã€‚\r\n */\r\n\r\nimport React from 'react';\r\nimport Image from 'next/image';\r\nimport { Home, LogOut, Palette } from 'lucide-react';\r\nimport styles from '../styles/shared.module.css';\r\n\r\ninterface MiniSidebarProps {\r\n  avatarUrl: string | null;\r\n  userName: string | null;\r\n  userEmail: string | null;\r\n  onHomeClick: () => void;\r\n  onLogoutClick: () => void;\r\n  onAvatarClick: () => void;\r\n  currentTheme?: string | null;\r\n  onThemeClick: () => void;\r\n}\r\n\r\nconst MiniSidebar: React.FC<MiniSidebarProps> = ({\r\n  avatarUrl,\r\n  userName,\r\n  userEmail,\r\n  onHomeClick,\r\n  onLogoutClick,\r\n  onAvatarClick,\r\n  currentTheme = 'default',\r\n  onThemeClick\r\n}) => {\r\n  return (\r\n    <div className={styles.miniSidebar}>\r\n      <div className={styles.patternOverlay}></div>\r\n      <div className={styles.avatarContainer}>\r\n        <button \r\n          className={styles.miniSidebarButton}\r\n          onClick={onAvatarClick}\r\n        >\r\n          {avatarUrl ? (\r\n            <Image\r\n              src={`${avatarUrl}?t=${Date.now()}`}\r\n              alt=\"ç”¨æˆ·å¤´åƒ\"\r\n              width={38}\r\n              height={38}\r\n              className=\"rounded-full ring-1 ring-white/50 transition-all duration-300 hover:ring-2\"\r\n            />\r\n          ) : (\r\n            <div \r\n              className={styles.avatarPlaceholder}\r\n              style={{ width: '38px', height: '38px', fontSize: '16px' }}\r\n            >\r\n              {userName?.[0]?.toUpperCase() || userEmail?.[0]?.toUpperCase() || '?'}\r\n            </div>\r\n          )}\r\n        </button>\r\n      </div>\r\n      <div className={styles.miniSidebarDivider}></div>\r\n      <button \r\n        className={styles.miniSidebarButton}\r\n        onClick={onHomeClick}\r\n      >\r\n        <Home className=\"w-5 h-5 text-white\" />\r\n      </button>\r\n      \r\n      {/* ä¸»é¢˜é€‰æ‹©æŒ‰é’® */}\r\n      <button \r\n        className={styles.miniSidebarButton}\r\n        onClick={onThemeClick}\r\n        title=\"ä¸»é¢˜è®¾ç½®\"\r\n      >\r\n        <Palette className=\"w-5 h-5 text-white\" />\r\n      </button>\r\n      \r\n      <button \r\n        className={styles.miniSidebarButton}\r\n        onClick={onLogoutClick}\r\n      >\r\n        <LogOut className=\"w-5 h-5 text-white\" />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MiniSidebar; "
  },
  {
    "path": "app\\components\\features\\file-management\\NewFolderForm.tsx",
    "newContent": "/**\r\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\r\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/folderManagement/NewFolderForm ç»„ä»¶ã€‚\r\n */\r\n\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport { Folder, AlertCircle } from 'lucide-react';\r\nimport styles from '../styles/shared.module.css';\r\n\r\ninterface NewFolderFormProps {\r\n  folderName: string;\r\n  setFolderName: (name: string) => void;\r\n  folderTags: string[];\r\n  setFolderTags: (tags: string[]) => void;\r\n  onCreateFolder: () => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst NewFolderForm: React.FC<NewFolderFormProps> = ({\r\n  folderName,\r\n  setFolderName,\r\n  folderTags,\r\n  setFolderTags,\r\n  onCreateFolder,\r\n  onCancel\r\n}) => {\r\n  const [newTag, setNewTag] = useState('');\r\n  const [nameError, setNameError] = useState<string | null>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // æ£€æŸ¥æ–‡ä»¶å¤¹åç§°æ˜¯å¦æœ‰æ•ˆ\r\n  useEffect(() => {\r\n    const trimmedName = folderName.trim();\r\n    \r\n    if (trimmedName === '') {\r\n      setNameError(null); // ç©ºåç§°ä¸æ˜¾ç¤ºé”™è¯¯ï¼Œä½†åˆ›å»ºæŒ‰é’®ä¼šå¤„ç†\r\n      return;\r\n    }\r\n\r\n    // æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦\r\n    const invalidChars = /[\\/\\\\:*?\"<>|]/;\r\n    if (invalidChars.test(trimmedName)) {\r\n      setNameError('æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å«ä¸‹åˆ—å­—ç¬¦: / \\\\ : * ? \" < > |');\r\n      return;\r\n    }\r\n\r\n    setNameError(null);\r\n  }, [folderName]);\r\n\r\n  // å¤„ç†å›è½¦é”®åˆ›å»ºæ–‡ä»¶å¤¹\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !nameError && folderName.trim()) {\r\n      onCreateFolder();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`${styles.newFolderRow} p-4 border border-gray-200 rounded-lg bg-white shadow-sm mb-4`}>\r\n      <div className={`${styles.newFolderForm} flex flex-col space-y-4`}>\r\n        <div className={`flex items-center`}>\r\n          <Folder className=\"w-6 h-6 text-blue-500 flex-shrink-0 mr-3\" />\r\n          <div className={`${styles.newFolderNameContainer} flex-grow relative`}>\r\n            <input\r\n              type=\"text\"\r\n              ref={inputRef}\r\n              className={`${styles.newFolderInput} h-10 px-3 rounded-md border ${nameError ? 'border-red-500' : 'border-gray-300'} w-full text-base`}\r\n              value={folderName}\r\n              onChange={(e) => setFolderName(e.target.value)}\r\n              placeholder=\"æ–°æ–‡ä»¶å¤¹åç§°\"\r\n              autoFocus\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n            {nameError && (\r\n              <div className=\"text-red-500 text-xs mt-1 flex items-center\">\r\n                <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n                <span>{nameError}</span>\r\n              </div>\r\n            )}\r\n            {!nameError && (\r\n              <div className=\"text-gray-500 text-xs mt-1\">\r\n                ç›¸åŒç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåæ–‡ä»¶å¤¹\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className={`${styles.newFolderTagsContainer} ml-9`}>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">æ·»åŠ æ ‡ç­¾</label>\r\n          <div className={`${styles.tagsWrapper} h-10 flex items-center flex-wrap gap-2 border border-gray-300 rounded-md px-3 py-1 overflow-y-auto`}>\r\n            {folderTags.map((tag, index) => (\r\n              <div key={index} className={`${styles.tagItem} h-7 flex items-center bg-blue-100 text-blue-800 px-2 rounded-md`}>\r\n                <span className=\"text-sm\">{tag}</span>\r\n                <button\r\n                  className={`${styles.removeTagButton} ml-1 text-blue-600 hover:text-blue-800 w-5 h-5 flex items-center justify-center rounded-full hover:bg-blue-200`}\r\n                  onClick={() => {\r\n                    const updatedTags = [...folderTags];\r\n                    updatedTags.splice(index, 1);\r\n                    setFolderTags(updatedTags);\r\n                  }}\r\n                >\r\n                  Ã—\r\n                </button>\r\n              </div>\r\n            ))}\r\n            <input\r\n              type=\"text\"\r\n              className={`${styles.tagInput} flex-grow h-7 border-0 outline-none text-sm bg-transparent`}\r\n              value={newTag}\r\n              onChange={(e) => setNewTag(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && newTag.trim()) {\r\n                  setFolderTags([...folderTags, newTag.trim()]);\r\n                  setNewTag('');\r\n                  e.preventDefault();\r\n                }\r\n              }}\r\n              placeholder=\"æ·»åŠ æ ‡ç­¾...\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        <div className={`${styles.newFolderActions} flex items-center gap-3 ml-9`}>\r\n          <button \r\n            className={`${styles.confirmButton} h-10 px-4 ${nameError || !folderName.trim() ? 'bg-blue-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white rounded-md flex items-center justify-center`}\r\n            onClick={onCreateFolder}\r\n            disabled={!!nameError || !folderName.trim()}\r\n          >\r\n            åˆ›å»º\r\n          </button>\r\n          <button \r\n            className={`${styles.cancelButton} h-10 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-md flex items-center justify-center border border-gray-300`}\r\n            onClick={onCancel}\r\n          >\r\n            å–æ¶ˆ\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewFolderForm; "
  },
  {
    "path": "app\\components\\features\\file-management\\RenameModal\\index.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileOperations/RenameModal ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport styles from '@/app/shared/themes/components/renameModal.module.css';\nimport { CloseOutlined, TagOutlined, PlusOutlined } from '@ant-design/icons';\n\ninterface RenameModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onRename: (newName: string, tags?: string[]) => void;\n  initialName: string;\n  initialTags?: string[];\n  fileType: 'file' | 'folder';\n}\n\nconst RenameModal: React.FC<RenameModalProps> = ({\n  isOpen,\n  onClose,\n  onRename,\n  initialName,\n  initialTags = [],\n  fileType\n}) => {\n  const [newName, setNewName] = useState(initialName);\n  const [tags, setTags] = useState<string[]>(initialTags);\n  const [tagInput, setTagInput] = useState('');\n  \n  const inputRef = useRef<HTMLInputElement>(null);\n  const tagInputRef = useRef<HTMLInputElement>(null);\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    setNewName(initialName);\n    // ç¡®ä¿åˆå§‹æ ‡ç­¾ä¸åŒ…å«é‡å¤é¡¹\n    setTags(Array.from(new Set(initialTags)));\n  }, [initialName, initialTags]);\n\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†å¹¶é€‰ä¸­æ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰\n      inputRef.current.focus();\n      \n      const extension = fileType === 'file' ? initialName.lastIndexOf('.') : -1;\n      if (extension !== -1) {\n        inputRef.current.setSelectionRange(0, extension);\n      } else {\n        inputRef.current.select();\n      }\n    }\n  }, [isOpen, initialName, fileType]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (modalRef.current && !modalRef.current.contains(event.target as Node)) {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n    \n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isOpen, onClose]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // é¦–å…ˆç¡®ä¿æ–°åç§°æ˜¯æœ‰æ•ˆçš„éç©ºå­—ç¬¦ä¸²\n    if (newName && typeof newName === 'string' && newName.trim() && \n        (newName !== initialName || JSON.stringify(tags) !== JSON.stringify(initialTags))) {\n      onRename(newName, tags);\n    } else if (!newName || !newName.trim()) {\n      // å¦‚æœåç§°ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä½†ä¸å…³é—­æ¨¡æ€æ¡†\n      return;\n    }\n    onClose();\n  };\n\n  const handleAddTag = () => {\n    if (!tagInput.trim()) return;\n    \n    // é¿å…æ·»åŠ é‡å¤æ ‡ç­¾\n    if (!tags.includes(tagInput.trim())) {\n      setTags([...tags, tagInput.trim()]);\n    }\n    \n    setTagInput('');\n    \n    // æ·»åŠ åè‡ªåŠ¨èšç„¦å›æ ‡ç­¾è¾“å…¥æ¡†\n    setTimeout(() => {\n      if (tagInputRef.current) {\n        tagInputRef.current.focus();\n      }\n    }, 0);\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    setTags(tags.filter(tag => tag !== tagToRemove));\n  };\n\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleAddTag();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className={styles['modal-overlay']}>\n      <div ref={modalRef} className={`${styles['modal-content']} ${styles['rename-modal']}`}>\n        <div className={styles['modal-header']}>\n          <h3 className={styles['modal-title']}>\n            {fileType === 'folder' ? 'é‡å‘½åæ–‡ä»¶å¤¹' : 'é‡å‘½åæ–‡ä»¶'}\n          </h3>\n          <button \n            className={styles['modal-close']} \n            onClick={onClose}\n            aria-label=\"å…³é—­\"\n          >\n            <CloseOutlined />\n          </button>\n        </div>\n        \n        <form className={styles['rename-form']} onSubmit={handleSubmit}>\n          <div className={styles['form-group']}>\n            <label className={styles['form-label']}>åç§°</label>\n            <input\n              ref={inputRef}\n              type=\"text\"\n              className={styles['rename-input']}\n              value={newName}\n              onChange={(e) => setNewName(e.target.value)}\n              placeholder=\"è¾“å…¥æ–°åç§°\"\n              autoFocus\n            />\n          </div>\n          \n          <div className={styles['form-group']}>\n            <label className={styles['form-label']}>æ ‡ç­¾</label>\n            <div className={styles['tags-container']}>\n              {tags.map((tag, index) => (\n                <div key={index} className={styles['tag']}>\n                  <span>{tag}</span>\n                  <button \n                    type=\"button\"\n                    className={styles['tag-remove']}\n                    onClick={() => handleRemoveTag(tag)}\n                  >\n                    &times;\n                  </button>\n                </div>\n              ))}\n            </div>\n            <div className={styles['tag-input-container']}>\n              <TagOutlined className={styles['tag-icon']} />\n              <input\n                ref={tagInputRef}\n                type=\"text\"\n                className={styles['tag-input']}\n                value={tagInput}\n                onChange={(e) => setTagInput(e.target.value)}\n                onKeyDown={handleTagInputKeyDown}\n                placeholder=\"è¾“å…¥æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ \"\n              />\n              <button\n                type=\"button\"\n                className={styles['tag-add-button']}\n                onClick={handleAddTag}\n                disabled={!tagInput.trim()}\n              >\n                <PlusOutlined />\n              </button>\n            </div>\n          </div>\n\n          <div className={styles['modal-footer']}>\n            <button \n              type=\"button\" \n              className={`${styles['modal-button']} ${styles.cancel}`}\n              onClick={onClose}\n            >\n              å–æ¶ˆ\n            </button>\n            <button \n              type=\"submit\" \n              className={`${styles['modal-button']} ${styles.confirm}`}\n              disabled={!newName.trim() || (newName === initialName && JSON.stringify(tags) === JSON.stringify(initialTags))}\n            >\n              ç¡®è®¤\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default RenameModal; "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\Breadcrumb.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Breadcrumb ç»„ä»¶ã€‚\n */\n\nimport React from 'react';\nimport { Home, ChevronRight, ChevronLeft } from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\nimport { FolderPathItem } from '@/app/types';\n\ninterface BreadcrumbProps {\n  folderPath: FolderPathItem[];\n  showHome?: boolean;\n  onNavigate?: (folderId: string | null) => void;\n  onPathClick: (folderId: string | null) => void;\n  onBackClick?: () => void;\n}\n\nexport function Breadcrumb({ \n  folderPath, \n  showHome = true, \n  onNavigate, \n  onPathClick,\n  onBackClick\n}: BreadcrumbProps) {\n  // å‘ä¸‹å…¼å®¹ï¼šå¦‚æœæœ‰onNavigateä½†æ²¡æœ‰onPathClickï¼Œå°±ä½¿ç”¨onNavigate\n  const handlePathClick = onPathClick || onNavigate;\n\n  if (!handlePathClick) {\n    console.error('Breadcrumbç»„ä»¶ç¼ºå°‘å¿…è¦çš„onPathClickæˆ–onNavigateå›è°ƒå‡½æ•°');\n    return null;\n  }\n\n  return (\n    <div className={styles.breadcrumb}>\n      {onBackClick && folderPath.length > 0 && (\n        <button \n          className={styles.breadcrumbBackButton}\n          onClick={onBackClick}\n          title=\"è¿”å›ä¸Šä¸€çº§\"\n        >\n          <ChevronLeft size={16} />\n        </button>\n      )}\n      \n      {showHome && (\n        <div className={styles.breadcrumbItem}>\n          <button\n            className={styles.breadcrumbLink}\n            onClick={() => handlePathClick(null)}\n          >\n            <Home size={16} className={styles.breadcrumbIcon} />\n            æ ¹ç›®å½•\n          </button>\n        </div>\n      )}\n      \n      {folderPath.map((folder) => (\n        <React.Fragment key={folder.id}>\n          <span className={styles.breadcrumbSeparator}>\n            <ChevronRight size={14} />\n          </span>\n          <div className={styles.breadcrumbItem}>\n            <button\n              className={styles.breadcrumbLink}\n              onClick={() => handlePathClick(folder.id)}\n            >\n              {folder.name}\n            </button>\n          </div>\n        </React.Fragment>\n      ))}\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\ErrorDisplay.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/ErrorDisplay ç»„ä»¶ã€‚\n */\n\n'use client';\n\nimport React from 'react';\nimport { AlertTriangle, RefreshCw, Wifi, Server, CloudOff } from 'lucide-react';\nimport styles from '../../../../file-management/styles/shared.module.css';\n\ninterface ErrorDisplayProps {\n  title?: string;\n  message?: string;\n  errorType?: 'network' | 'auth' | 'server' | 'data' | 'timeout' | 'unknown';\n  onRetry?: () => void;\n  retryText?: string;\n}\n\n/**\n * æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼Œæ”¯æŒä¸åŒç±»å‹çš„é”™è¯¯\n */\nexport const ErrorDisplay: React.FC<ErrorDisplayProps> = ({\n  title,\n  message = 'è¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜',\n  errorType = 'unknown',\n  onRetry,\n  retryText = 'é‡è¯•'\n}) => {\n  // æ ¹æ®é”™è¯¯ç±»å‹è·å–å›¾æ ‡å’Œæ ‡é¢˜\n  const getErrorInfo = () => {\n    switch (errorType) {\n      case 'network':\n        return {\n          icon: <Wifi className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'ç½‘ç»œè¿æ¥é”™è¯¯'\n        };\n      case 'auth':\n        return {\n          icon: <AlertTriangle className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'èº«ä»½éªŒè¯å¤±è´¥'\n        };\n      case 'server':\n        return {\n          icon: <Server className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'æœåŠ¡å™¨é”™è¯¯'\n        };\n      case 'data':\n        return {\n          icon: <CloudOff className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'æ•°æ®åŠ è½½å¤±è´¥'\n        };\n      case 'timeout':\n        return {\n          icon: <AlertTriangle className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'è¯·æ±‚è¶…æ—¶'\n        };\n      default:\n        return {\n          icon: <AlertTriangle className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'åŠ è½½å‡ºé”™'\n        };\n    }\n  };\n\n  const { icon, defaultTitle } = getErrorInfo();\n  const displayTitle = title || defaultTitle;\n\n  return (\n    <div className={styles.errorContainer}>\n      <div className={styles.errorCard}>\n        <div className={styles.errorIcon}>\n          {icon}\n        </div>\n        <h3 className={styles.errorTitle}>{displayTitle}</h3>\n        <p className={styles.errorText}>{message}</p>\n        {onRetry && (\n          <button \n            className={styles.retryButton}\n            onClick={onRetry}\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n            {retryText}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}; "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\FileList.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileList/FileList ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { \n  File as FileIcon, \n  Folder, \n  Image as ImageIcon, \n  FileText, \n  Video, \n  Music, \n  MoreVertical,\n  Tag as TagIcon,\n  SearchX,\n  Filter,\n  Check,\n  X,\n  Plus\n} from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\nimport { getFileType as getFileTypeDisplay } from '@/app/utils/file/type';\nimport { getFileNameAndExtension } from '@/app/utils/file/path';\nimport { FileInfo } from '@/app/types';\n\ninterface FileListProps {\n  files: FileInfo[];\n  selectedFiles: string[];\n  onFileClick: (file: FileInfo) => void;\n  onFileDoubleClick?: (file: FileInfo) => void;\n  onFileContextMenu?: (event: React.MouseEvent, file: FileInfo) => void;\n  onSelectFiles?: (fileIds: string[]) => void;\n  onFileSelect?: (file: FileInfo, checked: boolean) => void;\n  onSelectAll?: () => void;\n  onDeselectAll?: () => void;\n  onSelectAllFiles?: () => void;\n  onDeselectAllFiles?: () => void;\n  fileTypeFilter?: string | null;\n  isLoading?: boolean;\n  error?: string | null;\n  onBackClick?: () => void;\n  editingFileId?: string | null;\n  editingFile?: string | null;\n  editingName?: string;\n  editingTags?: string[];\n  newTag?: string;\n  onNewTagChange?: (value: string) => void;\n  onEditNameChange?: (value: string) => void;\n  onStartEdit?: (file: FileInfo) => void;\n  onConfirmEdit?: (fileId: string, newName: string, newTags: string[]) => void;\n  onCancelEdit?: () => void;\n  onAddTag?: (tag: string) => void;\n  onRemoveTag?: (tag: string) => void;\n  showCheckboxes?: boolean;\n  areAllSelected?: boolean;\n}\n\nexport function FileList({\n  files,\n  selectedFiles,\n  onFileClick,\n  onFileDoubleClick,\n  onFileContextMenu,\n  onSelectFiles,\n  onFileSelect,\n  onSelectAll,\n  onDeselectAll,\n  onSelectAllFiles,\n  onDeselectAllFiles,\n  fileTypeFilter,\n  isLoading,\n  error,\n  onBackClick,\n  editingFileId,\n  editingFile,\n  editingName: providedEditingName,\n  editingTags: providedEditingTags,\n  newTag: providedNewTag,\n  onNewTagChange,\n  onEditNameChange,\n  onStartEdit,\n  onConfirmEdit,\n  onCancelEdit,\n  onAddTag,\n  onRemoveTag,\n  showCheckboxes = true,\n  areAllSelected\n}: FileListProps) {\n  const actualEditingFileId = editingFileId || editingFile;\n\n  const [localEditName, setLocalEditName] = useState<string>('');\n  const [localEditTags, setLocalEditTags] = useState<string[]>([]);\n  const [localNewTag, setLocalNewTag] = useState<string>('');\n  \n  const editName = providedEditingName !== undefined ? providedEditingName : localEditName;\n  const editTags = providedEditingTags !== undefined ? providedEditingTags : localEditTags;\n  const newTagValue = providedNewTag !== undefined ? providedNewTag : localNewTag;\n  \n  const setEditName = (value: string) => {\n    if (onEditNameChange) {\n      onEditNameChange(value);\n    } else {\n      setLocalEditName(value);\n    }\n  };\n  \n  const setEditTags = (tags: string[]) => {\n    setLocalEditTags(tags);\n  };\n  \n  const setNewTag = (value: string) => {\n    if (onNewTagChange) {\n      onNewTagChange(value);\n    } else {\n      setLocalNewTag(value);\n    }\n  };\n\n  const editNameInputRef = useRef<HTMLInputElement>(null);\n  const newTagInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (actualEditingFileId && providedEditingName === undefined) {\n      const file = files.find(f => f.id === actualEditingFileId);\n      if (file) {\n        setLocalEditName(file.name);\n        setLocalEditTags(file.tags || []);\n      }\n    }\n    \n    if (actualEditingFileId) {\n      setTimeout(() => {\n        if (editNameInputRef.current) {\n          editNameInputRef.current.focus();\n          editNameInputRef.current.select();\n        }\n      }, 0);\n    }\n  }, [actualEditingFileId, files, providedEditingName]);\n\n  const handleEditKeyDown = (e: React.KeyboardEvent, fileId: string) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      onConfirmEdit && onConfirmEdit(fileId, editName, editTags);\n    } else if (e.key === 'Escape') {\n      e.preventDefault();\n      onCancelEdit && onCancelEdit();\n    }\n  };\n\n  const handleAddTag = () => {\n    const trimmedTag = newTagValue.trim();\n    if (!trimmedTag) return;\n    \n    if (!editTags.includes(trimmedTag)) {\n      if (onAddTag) {\n        onAddTag(trimmedTag);\n      } else {\n        setEditTags([...editTags, trimmedTag]);\n      }\n      setNewTag('');\n      \n      setTimeout(() => {\n        if (newTagInputRef.current) {\n          newTagInputRef.current.focus();\n        }\n      }, 0);\n    }\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    if (onRemoveTag) {\n      onRemoveTag(tagToRemove);\n    } else {\n      setEditTags(editTags.filter(tag => tag !== tagToRemove));\n    }\n  };\n\n  const handleTagKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleAddTag();\n    }\n  };\n\n  const handleFileCheckboxChange = (file: FileInfo, checked: boolean) => {\n    if (onFileSelect) {\n      onFileSelect(file, checked);\n      return;\n    }\n    \n    if (onSelectFiles) {\n      if (checked) {\n        onSelectFiles([...selectedFiles, file.id]);\n      } else {\n        onSelectFiles(selectedFiles.filter(id => id !== file.id));\n      }\n    } else {\n      console.error('FileList: ç¼ºå°‘å¿…è¦çš„onSelectFilesæˆ–onFileSelectå›è°ƒå‡½æ•°');\n    }\n  };\n\n  const handleSelectAll = onSelectAll || onSelectAllFiles;\n  const handleDeselectAll = onDeselectAll || onDeselectAllFiles;\n\n  const renderFileIcon = (type?: string, extension?: string, isFolder?: boolean) => {\n    if (isFolder) return <Folder className={styles.fileIcon} />;\n    \n    const getFileIconType = () => {\n      if (!type) return 'file';\n      \n      if (type.includes('image')) return 'image';\n      if (type.includes('text') || type.includes('document') || extension?.match(/docx?|pdf|txt|md/i)) return 'file-text';\n      if (type.includes('video')) return 'video';\n      if (type.includes('audio')) return 'music';\n      if (extension?.match(/zip|rar|7z|tar|gz/i)) return 'archive';\n      if (extension?.match(/js|ts|jsx|tsx|py|java|c|cpp|go|rb|php|html|css/i)) return 'code';\n      \n      return 'file';\n    };\n    \n    const iconType = getFileIconType();\n    const IconComponent = {\n      'folder': Folder,\n      'file': FileIcon,\n      'image': ImageIcon,\n      'file-text': FileText,\n      'video': Video,\n      'music': Music,\n      'archive': FileIcon,\n      'code': FileIcon\n    }[iconType] || FileIcon;\n\n    return <IconComponent className={styles.fileIcon} />;\n  };\n\n  const renderTags = (file: FileInfo) => {\n    const tags = file.tags || [];\n    \n    if (actualEditingFileId === file.id) {\n      return (\n        <div className={styles.tagEditContainer}>\n          <div className={styles.editTagsList}>\n            {editTags.map((tag, index) => (\n              <div key={index} className={styles.editTag}>\n                <span>{tag}</span>\n                <button \n                  className={styles.removeTagButton}\n                  onClick={() => handleRemoveTag(tag)}\n                >\n                  <X size={12} />\n                </button>\n              </div>\n            ))}\n          </div>\n          <div className={styles.addTagInput}>\n            <input\n              ref={newTagInputRef}\n              type=\"text\"\n              placeholder=\"æ·»åŠ æ ‡ç­¾...\"\n              value={localNewTag}\n              onChange={(e) => setNewTag(e.target.value)}\n              onKeyDown={handleTagKeyDown}\n              className={styles.tagInput}\n            />\n            <button \n              className={styles.addTagButton}\n              onClick={handleAddTag}\n            >\n              <Plus size={14} />\n            </button>\n          </div>\n        </div>\n      );\n    }\n    \n    if (!tags || tags.length === 0) return <span className={styles.emptyText}>-</span>;\n    \n    const maxTagsToShow = 3;\n    const visibleTags = tags.slice(0, maxTagsToShow);\n    const extraTagsCount = tags.length - maxTagsToShow;\n    \n    return (\n      <div className={styles.tagContainer}>\n        {visibleTags.map((tag, index) => (\n          <span key={index} className={styles.tag}>\n            {tag}\n          </span>\n        ))}\n        {extraTagsCount > 0 && (\n          <span className={styles.extraTagsCount}>+{extraTagsCount}</span>\n        )}\n      </div>\n    );\n  };\n\n  const isAllSelected = areAllSelected !== undefined \n    ? areAllSelected \n    : (files.length > 0 && selectedFiles.length === files.length);\n\n  if (!Array.isArray(files) || files.length === 0) {\n    const getEmptyStateMessage = () => {\n      if (fileTypeFilter) {\n        switch(fileTypeFilter) {\n          case 'image':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶`;\n          case 'document':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡æ¡£æ–‡ä»¶`;\n          case 'video':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°è§†é¢‘æ–‡ä»¶`;\n          case 'audio':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶`;\n          case 'other':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å…¶ä»–ç±»å‹çš„æ–‡ä»¶`;\n          default:\n            return `æ²¡æœ‰æ‰¾åˆ°${fileTypeFilter}ç±»å‹çš„æ–‡ä»¶`;\n        }\n      }\n      return 'æ²¡æœ‰æ–‡ä»¶';\n    };\n\n    const getEmptyStateIcon = () => {\n      if (fileTypeFilter) {\n        return <Filter size={50} stroke=\"#CBD5E0\" />;\n      }\n      return <FileIcon size={50} stroke=\"#CBD5E0\" />;\n    };\n\n    const getEmptyStateHint = () => {\n      if (fileTypeFilter) {\n        return `ç³»ç»Ÿå·²æœç´¢æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œæœªæ‰¾åˆ°${\n          fileTypeFilter === 'image' ? 'å›¾ç‰‡' : \n          fileTypeFilter === 'document' ? 'æ–‡æ¡£' : \n          fileTypeFilter === 'video' ? 'è§†é¢‘' :\n          fileTypeFilter === 'audio' ? 'éŸ³é¢‘' : 'è¯¥ç±»å‹'\n        }æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä¸Šä¼ ä¸€äº›ï¼Œæˆ–é€‰æ‹©å…¶ä»–æ–‡ä»¶ç±»å‹æŸ¥çœ‹ã€‚`;\n      }\n      return 'ä¸Šä¼ æ–‡ä»¶æˆ–åˆ›å»ºæ–‡ä»¶å¤¹ä»¥å¼€å§‹ç®¡ç†æ‚¨çš„æ–‡ä»¶';\n    };\n\n    return (\n      <div className={styles.emptyState}>\n        {getEmptyStateIcon()}\n        <p className={styles.emptyStateText}>{getEmptyStateMessage()}</p>\n        <p className={styles.emptyStateHint}>\n          {getEmptyStateHint()}\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className={styles.fileListWrapper}>\n      <div className={styles.fileListContainer}>\n        <table className={styles.fileTable}>\n          <thead>\n            <tr>\n              <th>\n                <input\n                  type=\"checkbox\"\n                  checked={isAllSelected}\n                  onChange={isAllSelected ? \n                    () => handleDeselectAll && handleDeselectAll() : \n                    () => handleSelectAll && handleSelectAll()}\n                  disabled={!showCheckboxes}\n                />\n              </th>\n              <th>åç§°</th>\n              <th>ç±»å‹</th>\n              <th>å¤§å°</th>\n              <th>æ ‡ç­¾</th>\n              <th>ä¿®æ”¹æ—¥æœŸ</th>\n              <th>æ“ä½œ</th>\n            </tr>\n          </thead>\n          <tbody>\n            {files.map((file) => {\n              const isSelected = selectedFiles.includes(file.id);\n              const isEditing = actualEditingFileId === file.id;\n              \n              return (\n                <tr\n                  key={file.id}\n                  className={`${styles.fileRow} ${isSelected ? styles.selectedRow : ''} ${isEditing ? styles.editingRow : ''}`}\n                  onClick={() => !isEditing && onFileClick(file)}\n                  onDoubleClick={() => {\n                    if (!isEditing && onStartEdit && !file.isFolder) {\n                      onStartEdit(file);\n                    } else if (!isEditing && onFileDoubleClick) {\n                      onFileDoubleClick(file);\n                    }\n                  }}\n                  onContextMenu={(e) => !isEditing && onFileContextMenu && onFileContextMenu(e, file)}\n                >\n                  <td>\n                    {showCheckboxes && (\n                      <input\n                        type=\"checkbox\"\n                        checked={isSelected}\n                        onChange={(e) => handleFileCheckboxChange(file, e.target.checked)}\n                        onClick={(e) => e.stopPropagation()}\n                        disabled={isEditing}\n                      />\n                    )}\n                  </td>\n                  <td className={styles.fileNameCell}>\n                    <span className={styles.fileIcon}>\n                      {renderFileIcon(file.type, file.extension, file.isFolder)}\n                    </span>\n                    {isEditing ? (\n                      <input\n                        ref={editNameInputRef}\n                        type=\"text\"\n                        className={styles.fileNameInput}\n                        value={editName}\n                        onChange={(e) => setEditName(e.target.value)}\n                        onKeyDown={(e) => handleEditKeyDown(e, file.id)}\n                        onClick={(e) => e.stopPropagation()}\n                        autoComplete=\"off\"\n                      />\n                    ) : (\n                      <span className={styles.fileName}>{file.name}</span>\n                    )}\n                    {isEditing && (\n                      <div className={styles.editActions}>\n                        <button \n                          className={styles.editActionButton}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onConfirmEdit && onConfirmEdit(file.id, editName, editTags);\n                          }}\n                        >\n                          <Check size={16} />\n                        </button>\n                        <button \n                          className={styles.editActionButton}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onCancelEdit && onCancelEdit();\n                          }}\n                        >\n                          <X size={16} />\n                        </button>\n                      </div>\n                    )}\n                  </td>\n                  <td>{file.isFolder ? 'æ–‡ä»¶å¤¹' : \n                     file.type === 'document' ? 'æ–‡æ¡£' : \n                     getFileTypeDisplay(file.type || null, file.extension)}</td>\n                  <td>{file.size ? `${Math.round(file.size / 1024)} KB` : '-'}</td>\n                  <td className={styles.tagsCell}>{renderTags(file)}</td>\n                  <td>\n                    {file.createdAt \n                      ? new Date(file.createdAt).toLocaleString() \n                      : '-'\n                    }\n                  </td>\n                  <td>\n                    {!isEditing ? (\n                      <button \n                        className={styles.actionButton}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          if (onStartEdit) {\n                            onStartEdit(file);\n                          } else if (onFileContextMenu) {\n                            onFileContextMenu(e, file);\n                          }\n                        }}\n                      >\n                        <MoreVertical size={16} />\n                      </button>\n                    ) : (\n                      <span className={styles.editingMessage}>ç¼–è¾‘ä¸­</span>\n                    )}\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}"
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\index.ts",
    "newContent": "export * from './Sidebar';\nexport * from './Breadcrumb';\nexport * from './FileList';\n// export * from './UploadModal'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadModal\n// export * from './UploadButton'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadButton\nexport * from './Skeleton';\nexport * from './ErrorDisplay'; "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\Sidebar.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Sidebar ç»„ä»¶ã€‚\n */\n\nimport React, { useEffect } from 'react';\nimport { \n  Folder, Files, Image as ImageIcon, FileText, \n  Video, Music, File, Search, ChevronDown, \n  Star, Clock, Tag, Download, Settings,\n  CheckCircle\n} from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\n\nexport type FileType = 'image' | 'document' | 'video' | 'audio' | 'other' | null;\n\ninterface SidebarProps {\n  selectedFileType: FileType;\n  onTypeClick: (type: FileType) => void;\n  onSearchClick?: () => void;\n}\n\nexport function Sidebar({ selectedFileType, onTypeClick, onSearchClick }: SidebarProps) {\n  const fileTypes: { type: FileType; label: string; icon: React.ElementType }[] = [\n    { type: null, label: 'å…¨éƒ¨æ–‡ä»¶', icon: Files },\n    { type: 'image', label: 'å›¾ç‰‡', icon: ImageIcon },\n    { type: 'document', label: 'æ–‡æ¡£', icon: FileText },\n    { type: 'video', label: 'è§†é¢‘', icon: Video },\n    { type: 'audio', label: 'éŸ³é¢‘', icon: Music },\n    { type: 'other', label: 'å…¶ä»–', icon: File }\n  ];\n\n  const [quickAccessExpanded, setQuickAccessExpanded] = React.useState(true);\n  const [myFilesExpanded, setMyFilesExpanded] = React.useState(true);\n  const [settingsExpanded, setSettingsExpanded] = React.useState(false);\n\n  // ç›‘å¬æ–‡ä»¶ç±»å‹å˜åŒ–å¹¶è®°å½•æ—¥å¿—\n  useEffect(() => {\n    console.log('ä¾§è¾¹æ ï¼šå½“å‰é€‰æ‹©çš„æ–‡ä»¶ç±»å‹:', selectedFileType);\n  }, [selectedFileType]);\n\n  const handleTypeClick = (type: FileType) => {\n    // ç›´æ¥è°ƒç”¨å›è°ƒï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–é€»è¾‘\n    console.log('Sidebarç›´æ¥ç‚¹å‡»ç±»å‹:', type);\n    onTypeClick(type);\n  };\n\n  return (\n    <div className={styles.sidebar}>\n      <div className={styles.sidebarSection}>\n        <div \n          className={styles.sidebarHeader} \n          onClick={() => setMyFilesExpanded(!myFilesExpanded)}\n        >\n          <Folder className={styles.icon} />\n          æˆ‘çš„æ–‡ä»¶\n          <ChevronDown \n            className={styles.icon} \n            style={{ \n              marginLeft: 'auto', \n              transform: myFilesExpanded ? 'rotate(180deg)' : 'rotate(0)', \n              transition: 'transform 0.3s' \n            }} \n            size={16} \n          />\n        </div>\n        {myFilesExpanded && (\n          <div className={styles.sidebarSubmenu}>\n            {fileTypes.map(({ type, label, icon: Icon }) => (\n              <div\n                key={type || 'all'}\n                className={`${styles.sidebarItem} ${selectedFileType === type ? styles.active : ''}`}\n                onClick={() => handleTypeClick(type)}\n              >\n                <Icon className={styles.icon} />\n                {label}\n                {selectedFileType === type && (\n                  <CheckCircle \n                    className={styles.icon} \n                    style={{ \n                      marginLeft: 'auto', \n                      color: 'var(--theme-primary, #3b82f6)',\n                      fill: 'var(--theme-primary, #3b82f6)',\n                      stroke: '#fff',\n                      opacity: 0.9,\n                    }} \n                    size={16} \n                  />\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div className={styles.sidebarSection}>\n        <div \n          className={styles.sidebarHeader}\n          onClick={() => setQuickAccessExpanded(!quickAccessExpanded)}\n        >\n          <Search className={styles.icon} />\n          å¿«æ·æŸ¥è¯¢\n          <ChevronDown \n            className={styles.icon} \n            style={{ \n              marginLeft: 'auto', \n              transform: quickAccessExpanded ? 'rotate(180deg)' : 'rotate(0)', \n              transition: 'transform 0.3s' \n            }} \n            size={16} \n          />\n        </div>\n        {quickAccessExpanded && (\n          <div className={styles.sidebarSubmenu}>\n            <div \n              className={styles.sidebarItem}\n              onClick={onSearchClick}\n            >\n              <Search className={styles.icon} />\n              æœç´¢æ–‡ä»¶\n            </div>\n            <div className={styles.sidebarItem}>\n              <Star className={styles.icon} />\n              æ”¶è—æ–‡ä»¶\n            </div>\n            <div className={styles.sidebarItem}>\n              <Clock className={styles.icon} />\n              æœ€è¿‘è®¿é—®\n            </div>\n            <div className={styles.sidebarItem}>\n              <Tag className={styles.icon} />\n              æŒ‰æ ‡ç­¾æŸ¥æ‰¾\n            </div>\n            <div className={styles.sidebarItem}>\n              <Download className={styles.icon} />\n              ä¸‹è½½è®°å½•\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className={styles.sidebarSection}>\n        <div \n          className={styles.sidebarHeader}\n          onClick={() => setSettingsExpanded(!settingsExpanded)}\n        >\n          <Settings className={styles.icon} />\n          ç³»ç»Ÿè®¾ç½®\n          <ChevronDown \n            className={styles.icon} \n            style={{ \n              marginLeft: 'auto', \n              transform: settingsExpanded ? 'rotate(180deg)' : 'rotate(0)', \n              transition: 'transform 0.3s' \n            }} \n            size={16} \n          />\n        </div>\n        {settingsExpanded && (\n          <div className={styles.sidebarSubmenu}>\n            <div className={styles.sidebarItem}>\n              <Settings className={styles.icon} />\n              å­˜å‚¨ç®¡ç†\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\Skeleton.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/Skeleton ç»„ä»¶ã€‚\n */\n\n'use client';\n\nimport React from 'react';\nimport styles from './Skeleton.module.css';\n\ninterface SkeletonProps {\n  variant?: 'sidebar' | 'file' | 'avatar' | 'text' | 'button' | 'card';\n  width?: string | number;\n  height?: string | number;\n  animation?: 'pulse' | 'wave' | 'none';\n  count?: number;\n  className?: string;\n  borderRadius?: string;\n}\n\nexport const Skeleton: React.FC<SkeletonProps> = ({ \n  variant = 'text', \n  width, \n  height, \n  animation = 'pulse',\n  count = 1,\n  className = '',\n  borderRadius\n}) => {\n  const getVariantStyles = () => {\n    switch (variant) {\n      case 'sidebar':\n        return {\n          width: width || '100%',\n          height: height || '40px',\n          borderRadius: borderRadius || '8px'\n        };\n      case 'file':\n        return {\n          width: width || '100%',\n          height: height || '56px',\n          borderRadius: borderRadius || '8px'\n        };\n      case 'avatar':\n        return {\n          width: width || '40px',\n          height: height || '40px',\n          borderRadius: borderRadius || '50%'\n        };\n      case 'text':\n        return {\n          width: width || '100%',\n          height: height || '16px',\n          borderRadius: borderRadius || '4px'\n        };\n      case 'button':\n        return {\n          width: width || '120px',\n          height: height || '36px',\n          borderRadius: borderRadius || '6px'\n        };\n      case 'card':\n        return {\n          width: width || '100%',\n          height: height || '200px',\n          borderRadius: borderRadius || '12px'\n        };\n      default:\n        return {\n          width: width || '100%',\n          height: height || '16px',\n          borderRadius: borderRadius || '4px'\n        };\n    }\n  };\n\n  const renderSkeleton = () => {\n    const items = [];\n    const baseStyles = getVariantStyles();\n    \n    for (let i = 0; i < count; i++) {\n      items.push(\n        <div \n          key={i}\n          className={`${styles.skeleton} ${styles[`animation-${animation}`]} ${className}`}\n          style={{\n            ...baseStyles,\n            marginBottom: count > 1 && i < count - 1 ? '8px' : '0'\n          }}\n        />\n      );\n    }\n    \n    return items;\n  };\n\n  return <>{renderSkeleton()}</>;\n};\n\nexport const SkeletonFileList: React.FC = () => {\n  return (\n    <div className={styles.fileListSkeleton}>\n      <div className={styles.fileListHeader}>\n        <Skeleton variant=\"text\" width=\"15%\" height=\"24px\" />\n        <div className={styles.headerActions}>\n          <Skeleton variant=\"button\" width=\"100px\" />\n          <Skeleton variant=\"button\" width=\"100px\" />\n        </div>\n      </div>\n      \n      <div className={styles.fileItems}>\n        {[...Array(8)].map((_, index) => (\n          <div key={index} className={styles.fileItemSkeleton}>\n            <div className={styles.fileIcon}>\n              <Skeleton variant=\"avatar\" width=\"32px\" height=\"32px\" borderRadius=\"6px\" />\n            </div>\n            <div className={styles.fileDetails}>\n              <Skeleton variant=\"text\" width=\"60%\" height=\"18px\" />\n              <Skeleton variant=\"text\" width=\"40%\" height=\"14px\" />\n            </div>\n            <div className={styles.fileActions}>\n              <Skeleton variant=\"button\" width=\"70px\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport const SkeletonSidebar: React.FC = () => {\n  return (\n    <div className={styles.sidebarSkeleton}>\n      <div className={styles.sidebarHeader}>\n        <Skeleton variant=\"text\" width=\"70%\" height=\"24px\" />\n      </div>\n      <div className={styles.sidebarContent}>\n        <Skeleton variant=\"sidebar\" count={5} />\n        <div className={styles.sidebarSection}>\n          <Skeleton variant=\"text\" width=\"50%\" height=\"18px\" />\n          <Skeleton variant=\"sidebar\" count={3} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const SkeletonPageLayout: React.FC = () => {\n  return (\n    <div className={styles.pageLayoutSkeleton}>\n      <div className={styles.miniSidebarSkeleton}>\n        <Skeleton variant=\"avatar\" width=\"40px\" height=\"40px\" />\n        <Skeleton variant=\"button\" width=\"40px\" height=\"40px\" borderRadius=\"12px\" />\n        <Skeleton variant=\"button\" width=\"40px\" height=\"40px\" borderRadius=\"12px\" />\n      </div>\n      \n      <div className={styles.sidebarContainerSkeleton}>\n        <SkeletonSidebar />\n      </div>\n      \n      <div className={styles.mainContentSkeleton}>\n        <div className={styles.topBarSkeleton}>\n          <div className={styles.breadcrumbSkeleton}>\n            <Skeleton variant=\"text\" width=\"180px\" height=\"20px\" />\n          </div>\n          <div className={styles.actionButtonsSkeleton}>\n            <Skeleton variant=\"button\" width=\"100px\" />\n            <Skeleton variant=\"button\" width=\"100px\" />\n          </div>\n        </div>\n        \n        <SkeletonFileList />\n      </div>\n    </div>\n  );\n}; "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\UploadButton.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadButton ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Upload, Folder, ChevronDown } from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\nimport { UploadModal } from './UploadModal';\n\ninterface UploadButtonProps {\n  showDropdown: boolean;\n  setShowDropdown: (show: boolean) => void;\n  setIsModalOpen: (open: boolean) => void;\n  setIsFolderModalOpen: (open: boolean) => void;\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\n}\n\nexport function UploadButton({ \n  showDropdown, \n  setShowDropdown, \n  setIsModalOpen, \n  setIsFolderModalOpen,\n  uploadDropdownRef \n}: UploadButtonProps) {\n  \n  // å¤„ç†ä¸Šä¼ æŒ‰é’®ç‚¹å‡»\n  const handleUploadClick = (type: 'file' | 'folder') => {\n    if (type === 'file') {\n      setIsModalOpen(true);\n    } else {\n      setIsFolderModalOpen(true);\n    }\n    setShowDropdown(false);\n  };\n\n  return (\n    <div className={styles.uploadOptionsContainer} ref={uploadDropdownRef}>\n      <button\n        className={`${styles.uploadButton} ${showDropdown ? styles.activeButton : ''}`}\n        onClick={() => setShowDropdown(!showDropdown)}\n      >\n        <Upload size={18} className={styles.buttonIcon} />\n        ä¸Šä¼ æ–‡ä»¶\n        <ChevronDown size={16} className={styles.dropdownIcon} />\n      </button>\n      \n      {showDropdown && (\n        <div className={styles.dropdownMenu}>\n          <div \n            className={styles.dropdownItem}\n            onClick={() => handleUploadClick('file')}\n          >\n            <Upload size={16} className=\"mr-2\" />\n            <span>ä¸Šä¼ æ–‡ä»¶</span>\n          </div>\n          <div \n            className={styles.dropdownItem}\n            onClick={() => handleUploadClick('folder')}\n          >\n            <Folder size={16} className=\"mr-2\" />\n            <span>ä¸Šä¼ æ–‡ä»¶å¤¹</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\file-management\\shared\\UploadModal.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadModal ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useEffect, useRef, KeyboardEvent } from 'react';\nimport { InboxOutlined, CloseCircleOutlined, TagOutlined, CloseOutlined } from '@ant-design/icons';\nimport { Modal, Upload, Input, message, Button, Tag } from 'antd';\nimport type { RcFile, UploadFile } from 'antd/es/upload/interface';\nimport type { UploadProps } from 'antd';\nimport type { InputRef } from 'antd/es/input';\nimport { FileInfo, FileResponse } from '@/app/types';\nimport styles from '../../styles/shared.module.css';\nimport { useSession } from 'next-auth/react';\nimport { API_PATHS } from '@/app/lib/api/paths';\n\nconst { Dragger } = Upload;\n\ninterface UploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: (files?: FileInfo[]) => void;\n  isFolderUpload?: boolean;\n  currentFolderId?: string | null;\n}\n\n// æ‰©å±•UploadFileç±»å‹ï¼Œæ·»åŠ webkitRelativePathå±æ€§\ninterface ExtendedUploadFile extends UploadFile<any> {\n  webkitRelativePath?: string;\n}\n\nexport function UploadModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  isFolderUpload = false,\n  currentFolderId\n}: UploadModalProps) {\n  const [fileList, setFileList] = useState<ExtendedUploadFile[]>([]);\n  const [tagInput, setTagInput] = useState<string>('');\n  const [tagList, setTagList] = useState<string[]>([]);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const tagInputRef = useRef<InputRef>(null);\n  const { data: session } = useSession();\n\n  useEffect(() => {\n    // å½“æ¨¡æ€æ¡†æ‰“å¼€æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€\n    if (isOpen && !session) {\n      message.error('è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶');\n      onClose();\n    }\n  }, [isOpen, session, onClose]);\n\n  // å¤„ç†æ–‡ä»¶é€‰æ‹©\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFiles = e.target.files;\n    if (!selectedFiles || selectedFiles.length === 0) return;\n\n    const newFiles: ExtendedUploadFile[] = [];\n    for (let i = 0; i < selectedFiles.length; i++) {\n      const file = selectedFiles[i];\n      newFiles.push({\n        uid: `file-${Date.now()}-${i}`,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        originFileObj: file as any,\n        webkitRelativePath: file.webkitRelativePath, // æ·»åŠ ç›¸å¯¹è·¯å¾„\n      });\n    }\n\n    setFileList(prev => [...prev, ...newFiles]);\n    \n    // æ¸…ç©ºinputä»¥å…è®¸å†æ¬¡é€‰æ‹©ç›¸åŒçš„æ–‡ä»¶\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // å¤„ç†æ ‡ç­¾è¾“å…¥\n  const handleTagInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setTagInput(e.target.value);\n  };\n\n  // å¤„ç†æ ‡ç­¾è¾“å…¥çš„å›è½¦äº‹ä»¶\n  const handleTagInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter' && tagInput.trim()) {\n      e.preventDefault();\n      addTag(tagInput.trim());\n    }\n  };\n\n  // æ·»åŠ æ ‡ç­¾\n  const addTag = (tag: string) => {\n    if (!tag) return;\n    \n    // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨\n    if (!tagList.includes(tag)) {\n      setTagList(prev => [...prev, tag]);\n    }\n    \n    // æ¸…ç©ºè¾“å…¥æ¡†\n    setTagInput('');\n    \n    // èšç„¦å›è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ç»§ç»­è¾“å…¥\n    if (tagInputRef.current) {\n      setTimeout(() => {\n        tagInputRef.current?.focus();\n      }, 0);\n    }\n  };\n\n  // åˆ é™¤æ ‡ç­¾\n  const removeTag = (tagToRemove: string) => {\n    setTagList(tagList.filter(tag => tag !== tagToRemove));\n  };\n\n  const handleUpload = async () => {\n    if (fileList.length === 0) {\n      message.warning('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');\n      return;\n    }\n\n    setUploading(true);\n\n    try {\n      const formData = new FormData();\n      \n      // æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°FormData\n      let filesAdded = 0;\n      fileList.forEach((file, index) => {\n        const rawFile = file.originFileObj;\n        if (rawFile instanceof File) {\n          // ä½¿ç”¨'file'å­—æ®µåï¼Œä¸åç«¯å¯¹åº”\n          formData.append('file', rawFile);\n          \n          // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæ·»åŠ ç›¸å¯¹è·¯å¾„ä¿¡æ¯\n          if (isFolderUpload && file.webkitRelativePath) {\n            // ä½¿ç”¨æ•°å­—ç´¢å¼•ä½œä¸ºé”®ï¼Œç¡®ä¿åç«¯å¯ä»¥æ­£ç¡®è§£æ\n            formData.append(`paths_${index}`, file.webkitRelativePath);\n            console.log(`æ–‡ä»¶ ${index}: ${file.name} - è·¯å¾„: ${file.webkitRelativePath}`);\n          }\n          \n          filesAdded++;\n          console.log(`æ·»åŠ æ–‡ä»¶ ${index+1}: ${file.name}, å¤§å°: ${file.size} å­—èŠ‚`);\n        } else {\n          console.warn(`æ— æ³•è·å–æ–‡ä»¶ ${index+1}: ${file.name} çš„åŸå§‹Fileå¯¹è±¡`);\n        }\n      });\n      \n      if (filesAdded === 0) {\n        throw new Error('æ— æ³•å¤„ç†ä¸Šä¼ æ–‡ä»¶ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶');\n      }\n      \n      // æ·»åŠ æ ‡å¿—è¡¨æ˜è¿™æ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ \n      if (isFolderUpload) {\n        formData.append('isFolderUpload', 'true');\n        console.log('æ–‡ä»¶å¤¹ä¸Šä¼ æ¨¡å¼å·²å¯ç”¨');\n      }\n      \n      // å°†æ ‡ç­¾æ•°ç»„è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²\n      if (tagList.length > 0) {\n        formData.append('tags', JSON.stringify(tagList));\n        console.log('æ·»åŠ æ ‡ç­¾:', tagList);\n      }\n\n      if (currentFolderId) {\n        formData.append('folderId', currentFolderId);\n        console.log('å½“å‰æ–‡ä»¶å¤¹ID:', currentFolderId);\n      }\n\n      console.log(`å‡†å¤‡ä¸Šä¼  ${filesAdded} ä¸ªæ–‡ä»¶...`);\n      \n      // æ˜¾ç¤ºä¸Šä¼ å¼€å§‹æ¶ˆæ¯\n      const uploadKey = `upload-${Date.now()}`;\n      message.loading({ content: 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...', key: uploadKey, duration: 0 });\n\n      // ä½¿ç”¨fetchå‘é€è¯·æ±‚\n      const response = await fetch(API_PATHS.STORAGE.FILES.UPLOAD, {\n        method: 'POST',\n        body: formData,\n      });\n\n      // è·å–å“åº”\n      const contentType = response.headers.get(\"content-type\");\n      let data;\n      \n      if (contentType && contentType.includes(\"application/json\")) {\n        data = await response.json();\n      } else {\n        // å¦‚æœä¸æ˜¯JSONå“åº”ï¼Œå°è¯•è·å–æ–‡æœ¬\n        const text = await response.text();\n        console.error('æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”:', text);\n        throw new Error('æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”æ ¼å¼');\n      }\n      \n      // æ£€æŸ¥å“åº”çŠ¶æ€\n      if (!response.ok) {\n        console.error('ä¸Šä¼ å“åº”é”™è¯¯:', data);\n        \n        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯\n        message.error({ \n          content: `ä¸Šä¼ å¤±è´¥: ${data.details || data.error || 'æœåŠ¡å™¨é”™è¯¯'}`, \n          key: uploadKey,\n          duration: 5 \n        });\n        \n        throw new Error(data.details || data.error || 'ä¸Šä¼ å¤±è´¥');\n      }\n\n      // ä¸Šä¼ æˆåŠŸå¤„ç†\n      console.log('ä¸Šä¼ æˆåŠŸ:', data);\n      message.success({ content: 'ä¸Šä¼ æˆåŠŸ', key: uploadKey, duration: 3 });\n      \n      // å…³é—­æ¨¡æ€æ¡†å¹¶é€šçŸ¥çˆ¶ç»„ä»¶\n      handleClose();\n      if (typeof onSuccess === 'function') {\n        onSuccess(data.files || (data.file ? [data.file] : undefined));\n      } else {\n        console.warn('onSuccessä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ— æ³•é€šçŸ¥ä¸Šä¼ æˆåŠŸ');\n      }\n    } catch (error) {\n      console.error('ä¸Šä¼ è¿‡ç¨‹ä¸­å‡ºé”™:', error);\n      message.error(`ä¸Šä¼ å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    setFileList([]);\n    setTagInput('');\n    setTagList([]);\n    onClose();\n  };\n  \n  // ç›´æ¥ä½¿ç”¨åŸç”Ÿæ–‡ä»¶è¾“å…¥\n  const triggerFileInput = () => {\n    if (fileInputRef.current) {\n      fileInputRef.current.click();\n    }\n  };\n  \n  const removeFile = (index: number) => {\n    setFileList(prev => prev.filter((_, i) => i !== index));\n  };\n\n  return (\n    <Modal\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\n      open={isOpen}\n      onCancel={handleClose}\n      onOk={handleUpload}\n      okText=\"ä¸Šä¼ \"\n      cancelText=\"å–æ¶ˆ\"\n      confirmLoading={uploading}\n      width={600}\n    >\n      <div className={styles.uploadContainer || ''}>\n        <input\n          type=\"file\"\n          ref={fileInputRef}\n          onChange={handleFileChange}\n          style={{ display: 'none' }}\n          multiple={true}\n          {...(isFolderUpload ? { webkitdirectory: '', directory: '', mozdirectory: '', msdirectory: '' } : {})}\n        />\n        \n        <div \n          className={styles.dropzone || ''}\n          onClick={triggerFileInput}\n          style={{ \n            border: '2px dashed #d9d9d9',\n            borderRadius: '4px',\n            padding: '20px',\n            textAlign: 'center',\n            cursor: 'pointer',\n            marginBottom: '16px'\n          }}\n        >\n          <p><InboxOutlined style={{ fontSize: '48px', color: '#40a9ff' }} /></p>\n          <p style={{ marginTop: '8px', fontWeight: 'bold' }}>\n            ç‚¹å‡»æˆ–æ‹–æ‹½{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}åˆ°æ­¤åŒºåŸŸä¸Šä¼ \n          </p>\n          <p style={{ color: '#888' }}>\n            {isFolderUpload\n              ? 'æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å†…éƒ¨æ–‡ä»¶ï¼Œä¿ç•™æ–‡ä»¶å¤¹ç»“æ„'\n              : 'æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡ä¸Šä¼ æ–‡ä»¶ï¼Œæœ€å¤§æ”¯æŒåŒæ—¶é€‰æ‹©50ä¸ªæ–‡ä»¶'}\n          </p>\n          <Button type=\"primary\" onClick={(e) => { e.stopPropagation(); triggerFileInput(); }}>\n            é€‰æ‹©{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}\n          </Button>\n        </div>\n        \n        {fileList.length > 0 && (\n          <div style={{ marginBottom: '16px' }}>\n            <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\n              å·²é€‰æ‹© {fileList.length} ä¸ªæ–‡ä»¶:\n            </div>\n            <ul style={{ maxHeight: '150px', overflowY: 'auto', padding: '0 0 0 20px' }}>\n              {fileList.map((file, index) => (\n                <li key={file.uid} style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>\n                  <span>\n                    {file.name} \n                    {isFolderUpload && file.webkitRelativePath && (\n                      <span style={{ fontSize: '12px', color: '#8c8c8c', marginLeft: '4px' }}>\n                        (è·¯å¾„: {file.webkitRelativePath.split('/').slice(0, -1).join('/')})\n                      </span>\n                    )}\n                    ({((file.size || 0) / 1024).toFixed(2)} KB)\n                  </span>\n                  <Button \n                    type=\"text\" \n                    danger \n                    onClick={() => removeFile(index)}\n                    style={{ padding: '0 4px' }}\n                  >\n                    åˆ é™¤\n                  </Button>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        <div style={{ marginTop: 16 }}>\n          <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\n            <span style={{ fontWeight: 'bold', marginRight: '8px' }}>æ·»åŠ æ ‡ç­¾:</span>\n            <span style={{ fontSize: '12px', color: '#8c8c8c' }}>\n              (è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ )\n            </span>\n          </div>\n          \n          <div className={styles.tagsInputWrapper}>\n            <Input\n              ref={tagInputRef}\n              placeholder=\"è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ \"\n              value={tagInput}\n              onChange={handleTagInputChange}\n              onKeyDown={handleTagInputKeyDown}\n              prefix={<TagOutlined style={{ color: '#bfbfbf' }} />}\n              suffix={\n                <span style={{ color: '#bfbfbf', fontSize: '12px' }}>\n                  æŒ‰å›è½¦æ·»åŠ \n                </span>\n              }\n            />\n          </div>\n          \n          <div className={styles.tagsContainer}>\n            {tagList.length > 0 ? (\n              <div className={styles.tagsList}>\n                {tagList.map((tag, index) => (\n                  <Tag\n                    key={index}\n                    closable\n                    onClose={() => removeTag(tag)}\n                    className={styles.interactiveTag}\n                  >\n                    {tag}\n                  </Tag>\n                ))}\n              </div>\n            ) : (\n              <div className={styles.emptyTagsHint}>\n                æ·»åŠ ä¸€äº›æ ‡ç­¾æ¥å¸®åŠ©ç®¡ç†æ‚¨çš„æ–‡ä»¶\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div style={{ marginTop: '16px', padding: '12px', background: '#f5f5f5', borderRadius: '8px', fontSize: '13px', color: '#555' }}>\n          <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\n            {isFolderUpload ? 'æ–‡ä»¶å¤¹ä¸Šä¼ è¯´æ˜:' : 'æ–‡ä»¶ä¸Šä¼ è¯´æ˜:'}\n          </div>\n          <ul style={{ paddingLeft: '16px', margin: '0' }}>\n            {isFolderUpload ? (\n              <>\n                <li>æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹ç»“æ„</li>\n                <li>ä¿ç•™å®Œæ•´çš„æ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„</li>\n                <li>ç›®å‰ä»…Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©</li>\n                <li>å¦‚æœæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©ï¼Œè¯·é€‰æ‹©å•ä¸ªæ–‡ä»¶æ¨¡å¼</li>\n              </>\n            ) : (\n              <>\n                <li>æ”¯æŒæ‰¹é‡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</li>\n                <li>æ”¯æŒå¸¸è§çš„æ–‡ä»¶æ ¼å¼ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰</li>\n                <li>æ¯ä¸ªæ–‡ä»¶å¤§å°é™åˆ¶ä¸º50MB</li>\n                <li>ä¸€æ¬¡æœ€å¤šå¯é€‰æ‹©50ä¸ªæ–‡ä»¶</li>\n              </>\n            )}\n            <li>æ‚¨å¯ä»¥ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ·»åŠ æ ‡ç­¾ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»„ç»‡å’ŒæŸ¥æ‰¾</li>\n          </ul>\n        </div>\n      </div>\n    </Modal>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\file-management\\SortDropdown.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/SortDropdown ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport styles from '../styles/SortDropdown.module.css';\nimport { FileSortInterface, SortDirectionEnum } from '@/app/types';\n\ninterface SortDropdownProps {\n  sortOrder: FileSortInterface;\n  onSortChange: (order: FileSortInterface) => void;\n}\n\nexport const SortDropdown: React.FC<SortDropdownProps> = ({\n  sortOrder,\n  onSortChange\n}) => {\n  const [showDropdown, setShowDropdown] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setShowDropdown(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // æ ¹æ®å½“å‰æ’åºå­—æ®µè·å–æ˜¾ç¤ºæ–‡æœ¬\n  const getSortFieldText = () => {\n    switch(sortOrder.field) {\n      case 'name': return 'æ–‡ä»¶å';\n      case 'size': return 'å¤§å°';\n      case 'createdAt': return 'æ—¶é—´';\n      default: return 'é»˜è®¤';\n    }\n  };\n\n  return (\n    <div className={styles.sortDropdown} ref={dropdownRef}>\n      <button \n        className={styles.topButton}\n        onClick={() => setShowDropdown(!showDropdown)}\n        style={{ \n          background: showDropdown ? '#f0f7ff' : 'white',\n          borderColor: showDropdown ? '#60a5fa' : '#e8e8e8'\n        }}\n      >\n        <span>â†•ï¸</span>\n        æ’åº: {getSortFieldText()} {sortOrder.direction === SortDirectionEnum.ASC ? 'â†‘' : 'â†“'}\n      </button>\n      {showDropdown && (\n        <div className={styles.dropdownMenu}>\n          <button \n            className={styles.dropdownItem}\n            onClick={() => {\n              const newSortOrder: FileSortInterface = {\n                field: 'name',\n                direction: sortOrder.field === 'name' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\n              };\n              onSortChange(newSortOrder);\n              setShowDropdown(false);\n            }}\n            style={{ \n              fontWeight: sortOrder.field === 'name' ? 'bold' : 'normal',\n              background: sortOrder.field === 'name' ? '#f0f7ff' : 'transparent'\n            }}\n          >\n            <span>ğŸ“</span>\n            æŒ‰æ–‡ä»¶å{sortOrder.field === 'name' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\n          </button>\n          <button \n            className={styles.dropdownItem}\n            onClick={() => {\n              const newSortOrder: FileSortInterface = {\n                field: 'size',\n                direction: sortOrder.field === 'size' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\n              };\n              onSortChange(newSortOrder);\n              setShowDropdown(false);\n            }}\n            style={{ \n              fontWeight: sortOrder.field === 'size' ? 'bold' : 'normal',\n              background: sortOrder.field === 'size' ? '#f0f7ff' : 'transparent'\n            }}\n          >\n            <span>ğŸ“Š</span>\n            æŒ‰å¤§å°{sortOrder.field === 'size' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\n          </button>\n          <button \n            className={styles.dropdownItem}\n            onClick={() => {\n              const newSortOrder: FileSortInterface = {\n                field: 'createdAt',\n                direction: sortOrder.field === 'createdAt' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\n              };\n              onSortChange(newSortOrder);\n              setShowDropdown(false);\n            }}\n            style={{ \n              fontWeight: sortOrder.field === 'createdAt' ? 'bold' : 'normal',\n              background: sortOrder.field === 'createdAt' ? '#f0f7ff' : 'transparent'\n            }}\n          >\n            <span>ğŸ•’</span>\n            æŒ‰æ—¶é—´{sortOrder.field === 'createdAt' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SortDropdown; "
  },
  {
    "path": "app\\components\\features\\file-management\\Toolbar.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/toolbar/Toolbar ç»„ä»¶ã€‚\n */\n\nimport React, { useRef, useState } from 'react';\nimport { useFileContext } from '../context/FileContext';\nimport { X, Download, Edit, Move } from 'lucide-react';\nimport { message } from 'antd';\nimport styles from './Toolbar.module.css';\nimport commonStyles from '../styles/common.module.css';\n\ninterface ToolbarProps {\n  onUploadClick: () => void;\n  onFolderUploadClick: () => void;\n  onCreateFolderClick: () => void;\n}\n\nexport function Toolbar({ onUploadClick, onFolderUploadClick, onCreateFolderClick }: ToolbarProps) {\n  const {\n    selectedFiles,\n    clearSelection,\n    files\n  } = useFileContext();\n\n  const [showUploadDropdown, setShowUploadDropdown] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const handleDownload = () => {\n    // TODO: å®ç°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½\n    message.info('ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­');\n  };\n\n  const handleRename = () => {\n    if (selectedFiles.length !== 1) {\n      message.warning('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé‡å‘½å');\n      return;\n    }\n    const selectedFile = files.find(file => file.id === selectedFiles[0]);\n    if (selectedFile) {\n      // TODO: å®ç°é‡å‘½ååŠŸèƒ½\n      message.info('é‡å‘½ååŠŸèƒ½å¼€å‘ä¸­');\n    }\n  };\n\n  return (\n    <div className={styles.topBar}>\n      <div className={styles.buttonGroup}>\n        {selectedFiles.length > 0 ? (\n          <>\n            <button className={styles.topButton} onClick={() => clearSelection()}>\n              <X className={commonStyles.icon} />\n              å–æ¶ˆé€‰æ‹©\n            </button>\n            <button className={styles.topButton} onClick={handleDownload}>\n              <Download className={commonStyles.icon} />\n              ä¸‹è½½\n            </button>\n            <button className={styles.topButton} onClick={handleRename}>\n              <Edit className={commonStyles.icon} />\n              é‡å‘½å\n            </button>\n            <button className={styles.topButton}>\n              <Move className={commonStyles.icon} />\n              ç§»åŠ¨\n            </button>\n          </>\n        ) : (\n          <>\n            <div className={styles.uploadDropdown} ref={dropdownRef}>\n              <button\n                className={styles.topButton}\n                onClick={() => setShowUploadDropdown(!showUploadDropdown)}\n              >\n                <span className={styles.buttonIcon}>â¬†ï¸</span>\n                ä¸Šä¼ \n                <span className={styles.dropdownArrow}>â–¼</span>\n              </button>\n              {showUploadDropdown && (\n                <div className={styles.dropdownMenu}>\n                  <button\n                    className={styles.dropdownItem}\n                    onClick={() => {\n                      onUploadClick();\n                      setShowUploadDropdown(false);\n                    }}\n                  >\n                    <span className={styles.buttonIcon}>ğŸ“„</span>\n                    ä¸Šä¼ æ–‡ä»¶\n                  </button>\n                  <button\n                    className={styles.dropdownItem}\n                    onClick={() => {\n                      onFolderUploadClick();\n                      setShowUploadDropdown(false);\n                    }}\n                  >\n                    <span className={styles.buttonIcon}>ğŸ“</span>\n                    ä¸Šä¼ æ–‡ä»¶å¤¹\n                  </button>\n                </div>\n              )}\n            </div>\n            <button\n              className={styles.topButton}\n              onClick={onCreateFolderClick}\n            >\n              <span className={styles.buttonIcon}>ğŸ“</span>\n              æ–°å»ºæ–‡ä»¶å¤¹\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\file-management\\TopActionBar.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/TopActionBar ç»„ä»¶ã€‚\n */\n\nimport React from 'react';\nimport { \n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \n} from 'lucide-react';\nimport styles from '../styles/shared.module.css';\nimport SortDropdown from './SortDropdown';\nimport { UploadButton } from '../components/shared';\nimport { FileSortInterface } from '@/app/types';\n\ninterface TopActionBarProps {\n  selectedFiles: string[];\n  onClearSelection: () => void;\n  onDownload: () => void;\n  onRename: () => void;\n  onMove: () => void;\n  onDelete: () => void;\n  onClearFilter: () => void;\n  onCreateFolder: () => void;\n  selectedFileType: string | null;\n  showSearchView: boolean;\n  isInRootFolder: boolean;\n  sortOrder: FileSortInterface;\n  setSortOrder: (order: FileSortInterface) => void;\n  showUploadDropdown: boolean;\n  setShowUploadDropdown: (show: boolean) => void;\n  setIsUploadModalOpen: (open: boolean) => void;\n  setIsFolderUploadModalOpen: (open: boolean) => void;\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\n}\n\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\n  selectedFiles,\n  onClearSelection,\n  onDownload,\n  onRename,\n  onMove,\n  onDelete,\n  onClearFilter,\n  onCreateFolder,\n  selectedFileType,\n  showSearchView,\n  isInRootFolder,\n  sortOrder,\n  setSortOrder,\n  showUploadDropdown,\n  setShowUploadDropdown,\n  setIsUploadModalOpen,\n  setIsFolderUploadModalOpen,\n  uploadDropdownRef\n}) => {\n  return (\n    <div className={styles.topBar}>\n      <div className={styles.buttonGroup}>\n        {selectedFiles.length > 0 ? (\n          <>\n            <button className={styles.topButton} onClick={onClearSelection}>\n              <X className=\"w-4 h-4\" />\n              å–æ¶ˆé€‰æ‹©\n            </button>\n            <button className={styles.topButton} onClick={onDownload}>\n              <Download className=\"w-4 h-4\" />\n              ä¸‹è½½\n            </button>\n            <button \n              className={styles.topButton}\n              onClick={onRename}\n            >\n              <Edit className=\"w-4 h-4\" />\n              é‡å‘½å\n            </button>\n            <button className={styles.topButton} onClick={onMove}>\n              <Move className=\"w-4 h-4\" />\n              ç§»åŠ¨\n            </button>\n            <button className={styles.topButton} onClick={onDelete}>\n              <Trash2 className=\"w-4 h-4\" />\n              åˆ é™¤\n            </button>\n          </>\n        ) : (\n          <>\n            <button \n              className={styles.topButton}\n              onClick={onClearFilter}\n              disabled={isInRootFolder}\n            >\n              <span>ğŸ“</span>\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\n            </button>\n\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\n            {selectedFileType && (\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\n                {(() => {\n                  switch(selectedFileType) {\n                    case 'image': return <ImageIcon className=\"w-4 h-4 mr-2\" />;\n                    case 'document': return <FileText className=\"w-4 h-4 mr-2\" />;\n                    case 'video': return <Video className=\"w-4 h-4 mr-2\" />;\n                    case 'audio': return <Music className=\"w-4 h-4 mr-2\" />;\n                    case 'other': return <File className=\"w-4 h-4 mr-2\" />;\n                    default: return null;\n                  }\n                })()}\n                å½“å‰æµè§ˆï¼š\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\n              </div>\n            )}\n\n            {/* æ’åºä¸‹æ‹‰èœå• */}\n            <SortDropdown \n              sortOrder={sortOrder}\n              onSortChange={setSortOrder}\n            />\n            \n            {/* ä¸Šä¼ æŒ‰é’® */}\n            <UploadButton \n              showDropdown={showUploadDropdown}\n              setShowDropdown={setShowUploadDropdown}\n              setIsModalOpen={setIsUploadModalOpen}\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\n              uploadDropdownRef={uploadDropdownRef}\n            />\n            \n            <button \n              className={styles.folderButton} \n              onClick={onCreateFolder}\n            >\n              <FolderUp className=\"w-4 h-4 mr-2\" />\n              æ–°å»ºæ–‡ä»¶å¤¹\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default TopActionBar; "
  },
  {
    "path": "app\\components\\features\\file-management\\upload\\UploadModal\\UploadModal.tsx",
    "newContent": "'use client';\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { Modal, Button, Space, Tag, Input, message, Progress } from 'antd';\r\nimport { UploadOutlined, FolderOutlined } from '@ant-design/icons';\r\nimport { UploadModalProps } from '@/app/types/domains/file-management';\r\nimport { FileTreeNode } from '@/app/types/domains/fileTypes';\r\nimport { formatFileSize } from '@/app/lib/utils/file';\r\nimport { uploadFile, uploadFolder, processSelectedFiles } from '@/app/lib/uploadService';\r\n\r\n// æ„å»ºæ–‡ä»¶æ ‘èŠ‚ç‚¹\r\nfunction createFileTreeNode(name: string, type: 'file' | 'folder', size: number = 0, file?: File): FileTreeNode {\r\n  return {\r\n    name,\r\n    type,\r\n    size,\r\n    children: type === 'folder' ? [] : undefined,\r\n    file: file as any\r\n  };\r\n}\r\n\r\n// æ›´æ–°æ–‡ä»¶å¤¹å¤§å°\r\nfunction updateFolderSize(node: FileTreeNode, fileSize: number) {\r\n  let currentNode = node;\r\n  while (currentNode) {\r\n    currentNode.size += fileSize;\r\n    currentNode = currentNode.children?.find(child => \r\n      child.type === 'folder'\r\n    ) as FileTreeNode;\r\n  }\r\n}\r\n\r\n// æ„å»ºæ–‡ä»¶æ ‘ç»“æ„\r\nfunction buildFileTree(files: File[], rootName: string): FileTreeNode {\r\n  const root = createFileTreeNode(rootName, 'folder');\r\n  \r\n  files.forEach(file => {\r\n    const paths = (file as any).webkitRelativePath.split('/');\r\n    let currentNode = root;\r\n    \r\n    for (let i = 1; i < paths.length; i++) {\r\n      const pathPart = paths[i];\r\n      const isFile = i === paths.length - 1;\r\n\r\n      if (isFile) {\r\n        const fileNode = createFileTreeNode(pathPart, 'file', file.size, file);\r\n        currentNode.children?.push(fileNode);\r\n        updateFolderSize(currentNode, file.size);\r\n      } else {\r\n        let folderNode = currentNode.children?.find(\r\n          child => child.name === pathPart && child.type === 'folder'\r\n        );\r\n        \r\n        if (!folderNode) {\r\n          folderNode = createFileTreeNode(pathPart, 'folder');\r\n          currentNode.children?.push(folderNode);\r\n        }\r\n        currentNode = folderNode;\r\n      }\r\n    }\r\n  });\r\n\r\n  return root;\r\n}\r\n\r\n/**\r\n * æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†ç»„ä»¶\r\n * æ”¯æŒæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæä¾›æ‹–æ”¾å’Œé€‰æ‹©ç•Œé¢\r\n */\r\nconst UploadModal: React.FC<UploadModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onUploadSuccess,\r\n  currentFolderId,\r\n  isFolderUpload,\r\n  withTags\r\n}) => {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [files, setFiles] = useState<File[]>([]);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [tags, setTags] = useState<string[]>([]);\r\n  const [tagInput, setTagInput] = useState('');\r\n  const [folderName, setFolderName] = useState<string | null>(null);\r\n  const [fileTree, setFileTree] = useState<FileTreeNode | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // é‡ç½®æ‰€æœ‰çŠ¶æ€\r\n  const resetState = () => {\r\n    setFiles([]);\r\n    setIsDragging(false);\r\n    setTags([]);\r\n    setTagInput('');\r\n    setFolderName(null);\r\n    setFileTree(null);\r\n    setUploadProgress(0);\r\n  };\r\n\r\n  // ç›‘å¬ isOpen å˜åŒ–ï¼Œå½“å¼¹çª—å…³é—­æ—¶é‡ç½®çŠ¶æ€\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      resetState();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const handleClose = () => {\r\n    resetState();\r\n    onClose();\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(true);\r\n  };\r\n\r\n  const handleDragLeave = () => {\r\n    setIsDragging(false);\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n    \r\n    const droppedFiles = Array.from(e.dataTransfer.files);\r\n    if (droppedFiles.length > 0) {\r\n      const { files: processedFiles, folderName } = processSelectedFiles(droppedFiles, isFolderUpload);\r\n      setFiles(processedFiles);\r\n      setFolderName(folderName);\r\n      \r\n      if (isFolderUpload && folderName) {\r\n        setFileTree(buildFileTree(processedFiles, folderName));\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFiles = Array.from(e.target.files || []);\r\n    if (selectedFiles.length > 0) {\r\n      const { files: processedFiles, folderName } = processSelectedFiles(selectedFiles, isFolderUpload);\r\n      setFiles(processedFiles);\r\n      setFolderName(folderName);\r\n      \r\n      if (isFolderUpload && folderName) {\r\n        setFileTree(buildFileTree(processedFiles, folderName));\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeFile = (fileName: string) => {\r\n    setFiles(prev => prev.filter(file => file.name !== fileName));\r\n  };\r\n\r\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === 'Enter' && tagInput.trim()) {\r\n      e.preventDefault();\r\n      const newTag = tagInput.trim();\r\n      if (!tags.includes(newTag)) {\r\n        setTags([...tags, newTag]);\r\n      }\r\n      setTagInput('');\r\n    }\r\n  };\r\n\r\n  const removeTag = (tagToRemove: string) => {\r\n    setTags(tags.filter(tag => tag !== tagToRemove));\r\n  };\r\n\r\n  // é€’å½’æ¸²æŸ“æ–‡ä»¶æ ‘ç»„ä»¶\r\n  const renderFileTree = (node: FileTreeNode, level: number = 0) => {\r\n    return (\r\n      <div key={node.name} style={{ marginLeft: `${level * 20}px` }}>\r\n        <div className=\"file-item\">\r\n          <div className=\"file-info\">\r\n            <span className=\"file-type-icon\">\r\n              {node.type === 'folder' ? 'ğŸ“' : \r\n               node.file?.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\r\n               node.file?.type.includes('pdf') ? 'ğŸ“„' :\r\n               node.file?.type.includes('word') ? 'ğŸ“' :\r\n               'ğŸ“„'}\r\n            </span>\r\n            <div>\r\n              <p className=\"file-name\">{node.name}</p>\r\n              <p className=\"file-size\">\r\n                {formatFileSize(node.size)}\r\n                {node.type === 'folder' && ` (${node.children?.length || 0} ä¸ªæ–‡ä»¶)`}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        {node.children && node.children.length > 0 && (\r\n          <div className=\"file-children\">\r\n            {node.children.map(child => renderFileTree(child, level + 1))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // ä¸Šä¼ å¤„ç†å‡½æ•°\r\n  const handleUpload = async () => {\r\n    if (files.length === 0) return;\r\n    \r\n    setIsUploading(true);\r\n    setUploadProgress(0);\r\n    \r\n    try {\r\n      // å¤„ç†æ–‡ä»¶å¤¹ä¸Šä¼ \r\n      if (isFolderUpload && folderName) {\r\n        await uploadFolder(files, folderName, {\r\n          folderId: currentFolderId || undefined,\r\n          tags,\r\n          onProgress: (progress) => {\r\n            setUploadProgress(progress);\r\n          },\r\n          onSuccess: (response) => {\r\n            message.success(`æ–‡ä»¶å¤¹ \"${folderName}\" ä¸Šä¼ æˆåŠŸ`);\r\n            setIsUploading(false);\r\n            onUploadSuccess();\r\n            handleClose();\r\n          },\r\n          onError: (error) => {\r\n            message.error(`ä¸Šä¼ å¤±è´¥: ${error.message}`);\r\n            setIsUploading(false);\r\n          }\r\n        });\r\n      } else {\r\n        // å•æ–‡ä»¶æˆ–å¤šæ–‡ä»¶ä¸Šä¼ \r\n        let uploadedCount = 0;\r\n        const totalFiles = files.length;\r\n        \r\n        for (const file of files) {\r\n          await uploadFile(file, {\r\n            folderId: currentFolderId || undefined,\r\n            tags,\r\n            onProgress: (fileProgress) => {\r\n              // è®¡ç®—æ€»ä½“è¿›åº¦ï¼šå·²å®Œæˆæ–‡ä»¶ + å½“å‰æ–‡ä»¶è¿›åº¦\r\n              const totalProgress = Math.round(\r\n                (uploadedCount * 100 + fileProgress) / totalFiles\r\n              );\r\n              setUploadProgress(totalProgress);\r\n            },\r\n            onSuccess: () => {\r\n              uploadedCount++;\r\n              \r\n              // æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ\r\n              if (uploadedCount === totalFiles) {\r\n                message.success(totalFiles > 1 \r\n                  ? `${totalFiles}ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸ` \r\n                  : 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');\r\n                \r\n                setIsUploading(false);\r\n                onUploadSuccess();\r\n                handleClose();\r\n              }\r\n            },\r\n            onError: (error) => {\r\n              message.error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${error.message}`);\r\n              setIsUploading(false);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'ä¸Šä¼ å¤±è´¥';\r\n      message.error(errorMessage);\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\r\n      open={isOpen}\r\n      onCancel={handleClose}\r\n      footer={[\r\n        <Button key=\"cancel\" onClick={handleClose} disabled={isUploading}>\r\n          å–æ¶ˆ\r\n        </Button>,\r\n        <Button \r\n          key=\"upload\" \r\n          type=\"primary\" \r\n          onClick={handleUpload} \r\n          disabled={files.length === 0 || isUploading}\r\n          loading={isUploading}\r\n        >\r\n          ä¸Šä¼ \r\n        </Button>,\r\n      ]}\r\n      width={800}\r\n    >\r\n      {isUploading ? (\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"my-4\">\r\n            <Progress percent={uploadProgress} status=\"active\" />\r\n            <div className=\"mt-2\">{`ä¸Šä¼ ä¸­...${uploadProgress}%`}</div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"upload-content\">\r\n          {/* æ‹–æ”¾åŒºåŸŸ */}\r\n          <div\r\n            onDragOver={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\r\n              isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-500'\r\n            }`}\r\n          >\r\n            <div className=\"upload-icon mb-4\">\r\n              {isFolderUpload ? <FolderOutlined style={{ fontSize: 48 }} /> : <UploadOutlined style={{ fontSize: 48 }} />}\r\n            </div>\r\n            <p className=\"text-lg mb-2\">\r\n              {isDragging\r\n                ? isFolderUpload\r\n                  ? 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶å¤¹'\r\n                  : 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶'\r\n                : isFolderUpload\r\n                ? 'æ‹–æ”¾æ–‡ä»¶å¤¹è‡³æ­¤å¤„ï¼Œæˆ–'\r\n                : 'æ‹–æ”¾æ–‡ä»¶è‡³æ­¤å¤„ï¼Œæˆ–'}\r\n            </p>\r\n            <Button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              type=\"primary\"\r\n              icon={isFolderUpload ? <FolderOutlined /> : <UploadOutlined />}\r\n            >\r\n              {isFolderUpload ? 'é€‰æ‹©æ–‡ä»¶å¤¹' : 'é€‰æ‹©æ–‡ä»¶'}\r\n            </Button>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              multiple={!isFolderUpload}\r\n              style={{ display: 'none' }}\r\n              onChange={handleFileSelect}\r\n              {...(isFolderUpload ? { webkitdirectory: \"\", directory: \"\" } : {})}\r\n            />\r\n          </div>\r\n\r\n          {/* æ ‡ç­¾è¾“å…¥åŒºåŸŸ */}\r\n          {withTags && (\r\n            <div className=\"tags-section mt-6\">\r\n              <h4 className=\"text-base font-medium mb-2\">æ·»åŠ æ ‡ç­¾</h4>\r\n              <div className=\"tag-input\">\r\n                <Input\r\n                  placeholder=\"è¾“å…¥æ ‡ç­¾å¹¶æŒ‰Enteræ·»åŠ \"\r\n                  value={tagInput}\r\n                  onChange={(e) => setTagInput(e.target.value)}\r\n                  onKeyDown={handleTagInputKeyDown}\r\n                />\r\n              </div>\r\n              {tags.length > 0 && (\r\n                <div className=\"tags-list mt-2 flex flex-wrap gap-1\">\r\n                  {tags.map((tag) => (\r\n                    <Tag\r\n                      key={tag}\r\n                      closable\r\n                      onClose={() => removeTag(tag)}\r\n                    >\r\n                      {tag}\r\n                    </Tag>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* æ–‡ä»¶åˆ—è¡¨æˆ–æ–‡ä»¶æ ‘ */}\r\n          {files.length > 0 && (\r\n            <div className=\"file-list mt-6\">\r\n              <h4 className=\"text-base font-medium mb-2\">\r\n                {isFolderUpload \r\n                  ? `æ–‡ä»¶å¤¹: ${folderName} (${files.length}ä¸ªæ–‡ä»¶)` \r\n                  : `é€‰æ‹©çš„æ–‡ä»¶ (${files.length})`}\r\n              </h4>\r\n              \r\n              {isFolderUpload && fileTree ? (\r\n                <div className=\"folder-tree border rounded p-3\">\r\n                  {renderFileTree(fileTree)}\r\n                </div>\r\n              ) : (\r\n                <div className=\"file-items space-y-2\">\r\n                  {files.map((file) => (\r\n                    <div\r\n                      key={file.name}\r\n                      className=\"file-item flex justify-between items-center border rounded p-2\"\r\n                    >\r\n                      <div className=\"file-details flex items-center\">\r\n                        <span className=\"file-icon mr-2\">\r\n                          {file.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\r\n                           file.type.includes('pdf') ? 'ğŸ“„' :\r\n                           file.type.includes('word') ? 'ğŸ“' :\r\n                           'ğŸ“„'}\r\n                        </span>\r\n                        <div>\r\n                          <div className=\"file-name font-medium\">{file.name}</div>\r\n                          <div className=\"file-meta text-xs text-gray-500\">\r\n                            {formatFileSize(file.size)}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <Button\r\n                        type=\"text\"\r\n                        size=\"small\"\r\n                        danger\r\n                        onClick={() => removeFile(file.name)}\r\n                      >\r\n                        ç§»é™¤\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UploadModal; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\actionBar\\TopActionBar\\TopActionBar.tsx",
    "newContent": "import React from 'react';\r\nimport { \r\n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \r\n} from 'lucide-react';\r\nimport styles from '@/app/file-management/styles/shared.module.css';\r\nimport { SortDropdown } from '@/app/components/features/file-management/actionBar/SortDropdown';\r\nimport { UploadButton } from '@/app/components/features/file-management/upload/UploadButton';\r\nimport { FileSortInterface } from '@/app/types';\r\n\r\ninterface TopActionBarProps {\r\n  selectedFiles: string[];\r\n  onClearSelection: () => void;\r\n  onDownload: () => void;\r\n  onRename: () => void;\r\n  onMove: () => void;\r\n  onDelete: () => void;\r\n  onClearFilter: () => void;\r\n  onCreateFolder: () => void;\r\n  selectedFileType: string | null;\r\n  showSearchView: boolean;\r\n  isInRootFolder: boolean;\r\n  sortOrder: FileSortInterface;\r\n  setSortOrder: (order: FileSortInterface) => void;\r\n  showUploadDropdown: boolean;\r\n  setShowUploadDropdown: (show: boolean) => void;\r\n  setIsUploadModalOpen: (open: boolean) => void;\r\n  setIsFolderUploadModalOpen: (open: boolean) => void;\r\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\r\n}\r\n\r\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\r\n  selectedFiles,\r\n  onClearSelection,\r\n  onDownload,\r\n  onRename,\r\n  onMove,\r\n  onDelete,\r\n  onClearFilter,\r\n  onCreateFolder,\r\n  selectedFileType,\r\n  showSearchView,\r\n  isInRootFolder,\r\n  sortOrder,\r\n  setSortOrder,\r\n  showUploadDropdown,\r\n  setShowUploadDropdown,\r\n  setIsUploadModalOpen,\r\n  setIsFolderUploadModalOpen,\r\n  uploadDropdownRef\r\n}) => {\r\n  return (\r\n    <div className={styles.topBar}>\r\n      <div className={styles.buttonGroup}>\r\n        {selectedFiles.length > 0 ? (\r\n          <>\r\n            <button className={styles.topButton} onClick={onClearSelection}>\r\n              <X className=\"w-4 h-4\" />\r\n              å–æ¶ˆé€‰æ‹©\r\n            </button>\r\n            <button className={styles.topButton} onClick={onDownload}>\r\n              <Download className=\"w-4 h-4\" />\r\n              ä¸‹è½½\r\n            </button>\r\n            <button \r\n              className={styles.topButton}\r\n              onClick={onRename}\r\n            >\r\n              <Edit className=\"w-4 h-4\" />\r\n              é‡å‘½å\r\n            </button>\r\n            <button className={styles.topButton} onClick={onMove}>\r\n              <Move className=\"w-4 h-4\" />\r\n              ç§»åŠ¨\r\n            </button>\r\n            <button className={styles.topButton} onClick={onDelete}>\r\n              <Trash2 className=\"w-4 h-4\" />\r\n              åˆ é™¤\r\n            </button>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <button \r\n              className={styles.topButton}\r\n              onClick={onClearFilter}\r\n              disabled={isInRootFolder}\r\n            >\r\n              <span>ğŸ“</span>\r\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\r\n            </button>\r\n\r\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\r\n            {selectedFileType && (\r\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\r\n                {(() => {\r\n                  switch(selectedFileType) {\r\n                    case 'image': return <ImageIcon className=\"w-4 h-4 mr-2\" />;\r\n                    case 'document': return <FileText className=\"w-4 h-4 mr-2\" />;\r\n                    case 'video': return <Video className=\"w-4 h-4 mr-2\" />;\r\n                    case 'audio': return <Music className=\"w-4 h-4 mr-2\" />;\r\n                    case 'other': return <File className=\"w-4 h-4 mr-2\" />;\r\n                    default: return null;\r\n                  }\r\n                })()}\r\n                å½“å‰æµè§ˆï¼š\r\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\r\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\r\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\r\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\r\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\r\n              </div>\r\n            )}\r\n\r\n            {/* æ’åºä¸‹æ‹‰èœå• */}\r\n            <SortDropdown \r\n              sortOrder={sortOrder}\r\n              onSortChange={setSortOrder}\r\n            />\r\n            \r\n            {/* ä¸Šä¼ æŒ‰é’® */}\r\n            <UploadButton \r\n              showDropdown={showUploadDropdown}\r\n              setShowDropdown={setShowUploadDropdown}\r\n              setIsModalOpen={setIsUploadModalOpen}\r\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\r\n              uploadDropdownRef={uploadDropdownRef}\r\n            />\r\n            \r\n            <button \r\n              className={styles.folderButton} \r\n              onClick={onCreateFolder}\r\n            >\r\n              <FolderUp className=\"w-4 h-4 mr-2\" />\r\n              æ–°å»ºæ–‡ä»¶å¤¹\r\n            </button>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TopActionBar; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\MiniSidebar.tsx",
    "newContent": "/**\r\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\r\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/MiniSidebar ç»„ä»¶ã€‚\r\n */\r\n\r\nimport React from 'react';\r\nimport Image from 'next/image';\r\nimport { Home, LogOut, Palette } from 'lucide-react';\r\nimport styles from '../styles/shared.module.css';\r\n\r\ninterface MiniSidebarProps {\r\n  avatarUrl: string | null;\r\n  userName: string | null;\r\n  userEmail: string | null;\r\n  onHomeClick: () => void;\r\n  onLogoutClick: () => void;\r\n  onAvatarClick: () => void;\r\n  currentTheme?: string | null;\r\n  onThemeClick: () => void;\r\n}\r\n\r\nconst MiniSidebar: React.FC<MiniSidebarProps> = ({\r\n  avatarUrl,\r\n  userName,\r\n  userEmail,\r\n  onHomeClick,\r\n  onLogoutClick,\r\n  onAvatarClick,\r\n  currentTheme = 'default',\r\n  onThemeClick\r\n}) => {\r\n  return (\r\n    <div className={styles.miniSidebar}>\r\n      <div className={styles.patternOverlay}></div>\r\n      <div className={styles.avatarContainer}>\r\n        <button \r\n          className={styles.miniSidebarButton}\r\n          onClick={onAvatarClick}\r\n        >\r\n          {avatarUrl ? (\r\n            <Image\r\n              src={`${avatarUrl}?t=${Date.now()}`}\r\n              alt=\"ç”¨æˆ·å¤´åƒ\"\r\n              width={38}\r\n              height={38}\r\n              className=\"rounded-full ring-1 ring-white/50 transition-all duration-300 hover:ring-2\"\r\n            />\r\n          ) : (\r\n            <div \r\n              className={styles.avatarPlaceholder}\r\n              style={{ width: '38px', height: '38px', fontSize: '16px' }}\r\n            >\r\n              {userName?.[0]?.toUpperCase() || userEmail?.[0]?.toUpperCase() || '?'}\r\n            </div>\r\n          )}\r\n        </button>\r\n      </div>\r\n      <div className={styles.miniSidebarDivider}></div>\r\n      <button \r\n        className={styles.miniSidebarButton}\r\n        onClick={onHomeClick}\r\n      >\r\n        <Home className=\"w-5 h-5 text-white\" />\r\n      </button>\r\n      \r\n      {/* ä¸»é¢˜é€‰æ‹©æŒ‰é’® */}\r\n      <button \r\n        className={styles.miniSidebarButton}\r\n        onClick={onThemeClick}\r\n        title=\"ä¸»é¢˜è®¾ç½®\"\r\n      >\r\n        <Palette className=\"w-5 h-5 text-white\" />\r\n      </button>\r\n      \r\n      <button \r\n        className={styles.miniSidebarButton}\r\n        onClick={onLogoutClick}\r\n      >\r\n        <LogOut className=\"w-5 h-5 text-white\" />\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MiniSidebar; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\NewFolderForm.tsx",
    "newContent": "/**\r\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\r\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/folderManagement/NewFolderForm ç»„ä»¶ã€‚\r\n */\r\n\r\nimport React, { useRef, useState, useEffect } from 'react';\r\nimport { Folder, AlertCircle } from 'lucide-react';\r\nimport styles from '../styles/shared.module.css';\r\n\r\ninterface NewFolderFormProps {\r\n  folderName: string;\r\n  setFolderName: (name: string) => void;\r\n  folderTags: string[];\r\n  setFolderTags: (tags: string[]) => void;\r\n  onCreateFolder: () => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst NewFolderForm: React.FC<NewFolderFormProps> = ({\r\n  folderName,\r\n  setFolderName,\r\n  folderTags,\r\n  setFolderTags,\r\n  onCreateFolder,\r\n  onCancel\r\n}) => {\r\n  const [newTag, setNewTag] = useState('');\r\n  const [nameError, setNameError] = useState<string | null>(null);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // æ£€æŸ¥æ–‡ä»¶å¤¹åç§°æ˜¯å¦æœ‰æ•ˆ\r\n  useEffect(() => {\r\n    const trimmedName = folderName.trim();\r\n    \r\n    if (trimmedName === '') {\r\n      setNameError(null); // ç©ºåç§°ä¸æ˜¾ç¤ºé”™è¯¯ï¼Œä½†åˆ›å»ºæŒ‰é’®ä¼šå¤„ç†\r\n      return;\r\n    }\r\n\r\n    // æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦\r\n    const invalidChars = /[\\/\\\\:*?\"<>|]/;\r\n    if (invalidChars.test(trimmedName)) {\r\n      setNameError('æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å«ä¸‹åˆ—å­—ç¬¦: / \\\\ : * ? \" < > |');\r\n      return;\r\n    }\r\n\r\n    setNameError(null);\r\n  }, [folderName]);\r\n\r\n  // å¤„ç†å›è½¦é”®åˆ›å»ºæ–‡ä»¶å¤¹\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === 'Enter' && !nameError && folderName.trim()) {\r\n      onCreateFolder();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`${styles.newFolderRow} p-4 border border-gray-200 rounded-lg bg-white shadow-sm mb-4`}>\r\n      <div className={`${styles.newFolderForm} flex flex-col space-y-4`}>\r\n        <div className={`flex items-center`}>\r\n          <Folder className=\"w-6 h-6 text-blue-500 flex-shrink-0 mr-3\" />\r\n          <div className={`${styles.newFolderNameContainer} flex-grow relative`}>\r\n            <input\r\n              type=\"text\"\r\n              ref={inputRef}\r\n              className={`${styles.newFolderInput} h-10 px-3 rounded-md border ${nameError ? 'border-red-500' : 'border-gray-300'} w-full text-base`}\r\n              value={folderName}\r\n              onChange={(e) => setFolderName(e.target.value)}\r\n              placeholder=\"æ–°æ–‡ä»¶å¤¹åç§°\"\r\n              autoFocus\r\n              onKeyDown={handleKeyDown}\r\n            />\r\n            {nameError && (\r\n              <div className=\"text-red-500 text-xs mt-1 flex items-center\">\r\n                <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n                <span>{nameError}</span>\r\n              </div>\r\n            )}\r\n            {!nameError && (\r\n              <div className=\"text-gray-500 text-xs mt-1\">\r\n                ç›¸åŒç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåæ–‡ä»¶å¤¹\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n        \r\n        <div className={`${styles.newFolderTagsContainer} ml-9`}>\r\n          <label className=\"block text-sm font-medium text-gray-700 mb-1\">æ·»åŠ æ ‡ç­¾</label>\r\n          <div className={`${styles.tagsWrapper} h-10 flex items-center flex-wrap gap-2 border border-gray-300 rounded-md px-3 py-1 overflow-y-auto`}>\r\n            {folderTags.map((tag, index) => (\r\n              <div key={index} className={`${styles.tagItem} h-7 flex items-center bg-blue-100 text-blue-800 px-2 rounded-md`}>\r\n                <span className=\"text-sm\">{tag}</span>\r\n                <button\r\n                  className={`${styles.removeTagButton} ml-1 text-blue-600 hover:text-blue-800 w-5 h-5 flex items-center justify-center rounded-full hover:bg-blue-200`}\r\n                  onClick={() => {\r\n                    const updatedTags = [...folderTags];\r\n                    updatedTags.splice(index, 1);\r\n                    setFolderTags(updatedTags);\r\n                  }}\r\n                >\r\n                  Ã—\r\n                </button>\r\n              </div>\r\n            ))}\r\n            <input\r\n              type=\"text\"\r\n              className={`${styles.tagInput} flex-grow h-7 border-0 outline-none text-sm bg-transparent`}\r\n              value={newTag}\r\n              onChange={(e) => setNewTag(e.target.value)}\r\n              onKeyDown={(e) => {\r\n                if (e.key === 'Enter' && newTag.trim()) {\r\n                  setFolderTags([...folderTags, newTag.trim()]);\r\n                  setNewTag('');\r\n                  e.preventDefault();\r\n                }\r\n              }}\r\n              placeholder=\"æ·»åŠ æ ‡ç­¾...\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        <div className={`${styles.newFolderActions} flex items-center gap-3 ml-9`}>\r\n          <button \r\n            className={`${styles.confirmButton} h-10 px-4 ${nameError || !folderName.trim() ? 'bg-blue-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white rounded-md flex items-center justify-center`}\r\n            onClick={onCreateFolder}\r\n            disabled={!!nameError || !folderName.trim()}\r\n          >\r\n            åˆ›å»º\r\n          </button>\r\n          <button \r\n            className={`${styles.cancelButton} h-10 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-md flex items-center justify-center border border-gray-300`}\r\n            onClick={onCancel}\r\n          >\r\n            å–æ¶ˆ\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NewFolderForm; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\RenameModal\\index.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileOperations/RenameModal ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport styles from '@/app/shared/themes/components/renameModal.module.css';\nimport { CloseOutlined, TagOutlined, PlusOutlined } from '@ant-design/icons';\n\ninterface RenameModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onRename: (newName: string, tags?: string[]) => void;\n  initialName: string;\n  initialTags?: string[];\n  fileType: 'file' | 'folder';\n}\n\nconst RenameModal: React.FC<RenameModalProps> = ({\n  isOpen,\n  onClose,\n  onRename,\n  initialName,\n  initialTags = [],\n  fileType\n}) => {\n  const [newName, setNewName] = useState(initialName);\n  const [tags, setTags] = useState<string[]>(initialTags);\n  const [tagInput, setTagInput] = useState('');\n  \n  const inputRef = useRef<HTMLInputElement>(null);\n  const tagInputRef = useRef<HTMLInputElement>(null);\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    setNewName(initialName);\n    // ç¡®ä¿åˆå§‹æ ‡ç­¾ä¸åŒ…å«é‡å¤é¡¹\n    setTags(Array.from(new Set(initialTags)));\n  }, [initialName, initialTags]);\n\n  useEffect(() => {\n    if (isOpen && inputRef.current) {\n      // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†å¹¶é€‰ä¸­æ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰\n      inputRef.current.focus();\n      \n      const extension = fileType === 'file' ? initialName.lastIndexOf('.') : -1;\n      if (extension !== -1) {\n        inputRef.current.setSelectionRange(0, extension);\n      } else {\n        inputRef.current.select();\n      }\n    }\n  }, [isOpen, initialName, fileType]);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (modalRef.current && !modalRef.current.contains(event.target as Node)) {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n    \n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isOpen, onClose]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    // é¦–å…ˆç¡®ä¿æ–°åç§°æ˜¯æœ‰æ•ˆçš„éç©ºå­—ç¬¦ä¸²\n    if (newName && typeof newName === 'string' && newName.trim() && \n        (newName !== initialName || JSON.stringify(tags) !== JSON.stringify(initialTags))) {\n      onRename(newName, tags);\n    } else if (!newName || !newName.trim()) {\n      // å¦‚æœåç§°ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä½†ä¸å…³é—­æ¨¡æ€æ¡†\n      return;\n    }\n    onClose();\n  };\n\n  const handleAddTag = () => {\n    if (!tagInput.trim()) return;\n    \n    // é¿å…æ·»åŠ é‡å¤æ ‡ç­¾\n    if (!tags.includes(tagInput.trim())) {\n      setTags([...tags, tagInput.trim()]);\n    }\n    \n    setTagInput('');\n    \n    // æ·»åŠ åè‡ªåŠ¨èšç„¦å›æ ‡ç­¾è¾“å…¥æ¡†\n    setTimeout(() => {\n      if (tagInputRef.current) {\n        tagInputRef.current.focus();\n      }\n    }, 0);\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    setTags(tags.filter(tag => tag !== tagToRemove));\n  };\n\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleAddTag();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className={styles['modal-overlay']}>\n      <div ref={modalRef} className={`${styles['modal-content']} ${styles['rename-modal']}`}>\n        <div className={styles['modal-header']}>\n          <h3 className={styles['modal-title']}>\n            {fileType === 'folder' ? 'é‡å‘½åæ–‡ä»¶å¤¹' : 'é‡å‘½åæ–‡ä»¶'}\n          </h3>\n          <button \n            className={styles['modal-close']} \n            onClick={onClose}\n            aria-label=\"å…³é—­\"\n          >\n            <CloseOutlined />\n          </button>\n        </div>\n        \n        <form className={styles['rename-form']} onSubmit={handleSubmit}>\n          <div className={styles['form-group']}>\n            <label className={styles['form-label']}>åç§°</label>\n            <input\n              ref={inputRef}\n              type=\"text\"\n              className={styles['rename-input']}\n              value={newName}\n              onChange={(e) => setNewName(e.target.value)}\n              placeholder=\"è¾“å…¥æ–°åç§°\"\n              autoFocus\n            />\n          </div>\n          \n          <div className={styles['form-group']}>\n            <label className={styles['form-label']}>æ ‡ç­¾</label>\n            <div className={styles['tags-container']}>\n              {tags.map((tag, index) => (\n                <div key={index} className={styles['tag']}>\n                  <span>{tag}</span>\n                  <button \n                    type=\"button\"\n                    className={styles['tag-remove']}\n                    onClick={() => handleRemoveTag(tag)}\n                  >\n                    &times;\n                  </button>\n                </div>\n              ))}\n            </div>\n            <div className={styles['tag-input-container']}>\n              <TagOutlined className={styles['tag-icon']} />\n              <input\n                ref={tagInputRef}\n                type=\"text\"\n                className={styles['tag-input']}\n                value={tagInput}\n                onChange={(e) => setTagInput(e.target.value)}\n                onKeyDown={handleTagInputKeyDown}\n                placeholder=\"è¾“å…¥æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ \"\n              />\n              <button\n                type=\"button\"\n                className={styles['tag-add-button']}\n                onClick={handleAddTag}\n                disabled={!tagInput.trim()}\n              >\n                <PlusOutlined />\n              </button>\n            </div>\n          </div>\n\n          <div className={styles['modal-footer']}>\n            <button \n              type=\"button\" \n              className={`${styles['modal-button']} ${styles.cancel}`}\n              onClick={onClose}\n            >\n              å–æ¶ˆ\n            </button>\n            <button \n              type=\"submit\" \n              className={`${styles['modal-button']} ${styles.confirm}`}\n              disabled={!newName.trim() || (newName === initialName && JSON.stringify(tags) === JSON.stringify(initialTags))}\n            >\n              ç¡®è®¤\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default RenameModal; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\Breadcrumb.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Breadcrumb ç»„ä»¶ã€‚\n */\n\nimport React from 'react';\nimport { Home, ChevronRight, ChevronLeft } from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\nimport { FolderPathItem } from '@/app/types';\n\ninterface BreadcrumbProps {\n  folderPath: FolderPathItem[];\n  showHome?: boolean;\n  onNavigate?: (folderId: string | null) => void;\n  onPathClick: (folderId: string | null) => void;\n  onBackClick?: () => void;\n}\n\nexport function Breadcrumb({ \n  folderPath, \n  showHome = true, \n  onNavigate, \n  onPathClick,\n  onBackClick\n}: BreadcrumbProps) {\n  // å‘ä¸‹å…¼å®¹ï¼šå¦‚æœæœ‰onNavigateä½†æ²¡æœ‰onPathClickï¼Œå°±ä½¿ç”¨onNavigate\n  const handlePathClick = onPathClick || onNavigate;\n\n  if (!handlePathClick) {\n    console.error('Breadcrumbç»„ä»¶ç¼ºå°‘å¿…è¦çš„onPathClickæˆ–onNavigateå›è°ƒå‡½æ•°');\n    return null;\n  }\n\n  return (\n    <div className={styles.breadcrumb}>\n      {onBackClick && folderPath.length > 0 && (\n        <button \n          className={styles.breadcrumbBackButton}\n          onClick={onBackClick}\n          title=\"è¿”å›ä¸Šä¸€çº§\"\n        >\n          <ChevronLeft size={16} />\n        </button>\n      )}\n      \n      {showHome && (\n        <div className={styles.breadcrumbItem}>\n          <button\n            className={styles.breadcrumbLink}\n            onClick={() => handlePathClick(null)}\n          >\n            <Home size={16} className={styles.breadcrumbIcon} />\n            æ ¹ç›®å½•\n          </button>\n        </div>\n      )}\n      \n      {folderPath.map((folder) => (\n        <React.Fragment key={folder.id}>\n          <span className={styles.breadcrumbSeparator}>\n            <ChevronRight size={14} />\n          </span>\n          <div className={styles.breadcrumbItem}>\n            <button\n              className={styles.breadcrumbLink}\n              onClick={() => handlePathClick(folder.id)}\n            >\n              {folder.name}\n            </button>\n          </div>\n        </React.Fragment>\n      ))}\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\ErrorDisplay.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/ErrorDisplay ç»„ä»¶ã€‚\n */\n\n'use client';\n\nimport React from 'react';\nimport { AlertTriangle, RefreshCw, Wifi, Server, CloudOff } from 'lucide-react';\nimport styles from '../../../../file-management/styles/shared.module.css';\n\ninterface ErrorDisplayProps {\n  title?: string;\n  message?: string;\n  errorType?: 'network' | 'auth' | 'server' | 'data' | 'timeout' | 'unknown';\n  onRetry?: () => void;\n  retryText?: string;\n}\n\n/**\n * æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼Œæ”¯æŒä¸åŒç±»å‹çš„é”™è¯¯\n */\nexport const ErrorDisplay: React.FC<ErrorDisplayProps> = ({\n  title,\n  message = 'è¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜',\n  errorType = 'unknown',\n  onRetry,\n  retryText = 'é‡è¯•'\n}) => {\n  // æ ¹æ®é”™è¯¯ç±»å‹è·å–å›¾æ ‡å’Œæ ‡é¢˜\n  const getErrorInfo = () => {\n    switch (errorType) {\n      case 'network':\n        return {\n          icon: <Wifi className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'ç½‘ç»œè¿æ¥é”™è¯¯'\n        };\n      case 'auth':\n        return {\n          icon: <AlertTriangle className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'èº«ä»½éªŒè¯å¤±è´¥'\n        };\n      case 'server':\n        return {\n          icon: <Server className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'æœåŠ¡å™¨é”™è¯¯'\n        };\n      case 'data':\n        return {\n          icon: <CloudOff className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'æ•°æ®åŠ è½½å¤±è´¥'\n        };\n      case 'timeout':\n        return {\n          icon: <AlertTriangle className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'è¯·æ±‚è¶…æ—¶'\n        };\n      default:\n        return {\n          icon: <AlertTriangle className=\"w-12 h-12 text-red-500\" />,\n          defaultTitle: 'åŠ è½½å‡ºé”™'\n        };\n    }\n  };\n\n  const { icon, defaultTitle } = getErrorInfo();\n  const displayTitle = title || defaultTitle;\n\n  return (\n    <div className={styles.errorContainer}>\n      <div className={styles.errorCard}>\n        <div className={styles.errorIcon}>\n          {icon}\n        </div>\n        <h3 className={styles.errorTitle}>{displayTitle}</h3>\n        <p className={styles.errorText}>{message}</p>\n        {onRetry && (\n          <button \n            className={styles.retryButton}\n            onClick={onRetry}\n          >\n            <RefreshCw className=\"w-4 h-4\" />\n            {retryText}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\FileList.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileList/FileList ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { \n  File as FileIcon, \n  Folder, \n  Image as ImageIcon, \n  FileText, \n  Video, \n  Music, \n  MoreVertical,\n  Tag as TagIcon,\n  SearchX,\n  Filter,\n  Check,\n  X,\n  Plus\n} from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\nimport { getFileType as getFileTypeDisplay } from '@/app/utils/file/type';\nimport { getFileNameAndExtension } from '@/app/utils/file/path';\nimport { FileInfo } from '@/app/types';\n\ninterface FileListProps {\n  files: FileInfo[];\n  selectedFiles: string[];\n  onFileClick: (file: FileInfo) => void;\n  onFileDoubleClick?: (file: FileInfo) => void;\n  onFileContextMenu?: (event: React.MouseEvent, file: FileInfo) => void;\n  onSelectFiles?: (fileIds: string[]) => void;\n  onFileSelect?: (file: FileInfo, checked: boolean) => void;\n  onSelectAll?: () => void;\n  onDeselectAll?: () => void;\n  onSelectAllFiles?: () => void;\n  onDeselectAllFiles?: () => void;\n  fileTypeFilter?: string | null;\n  isLoading?: boolean;\n  error?: string | null;\n  onBackClick?: () => void;\n  editingFileId?: string | null;\n  editingFile?: string | null;\n  editingName?: string;\n  editingTags?: string[];\n  newTag?: string;\n  onNewTagChange?: (value: string) => void;\n  onEditNameChange?: (value: string) => void;\n  onStartEdit?: (file: FileInfo) => void;\n  onConfirmEdit?: (fileId: string, newName: string, newTags: string[]) => void;\n  onCancelEdit?: () => void;\n  onAddTag?: (tag: string) => void;\n  onRemoveTag?: (tag: string) => void;\n  showCheckboxes?: boolean;\n  areAllSelected?: boolean;\n}\n\nexport function FileList({\n  files,\n  selectedFiles,\n  onFileClick,\n  onFileDoubleClick,\n  onFileContextMenu,\n  onSelectFiles,\n  onFileSelect,\n  onSelectAll,\n  onDeselectAll,\n  onSelectAllFiles,\n  onDeselectAllFiles,\n  fileTypeFilter,\n  isLoading,\n  error,\n  onBackClick,\n  editingFileId,\n  editingFile,\n  editingName: providedEditingName,\n  editingTags: providedEditingTags,\n  newTag: providedNewTag,\n  onNewTagChange,\n  onEditNameChange,\n  onStartEdit,\n  onConfirmEdit,\n  onCancelEdit,\n  onAddTag,\n  onRemoveTag,\n  showCheckboxes = true,\n  areAllSelected\n}: FileListProps) {\n  const actualEditingFileId = editingFileId || editingFile;\n\n  const [localEditName, setLocalEditName] = useState<string>('');\n  const [localEditTags, setLocalEditTags] = useState<string[]>([]);\n  const [localNewTag, setLocalNewTag] = useState<string>('');\n  \n  const editName = providedEditingName !== undefined ? providedEditingName : localEditName;\n  const editTags = providedEditingTags !== undefined ? providedEditingTags : localEditTags;\n  const newTagValue = providedNewTag !== undefined ? providedNewTag : localNewTag;\n  \n  const setEditName = (value: string) => {\n    if (onEditNameChange) {\n      onEditNameChange(value);\n    } else {\n      setLocalEditName(value);\n    }\n  };\n  \n  const setEditTags = (tags: string[]) => {\n    setLocalEditTags(tags);\n  };\n  \n  const setNewTag = (value: string) => {\n    if (onNewTagChange) {\n      onNewTagChange(value);\n    } else {\n      setLocalNewTag(value);\n    }\n  };\n\n  const editNameInputRef = useRef<HTMLInputElement>(null);\n  const newTagInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (actualEditingFileId && providedEditingName === undefined) {\n      const file = files.find(f => f.id === actualEditingFileId);\n      if (file) {\n        setLocalEditName(file.name);\n        setLocalEditTags(file.tags || []);\n      }\n    }\n    \n    if (actualEditingFileId) {\n      setTimeout(() => {\n        if (editNameInputRef.current) {\n          editNameInputRef.current.focus();\n          editNameInputRef.current.select();\n        }\n      }, 0);\n    }\n  }, [actualEditingFileId, files, providedEditingName]);\n\n  const handleEditKeyDown = (e: React.KeyboardEvent, fileId: string) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      onConfirmEdit && onConfirmEdit(fileId, editName, editTags);\n    } else if (e.key === 'Escape') {\n      e.preventDefault();\n      onCancelEdit && onCancelEdit();\n    }\n  };\n\n  const handleAddTag = () => {\n    const trimmedTag = newTagValue.trim();\n    if (!trimmedTag) return;\n    \n    if (!editTags.includes(trimmedTag)) {\n      if (onAddTag) {\n        onAddTag(trimmedTag);\n      } else {\n        setEditTags([...editTags, trimmedTag]);\n      }\n      setNewTag('');\n      \n      setTimeout(() => {\n        if (newTagInputRef.current) {\n          newTagInputRef.current.focus();\n        }\n      }, 0);\n    }\n  };\n\n  const handleRemoveTag = (tagToRemove: string) => {\n    if (onRemoveTag) {\n      onRemoveTag(tagToRemove);\n    } else {\n      setEditTags(editTags.filter(tag => tag !== tagToRemove));\n    }\n  };\n\n  const handleTagKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleAddTag();\n    }\n  };\n\n  const handleFileCheckboxChange = (file: FileInfo, checked: boolean) => {\n    if (onFileSelect) {\n      onFileSelect(file, checked);\n      return;\n    }\n    \n    if (onSelectFiles) {\n      if (checked) {\n        onSelectFiles([...selectedFiles, file.id]);\n      } else {\n        onSelectFiles(selectedFiles.filter(id => id !== file.id));\n      }\n    } else {\n      console.error('FileList: ç¼ºå°‘å¿…è¦çš„onSelectFilesæˆ–onFileSelectå›è°ƒå‡½æ•°');\n    }\n  };\n\n  const handleSelectAll = onSelectAll || onSelectAllFiles;\n  const handleDeselectAll = onDeselectAll || onDeselectAllFiles;\n\n  const renderFileIcon = (type?: string, extension?: string, isFolder?: boolean) => {\n    if (isFolder) return <Folder className={styles.fileIcon} />;\n    \n    const getFileIconType = () => {\n      if (!type) return 'file';\n      \n      if (type.includes('image')) return 'image';\n      if (type.includes('text') || type.includes('document') || extension?.match(/docx?|pdf|txt|md/i)) return 'file-text';\n      if (type.includes('video')) return 'video';\n      if (type.includes('audio')) return 'music';\n      if (extension?.match(/zip|rar|7z|tar|gz/i)) return 'archive';\n      if (extension?.match(/js|ts|jsx|tsx|py|java|c|cpp|go|rb|php|html|css/i)) return 'code';\n      \n      return 'file';\n    };\n    \n    const iconType = getFileIconType();\n    const IconComponent = {\n      'folder': Folder,\n      'file': FileIcon,\n      'image': ImageIcon,\n      'file-text': FileText,\n      'video': Video,\n      'music': Music,\n      'archive': FileIcon,\n      'code': FileIcon\n    }[iconType] || FileIcon;\n\n    return <IconComponent className={styles.fileIcon} />;\n  };\n\n  const renderTags = (file: FileInfo) => {\n    const tags = file.tags || [];\n    \n    if (actualEditingFileId === file.id) {\n      return (\n        <div className={styles.tagEditContainer}>\n          <div className={styles.editTagsList}>\n            {editTags.map((tag, index) => (\n              <div key={index} className={styles.editTag}>\n                <span>{tag}</span>\n                <button \n                  className={styles.removeTagButton}\n                  onClick={() => handleRemoveTag(tag)}\n                >\n                  <X size={12} />\n                </button>\n              </div>\n            ))}\n          </div>\n          <div className={styles.addTagInput}>\n            <input\n              ref={newTagInputRef}\n              type=\"text\"\n              placeholder=\"æ·»åŠ æ ‡ç­¾...\"\n              value={localNewTag}\n              onChange={(e) => setNewTag(e.target.value)}\n              onKeyDown={handleTagKeyDown}\n              className={styles.tagInput}\n            />\n            <button \n              className={styles.addTagButton}\n              onClick={handleAddTag}\n            >\n              <Plus size={14} />\n            </button>\n          </div>\n        </div>\n      );\n    }\n    \n    if (!tags || tags.length === 0) return <span className={styles.emptyText}>-</span>;\n    \n    const maxTagsToShow = 3;\n    const visibleTags = tags.slice(0, maxTagsToShow);\n    const extraTagsCount = tags.length - maxTagsToShow;\n    \n    return (\n      <div className={styles.tagContainer}>\n        {visibleTags.map((tag, index) => (\n          <span key={index} className={styles.tag}>\n            {tag}\n          </span>\n        ))}\n        {extraTagsCount > 0 && (\n          <span className={styles.extraTagsCount}>+{extraTagsCount}</span>\n        )}\n      </div>\n    );\n  };\n\n  const isAllSelected = areAllSelected !== undefined \n    ? areAllSelected \n    : (files.length > 0 && selectedFiles.length === files.length);\n\n  if (!Array.isArray(files) || files.length === 0) {\n    const getEmptyStateMessage = () => {\n      if (fileTypeFilter) {\n        switch(fileTypeFilter) {\n          case 'image':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶`;\n          case 'document':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡æ¡£æ–‡ä»¶`;\n          case 'video':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°è§†é¢‘æ–‡ä»¶`;\n          case 'audio':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶`;\n          case 'other':\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å…¶ä»–ç±»å‹çš„æ–‡ä»¶`;\n          default:\n            return `æ²¡æœ‰æ‰¾åˆ°${fileTypeFilter}ç±»å‹çš„æ–‡ä»¶`;\n        }\n      }\n      return 'æ²¡æœ‰æ–‡ä»¶';\n    };\n\n    const getEmptyStateIcon = () => {\n      if (fileTypeFilter) {\n        return <Filter size={50} stroke=\"#CBD5E0\" />;\n      }\n      return <FileIcon size={50} stroke=\"#CBD5E0\" />;\n    };\n\n    const getEmptyStateHint = () => {\n      if (fileTypeFilter) {\n        return `ç³»ç»Ÿå·²æœç´¢æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œæœªæ‰¾åˆ°${\n          fileTypeFilter === 'image' ? 'å›¾ç‰‡' : \n          fileTypeFilter === 'document' ? 'æ–‡æ¡£' : \n          fileTypeFilter === 'video' ? 'è§†é¢‘' :\n          fileTypeFilter === 'audio' ? 'éŸ³é¢‘' : 'è¯¥ç±»å‹'\n        }æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä¸Šä¼ ä¸€äº›ï¼Œæˆ–é€‰æ‹©å…¶ä»–æ–‡ä»¶ç±»å‹æŸ¥çœ‹ã€‚`;\n      }\n      return 'ä¸Šä¼ æ–‡ä»¶æˆ–åˆ›å»ºæ–‡ä»¶å¤¹ä»¥å¼€å§‹ç®¡ç†æ‚¨çš„æ–‡ä»¶';\n    };\n\n    return (\n      <div className={styles.emptyState}>\n        {getEmptyStateIcon()}\n        <p className={styles.emptyStateText}>{getEmptyStateMessage()}</p>\n        <p className={styles.emptyStateHint}>\n          {getEmptyStateHint()}\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className={styles.fileListWrapper}>\n      <div className={styles.fileListContainer}>\n        <table className={styles.fileTable}>\n          <thead>\n            <tr>\n              <th>\n                <input\n                  type=\"checkbox\"\n                  checked={isAllSelected}\n                  onChange={isAllSelected ? \n                    () => handleDeselectAll && handleDeselectAll() : \n                    () => handleSelectAll && handleSelectAll()}\n                  disabled={!showCheckboxes}\n                />\n              </th>\n              <th>åç§°</th>\n              <th>ç±»å‹</th>\n              <th>å¤§å°</th>\n              <th>æ ‡ç­¾</th>\n              <th>ä¿®æ”¹æ—¥æœŸ</th>\n              <th>æ“ä½œ</th>\n            </tr>\n          </thead>\n          <tbody>\n            {files.map((file) => {\n              const isSelected = selectedFiles.includes(file.id);\n              const isEditing = actualEditingFileId === file.id;\n              \n              return (\n                <tr\n                  key={file.id}\n                  className={`${styles.fileRow} ${isSelected ? styles.selectedRow : ''} ${isEditing ? styles.editingRow : ''}`}\n                  onClick={() => !isEditing && onFileClick(file)}\n                  onDoubleClick={() => {\n                    if (!isEditing && onStartEdit && !file.isFolder) {\n                      onStartEdit(file);\n                    } else if (!isEditing && onFileDoubleClick) {\n                      onFileDoubleClick(file);\n                    }\n                  }}\n                  onContextMenu={(e) => !isEditing && onFileContextMenu && onFileContextMenu(e, file)}\n                >\n                  <td>\n                    {showCheckboxes && (\n                      <input\n                        type=\"checkbox\"\n                        checked={isSelected}\n                        onChange={(e) => handleFileCheckboxChange(file, e.target.checked)}\n                        onClick={(e) => e.stopPropagation()}\n                        disabled={isEditing}\n                      />\n                    )}\n                  </td>\n                  <td className={styles.fileNameCell}>\n                    <span className={styles.fileIcon}>\n                      {renderFileIcon(file.type, file.extension, file.isFolder)}\n                    </span>\n                    {isEditing ? (\n                      <input\n                        ref={editNameInputRef}\n                        type=\"text\"\n                        className={styles.fileNameInput}\n                        value={editName}\n                        onChange={(e) => setEditName(e.target.value)}\n                        onKeyDown={(e) => handleEditKeyDown(e, file.id)}\n                        onClick={(e) => e.stopPropagation()}\n                        autoComplete=\"off\"\n                      />\n                    ) : (\n                      <span className={styles.fileName}>{file.name}</span>\n                    )}\n                    {isEditing && (\n                      <div className={styles.editActions}>\n                        <button \n                          className={styles.editActionButton}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onConfirmEdit && onConfirmEdit(file.id, editName, editTags);\n                          }}\n                        >\n                          <Check size={16} />\n                        </button>\n                        <button \n                          className={styles.editActionButton}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            onCancelEdit && onCancelEdit();\n                          }}\n                        >\n                          <X size={16} />\n                        </button>\n                      </div>\n                    )}\n                  </td>\n                  <td>{file.isFolder ? 'æ–‡ä»¶å¤¹' : \n                     file.type === 'document' ? 'æ–‡æ¡£' : \n                     getFileTypeDisplay(file.type || null, file.extension)}</td>\n                  <td>{file.size ? `${Math.round(file.size / 1024)} KB` : '-'}</td>\n                  <td className={styles.tagsCell}>{renderTags(file)}</td>\n                  <td>\n                    {file.createdAt \n                      ? new Date(file.createdAt).toLocaleString() \n                      : '-'\n                    }\n                  </td>\n                  <td>\n                    {!isEditing ? (\n                      <button \n                        className={styles.actionButton}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          if (onStartEdit) {\n                            onStartEdit(file);\n                          } else if (onFileContextMenu) {\n                            onFileContextMenu(e, file);\n                          }\n                        }}\n                      >\n                        <MoreVertical size={16} />\n                      </button>\n                    ) : (\n                      <span className={styles.editingMessage}>ç¼–è¾‘ä¸­</span>\n                    )}\n                  </td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}"
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\index.ts",
    "newContent": "export * from './Sidebar';\nexport * from './Breadcrumb';\nexport * from './FileList';\n// export * from './UploadModal'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadModal\n// export * from './UploadButton'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadButton\nexport * from './Skeleton';\nexport * from './ErrorDisplay'; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\Sidebar.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Sidebar ç»„ä»¶ã€‚\n */\n\nimport React, { useEffect } from 'react';\nimport { \n  Folder, Files, Image as ImageIcon, FileText, \n  Video, Music, File, Search, ChevronDown, \n  Star, Clock, Tag, Download, Settings,\n  CheckCircle\n} from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\n\nexport type FileType = 'image' | 'document' | 'video' | 'audio' | 'other' | null;\n\ninterface SidebarProps {\n  selectedFileType: FileType;\n  onTypeClick: (type: FileType) => void;\n  onSearchClick?: () => void;\n}\n\nexport function Sidebar({ selectedFileType, onTypeClick, onSearchClick }: SidebarProps) {\n  const fileTypes: { type: FileType; label: string; icon: React.ElementType }[] = [\n    { type: null, label: 'å…¨éƒ¨æ–‡ä»¶', icon: Files },\n    { type: 'image', label: 'å›¾ç‰‡', icon: ImageIcon },\n    { type: 'document', label: 'æ–‡æ¡£', icon: FileText },\n    { type: 'video', label: 'è§†é¢‘', icon: Video },\n    { type: 'audio', label: 'éŸ³é¢‘', icon: Music },\n    { type: 'other', label: 'å…¶ä»–', icon: File }\n  ];\n\n  const [quickAccessExpanded, setQuickAccessExpanded] = React.useState(true);\n  const [myFilesExpanded, setMyFilesExpanded] = React.useState(true);\n  const [settingsExpanded, setSettingsExpanded] = React.useState(false);\n\n  // ç›‘å¬æ–‡ä»¶ç±»å‹å˜åŒ–å¹¶è®°å½•æ—¥å¿—\n  useEffect(() => {\n    console.log('ä¾§è¾¹æ ï¼šå½“å‰é€‰æ‹©çš„æ–‡ä»¶ç±»å‹:', selectedFileType);\n  }, [selectedFileType]);\n\n  const handleTypeClick = (type: FileType) => {\n    // ç›´æ¥è°ƒç”¨å›è°ƒï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–é€»è¾‘\n    console.log('Sidebarç›´æ¥ç‚¹å‡»ç±»å‹:', type);\n    onTypeClick(type);\n  };\n\n  return (\n    <div className={styles.sidebar}>\n      <div className={styles.sidebarSection}>\n        <div \n          className={styles.sidebarHeader} \n          onClick={() => setMyFilesExpanded(!myFilesExpanded)}\n        >\n          <Folder className={styles.icon} />\n          æˆ‘çš„æ–‡ä»¶\n          <ChevronDown \n            className={styles.icon} \n            style={{ \n              marginLeft: 'auto', \n              transform: myFilesExpanded ? 'rotate(180deg)' : 'rotate(0)', \n              transition: 'transform 0.3s' \n            }} \n            size={16} \n          />\n        </div>\n        {myFilesExpanded && (\n          <div className={styles.sidebarSubmenu}>\n            {fileTypes.map(({ type, label, icon: Icon }) => (\n              <div\n                key={type || 'all'}\n                className={`${styles.sidebarItem} ${selectedFileType === type ? styles.active : ''}`}\n                onClick={() => handleTypeClick(type)}\n              >\n                <Icon className={styles.icon} />\n                {label}\n                {selectedFileType === type && (\n                  <CheckCircle \n                    className={styles.icon} \n                    style={{ \n                      marginLeft: 'auto', \n                      color: 'var(--theme-primary, #3b82f6)',\n                      fill: 'var(--theme-primary, #3b82f6)',\n                      stroke: '#fff',\n                      opacity: 0.9,\n                    }} \n                    size={16} \n                  />\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div className={styles.sidebarSection}>\n        <div \n          className={styles.sidebarHeader}\n          onClick={() => setQuickAccessExpanded(!quickAccessExpanded)}\n        >\n          <Search className={styles.icon} />\n          å¿«æ·æŸ¥è¯¢\n          <ChevronDown \n            className={styles.icon} \n            style={{ \n              marginLeft: 'auto', \n              transform: quickAccessExpanded ? 'rotate(180deg)' : 'rotate(0)', \n              transition: 'transform 0.3s' \n            }} \n            size={16} \n          />\n        </div>\n        {quickAccessExpanded && (\n          <div className={styles.sidebarSubmenu}>\n            <div \n              className={styles.sidebarItem}\n              onClick={onSearchClick}\n            >\n              <Search className={styles.icon} />\n              æœç´¢æ–‡ä»¶\n            </div>\n            <div className={styles.sidebarItem}>\n              <Star className={styles.icon} />\n              æ”¶è—æ–‡ä»¶\n            </div>\n            <div className={styles.sidebarItem}>\n              <Clock className={styles.icon} />\n              æœ€è¿‘è®¿é—®\n            </div>\n            <div className={styles.sidebarItem}>\n              <Tag className={styles.icon} />\n              æŒ‰æ ‡ç­¾æŸ¥æ‰¾\n            </div>\n            <div className={styles.sidebarItem}>\n              <Download className={styles.icon} />\n              ä¸‹è½½è®°å½•\n            </div>\n          </div>\n        )}\n      </div>\n\n      <div className={styles.sidebarSection}>\n        <div \n          className={styles.sidebarHeader}\n          onClick={() => setSettingsExpanded(!settingsExpanded)}\n        >\n          <Settings className={styles.icon} />\n          ç³»ç»Ÿè®¾ç½®\n          <ChevronDown \n            className={styles.icon} \n            style={{ \n              marginLeft: 'auto', \n              transform: settingsExpanded ? 'rotate(180deg)' : 'rotate(0)', \n              transition: 'transform 0.3s' \n            }} \n            size={16} \n          />\n        </div>\n        {settingsExpanded && (\n          <div className={styles.sidebarSubmenu}>\n            <div className={styles.sidebarItem}>\n              <Settings className={styles.icon} />\n              å­˜å‚¨ç®¡ç†\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\Skeleton.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/Skeleton ç»„ä»¶ã€‚\n */\n\n'use client';\n\nimport React from 'react';\nimport styles from './Skeleton.module.css';\n\ninterface SkeletonProps {\n  variant?: 'sidebar' | 'file' | 'avatar' | 'text' | 'button' | 'card';\n  width?: string | number;\n  height?: string | number;\n  animation?: 'pulse' | 'wave' | 'none';\n  count?: number;\n  className?: string;\n  borderRadius?: string;\n}\n\nexport const Skeleton: React.FC<SkeletonProps> = ({ \n  variant = 'text', \n  width, \n  height, \n  animation = 'pulse',\n  count = 1,\n  className = '',\n  borderRadius\n}) => {\n  const getVariantStyles = () => {\n    switch (variant) {\n      case 'sidebar':\n        return {\n          width: width || '100%',\n          height: height || '40px',\n          borderRadius: borderRadius || '8px'\n        };\n      case 'file':\n        return {\n          width: width || '100%',\n          height: height || '56px',\n          borderRadius: borderRadius || '8px'\n        };\n      case 'avatar':\n        return {\n          width: width || '40px',\n          height: height || '40px',\n          borderRadius: borderRadius || '50%'\n        };\n      case 'text':\n        return {\n          width: width || '100%',\n          height: height || '16px',\n          borderRadius: borderRadius || '4px'\n        };\n      case 'button':\n        return {\n          width: width || '120px',\n          height: height || '36px',\n          borderRadius: borderRadius || '6px'\n        };\n      case 'card':\n        return {\n          width: width || '100%',\n          height: height || '200px',\n          borderRadius: borderRadius || '12px'\n        };\n      default:\n        return {\n          width: width || '100%',\n          height: height || '16px',\n          borderRadius: borderRadius || '4px'\n        };\n    }\n  };\n\n  const renderSkeleton = () => {\n    const items = [];\n    const baseStyles = getVariantStyles();\n    \n    for (let i = 0; i < count; i++) {\n      items.push(\n        <div \n          key={i}\n          className={`${styles.skeleton} ${styles[`animation-${animation}`]} ${className}`}\n          style={{\n            ...baseStyles,\n            marginBottom: count > 1 && i < count - 1 ? '8px' : '0'\n          }}\n        />\n      );\n    }\n    \n    return items;\n  };\n\n  return <>{renderSkeleton()}</>;\n};\n\nexport const SkeletonFileList: React.FC = () => {\n  return (\n    <div className={styles.fileListSkeleton}>\n      <div className={styles.fileListHeader}>\n        <Skeleton variant=\"text\" width=\"15%\" height=\"24px\" />\n        <div className={styles.headerActions}>\n          <Skeleton variant=\"button\" width=\"100px\" />\n          <Skeleton variant=\"button\" width=\"100px\" />\n        </div>\n      </div>\n      \n      <div className={styles.fileItems}>\n        {[...Array(8)].map((_, index) => (\n          <div key={index} className={styles.fileItemSkeleton}>\n            <div className={styles.fileIcon}>\n              <Skeleton variant=\"avatar\" width=\"32px\" height=\"32px\" borderRadius=\"6px\" />\n            </div>\n            <div className={styles.fileDetails}>\n              <Skeleton variant=\"text\" width=\"60%\" height=\"18px\" />\n              <Skeleton variant=\"text\" width=\"40%\" height=\"14px\" />\n            </div>\n            <div className={styles.fileActions}>\n              <Skeleton variant=\"button\" width=\"70px\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport const SkeletonSidebar: React.FC = () => {\n  return (\n    <div className={styles.sidebarSkeleton}>\n      <div className={styles.sidebarHeader}>\n        <Skeleton variant=\"text\" width=\"70%\" height=\"24px\" />\n      </div>\n      <div className={styles.sidebarContent}>\n        <Skeleton variant=\"sidebar\" count={5} />\n        <div className={styles.sidebarSection}>\n          <Skeleton variant=\"text\" width=\"50%\" height=\"18px\" />\n          <Skeleton variant=\"sidebar\" count={3} />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const SkeletonPageLayout: React.FC = () => {\n  return (\n    <div className={styles.pageLayoutSkeleton}>\n      <div className={styles.miniSidebarSkeleton}>\n        <Skeleton variant=\"avatar\" width=\"40px\" height=\"40px\" />\n        <Skeleton variant=\"button\" width=\"40px\" height=\"40px\" borderRadius=\"12px\" />\n        <Skeleton variant=\"button\" width=\"40px\" height=\"40px\" borderRadius=\"12px\" />\n      </div>\n      \n      <div className={styles.sidebarContainerSkeleton}>\n        <SkeletonSidebar />\n      </div>\n      \n      <div className={styles.mainContentSkeleton}>\n        <div className={styles.topBarSkeleton}>\n          <div className={styles.breadcrumbSkeleton}>\n            <Skeleton variant=\"text\" width=\"180px\" height=\"20px\" />\n          </div>\n          <div className={styles.actionButtonsSkeleton}>\n            <Skeleton variant=\"button\" width=\"100px\" />\n            <Skeleton variant=\"button\" width=\"100px\" />\n          </div>\n        </div>\n        \n        <SkeletonFileList />\n      </div>\n    </div>\n  );\n}; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\UploadButton.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadButton ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Upload, Folder, ChevronDown } from 'lucide-react';\nimport styles from '../../styles/shared.module.css';\nimport { UploadModal } from './UploadModal';\n\ninterface UploadButtonProps {\n  showDropdown: boolean;\n  setShowDropdown: (show: boolean) => void;\n  setIsModalOpen: (open: boolean) => void;\n  setIsFolderModalOpen: (open: boolean) => void;\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\n}\n\nexport function UploadButton({ \n  showDropdown, \n  setShowDropdown, \n  setIsModalOpen, \n  setIsFolderModalOpen,\n  uploadDropdownRef \n}: UploadButtonProps) {\n  \n  // å¤„ç†ä¸Šä¼ æŒ‰é’®ç‚¹å‡»\n  const handleUploadClick = (type: 'file' | 'folder') => {\n    if (type === 'file') {\n      setIsModalOpen(true);\n    } else {\n      setIsFolderModalOpen(true);\n    }\n    setShowDropdown(false);\n  };\n\n  return (\n    <div className={styles.uploadOptionsContainer} ref={uploadDropdownRef}>\n      <button\n        className={`${styles.uploadButton} ${showDropdown ? styles.activeButton : ''}`}\n        onClick={() => setShowDropdown(!showDropdown)}\n      >\n        <Upload size={18} className={styles.buttonIcon} />\n        ä¸Šä¼ æ–‡ä»¶\n        <ChevronDown size={16} className={styles.dropdownIcon} />\n      </button>\n      \n      {showDropdown && (\n        <div className={styles.dropdownMenu}>\n          <div \n            className={styles.dropdownItem}\n            onClick={() => handleUploadClick('file')}\n          >\n            <Upload size={16} className=\"mr-2\" />\n            <span>ä¸Šä¼ æ–‡ä»¶</span>\n          </div>\n          <div \n            className={styles.dropdownItem}\n            onClick={() => handleUploadClick('folder')}\n          >\n            <Folder size={16} className=\"mr-2\" />\n            <span>ä¸Šä¼ æ–‡ä»¶å¤¹</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\fileManagement\\shared\\UploadModal.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadModal ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useEffect, useRef, KeyboardEvent } from 'react';\nimport { InboxOutlined, CloseCircleOutlined, TagOutlined, CloseOutlined } from '@ant-design/icons';\nimport { Modal, Upload, Input, message, Button, Tag } from 'antd';\nimport type { RcFile, UploadFile } from 'antd/es/upload/interface';\nimport type { UploadProps } from 'antd';\nimport type { InputRef } from 'antd/es/input';\nimport { FileInfo, FileResponse } from '@/app/types';\nimport styles from '../../styles/shared.module.css';\nimport { useSession } from 'next-auth/react';\nimport { API_PATHS } from '@/app/lib/api/paths';\n\nconst { Dragger } = Upload;\n\ninterface UploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: (files?: FileInfo[]) => void;\n  isFolderUpload?: boolean;\n  currentFolderId?: string | null;\n}\n\n// æ‰©å±•UploadFileç±»å‹ï¼Œæ·»åŠ webkitRelativePathå±æ€§\ninterface ExtendedUploadFile extends UploadFile<any> {\n  webkitRelativePath?: string;\n}\n\nexport function UploadModal({\n  isOpen,\n  onClose,\n  onSuccess,\n  isFolderUpload = false,\n  currentFolderId\n}: UploadModalProps) {\n  const [fileList, setFileList] = useState<ExtendedUploadFile[]>([]);\n  const [tagInput, setTagInput] = useState<string>('');\n  const [tagList, setTagList] = useState<string[]>([]);\n  const [uploading, setUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const tagInputRef = useRef<InputRef>(null);\n  const { data: session } = useSession();\n\n  useEffect(() => {\n    // å½“æ¨¡æ€æ¡†æ‰“å¼€æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€\n    if (isOpen && !session) {\n      message.error('è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶');\n      onClose();\n    }\n  }, [isOpen, session, onClose]);\n\n  // å¤„ç†æ–‡ä»¶é€‰æ‹©\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const selectedFiles = e.target.files;\n    if (!selectedFiles || selectedFiles.length === 0) return;\n\n    const newFiles: ExtendedUploadFile[] = [];\n    for (let i = 0; i < selectedFiles.length; i++) {\n      const file = selectedFiles[i];\n      newFiles.push({\n        uid: `file-${Date.now()}-${i}`,\n        name: file.name,\n        size: file.size,\n        type: file.type,\n        originFileObj: file as any,\n        webkitRelativePath: file.webkitRelativePath, // æ·»åŠ ç›¸å¯¹è·¯å¾„\n      });\n    }\n\n    setFileList(prev => [...prev, ...newFiles]);\n    \n    // æ¸…ç©ºinputä»¥å…è®¸å†æ¬¡é€‰æ‹©ç›¸åŒçš„æ–‡ä»¶\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // å¤„ç†æ ‡ç­¾è¾“å…¥\n  const handleTagInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setTagInput(e.target.value);\n  };\n\n  // å¤„ç†æ ‡ç­¾è¾“å…¥çš„å›è½¦äº‹ä»¶\n  const handleTagInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Enter' && tagInput.trim()) {\n      e.preventDefault();\n      addTag(tagInput.trim());\n    }\n  };\n\n  // æ·»åŠ æ ‡ç­¾\n  const addTag = (tag: string) => {\n    if (!tag) return;\n    \n    // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨\n    if (!tagList.includes(tag)) {\n      setTagList(prev => [...prev, tag]);\n    }\n    \n    // æ¸…ç©ºè¾“å…¥æ¡†\n    setTagInput('');\n    \n    // èšç„¦å›è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ç»§ç»­è¾“å…¥\n    if (tagInputRef.current) {\n      setTimeout(() => {\n        tagInputRef.current?.focus();\n      }, 0);\n    }\n  };\n\n  // åˆ é™¤æ ‡ç­¾\n  const removeTag = (tagToRemove: string) => {\n    setTagList(tagList.filter(tag => tag !== tagToRemove));\n  };\n\n  const handleUpload = async () => {\n    if (fileList.length === 0) {\n      message.warning('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');\n      return;\n    }\n\n    setUploading(true);\n\n    try {\n      const formData = new FormData();\n      \n      // æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°FormData\n      let filesAdded = 0;\n      fileList.forEach((file, index) => {\n        const rawFile = file.originFileObj;\n        if (rawFile instanceof File) {\n          // ä½¿ç”¨'file'å­—æ®µåï¼Œä¸åç«¯å¯¹åº”\n          formData.append('file', rawFile);\n          \n          // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæ·»åŠ ç›¸å¯¹è·¯å¾„ä¿¡æ¯\n          if (isFolderUpload && file.webkitRelativePath) {\n            // ä½¿ç”¨æ•°å­—ç´¢å¼•ä½œä¸ºé”®ï¼Œç¡®ä¿åç«¯å¯ä»¥æ­£ç¡®è§£æ\n            formData.append(`paths_${index}`, file.webkitRelativePath);\n            console.log(`æ–‡ä»¶ ${index}: ${file.name} - è·¯å¾„: ${file.webkitRelativePath}`);\n          }\n          \n          filesAdded++;\n          console.log(`æ·»åŠ æ–‡ä»¶ ${index+1}: ${file.name}, å¤§å°: ${file.size} å­—èŠ‚`);\n        } else {\n          console.warn(`æ— æ³•è·å–æ–‡ä»¶ ${index+1}: ${file.name} çš„åŸå§‹Fileå¯¹è±¡`);\n        }\n      });\n      \n      if (filesAdded === 0) {\n        throw new Error('æ— æ³•å¤„ç†ä¸Šä¼ æ–‡ä»¶ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶');\n      }\n      \n      // æ·»åŠ æ ‡å¿—è¡¨æ˜è¿™æ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ \n      if (isFolderUpload) {\n        formData.append('isFolderUpload', 'true');\n        console.log('æ–‡ä»¶å¤¹ä¸Šä¼ æ¨¡å¼å·²å¯ç”¨');\n      }\n      \n      // å°†æ ‡ç­¾æ•°ç»„è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²\n      if (tagList.length > 0) {\n        formData.append('tags', JSON.stringify(tagList));\n        console.log('æ·»åŠ æ ‡ç­¾:', tagList);\n      }\n\n      if (currentFolderId) {\n        formData.append('folderId', currentFolderId);\n        console.log('å½“å‰æ–‡ä»¶å¤¹ID:', currentFolderId);\n      }\n\n      console.log(`å‡†å¤‡ä¸Šä¼  ${filesAdded} ä¸ªæ–‡ä»¶...`);\n      \n      // æ˜¾ç¤ºä¸Šä¼ å¼€å§‹æ¶ˆæ¯\n      const uploadKey = `upload-${Date.now()}`;\n      message.loading({ content: 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...', key: uploadKey, duration: 0 });\n\n      // ä½¿ç”¨fetchå‘é€è¯·æ±‚\n      const response = await fetch(API_PATHS.STORAGE.FILES.UPLOAD, {\n        method: 'POST',\n        body: formData,\n      });\n\n      // è·å–å“åº”\n      const contentType = response.headers.get(\"content-type\");\n      let data;\n      \n      if (contentType && contentType.includes(\"application/json\")) {\n        data = await response.json();\n      } else {\n        // å¦‚æœä¸æ˜¯JSONå“åº”ï¼Œå°è¯•è·å–æ–‡æœ¬\n        const text = await response.text();\n        console.error('æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”:', text);\n        throw new Error('æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”æ ¼å¼');\n      }\n      \n      // æ£€æŸ¥å“åº”çŠ¶æ€\n      if (!response.ok) {\n        console.error('ä¸Šä¼ å“åº”é”™è¯¯:', data);\n        \n        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯\n        message.error({ \n          content: `ä¸Šä¼ å¤±è´¥: ${data.details || data.error || 'æœåŠ¡å™¨é”™è¯¯'}`, \n          key: uploadKey,\n          duration: 5 \n        });\n        \n        throw new Error(data.details || data.error || 'ä¸Šä¼ å¤±è´¥');\n      }\n\n      // ä¸Šä¼ æˆåŠŸå¤„ç†\n      console.log('ä¸Šä¼ æˆåŠŸ:', data);\n      message.success({ content: 'ä¸Šä¼ æˆåŠŸ', key: uploadKey, duration: 3 });\n      \n      // å…³é—­æ¨¡æ€æ¡†å¹¶é€šçŸ¥çˆ¶ç»„ä»¶\n      handleClose();\n      if (typeof onSuccess === 'function') {\n        onSuccess(data.files || (data.file ? [data.file] : undefined));\n      } else {\n        console.warn('onSuccessä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ— æ³•é€šçŸ¥ä¸Šä¼ æˆåŠŸ');\n      }\n    } catch (error) {\n      console.error('ä¸Šä¼ è¿‡ç¨‹ä¸­å‡ºé”™:', error);\n      message.error(`ä¸Šä¼ å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    setFileList([]);\n    setTagInput('');\n    setTagList([]);\n    onClose();\n  };\n  \n  // ç›´æ¥ä½¿ç”¨åŸç”Ÿæ–‡ä»¶è¾“å…¥\n  const triggerFileInput = () => {\n    if (fileInputRef.current) {\n      fileInputRef.current.click();\n    }\n  };\n  \n  const removeFile = (index: number) => {\n    setFileList(prev => prev.filter((_, i) => i !== index));\n  };\n\n  return (\n    <Modal\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\n      open={isOpen}\n      onCancel={handleClose}\n      onOk={handleUpload}\n      okText=\"ä¸Šä¼ \"\n      cancelText=\"å–æ¶ˆ\"\n      confirmLoading={uploading}\n      width={600}\n    >\n      <div className={styles.uploadContainer || ''}>\n        <input\n          type=\"file\"\n          ref={fileInputRef}\n          onChange={handleFileChange}\n          style={{ display: 'none' }}\n          multiple={true}\n          {...(isFolderUpload ? { webkitdirectory: '', directory: '', mozdirectory: '', msdirectory: '' } : {})}\n        />\n        \n        <div \n          className={styles.dropzone || ''}\n          onClick={triggerFileInput}\n          style={{ \n            border: '2px dashed #d9d9d9',\n            borderRadius: '4px',\n            padding: '20px',\n            textAlign: 'center',\n            cursor: 'pointer',\n            marginBottom: '16px'\n          }}\n        >\n          <p><InboxOutlined style={{ fontSize: '48px', color: '#40a9ff' }} /></p>\n          <p style={{ marginTop: '8px', fontWeight: 'bold' }}>\n            ç‚¹å‡»æˆ–æ‹–æ‹½{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}åˆ°æ­¤åŒºåŸŸä¸Šä¼ \n          </p>\n          <p style={{ color: '#888' }}>\n            {isFolderUpload\n              ? 'æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å†…éƒ¨æ–‡ä»¶ï¼Œä¿ç•™æ–‡ä»¶å¤¹ç»“æ„'\n              : 'æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡ä¸Šä¼ æ–‡ä»¶ï¼Œæœ€å¤§æ”¯æŒåŒæ—¶é€‰æ‹©50ä¸ªæ–‡ä»¶'}\n          </p>\n          <Button type=\"primary\" onClick={(e) => { e.stopPropagation(); triggerFileInput(); }}>\n            é€‰æ‹©{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}\n          </Button>\n        </div>\n        \n        {fileList.length > 0 && (\n          <div style={{ marginBottom: '16px' }}>\n            <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\n              å·²é€‰æ‹© {fileList.length} ä¸ªæ–‡ä»¶:\n            </div>\n            <ul style={{ maxHeight: '150px', overflowY: 'auto', padding: '0 0 0 20px' }}>\n              {fileList.map((file, index) => (\n                <li key={file.uid} style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>\n                  <span>\n                    {file.name} \n                    {isFolderUpload && file.webkitRelativePath && (\n                      <span style={{ fontSize: '12px', color: '#8c8c8c', marginLeft: '4px' }}>\n                        (è·¯å¾„: {file.webkitRelativePath.split('/').slice(0, -1).join('/')})\n                      </span>\n                    )}\n                    ({((file.size || 0) / 1024).toFixed(2)} KB)\n                  </span>\n                  <Button \n                    type=\"text\" \n                    danger \n                    onClick={() => removeFile(index)}\n                    style={{ padding: '0 4px' }}\n                  >\n                    åˆ é™¤\n                  </Button>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n\n        <div style={{ marginTop: 16 }}>\n          <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\n            <span style={{ fontWeight: 'bold', marginRight: '8px' }}>æ·»åŠ æ ‡ç­¾:</span>\n            <span style={{ fontSize: '12px', color: '#8c8c8c' }}>\n              (è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ )\n            </span>\n          </div>\n          \n          <div className={styles.tagsInputWrapper}>\n            <Input\n              ref={tagInputRef}\n              placeholder=\"è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ \"\n              value={tagInput}\n              onChange={handleTagInputChange}\n              onKeyDown={handleTagInputKeyDown}\n              prefix={<TagOutlined style={{ color: '#bfbfbf' }} />}\n              suffix={\n                <span style={{ color: '#bfbfbf', fontSize: '12px' }}>\n                  æŒ‰å›è½¦æ·»åŠ \n                </span>\n              }\n            />\n          </div>\n          \n          <div className={styles.tagsContainer}>\n            {tagList.length > 0 ? (\n              <div className={styles.tagsList}>\n                {tagList.map((tag, index) => (\n                  <Tag\n                    key={index}\n                    closable\n                    onClose={() => removeTag(tag)}\n                    className={styles.interactiveTag}\n                  >\n                    {tag}\n                  </Tag>\n                ))}\n              </div>\n            ) : (\n              <div className={styles.emptyTagsHint}>\n                æ·»åŠ ä¸€äº›æ ‡ç­¾æ¥å¸®åŠ©ç®¡ç†æ‚¨çš„æ–‡ä»¶\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div style={{ marginTop: '16px', padding: '12px', background: '#f5f5f5', borderRadius: '8px', fontSize: '13px', color: '#555' }}>\n          <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\n            {isFolderUpload ? 'æ–‡ä»¶å¤¹ä¸Šä¼ è¯´æ˜:' : 'æ–‡ä»¶ä¸Šä¼ è¯´æ˜:'}\n          </div>\n          <ul style={{ paddingLeft: '16px', margin: '0' }}>\n            {isFolderUpload ? (\n              <>\n                <li>æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹ç»“æ„</li>\n                <li>ä¿ç•™å®Œæ•´çš„æ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„</li>\n                <li>ç›®å‰ä»…Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©</li>\n                <li>å¦‚æœæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©ï¼Œè¯·é€‰æ‹©å•ä¸ªæ–‡ä»¶æ¨¡å¼</li>\n              </>\n            ) : (\n              <>\n                <li>æ”¯æŒæ‰¹é‡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</li>\n                <li>æ”¯æŒå¸¸è§çš„æ–‡ä»¶æ ¼å¼ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰</li>\n                <li>æ¯ä¸ªæ–‡ä»¶å¤§å°é™åˆ¶ä¸º50MB</li>\n                <li>ä¸€æ¬¡æœ€å¤šå¯é€‰æ‹©50ä¸ªæ–‡ä»¶</li>\n              </>\n            )}\n            <li>æ‚¨å¯ä»¥ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ·»åŠ æ ‡ç­¾ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»„ç»‡å’ŒæŸ¥æ‰¾</li>\n          </ul>\n        </div>\n      </div>\n    </Modal>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\fileManagement\\SortDropdown.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/SortDropdown ç»„ä»¶ã€‚\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport styles from '../styles/SortDropdown.module.css';\nimport { FileSortInterface, SortDirectionEnum } from '@/app/types';\n\ninterface SortDropdownProps {\n  sortOrder: FileSortInterface;\n  onSortChange: (order: FileSortInterface) => void;\n}\n\nexport const SortDropdown: React.FC<SortDropdownProps> = ({\n  sortOrder,\n  onSortChange\n}) => {\n  const [showDropdown, setShowDropdown] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n        setShowDropdown(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // æ ¹æ®å½“å‰æ’åºå­—æ®µè·å–æ˜¾ç¤ºæ–‡æœ¬\n  const getSortFieldText = () => {\n    switch(sortOrder.field) {\n      case 'name': return 'æ–‡ä»¶å';\n      case 'size': return 'å¤§å°';\n      case 'createdAt': return 'æ—¶é—´';\n      default: return 'é»˜è®¤';\n    }\n  };\n\n  return (\n    <div className={styles.sortDropdown} ref={dropdownRef}>\n      <button \n        className={styles.topButton}\n        onClick={() => setShowDropdown(!showDropdown)}\n        style={{ \n          background: showDropdown ? '#f0f7ff' : 'white',\n          borderColor: showDropdown ? '#60a5fa' : '#e8e8e8'\n        }}\n      >\n        <span>â†•ï¸</span>\n        æ’åº: {getSortFieldText()} {sortOrder.direction === SortDirectionEnum.ASC ? 'â†‘' : 'â†“'}\n      </button>\n      {showDropdown && (\n        <div className={styles.dropdownMenu}>\n          <button \n            className={styles.dropdownItem}\n            onClick={() => {\n              const newSortOrder: FileSortInterface = {\n                field: 'name',\n                direction: sortOrder.field === 'name' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\n              };\n              onSortChange(newSortOrder);\n              setShowDropdown(false);\n            }}\n            style={{ \n              fontWeight: sortOrder.field === 'name' ? 'bold' : 'normal',\n              background: sortOrder.field === 'name' ? '#f0f7ff' : 'transparent'\n            }}\n          >\n            <span>ğŸ“</span>\n            æŒ‰æ–‡ä»¶å{sortOrder.field === 'name' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\n          </button>\n          <button \n            className={styles.dropdownItem}\n            onClick={() => {\n              const newSortOrder: FileSortInterface = {\n                field: 'size',\n                direction: sortOrder.field === 'size' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\n              };\n              onSortChange(newSortOrder);\n              setShowDropdown(false);\n            }}\n            style={{ \n              fontWeight: sortOrder.field === 'size' ? 'bold' : 'normal',\n              background: sortOrder.field === 'size' ? '#f0f7ff' : 'transparent'\n            }}\n          >\n            <span>ğŸ“Š</span>\n            æŒ‰å¤§å°{sortOrder.field === 'size' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\n          </button>\n          <button \n            className={styles.dropdownItem}\n            onClick={() => {\n              const newSortOrder: FileSortInterface = {\n                field: 'createdAt',\n                direction: sortOrder.field === 'createdAt' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\n              };\n              onSortChange(newSortOrder);\n              setShowDropdown(false);\n            }}\n            style={{ \n              fontWeight: sortOrder.field === 'createdAt' ? 'bold' : 'normal',\n              background: sortOrder.field === 'createdAt' ? '#f0f7ff' : 'transparent'\n            }}\n          >\n            <span>ğŸ•’</span>\n            æŒ‰æ—¶é—´{sortOrder.field === 'createdAt' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SortDropdown; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\Toolbar.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/toolbar/Toolbar ç»„ä»¶ã€‚\n */\n\nimport React, { useRef, useState } from 'react';\nimport { useFileContext } from '../context/FileContext';\nimport { X, Download, Edit, Move } from 'lucide-react';\nimport { message } from 'antd';\nimport styles from './Toolbar.module.css';\nimport commonStyles from '../styles/common.module.css';\n\ninterface ToolbarProps {\n  onUploadClick: () => void;\n  onFolderUploadClick: () => void;\n  onCreateFolderClick: () => void;\n}\n\nexport function Toolbar({ onUploadClick, onFolderUploadClick, onCreateFolderClick }: ToolbarProps) {\n  const {\n    selectedFiles,\n    clearSelection,\n    files\n  } = useFileContext();\n\n  const [showUploadDropdown, setShowUploadDropdown] = useState(false);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const handleDownload = () => {\n    // TODO: å®ç°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½\n    message.info('ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­');\n  };\n\n  const handleRename = () => {\n    if (selectedFiles.length !== 1) {\n      message.warning('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé‡å‘½å');\n      return;\n    }\n    const selectedFile = files.find(file => file.id === selectedFiles[0]);\n    if (selectedFile) {\n      // TODO: å®ç°é‡å‘½ååŠŸèƒ½\n      message.info('é‡å‘½ååŠŸèƒ½å¼€å‘ä¸­');\n    }\n  };\n\n  return (\n    <div className={styles.topBar}>\n      <div className={styles.buttonGroup}>\n        {selectedFiles.length > 0 ? (\n          <>\n            <button className={styles.topButton} onClick={() => clearSelection()}>\n              <X className={commonStyles.icon} />\n              å–æ¶ˆé€‰æ‹©\n            </button>\n            <button className={styles.topButton} onClick={handleDownload}>\n              <Download className={commonStyles.icon} />\n              ä¸‹è½½\n            </button>\n            <button className={styles.topButton} onClick={handleRename}>\n              <Edit className={commonStyles.icon} />\n              é‡å‘½å\n            </button>\n            <button className={styles.topButton}>\n              <Move className={commonStyles.icon} />\n              ç§»åŠ¨\n            </button>\n          </>\n        ) : (\n          <>\n            <div className={styles.uploadDropdown} ref={dropdownRef}>\n              <button\n                className={styles.topButton}\n                onClick={() => setShowUploadDropdown(!showUploadDropdown)}\n              >\n                <span className={styles.buttonIcon}>â¬†ï¸</span>\n                ä¸Šä¼ \n                <span className={styles.dropdownArrow}>â–¼</span>\n              </button>\n              {showUploadDropdown && (\n                <div className={styles.dropdownMenu}>\n                  <button\n                    className={styles.dropdownItem}\n                    onClick={() => {\n                      onUploadClick();\n                      setShowUploadDropdown(false);\n                    }}\n                  >\n                    <span className={styles.buttonIcon}>ğŸ“„</span>\n                    ä¸Šä¼ æ–‡ä»¶\n                  </button>\n                  <button\n                    className={styles.dropdownItem}\n                    onClick={() => {\n                      onFolderUploadClick();\n                      setShowUploadDropdown(false);\n                    }}\n                  >\n                    <span className={styles.buttonIcon}>ğŸ“</span>\n                    ä¸Šä¼ æ–‡ä»¶å¤¹\n                  </button>\n                </div>\n              )}\n            </div>\n            <button\n              className={styles.topButton}\n              onClick={onCreateFolderClick}\n            >\n              <span className={styles.buttonIcon}>ğŸ“</span>\n              æ–°å»ºæ–‡ä»¶å¤¹\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n} "
  },
  {
    "path": "app\\components\\features\\fileManagement\\TopActionBar.tsx",
    "newContent": "/**\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/TopActionBar ç»„ä»¶ã€‚\n */\n\nimport React from 'react';\nimport { \n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \n} from 'lucide-react';\nimport styles from '../styles/shared.module.css';\nimport SortDropdown from './SortDropdown';\nimport { UploadButton } from '../components/shared';\nimport { FileSortInterface } from '@/app/types';\n\ninterface TopActionBarProps {\n  selectedFiles: string[];\n  onClearSelection: () => void;\n  onDownload: () => void;\n  onRename: () => void;\n  onMove: () => void;\n  onDelete: () => void;\n  onClearFilter: () => void;\n  onCreateFolder: () => void;\n  selectedFileType: string | null;\n  showSearchView: boolean;\n  isInRootFolder: boolean;\n  sortOrder: FileSortInterface;\n  setSortOrder: (order: FileSortInterface) => void;\n  showUploadDropdown: boolean;\n  setShowUploadDropdown: (show: boolean) => void;\n  setIsUploadModalOpen: (open: boolean) => void;\n  setIsFolderUploadModalOpen: (open: boolean) => void;\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\n}\n\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\n  selectedFiles,\n  onClearSelection,\n  onDownload,\n  onRename,\n  onMove,\n  onDelete,\n  onClearFilter,\n  onCreateFolder,\n  selectedFileType,\n  showSearchView,\n  isInRootFolder,\n  sortOrder,\n  setSortOrder,\n  showUploadDropdown,\n  setShowUploadDropdown,\n  setIsUploadModalOpen,\n  setIsFolderUploadModalOpen,\n  uploadDropdownRef\n}) => {\n  return (\n    <div className={styles.topBar}>\n      <div className={styles.buttonGroup}>\n        {selectedFiles.length > 0 ? (\n          <>\n            <button className={styles.topButton} onClick={onClearSelection}>\n              <X className=\"w-4 h-4\" />\n              å–æ¶ˆé€‰æ‹©\n            </button>\n            <button className={styles.topButton} onClick={onDownload}>\n              <Download className=\"w-4 h-4\" />\n              ä¸‹è½½\n            </button>\n            <button \n              className={styles.topButton}\n              onClick={onRename}\n            >\n              <Edit className=\"w-4 h-4\" />\n              é‡å‘½å\n            </button>\n            <button className={styles.topButton} onClick={onMove}>\n              <Move className=\"w-4 h-4\" />\n              ç§»åŠ¨\n            </button>\n            <button className={styles.topButton} onClick={onDelete}>\n              <Trash2 className=\"w-4 h-4\" />\n              åˆ é™¤\n            </button>\n          </>\n        ) : (\n          <>\n            <button \n              className={styles.topButton}\n              onClick={onClearFilter}\n              disabled={isInRootFolder}\n            >\n              <span>ğŸ“</span>\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\n            </button>\n\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\n            {selectedFileType && (\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\n                {(() => {\n                  switch(selectedFileType) {\n                    case 'image': return <ImageIcon className=\"w-4 h-4 mr-2\" />;\n                    case 'document': return <FileText className=\"w-4 h-4 mr-2\" />;\n                    case 'video': return <Video className=\"w-4 h-4 mr-2\" />;\n                    case 'audio': return <Music className=\"w-4 h-4 mr-2\" />;\n                    case 'other': return <File className=\"w-4 h-4 mr-2\" />;\n                    default: return null;\n                  }\n                })()}\n                å½“å‰æµè§ˆï¼š\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\n              </div>\n            )}\n\n            {/* æ’åºä¸‹æ‹‰èœå• */}\n            <SortDropdown \n              sortOrder={sortOrder}\n              onSortChange={setSortOrder}\n            />\n            \n            {/* ä¸Šä¼ æŒ‰é’® */}\n            <UploadButton \n              showDropdown={showUploadDropdown}\n              setShowDropdown={setShowUploadDropdown}\n              setIsModalOpen={setIsUploadModalOpen}\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\n              uploadDropdownRef={uploadDropdownRef}\n            />\n            \n            <button \n              className={styles.folderButton} \n              onClick={onCreateFolder}\n            >\n              <FolderUp className=\"w-4 h-4 mr-2\" />\n              æ–°å»ºæ–‡ä»¶å¤¹\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default TopActionBar; "
  },
  {
    "path": "app\\components\\features\\fileManagement\\upload\\UploadModal\\UploadModal.tsx",
    "newContent": "'use client';\r\n\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { Modal, Button, Space, Tag, Input, message, Progress } from 'antd';\r\nimport { UploadOutlined, FolderOutlined } from '@ant-design/icons';\r\nimport { UploadModalProps } from '@/app/types/domains/file-management';\r\nimport { FileTreeNode } from '@/app/types/domains/fileTypes';\r\nimport { formatFileSize } from '@/app/lib/utils/file';\r\nimport { uploadFile, uploadFolder, processSelectedFiles } from '@/app/lib/uploadService';\r\n\r\n// æ„å»ºæ–‡ä»¶æ ‘èŠ‚ç‚¹\r\nfunction createFileTreeNode(name: string, type: 'file' | 'folder', size: number = 0, file?: File): FileTreeNode {\r\n  return {\r\n    name,\r\n    type,\r\n    size,\r\n    children: type === 'folder' ? [] : undefined,\r\n    file: file as any\r\n  };\r\n}\r\n\r\n// æ›´æ–°æ–‡ä»¶å¤¹å¤§å°\r\nfunction updateFolderSize(node: FileTreeNode, fileSize: number) {\r\n  let currentNode = node;\r\n  while (currentNode) {\r\n    currentNode.size += fileSize;\r\n    currentNode = currentNode.children?.find(child => \r\n      child.type === 'folder'\r\n    ) as FileTreeNode;\r\n  }\r\n}\r\n\r\n// æ„å»ºæ–‡ä»¶æ ‘ç»“æ„\r\nfunction buildFileTree(files: File[], rootName: string): FileTreeNode {\r\n  const root = createFileTreeNode(rootName, 'folder');\r\n  \r\n  files.forEach(file => {\r\n    const paths = (file as any).webkitRelativePath.split('/');\r\n    let currentNode = root;\r\n    \r\n    for (let i = 1; i < paths.length; i++) {\r\n      const pathPart = paths[i];\r\n      const isFile = i === paths.length - 1;\r\n\r\n      if (isFile) {\r\n        const fileNode = createFileTreeNode(pathPart, 'file', file.size, file);\r\n        currentNode.children?.push(fileNode);\r\n        updateFolderSize(currentNode, file.size);\r\n      } else {\r\n        let folderNode = currentNode.children?.find(\r\n          child => child.name === pathPart && child.type === 'folder'\r\n        );\r\n        \r\n        if (!folderNode) {\r\n          folderNode = createFileTreeNode(pathPart, 'folder');\r\n          currentNode.children?.push(folderNode);\r\n        }\r\n        currentNode = folderNode;\r\n      }\r\n    }\r\n  });\r\n\r\n  return root;\r\n}\r\n\r\n/**\r\n * æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†ç»„ä»¶\r\n * æ”¯æŒæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæä¾›æ‹–æ”¾å’Œé€‰æ‹©ç•Œé¢\r\n */\r\nconst UploadModal: React.FC<UploadModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onUploadSuccess,\r\n  currentFolderId,\r\n  isFolderUpload,\r\n  withTags\r\n}) => {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [files, setFiles] = useState<File[]>([]);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [tags, setTags] = useState<string[]>([]);\r\n  const [tagInput, setTagInput] = useState('');\r\n  const [folderName, setFolderName] = useState<string | null>(null);\r\n  const [fileTree, setFileTree] = useState<FileTreeNode | null>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // é‡ç½®æ‰€æœ‰çŠ¶æ€\r\n  const resetState = () => {\r\n    setFiles([]);\r\n    setIsDragging(false);\r\n    setTags([]);\r\n    setTagInput('');\r\n    setFolderName(null);\r\n    setFileTree(null);\r\n    setUploadProgress(0);\r\n  };\r\n\r\n  // ç›‘å¬ isOpen å˜åŒ–ï¼Œå½“å¼¹çª—å…³é—­æ—¶é‡ç½®çŠ¶æ€\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      resetState();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const handleClose = () => {\r\n    resetState();\r\n    onClose();\r\n  };\r\n\r\n  const handleDragOver = (e: React.DragEvent) => {\r\n    e.preventDefault();\r\n    setIsDragging(true);\r\n  };\r\n\r\n  const handleDragLeave = () => {\r\n    setIsDragging(false);\r\n  };\r\n\r\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    setIsDragging(false);\r\n    \r\n    const droppedFiles = Array.from(e.dataTransfer.files);\r\n    if (droppedFiles.length > 0) {\r\n      const { files: processedFiles, folderName } = processSelectedFiles(droppedFiles, isFolderUpload);\r\n      setFiles(processedFiles);\r\n      setFolderName(folderName);\r\n      \r\n      if (isFolderUpload && folderName) {\r\n        setFileTree(buildFileTree(processedFiles, folderName));\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFiles = Array.from(e.target.files || []);\r\n    if (selectedFiles.length > 0) {\r\n      const { files: processedFiles, folderName } = processSelectedFiles(selectedFiles, isFolderUpload);\r\n      setFiles(processedFiles);\r\n      setFolderName(folderName);\r\n      \r\n      if (isFolderUpload && folderName) {\r\n        setFileTree(buildFileTree(processedFiles, folderName));\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeFile = (fileName: string) => {\r\n    setFiles(prev => prev.filter(file => file.name !== fileName));\r\n  };\r\n\r\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === 'Enter' && tagInput.trim()) {\r\n      e.preventDefault();\r\n      const newTag = tagInput.trim();\r\n      if (!tags.includes(newTag)) {\r\n        setTags([...tags, newTag]);\r\n      }\r\n      setTagInput('');\r\n    }\r\n  };\r\n\r\n  const removeTag = (tagToRemove: string) => {\r\n    setTags(tags.filter(tag => tag !== tagToRemove));\r\n  };\r\n\r\n  // é€’å½’æ¸²æŸ“æ–‡ä»¶æ ‘ç»„ä»¶\r\n  const renderFileTree = (node: FileTreeNode, level: number = 0) => {\r\n    return (\r\n      <div key={node.name} style={{ marginLeft: `${level * 20}px` }}>\r\n        <div className=\"file-item\">\r\n          <div className=\"file-info\">\r\n            <span className=\"file-type-icon\">\r\n              {node.type === 'folder' ? 'ğŸ“' : \r\n               node.file?.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\r\n               node.file?.type.includes('pdf') ? 'ğŸ“„' :\r\n               node.file?.type.includes('word') ? 'ğŸ“' :\r\n               'ğŸ“„'}\r\n            </span>\r\n            <div>\r\n              <p className=\"file-name\">{node.name}</p>\r\n              <p className=\"file-size\">\r\n                {formatFileSize(node.size)}\r\n                {node.type === 'folder' && ` (${node.children?.length || 0} ä¸ªæ–‡ä»¶)`}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        {node.children && node.children.length > 0 && (\r\n          <div className=\"file-children\">\r\n            {node.children.map(child => renderFileTree(child, level + 1))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // ä¸Šä¼ å¤„ç†å‡½æ•°\r\n  const handleUpload = async () => {\r\n    if (files.length === 0) return;\r\n    \r\n    setIsUploading(true);\r\n    setUploadProgress(0);\r\n    \r\n    try {\r\n      // å¤„ç†æ–‡ä»¶å¤¹ä¸Šä¼ \r\n      if (isFolderUpload && folderName) {\r\n        await uploadFolder(files, folderName, {\r\n          folderId: currentFolderId || undefined,\r\n          tags,\r\n          onProgress: (progress) => {\r\n            setUploadProgress(progress);\r\n          },\r\n          onSuccess: (response) => {\r\n            message.success(`æ–‡ä»¶å¤¹ \"${folderName}\" ä¸Šä¼ æˆåŠŸ`);\r\n            setIsUploading(false);\r\n            onUploadSuccess();\r\n            handleClose();\r\n          },\r\n          onError: (error) => {\r\n            message.error(`ä¸Šä¼ å¤±è´¥: ${error.message}`);\r\n            setIsUploading(false);\r\n          }\r\n        });\r\n      } else {\r\n        // å•æ–‡ä»¶æˆ–å¤šæ–‡ä»¶ä¸Šä¼ \r\n        let uploadedCount = 0;\r\n        const totalFiles = files.length;\r\n        \r\n        for (const file of files) {\r\n          await uploadFile(file, {\r\n            folderId: currentFolderId || undefined,\r\n            tags,\r\n            onProgress: (fileProgress) => {\r\n              // è®¡ç®—æ€»ä½“è¿›åº¦ï¼šå·²å®Œæˆæ–‡ä»¶ + å½“å‰æ–‡ä»¶è¿›åº¦\r\n              const totalProgress = Math.round(\r\n                (uploadedCount * 100 + fileProgress) / totalFiles\r\n              );\r\n              setUploadProgress(totalProgress);\r\n            },\r\n            onSuccess: () => {\r\n              uploadedCount++;\r\n              \r\n              // æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ\r\n              if (uploadedCount === totalFiles) {\r\n                message.success(totalFiles > 1 \r\n                  ? `${totalFiles}ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸ` \r\n                  : 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');\r\n                \r\n                setIsUploading(false);\r\n                onUploadSuccess();\r\n                handleClose();\r\n              }\r\n            },\r\n            onError: (error) => {\r\n              message.error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${error.message}`);\r\n              setIsUploading(false);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'ä¸Šä¼ å¤±è´¥';\r\n      message.error(errorMessage);\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\r\n      open={isOpen}\r\n      onCancel={handleClose}\r\n      footer={[\r\n        <Button key=\"cancel\" onClick={handleClose} disabled={isUploading}>\r\n          å–æ¶ˆ\r\n        </Button>,\r\n        <Button \r\n          key=\"upload\" \r\n          type=\"primary\" \r\n          onClick={handleUpload} \r\n          disabled={files.length === 0 || isUploading}\r\n          loading={isUploading}\r\n        >\r\n          ä¸Šä¼ \r\n        </Button>,\r\n      ]}\r\n      width={800}\r\n    >\r\n      {isUploading ? (\r\n        <div className=\"text-center py-8\">\r\n          <div className=\"my-4\">\r\n            <Progress percent={uploadProgress} status=\"active\" />\r\n            <div className=\"mt-2\">{`ä¸Šä¼ ä¸­...${uploadProgress}%`}</div>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"upload-content\">\r\n          {/* æ‹–æ”¾åŒºåŸŸ */}\r\n          <div\r\n            onDragOver={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\r\n              isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-500'\r\n            }`}\r\n          >\r\n            <div className=\"upload-icon mb-4\">\r\n              {isFolderUpload ? <FolderOutlined style={{ fontSize: 48 }} /> : <UploadOutlined style={{ fontSize: 48 }} />}\r\n            </div>\r\n            <p className=\"text-lg mb-2\">\r\n              {isDragging\r\n                ? isFolderUpload\r\n                  ? 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶å¤¹'\r\n                  : 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶'\r\n                : isFolderUpload\r\n                ? 'æ‹–æ”¾æ–‡ä»¶å¤¹è‡³æ­¤å¤„ï¼Œæˆ–'\r\n                : 'æ‹–æ”¾æ–‡ä»¶è‡³æ­¤å¤„ï¼Œæˆ–'}\r\n            </p>\r\n            <Button\r\n              onClick={() => fileInputRef.current?.click()}\r\n              type=\"primary\"\r\n              icon={isFolderUpload ? <FolderOutlined /> : <UploadOutlined />}\r\n            >\r\n              {isFolderUpload ? 'é€‰æ‹©æ–‡ä»¶å¤¹' : 'é€‰æ‹©æ–‡ä»¶'}\r\n            </Button>\r\n            <input\r\n              ref={fileInputRef}\r\n              type=\"file\"\r\n              multiple={!isFolderUpload}\r\n              style={{ display: 'none' }}\r\n              onChange={handleFileSelect}\r\n              {...(isFolderUpload ? { webkitdirectory: \"\", directory: \"\" } : {})}\r\n            />\r\n          </div>\r\n\r\n          {/* æ ‡ç­¾è¾“å…¥åŒºåŸŸ */}\r\n          {withTags && (\r\n            <div className=\"tags-section mt-6\">\r\n              <h4 className=\"text-base font-medium mb-2\">æ·»åŠ æ ‡ç­¾</h4>\r\n              <div className=\"tag-input\">\r\n                <Input\r\n                  placeholder=\"è¾“å…¥æ ‡ç­¾å¹¶æŒ‰Enteræ·»åŠ \"\r\n                  value={tagInput}\r\n                  onChange={(e) => setTagInput(e.target.value)}\r\n                  onKeyDown={handleTagInputKeyDown}\r\n                />\r\n              </div>\r\n              {tags.length > 0 && (\r\n                <div className=\"tags-list mt-2 flex flex-wrap gap-1\">\r\n                  {tags.map((tag) => (\r\n                    <Tag\r\n                      key={tag}\r\n                      closable\r\n                      onClose={() => removeTag(tag)}\r\n                    >\r\n                      {tag}\r\n                    </Tag>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* æ–‡ä»¶åˆ—è¡¨æˆ–æ–‡ä»¶æ ‘ */}\r\n          {files.length > 0 && (\r\n            <div className=\"file-list mt-6\">\r\n              <h4 className=\"text-base font-medium mb-2\">\r\n                {isFolderUpload \r\n                  ? `æ–‡ä»¶å¤¹: ${folderName} (${files.length}ä¸ªæ–‡ä»¶)` \r\n                  : `é€‰æ‹©çš„æ–‡ä»¶ (${files.length})`}\r\n              </h4>\r\n              \r\n              {isFolderUpload && fileTree ? (\r\n                <div className=\"folder-tree border rounded p-3\">\r\n                  {renderFileTree(fileTree)}\r\n                </div>\r\n              ) : (\r\n                <div className=\"file-items space-y-2\">\r\n                  {files.map((file) => (\r\n                    <div\r\n                      key={file.name}\r\n                      className=\"file-item flex justify-between items-center border rounded p-2\"\r\n                    >\r\n                      <div className=\"file-details flex items-center\">\r\n                        <span className=\"file-icon mr-2\">\r\n                          {file.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\r\n                           file.type.includes('pdf') ? 'ğŸ“„' :\r\n                           file.type.includes('word') ? 'ğŸ“' :\r\n                           'ğŸ“„'}\r\n                        </span>\r\n                        <div>\r\n                          <div className=\"file-name font-medium\">{file.name}</div>\r\n                          <div className=\"file-meta text-xs text-gray-500\">\r\n                            {formatFileSize(file.size)}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <Button\r\n                        type=\"text\"\r\n                        size=\"small\"\r\n                        danger\r\n                        onClick={() => removeFile(file.name)}\r\n                      >\r\n                        ç§»é™¤\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default UploadModal; "
  },
  {
    "path": "app\\components\\features\\index.ts",
    "newContent": "// å¯¼å‡ºfeaturesç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶\r\nexport * from './home';\r\nexport * from './dashboard';\r\nexport * from './user-profile';\r\nexport * from './file-management'; "
  },
  {
    "path": "app\\components\\features\\user-profile\\index.ts",
    "newContent": "// å¯¼å‡ºuser-profileç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶\r\nexport * from './avatar';\r\nexport * from './profileHeader';\r\nexport * from './profileContent';\r\nexport * from './completeness';\r\nexport * from './passwordForm';\r\nexport * from './editForm'; "
  },
  {
    "path": "app\\components\\features\\user-profile\\profileHeader\\ProfileHeader.tsx",
    "newContent": "import React, { useState, useRef, useEffect } from 'react';\r\nimport Image from 'next/image';\r\nimport { Session } from 'next-auth';\r\nimport { UserInfo } from '@/app/dashboard/page';\r\nimport { Camera, Upload, Trash2 } from 'lucide-react';\r\nimport styles from './ProfileHeader.module.css';\r\nimport { AvatarModal } from '@/app/components/features/user-profile/avatar';\r\n\r\ninterface ProfileHeaderProps {\r\n  session: Session;\r\n  userInfo: UserInfo;\r\n  onEditClick: () => void;\r\n  onPasswordClick: () => void;\r\n  isLoading: boolean;\r\n  onAvatarChange?: (avatarUrl: string) => void;\r\n}\r\n\r\nconst ProfileHeader = ({ \r\n  session, \r\n  userInfo,\r\n  onEditClick, \r\n  onPasswordClick, \r\n  isLoading,\r\n  onAvatarChange\r\n}: ProfileHeaderProps) => {\r\n  const [avatarError, setAvatarError] = useState(false);\r\n  const [showAvatarModal, setShowAvatarModal] = useState(false);\r\n  \r\n  // ä½¿ç”¨userInfoä¸­çš„displayNameä½œä¸ºé¦–é€‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨sessionä¸­çš„name\r\n  const displayName = userInfo.displayName || session.user?.name || 'æœªè®¾ç½®æ˜µç§°';\r\n  \r\n  // è·å–ç”¨äºå¤´åƒå ä½ç¬¦çš„é¦–å­—æ¯\r\n  const nameInitial = displayName[0]?.toUpperCase() || '?';\r\n\r\n  // ç®€åŒ–å¤´åƒURLé€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨userInfoä¸­çš„å¤´åƒæˆ–sessionå¤´åƒ\r\n  const effectiveAvatarUrl = userInfo.avatarUrl || session.user?.image;\r\n  \r\n  // æ·»åŠ æ—¶é—´æˆ³ä½œä¸ºkeyçš„ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿æ¯æ¬¡å¤´åƒå˜æ›´éƒ½ä¼šé‡æ–°æ¸²æŸ“\r\n  const [refreshKey, setRefreshKey] = useState(Date.now());\r\n  const avatarKey = `${effectiveAvatarUrl || 'fallback'}-${refreshKey}`;\r\n\r\n  // æ·»åŠ useEffectç›‘å¬userInfo.avatarUrlçš„å˜åŒ–\r\n  useEffect(() => {\r\n    setRefreshKey(Date.now()); // å¼ºåˆ¶å¤´åƒé‡æ–°æ¸²æŸ“\r\n    setAvatarError(false); // é‡ç½®é”™è¯¯çŠ¶æ€\r\n  }, [userInfo.avatarUrl]);\r\n\r\n  // æ·»åŠ æ·±åº¦è°ƒè¯• - ç›‘æ§propså˜åŒ–\r\n  useEffect(() => {\r\n    console.log('ProfileHeaderæ”¶åˆ°æ–°çš„userInfo:', \r\n      { \r\n        avatarUrl: userInfo.avatarUrl,\r\n        hasAvatar: !!userInfo.avatarUrl,\r\n        displayName: userInfo.displayName\r\n      }\r\n    );\r\n  }, [userInfo]);\r\n\r\n  // æ‰“å¼€å¤´åƒç®¡ç†å¼¹çª—\r\n  const handleAvatarClick = () => {\r\n    setShowAvatarModal(true);\r\n  };\r\n\r\n  // å¤„ç†å¤´åƒå˜æ›´\r\n  const handleAvatarChange = (newAvatarUrl: string) => {\r\n    if (onAvatarChange) {\r\n      onAvatarChange(newAvatarUrl);\r\n    }\r\n    // å¼ºåˆ¶åˆ·æ–°\r\n    setRefreshKey(Date.now());\r\n  };\r\n\r\n  return (\r\n    <div className={styles.header}>\r\n      <div className={styles.avatarContainer}>\r\n        <div className={styles.avatar} onClick={handleAvatarClick}>\r\n          {effectiveAvatarUrl && !avatarError ? (\r\n            <Image\r\n              key={avatarKey}\r\n              src={`${effectiveAvatarUrl}?t=${refreshKey}`}\r\n              alt=\"ç”¨æˆ·å¤´åƒ\"\r\n              width={160}\r\n              height={160}\r\n              className={styles.avatarImage}\r\n              priority\r\n              unoptimized={true}\r\n              onError={() => setAvatarError(true)}\r\n            />\r\n          ) : (\r\n            <div className={styles.avatarFallback}>\r\n              <span>{nameInitial}</span>\r\n            </div>\r\n          )}\r\n          \r\n          {/* å¤´åƒæ‚¬åœè¦†ç›–å±‚ */}\r\n          <div className={styles.avatarOverlay}>\r\n            <button \r\n              className={styles.avatarButton} \r\n              onClick={handleAvatarClick}\r\n              title=\"ç®¡ç†å¤´åƒ\"\r\n            >\r\n              <Camera size={24} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <p className={styles.avatarHint}>ç‚¹å‡»æ›´æ¢å¤´åƒ</p>\r\n      </div>\r\n      \r\n      <div className={styles.info}>\r\n        <h1 className={styles.name}>{displayName}</h1>\r\n        <p className={styles.email}>{session.user?.email || 'æœªè®¾ç½®é‚®ç®±'}</p>\r\n        <div className={styles.buttons}>\r\n          <button\r\n            onClick={onEditClick}\r\n            className={styles.editButton}\r\n            disabled={isLoading}\r\n          >\r\n            ç¼–è¾‘ä¸ªäººä¿¡æ¯\r\n          </button>\r\n          <button\r\n            onClick={onPasswordClick}\r\n            className={styles.passwordButton}\r\n            disabled={isLoading}\r\n          >\r\n            è®¾ç½®å¯†ç \r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* å¤´åƒç®¡ç†å¼¹çª— */}\r\n      <AvatarModal \r\n        isOpen={showAvatarModal}\r\n        onClose={() => setShowAvatarModal(false)}\r\n        currentAvatarUrl={effectiveAvatarUrl || null}\r\n        userDisplayName={displayName}\r\n        onAvatarChange={handleAvatarChange}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileHeader; "
  },
  {
    "path": "app\\components\\features\\userProfile\\index.ts",
    "newContent": "// å¯¼å‡ºuser-profileç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶\r\nexport * from './avatar';\r\nexport * from './profileHeader';\r\nexport * from './profileContent';\r\nexport * from './completeness';\r\nexport * from './passwordForm';\r\nexport * from './editForm'; "
  },
  {
    "path": "app\\components\\features\\userProfile\\profileHeader\\ProfileHeader.tsx",
    "newContent": "import React, { useState, useRef, useEffect } from 'react';\r\nimport Image from 'next/image';\r\nimport { Session } from 'next-auth';\r\nimport { UserInfo } from '@/app/dashboard/page';\r\nimport { Camera, Upload, Trash2 } from 'lucide-react';\r\nimport styles from './ProfileHeader.module.css';\r\nimport { AvatarModal } from '@/app/components/features/user-profile/avatar';\r\n\r\ninterface ProfileHeaderProps {\r\n  session: Session;\r\n  userInfo: UserInfo;\r\n  onEditClick: () => void;\r\n  onPasswordClick: () => void;\r\n  isLoading: boolean;\r\n  onAvatarChange?: (avatarUrl: string) => void;\r\n}\r\n\r\nconst ProfileHeader = ({ \r\n  session, \r\n  userInfo,\r\n  onEditClick, \r\n  onPasswordClick, \r\n  isLoading,\r\n  onAvatarChange\r\n}: ProfileHeaderProps) => {\r\n  const [avatarError, setAvatarError] = useState(false);\r\n  const [showAvatarModal, setShowAvatarModal] = useState(false);\r\n  \r\n  // ä½¿ç”¨userInfoä¸­çš„displayNameä½œä¸ºé¦–é€‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨sessionä¸­çš„name\r\n  const displayName = userInfo.displayName || session.user?.name || 'æœªè®¾ç½®æ˜µç§°';\r\n  \r\n  // è·å–ç”¨äºå¤´åƒå ä½ç¬¦çš„é¦–å­—æ¯\r\n  const nameInitial = displayName[0]?.toUpperCase() || '?';\r\n\r\n  // ç®€åŒ–å¤´åƒURLé€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨userInfoä¸­çš„å¤´åƒæˆ–sessionå¤´åƒ\r\n  const effectiveAvatarUrl = userInfo.avatarUrl || session.user?.image;\r\n  \r\n  // æ·»åŠ æ—¶é—´æˆ³ä½œä¸ºkeyçš„ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿æ¯æ¬¡å¤´åƒå˜æ›´éƒ½ä¼šé‡æ–°æ¸²æŸ“\r\n  const [refreshKey, setRefreshKey] = useState(Date.now());\r\n  const avatarKey = `${effectiveAvatarUrl || 'fallback'}-${refreshKey}`;\r\n\r\n  // æ·»åŠ useEffectç›‘å¬userInfo.avatarUrlçš„å˜åŒ–\r\n  useEffect(() => {\r\n    setRefreshKey(Date.now()); // å¼ºåˆ¶å¤´åƒé‡æ–°æ¸²æŸ“\r\n    setAvatarError(false); // é‡ç½®é”™è¯¯çŠ¶æ€\r\n  }, [userInfo.avatarUrl]);\r\n\r\n  // æ·»åŠ æ·±åº¦è°ƒè¯• - ç›‘æ§propså˜åŒ–\r\n  useEffect(() => {\r\n    console.log('ProfileHeaderæ”¶åˆ°æ–°çš„userInfo:', \r\n      { \r\n        avatarUrl: userInfo.avatarUrl,\r\n        hasAvatar: !!userInfo.avatarUrl,\r\n        displayName: userInfo.displayName\r\n      }\r\n    );\r\n  }, [userInfo]);\r\n\r\n  // æ‰“å¼€å¤´åƒç®¡ç†å¼¹çª—\r\n  const handleAvatarClick = () => {\r\n    setShowAvatarModal(true);\r\n  };\r\n\r\n  // å¤„ç†å¤´åƒå˜æ›´\r\n  const handleAvatarChange = (newAvatarUrl: string) => {\r\n    if (onAvatarChange) {\r\n      onAvatarChange(newAvatarUrl);\r\n    }\r\n    // å¼ºåˆ¶åˆ·æ–°\r\n    setRefreshKey(Date.now());\r\n  };\r\n\r\n  return (\r\n    <div className={styles.header}>\r\n      <div className={styles.avatarContainer}>\r\n        <div className={styles.avatar} onClick={handleAvatarClick}>\r\n          {effectiveAvatarUrl && !avatarError ? (\r\n            <Image\r\n              key={avatarKey}\r\n              src={`${effectiveAvatarUrl}?t=${refreshKey}`}\r\n              alt=\"ç”¨æˆ·å¤´åƒ\"\r\n              width={160}\r\n              height={160}\r\n              className={styles.avatarImage}\r\n              priority\r\n              unoptimized={true}\r\n              onError={() => setAvatarError(true)}\r\n            />\r\n          ) : (\r\n            <div className={styles.avatarFallback}>\r\n              <span>{nameInitial}</span>\r\n            </div>\r\n          )}\r\n          \r\n          {/* å¤´åƒæ‚¬åœè¦†ç›–å±‚ */}\r\n          <div className={styles.avatarOverlay}>\r\n            <button \r\n              className={styles.avatarButton} \r\n              onClick={handleAvatarClick}\r\n              title=\"ç®¡ç†å¤´åƒ\"\r\n            >\r\n              <Camera size={24} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <p className={styles.avatarHint}>ç‚¹å‡»æ›´æ¢å¤´åƒ</p>\r\n      </div>\r\n      \r\n      <div className={styles.info}>\r\n        <h1 className={styles.name}>{displayName}</h1>\r\n        <p className={styles.email}>{session.user?.email || 'æœªè®¾ç½®é‚®ç®±'}</p>\r\n        <div className={styles.buttons}>\r\n          <button\r\n            onClick={onEditClick}\r\n            className={styles.editButton}\r\n            disabled={isLoading}\r\n          >\r\n            ç¼–è¾‘ä¸ªäººä¿¡æ¯\r\n          </button>\r\n          <button\r\n            onClick={onPasswordClick}\r\n            className={styles.passwordButton}\r\n            disabled={isLoading}\r\n          >\r\n            è®¾ç½®å¯†ç \r\n          </button>\r\n        </div>\r\n      </div>\r\n      \r\n      {/* å¤´åƒç®¡ç†å¼¹çª— */}\r\n      <AvatarModal \r\n        isOpen={showAvatarModal}\r\n        onClose={() => setShowAvatarModal(false)}\r\n        currentAvatarUrl={effectiveAvatarUrl || null}\r\n        userDisplayName={displayName}\r\n        onAvatarChange={handleAvatarChange}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileHeader; "
  },
  {
    "path": "app\\components\\index.ts",
    "newContent": "/**\r\n * ç»„ä»¶åº“ç´¢å¼•æ–‡ä»¶\r\n * \r\n * æ‰€æœ‰ç»„ä»¶å·²æŒ‰ç…§åŸå­è®¾è®¡æ¨¡å¼è¿›è¡Œé‡ç»„ï¼š\r\n * - ui/: åŸºç¡€UIç»„ä»¶\r\n *   - atoms/: åŸå­çº§ç»„ä»¶ï¼ˆæŒ‰é’®ã€è¾“å…¥æ¡†ç­‰ï¼‰\r\n *   - molecules/: åˆ†å­çº§ç»„ä»¶ï¼ˆå¤åˆUIå…ƒç´ ï¼‰\r\n *   - organisms/: æœ‰æœºä½“ç»„ä»¶ï¼ˆå®Œæ•´UIåŒºå—ï¼‰\r\n * \r\n * - common/: é€šç”¨åŠŸèƒ½ç»„ä»¶\r\n *   - feedback/: åé¦ˆç±»ç»„ä»¶ï¼ˆæç¤ºã€é€šçŸ¥ç­‰ï¼‰\r\n *   - form/: è¡¨å•ç›¸å…³ç»„ä»¶\r\n *   - media/: åª’ä½“ç»„ä»¶ï¼ˆéŸ³è§†é¢‘ç­‰ï¼‰\r\n * \r\n * - features/: ä¸šåŠ¡åŠŸèƒ½ç»„ä»¶\r\n *   - dashboard/: ä»ªè¡¨ç›˜ç›¸å…³ç»„ä»¶\r\n *   - file-management/: æ–‡ä»¶ç®¡ç†ç»„ä»¶\r\n *   - home/: é¦–é¡µç›¸å…³ç»„ä»¶\r\n *   - user-profile/: ç”¨æˆ·èµ„æ–™ç»„ä»¶\r\n * \r\n * ä¸ºä¿æŒå‘åå…¼å®¹æ€§ï¼Œæ‰€æœ‰ç»„ä»¶å¯ä»¥ä»æ ¹è·¯å¾„ç›´æ¥å¯¼å…¥\r\n */\r\n\r\n// ä»æ–°çš„ç›®å½•ç»“æ„ä¸­é‡æ–°å¯¼å‡ºç»„ä»¶\r\n// UIç»„ä»¶\r\nexport * from './ui';\r\n\r\n// å¯¼èˆªç»„ä»¶\r\nexport { default as Navbar } from './features/dashboard/navigation/Navbar';\r\n\r\n// æ–‡ä»¶ç®¡ç†ç»„ä»¶\r\nexport { default as UploadModal } from './features/file-management/upload/UploadModal';\r\nexport { default as FileUpload } from './features/file-management/upload/FileUpload';\r\nexport { default as TopActionBar } from './features/file-management/actionBar/TopActionBar';\r\nexport { default as SortDropdown } from './features/file-management/actionBar/SortDropdown';\r\nexport { default as NewFolderForm } from './features/file-management/folderManagement/NewFolderForm';\r\nexport { default as Toolbar } from './features/file-management/toolbar/Toolbar';\r\n\r\n// åˆ†æç»„ä»¶\r\nexport { default as StorageUsage } from './features/dashboard/analytics/StorageUsage';\r\n\r\n// åª’ä½“ç»„ä»¶\r\nexport { default as AudioVisualizer } from './common/media/AudioVisualizer';\r\n\r\n// ç”¨æˆ·èµ„æ–™ç»„ä»¶\r\nexport { default as ProfileHeader } from './features/user-profile/profileHeader';\r\nexport { default as ProfileCompleteness } from './features/user-profile/completeness';\r\nexport { default as PasswordForm } from './features/user-profile/passwordForm';\r\nexport { default as EditProfileForm } from './features/user-profile/editForm';\r\nexport * from './features/user-profile/avatar';\r\n\r\n// è¡¨å•ç»„ä»¶\r\nexport * from './common/form';\r\n\r\n// åé¦ˆç»„ä»¶\r\nexport { default as Toaster } from './common/feedback/toast';\r\n\r\n// é¦–é¡µç»„ä»¶\r\nexport { default as Hero } from './features/home/hero';\r\nexport { default as HomeHeader } from './features/home/header';\r\nexport { default as Footer } from './features/home/footer';\r\nexport { default as Features } from './features/home/features';\r\nexport { default as CTA } from './features/home/cta'; "
  },
  {
    "path": "app\\dashboard\\page.tsx",
    "newContent": "\"use client\"\r\n\r\nimport { useSession } from \"next-auth/react\"\r\nimport { useRouter } from 'next/navigation'\r\nimport { useState, useEffect, useRef } from \"react\"\r\nimport { ArrowLeft } from 'lucide-react'\r\n\r\n// å¯¼å…¥è‡ªå®šä¹‰é’©å­\r\nimport { useProfile, usePassword, UserProfile, UserProfileInput } from '@/app/hooks'\r\nimport { useToast } from '@/app/components/features/dashboard/Toaster'\r\nimport { useValidation } from './hooks/useValidation'\r\n// å¯¼å…¥ä¸»é¢˜æœåŠ¡\r\nimport { applyTheme as applyThemeService } from '@/app/shared/themes'\r\n\r\n// å¯¼å…¥ç»„ä»¶\r\nimport Modal from '@/app/components/features/dashboard/Modal'\r\nimport ProfileHeader from '@/app/components/features/dashboard/ProfileHeader'\r\nimport ProfileContent from '@/app/components/features/dashboard/ProfileContent'\r\nimport EditProfileForm from '@/app/components/features/dashboard/EditProfileForm'\r\nimport PasswordForm from '@/app/components/features/dashboard/PasswordForm'\r\nimport ProfileCompleteness from '@/app/components/features/dashboard/ProfileCompleteness'\r\n\r\n// åˆ›å»ºå…¼å®¹æ—§ç»„ä»¶çš„UserInfoæ¥å£\r\nexport interface UserInfo {\r\n  displayName: string;\r\n  bio: string;\r\n  location: string;\r\n  website: string;\r\n  company: string;\r\n  avatarUrl?: string | null; \r\n  theme?: string | null;     \r\n  createdAt?: string;        \r\n}\r\n\r\n// å¯¼å…¥æ ·å¼\r\nimport styles from './Dashboard.module.css'\r\n\r\nexport default function DashboardPage() {\r\n  const router = useRouter()\r\n  const { data: session, status } = useSession({\r\n    required: true,\r\n    onUnauthenticated() {\r\n      router.push('/auth/login')\r\n    },\r\n  })\r\n  \r\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false)\r\n  const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false)\r\n  \r\n  const { \r\n    user-profile, \r\n    isLoading: profileLoading, \r\n    error: profileError, \r\n    updateUserProfile,\r\n    effectiveAvatarUrl\r\n  } = useProfile()\r\n  \r\n  // åˆ›å»ºä¸€ä¸ªæœ¬åœ°çŠ¶æ€ç”¨äºç¼–è¾‘ï¼Œå…¼å®¹æ—§çš„UserInfoæ ¼å¼\r\n  const [userInfo, setUserInfo] = useState<UserInfo>({\r\n    displayName: '',\r\n    bio: '',\r\n    location: '',\r\n    website: '',\r\n    company: '',\r\n    avatarUrl: null,\r\n    theme: null\r\n  })\r\n  \r\n  // å½“user-profileæ›´æ–°æ—¶ï¼ŒåŒæ­¥æ›´æ–°userInfo\r\n  useEffect(() => {\r\n    if (user-profile) {\r\n      setUserInfo({\r\n        displayName: user-profile.name || '',\r\n        bio: user-profile.bio || '',\r\n        location: user-profile.location || '',\r\n        website: user-profile.website || '',\r\n        company: user-profile.company || '',\r\n        avatarUrl: user-profile.avatarUrl,\r\n        theme: user-profile.theme,\r\n        createdAt: user-profile.createdAt\r\n      })\r\n    }\r\n  }, [user-profile])\r\n  \r\n  const {\r\n    passwordInfo,\r\n    passwordError,\r\n    passwordSuccess,\r\n    isLoading: passwordLoading,\r\n    showPassword,\r\n    showConfirmPassword,\r\n    setShowPassword,\r\n    setShowConfirmPassword,\r\n    handlePasswordChange,\r\n    updatePassword,\r\n    resetPasswordState\r\n  } = usePassword()\r\n\r\n  const [isSaving, setIsSaving] = useState(false)\r\n  const toast = useToast()\r\n  const { validateForm } = useValidation()\r\n\r\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>, field: string) => {\r\n    setUserInfo(prev => ({...prev, [field]: e.target.value}))\r\n  }\r\n\r\n  const handleSave = async () => {\r\n    try {\r\n      console.log('ä¿å­˜ç”¨æˆ·èµ„æ–™:', userInfo);\r\n      \r\n      // è¡¨å•éªŒè¯\r\n      if (!validateForm(userInfo)) {\r\n        toast.error('è¯·ä¿®æ­£è¡¨å•ä¸­çš„é”™è¯¯åå†æäº¤');\r\n        return;\r\n      }\r\n      \r\n      // ç¦ç”¨ä¿å­˜æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤\r\n      setIsSaving(true);\r\n      \r\n      // è½¬æ¢ä¸ºUserProfileInputæ ¼å¼\r\n      const profileInput: UserProfileInput = {\r\n        displayName: userInfo.displayName,\r\n        bio: userInfo.bio,\r\n        location: userInfo.location,\r\n        website: userInfo.website,\r\n        company: userInfo.company,\r\n        // ä»…åœ¨énullæ—¶åŒ…å«avatarUrl\r\n        ...(userInfo.avatarUrl && { avatarUrl: userInfo.avatarUrl }),\r\n        // ä»…åœ¨énullæ—¶åŒ…å«theme\r\n        ...(userInfo.theme && { theme: userInfo.theme })\r\n      };\r\n      \r\n      const success = await updateUserProfile(profileInput);\r\n      \r\n      if (success) {\r\n        setIsEditModalOpen(false);\r\n        // ä½¿ç”¨Toasté€šçŸ¥æ›¿ä»£alert\r\n        toast.success('ä¸ªäººä¿¡æ¯å·²æˆåŠŸä¿å­˜ï¼');\r\n      } else {\r\n        // ä¿å­˜å¤±è´¥æç¤º\r\n        toast.error('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\r\n      }\r\n    } catch (error) {\r\n      console.error('ä¿å­˜ç”¨æˆ·èµ„æ–™æ—¶å‡ºé”™:', error);\r\n      toast.error('å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');\r\n    } finally {\r\n      // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½é‡æ–°å¯ç”¨ä¿å­˜æŒ‰é’®\r\n      setIsSaving(false);\r\n    }\r\n  }\r\n\r\n  const handlePasswordSave = async () => {\r\n    const success = await updatePassword()\r\n    if (success) {\r\n      setIsPasswordModalOpen(false)\r\n    }\r\n  }\r\n\r\n  const openPasswordModal = () => {\r\n    resetPasswordState()\r\n    setIsPasswordModalOpen(true)\r\n  }\r\n\r\n  // åº”ç”¨ä¸»é¢˜\r\n  useEffect(() => {\r\n    if (user-profile?.theme) {\r\n      applyTheme(user-profile.theme);\r\n    }\r\n  }, [user-profile?.theme]);\r\n\r\n  // å¤„ç†ä¸»é¢˜æ›´æ”¹\r\n  const handleThemeChange = async (themeId: string) => {\r\n    // å…ˆç«‹å³åœ¨æœ¬åœ°åº”ç”¨ä¸»é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\r\n    applyTheme(themeId);\r\n    \r\n    // æ›´æ–°ç”¨æˆ·èµ„æ–™ä¸­çš„ä¸»é¢˜\r\n    try {\r\n      const profileInput: UserProfileInput = {\r\n        theme: themeId\r\n      };\r\n      const success = await updateUserProfile(profileInput);\r\n      if (success) {\r\n        console.log(`ä¸»é¢˜ ${themeId} å·²æˆåŠŸåº”ç”¨å¹¶ä¿å­˜åˆ°æœåŠ¡å™¨`);\r\n      } else {\r\n        console.warn(`ä¸»é¢˜ ${themeId} å·²åœ¨æœ¬åœ°åº”ç”¨ï¼Œä½†æœªèƒ½ä¿å­˜åˆ°æœåŠ¡å™¨`);\r\n      }\r\n      return success;\r\n    } catch (error) {\r\n      console.error(`ä¸»é¢˜ ${themeId} åº”ç”¨å‘ç”Ÿé”™è¯¯:`, error);\r\n      // å³ä½¿ä¿å­˜å¤±è´¥ï¼Œæœ¬åœ°ä¸»é¢˜å·²åº”ç”¨ï¼Œæ‰€ä»¥ä¾ç„¶è¿”å›trueè®©UIä¿æŒå·²é€‰çŠ¶æ€\r\n      return true;\r\n    }\r\n  };\r\n\r\n  // å°†ä¸»é¢˜åº”ç”¨åˆ°æ–‡æ¡£ - ä½¿ç”¨ç»Ÿä¸€çš„ä¸»é¢˜æœåŠ¡\r\n  const applyTheme = (theme: string) => {\r\n    applyThemeService(theme);\r\n  };\r\n\r\n  // å¼•ç”¨ProfileHeaderä¸­çš„fileInputRef\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // è§¦å‘å¤´åƒä¸Šä¼ åŠŸèƒ½\r\n  const handleAvatarClick = () => {\r\n    console.log('èµ„æ–™å®Œæ•´åº¦å¤´åƒç‚¹å‡»è¢«è§¦å‘');\r\n    \r\n    // é¦–å…ˆå°è¯•ä½¿ç”¨ç‰¹å®šçš„classæŸ¥æ‰¾\r\n    const avatarInput = document.querySelector('.avatar-upload-input');\r\n    if (avatarInput && avatarInput instanceof HTMLInputElement) {\r\n      console.log('é€šè¿‡classæ‰¾åˆ°å¤´åƒä¸Šä¼ inputï¼Œè§¦å‘ç‚¹å‡»');\r\n      avatarInput.click();\r\n      return;\r\n    }\r\n    \r\n    // å¤‡ç”¨æ–¹æ¡ˆ1ï¼šé€šè¿‡å®¹å™¨classæŸ¥æ‰¾\r\n    const containerInput = document.querySelector('.avatarContainer input[type=\"file\"]');\r\n    if (containerInput && containerInput instanceof HTMLInputElement) {\r\n      console.log('é€šè¿‡å®¹å™¨æ‰¾åˆ°å¤´åƒä¸Šä¼ inputï¼Œè§¦å‘ç‚¹å‡»');\r\n      containerInput.click();\r\n      return;\r\n    }\r\n    \r\n    // å¤‡ç”¨æ–¹æ¡ˆ2ï¼šæŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ input\r\n    console.error('æœªæ‰¾åˆ°ç²¾ç¡®çš„å¤´åƒä¸Šä¼ inputå…ƒç´ ï¼Œå°è¯•æŸ¥æ‰¾æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ æ§ä»¶');\r\n    const fileInputs = document.querySelectorAll('input[type=\"file\"]');\r\n    let found = false;\r\n    fileInputs.forEach(input => {\r\n      const fileInput = input as HTMLInputElement;\r\n      if (fileInput.accept && fileInput.accept.includes('image')) {\r\n        console.log('æ‰¾åˆ°å¤‡é€‰å›¾ç‰‡ä¸Šä¼ inputï¼Œè§¦å‘ç‚¹å‡»');\r\n        fileInput.click();\r\n        found = true;\r\n        return;\r\n      }\r\n    });\r\n    \r\n    if (!found) {\r\n      console.error('æ— æ³•æ‰¾åˆ°ä»»ä½•å›¾ç‰‡ä¸Šä¼ æ§ä»¶');\r\n      alert('æ— æ³•æ‰¾åˆ°å¤´åƒä¸Šä¼ æ§ä»¶ï¼Œè¯·å°è¯•ç›´æ¥ç‚¹å‡»å¤´åƒè¿›è¡Œä¸Šä¼ ');\r\n    }\r\n  };\r\n\r\n  // åŠ è½½çŠ¶æ€\r\n  if (status === 'loading' || profileLoading) {\r\n    return (\r\n      <div className={styles.loading}>\r\n        <div className={styles.loadingCard}>\r\n          <div className={styles.loadingSpinner}></div>\r\n          <h2 className={styles.loadingTitle}>åŠ è½½ä¸­...</h2>\r\n          <p className={styles.loadingText}>æ­£åœ¨è·å–æ‚¨çš„ä¸ªäººä¿¡æ¯</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // é”™è¯¯çŠ¶æ€\r\n  if (profileError) {\r\n    return (\r\n      <div className={styles.errorContainer}>\r\n        <div className={styles.errorCard}>\r\n          <div className={styles.errorIcon}>âš ï¸</div>\r\n          <h2 className={styles.errorTitle}>åŠ è½½å¤±è´¥</h2>\r\n          <p className={styles.errorText}>{profileError}</p>\r\n          <button\r\n            onClick={() => window.location.reload()}\r\n            className={styles.retryButton}\r\n          >\r\n            é‡è¯•\r\n          </button>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // æœªç™»å½•\r\n  if (!session?.user) {\r\n    return null\r\n  }\r\n\r\n  // ç¼–è¾‘ä¸ªäººä¿¡æ¯å¼¹çª—åº•éƒ¨æŒ‰é’®\r\n  const renderEditFooter = () => (\r\n    <div className={styles.modalFooterButtons}>\r\n      <button\r\n        onClick={() => setIsEditModalOpen(false)}\r\n        className={styles.cancelButton}\r\n        disabled={isSaving}\r\n      >\r\n        å–æ¶ˆ\r\n      </button>\r\n      <button\r\n        onClick={handleSave}\r\n        className={styles.saveButton}\r\n        disabled={isSaving}\r\n      >\r\n        {isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜æ›´æ”¹'}\r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  // è®¾ç½®å¯†ç å¼¹çª—åº•éƒ¨æŒ‰é’®\r\n  const renderPasswordFooter = () => (\r\n    <div className={styles.modalFooterButtons}>\r\n      <button\r\n        onClick={() => setIsPasswordModalOpen(false)}\r\n        className={styles.cancelButton}\r\n      >\r\n        å–æ¶ˆ\r\n      </button>\r\n      <button\r\n        onClick={handlePasswordSave}\r\n        className={styles.saveButton}\r\n        disabled={passwordLoading}\r\n      >\r\n        ä¿å­˜å¯†ç \r\n      </button>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      <div className={styles.profile}>\r\n        {/* è¿”å›æŒ‰é’® */}\r\n        <button \r\n          onClick={() => router.push('/file-management/main')}\r\n          className={styles.backButton}\r\n          title=\"è¿”å›æ–‡ä»¶ç®¡ç†\"\r\n        >\r\n          <ArrowLeft className=\"w-5 h-5\" />\r\n        </button>\r\n        \r\n        <div className={styles.profileHeader}>\r\n          {/* ä¸ªäººèµ„æ–™å¤´éƒ¨ */}\r\n          <ProfileHeader \r\n            session={session}\r\n            userInfo={userInfo}\r\n            onEditClick={() => setIsEditModalOpen(true)}\r\n            onPasswordClick={openPasswordModal}\r\n            isLoading={profileLoading || passwordLoading}\r\n            onAvatarChange={async (avatarUrl) => {\r\n              console.log('å¤´åƒå˜æ›´è¢«è§¦å‘ï¼Œæ–°URL:', avatarUrl);\r\n              \r\n              try {\r\n                // åˆ›å»ºæ–°çš„userInfoå¯¹è±¡\r\n                const updatedInfo = {...userInfo, avatarUrl};\r\n                console.log('æ›´æ–°åçš„userInfo:', updatedInfo);\r\n                \r\n                // æ›´æ–°æœ¬åœ°çŠ¶æ€\r\n                setUserInfo(updatedInfo);\r\n                \r\n                // è½¬æ¢ä¸ºUserProfileInputæ ¼å¼\r\n                const profileInput: UserProfileInput = {\r\n                  displayName: updatedInfo.displayName,\r\n                  bio: updatedInfo.bio,\r\n                  location: updatedInfo.location,\r\n                  website: updatedInfo.website,\r\n                  company: updatedInfo.company,\r\n                  avatarUrl: updatedInfo.avatarUrl,\r\n                  // ä»…åœ¨themeä¸ä¸ºnullæ—¶åŒ…å«\r\n                  ...(updatedInfo.theme && { theme: updatedInfo.theme })\r\n                };\r\n                \r\n                // ä¿å­˜åˆ°æ•°æ®åº“å¹¶ç­‰å¾…å®Œæˆ\r\n                const success = await updateUserProfile(profileInput);\r\n                console.log('ä¿å­˜å¤´åƒåˆ°æ•°æ®åº“ç»“æœ:', success ? 'æˆåŠŸ' : 'å¤±è´¥');\r\n                \r\n                // å¦‚æœä¿å­˜å¤±è´¥ï¼Œå¼ºåˆ¶é‡æ–°è·å–ç”¨æˆ·æ•°æ®\r\n                if (!success) {\r\n                  window.location.reload(); // æœ€åçš„æ‰‹æ®µï¼šåˆ·æ–°æ•´ä¸ªé¡µé¢\r\n                }\r\n              } catch (error) {\r\n                console.error('å¤„ç†å¤´åƒå˜æ›´æ—¶å‡ºé”™:', error);\r\n                alert('æ›´æ–°å¤´åƒå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');\r\n              }\r\n            }}\r\n          />\r\n        </div>\r\n        \r\n        {/* èµ„æ–™å®Œæ•´åº¦ */}\r\n        <ProfileCompleteness \r\n          userInfo={userInfo} \r\n          onEditClick={() => setIsEditModalOpen(true)}\r\n          onAvatarClick={handleAvatarClick}\r\n        />\r\n        \r\n        {/* ä¸ªäººèµ„æ–™å†…å®¹ */}\r\n        <ProfileContent \r\n          session={session}\r\n          userInfo={userInfo}\r\n          isLoading={profileLoading || passwordLoading}\r\n        />\r\n      </div>\r\n\r\n      {/* ç¼–è¾‘ä¸ªäººä¿¡æ¯å¼¹çª— */}\r\n      <Modal\r\n        isOpen={isEditModalOpen}\r\n        onClose={() => setIsEditModalOpen(false)}\r\n        title=\"ç¼–è¾‘ä¸ªäººä¿¡æ¯\"\r\n        footer={renderEditFooter()}\r\n      >\r\n        <EditProfileForm \r\n          userInfo={userInfo}\r\n          onInputChange={handleInputChange}\r\n        />\r\n      </Modal>\r\n\r\n      {/* è®¾ç½®å¯†ç å¼¹çª— */}\r\n      <Modal\r\n        isOpen={isPasswordModalOpen}\r\n        onClose={() => setIsPasswordModalOpen(false)}\r\n        title=\"è®¾ç½®å¯†ç \"\r\n        footer={renderPasswordFooter()}\r\n      >\r\n        <PasswordForm\r\n          passwordInfo={passwordInfo}\r\n          passwordError={passwordError}\r\n          passwordSuccess={passwordSuccess}\r\n          showPassword={showPassword}\r\n          showConfirmPassword={showConfirmPassword}\r\n          setShowPassword={setShowPassword}\r\n          setShowConfirmPassword={setShowConfirmPassword}\r\n          handlePasswordChange={handlePasswordChange}\r\n          userEmail={session.user.email}\r\n        />\r\n      </Modal>\r\n    </div>\r\n  )\r\n} "
  },
  {
    "path": "app\\file-management\\main\\page.tsx",
    "newContent": "// @ts-nocheck\n'use client';\n\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useSession, signOut } from 'next-auth/react';\nimport { useRouter } from 'next/navigation';\nimport { message, Spin } from 'antd';\nimport Head from 'next/head';\n\n// å¼•å…¥å…±äº«ç»„ä»¶\nimport { Sidebar } from '@/app/components/features/file-management/navigation/Sidebar';\nimport { Breadcrumb } from '@/app/components/features/file-management/navigation/Breadcrumb';\nimport { FileList } from '@/app/components/features/file-management/fileList/FileList';\nimport { SkeletonPageLayout } from '@/app/components/features/file-management/shared/Skeleton';\nimport { ErrorDisplay } from '@/app/components/features/file-management/shared/ErrorDisplay';\nimport UploadModal from '@/app/components/features/file-management/upload/UploadModal';\nimport { FilePreview } from '@/app/components/features/file-management/filePreview/FilePreview';\nimport { RenameModal } from '@/app/components/features/file-management/fileOperations/RenameModal';\nimport ThemePanel from '@/app/shared/themes/components/ThemePanel';\n\n// å¯¼å…¥è‡ªå®šä¹‰ç»„ä»¶\nimport MiniSidebar from '@/app/components/features/file-management/navigation/MiniSidebar';\nimport { TopActionBar } from '@/app/components/features/file-management/actionBar/TopActionBar';\nimport NewFolderForm from '@/app/components/features/file-management/folderManagement/NewFolderForm';\nimport { SearchView } from '@/app/components/features/file-management/SearchView';\n\n// å¯¼å…¥è‡ªå®šä¹‰ hooks\nimport { \n  useFiles, \n  useFileOperations, \n  useFileUpload, \n  useFileSearch, \n  useFilePreview,\n  useLoadingState, \n  useUIState, \n  useThemeManager, \n  useProfile \n} from '@/app/hooks';\n// å¯¼å…¥ç±»å‹å’Œå·¥å…·å‡½æ•°\nimport { SortOrder, FileInfo } from '@/app/types';\nimport { convertFilesForDisplay } from '@/app/utils/file/converter';\n\n// å¯¼å…¥æ ·å¼\nimport styles from '../styles/shared.module.css';\n\nexport default function FileManagementPage() {\n  const router = useRouter();\n  const { data: session, status } = useSession();\n  \n  // è·å–ç”¨æˆ·èµ„æ–™ç›¸å…³çŠ¶æ€ï¼ŒåŒ…æ‹¬åŠ è½½çŠ¶æ€\n  const { \n    user-profile, \n    isLoading: profileLoading, \n    error: profileError,\n    fetchUserProfile, \n    forceRefreshProfile,\n    effectiveAvatarUrl\n  } = useProfile();\n\n  // ä½¿ç”¨ä¸»é¢˜ç®¡ç†hook\n  const { currentTheme, updateTheme } = useThemeManager();\n\n  // ä½¿ç”¨åŒçŠ¶æ€åŠ è½½ç®¡ç†\n  const {\n    loadingState,\n    error: loadingError,\n    isInitialLoading,\n    isRefreshing,\n    isError: isLoadingError,\n    startLoading,\n    finishLoading\n  } = useLoadingState({\n    initialLoad: true,\n    minLoadingTime: 800\n  });\n  \n  // ä½¿ç”¨useFilesé’©å­è·å–æ–‡ä»¶åˆ—è¡¨å’Œç›¸å…³æ“ä½œ\n  const {\n    files,\n    isLoading: filesLoading,\n    error: filesError,\n    currentFolderId,\n    folderPath,\n    selectedFileType,\n    selectedFiles,\n    sortOrder,\n    loadFiles,\n    toggleSelectFile: handleSelectFile,\n    toggleSelectAll,\n    changeSort,\n    filterByFileType,\n    openFolder,\n    refreshCurrentFolder,\n    handleFileClick,\n    handleBackClick,\n    handleFileUpdate,\n    setCurrentFolderId,\n    setFolderPath,\n    setSelectedFileType,\n    setSelectedFiles,\n    setSortOrder\n  } = useFiles();\n\n  // UIçŠ¶æ€ç®¡ç†\n  const {\n    sidebarVisible,\n    myFilesExpanded,\n    quickAccessExpanded,\n    isUploadModalOpen,\n    isFolderUploadModalOpen,\n    showUploadDropdown,\n    setSidebarVisible,\n    setMyFilesExpanded,\n    setQuickAccessExpanded,\n    setIsUploadModalOpen,\n    setIsFolderUploadModalOpen,\n    setShowUploadDropdown,\n    uploadDropdownRef\n  } = useUIState();\n\n  // æ·»åŠ ä¸»é¢˜é¢æ¿çŠ¶æ€\n  const [showThemePanel, setShowThemePanel] = useState(false);\n\n  // æ–‡ä»¶æ“ä½œé’©å­\n  const {\n    createFolder: handleCreateFolder,\n    downloadFiles: handleDownload,\n    deleteFiles: handleDelete,\n    renameFile: handleRenameFile,\n    isLoading: fileOperationsLoading,\n    error: fileOperationsError\n  } = useFileOperations([]);\n\n  // å…ˆè°ƒç”¨æ–‡ä»¶æœç´¢é’©å­ï¼Œç¡®ä¿updateFileInResultså¯ç”¨\n  const {\n    searchQuery,\n    setSearchQuery,\n    searchResults,\n    isLoading: searchLoading,\n    error: searchError,\n    showSearchView,\n    setShowSearchView,\n    searchType,\n    setSearchType,\n    enableRealTimeSearch,\n    setEnableRealTimeSearch,\n    debounceDelay,\n    setDebounceDelay,\n    handleSearch,\n    updateFileInResults\n  } = useFileSearch();\n\n  // æ–‡ä»¶é¢„è§ˆå’Œé‡å‘½å - ä¼ å…¥selectedFileTypeå‚æ•°\n  const {\n    previewFile,\n    setPreviewFile,\n    handlePreview: handlePreviewFile,\n    closePreview: handleClosePreview,\n    isRenameModalOpen,\n    setIsRenameModalOpen,\n    fileToRename,\n    setFileToRename,\n    openRename: handleRenameButtonClick,\n    renameFile: handleConfirmEdit\n  } = useFilePreview({\n    onRefresh: () => loadFiles(currentFolderId, selectedFileType, true),\n    onFileUpdate: handleFileUpdate,  // ä¼ å…¥æ–‡ä»¶æ›´æ–°å¤„ç†å‡½æ•°\n    onSearchResultsUpdate: updateFileInResults,  // ä¼ å…¥æœç´¢ç»“æœæ›´æ–°å‡½æ•°\n    selectedFileType  // ä¼ å…¥å½“å‰é€‰æ‹©çš„æ–‡ä»¶ç±»å‹\n  });\n\n  // æ·»åŠ åˆ›å»ºæ–‡ä»¶å¤¹ç›¸å…³çŠ¶æ€\n  const [isCreatingFolder, setIsCreatingFolder] = useState(false);\n  const [newFolderName, setNewFolderName] = useState('');\n  const [newFolderTags, setNewFolderTags] = useState<string[]>([]);\n  const [editingFile, setEditingFile] = useState<any>(null);\n  const [editingName, setEditingName] = useState('');\n  const [editingTags, setEditingTags] = useState<string[]>([]);\n  const [newTag, setNewTag] = useState('');\n  const [selectedFile, setSelectedFile] = useState<FileInfo | null>(null);\n\n  // æ–‡ä»¶ä¸Šä¸‹æ–‡èœå•å¤„ç† - ç§»è‡³hookså£°æ˜åŒºåŸŸ\n  const handleFileContextMenu = useCallback((e, file, setSelectedFile, setSelectedFiles) => {\n    // é˜»æ­¢é»˜è®¤å³é”®èœå•\n    e?.preventDefault();\n    e?.stopPropagation();\n    \n    if (file) {\n      // è®¾ç½®å½“å‰é€‰ä¸­çš„æ–‡ä»¶\n      setSelectedFile?.(file);\n      \n      // å¦‚æœæ˜¯å•å‡»é€‰æ‹©ï¼Œåªé€‰æ‹©å½“å‰æ–‡ä»¶\n      if (e?.type === 'contextmenu') {\n        setSelectedFiles?.([file.id]);\n      }\n      \n      // å¦‚æœæ˜¯æ–‡ä»¶ï¼ˆä¸æ˜¯æ–‡ä»¶å¤¹ï¼‰ï¼Œå¯ä»¥è®¾ç½®ä¸ºè¦é‡å‘½åçš„æ–‡ä»¶\n      if (!file.isFolder) {\n        setFileToRename(file);\n      }\n    }\n  }, [setFileToRename]);\n\n  // æ ‡ç­¾ç›¸å…³å¤„ç†å‡½æ•°\n  const handleAddTag = useCallback((tag: string) => {\n    if (editingFile) {\n      setEditingTags(prev => [...prev, tag]);\n    } else {\n      setNewFolderTags(prev => [...prev, tag]);\n    }\n    setNewTag('');\n  }, [editingFile]);\n\n  const handleRemoveTag = useCallback((tag: string) => {\n    if (editingFile) {\n      setEditingTags(prev => prev.filter(t => t !== tag));\n    } else {\n      setNewFolderTags(prev => prev.filter(t => t !== tag));\n    }\n  }, [editingFile]);\n\n  // çŠ¶æ€è·Ÿè¸ªå¼•ç”¨\n  const hasLoadedFilesRef = React.useRef(false);\n  const sessionInitializedRef = React.useRef(false);\n  // æ·»åŠ é˜²æ­¢é‡å¤åŠ è½½çš„æ ‡å¿—ï¼Œæ”¾åœ¨é¡¶å±‚\n  const loadInProgressRef = useRef(false);\n\n  // åœ¨æ–‡ä»¶ä¸Šä¼ æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ æˆåŠŸåè§¦å‘çš„å‡½æ•°\n  const handleUploadSuccess = useCallback(() => {\n    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\n    startLoading(true);\n    \n    // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨ï¼Œä¿æŒå½“å‰æ–‡ä»¶ç±»å‹è¿‡æ»¤ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\n    loadFiles(currentFolderId, selectedFileType, true).finally(() => {\n      finishLoading();\n    });\n  }, [currentFolderId, loadFiles, selectedFileType, startLoading, finishLoading]);\n\n  // å¤„ç†åˆ›å»ºæ–‡ä»¶å¤¹æŒ‰é’®ç‚¹å‡»\n  const handleCreateFolderClick = useCallback(() => {\n    setIsCreatingFolder(true);\n  }, [setIsCreatingFolder]);\n\n  const handleSignOut = useCallback(async () => {\n    try {\n      await signOut({ \n        callbackUrl: '/',\n        redirect: true \n      });\n    } catch (error) {\n      console.error('é€€å‡ºæ—¶å‘ç”Ÿé”™è¯¯:', error);\n      // å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå°è¯•å¼ºåˆ¶è·³è½¬åˆ°é¦–é¡µ\n      window.location.href = '/';\n    }\n  }, []);\n\n  // Sidebarä¸­\"æœç´¢æ–‡ä»¶\"ç‚¹å‡»å¤„ç†å‡½æ•°\n  const handleSearchClick = useCallback(() => {\n    setShowSearchView(true);\n  }, [setShowSearchView]);\n\n  // å¤„ç†æ–‡ä»¶ç‚¹å‡»\n  const handleFileItemClick = useCallback((file) => {\n    const localFile = files.find(f => f.id === file.id);\n    if (!localFile) return;\n\n    if (localFile.isFolder) {\n      // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œç»§ç»­ä½¿ç”¨åŸæœ‰çš„å¯¼èˆªé€»è¾‘\n      handleFileClick(localFile);\n    } else {\n      // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œæ‰“å¼€é¢„è§ˆ\n      handlePreviewFile(localFile);\n    }\n  }, [files, handleFileClick, handlePreviewFile]);\n\n  // å¤„ç†å…¨é€‰æ–‡ä»¶\n  const onSelectAllFiles = useCallback(() => {\n    setSelectedFiles(files.map(file => file.id));\n  }, [files, setSelectedFiles]);\n\n  // å¤„ç†å–æ¶ˆå…¨é€‰\n  const onDeselectAllFiles = useCallback(() => {\n    setSelectedFiles([]);\n  }, [setSelectedFiles]);\n\n  // å¤„ç†æ–‡ä»¶å¤é€‰æ¡†å˜åŒ–\n  const onFileCheckboxChange = useCallback((file: FileInfo, checked: boolean) => {\n    handleSelectFile(file.id, checked);\n  }, [handleSelectFile]);\n\n  // å¤„ç†è¿”å›æ ¹ç›®å½•/æ¸…é™¤è¿‡æ»¤å™¨ - ç§»åˆ°è¿™é‡Œ\n  const handleClearFilter = useCallback(() => {\n    setShowSearchView(false);\n    setSelectedFileType(null);\n    setCurrentFolderId(null);\n    setFolderPath([]);\n    \n    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\n    startLoading(true);\n    \n    // ä¼ é€’nullç±»å‹å‚æ•°ä»¥ç¡®ä¿æ¸…é™¤è¿‡æ»¤ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\n    loadFiles(null, null, true)\n      .finally(() => finishLoading());\n  }, [setShowSearchView, setSelectedFileType, setCurrentFolderId, setFolderPath, startLoading, loadFiles, finishLoading]);\n\n  // å¤„ç†æ ¹ç›®å½•ç‚¹å‡» - ç§»åˆ°è¿™é‡Œ\n  const handleRootClick = useCallback(() => {\n    setCurrentFolderId(null);\n    setFolderPath([]);\n    \n    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\n    startLoading(true);\n    \n    // ä¿æŒå½“å‰é€‰ä¸­çš„æ–‡ä»¶ç±»å‹ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\n    loadFiles(null, selectedFileType, true)\n      .finally(() => finishLoading());\n  }, [setCurrentFolderId, setFolderPath, startLoading, loadFiles, selectedFileType, finishLoading]);\n\n  // é‡å®šå‘é€»è¾‘ä¼˜åŒ–\n  useEffect(() => {\n    // åªåœ¨çŠ¶æ€ç¡®å®šæ—¶æ‰§è¡Œï¼Œé¿å…åˆå§‹loadingçŠ¶æ€è§¦å‘é‡å®šå‘\n    if (status === 'unauthenticated') {\n      console.log('ç”¨æˆ·æœªè®¤è¯ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢');\n      router.replace('/auth/login');\n    } else if (status === 'authenticated') {\n      console.log('ç”¨æˆ·å·²è®¤è¯ï¼Œç¡®è®¤ä¼šè¯çŠ¶æ€');\n      sessionInitializedRef.current = true;\n    }\n  }, [status, router]);\n\n  // æ–‡ä»¶åŠ è½½é€»è¾‘ä¼˜åŒ–\n  useEffect(() => {\n    // ç¡®ä¿sessionå­˜åœ¨ä¸”çŠ¶æ€ä¸ºå·²è®¤è¯ï¼Œä¸”æ–‡ä»¶æœªåŠ è½½è¿‡\n    if (status === 'authenticated' && session?.user && !hasLoadedFilesRef.current && !loadInProgressRef.current) {\n      console.log('åˆå§‹åŠ è½½æ–‡ä»¶åˆ—è¡¨', { currentFolderId, selectedFileType, session: !!session });\n      \n      // æ ‡è®°å·²ç»å¼€å§‹åŠ è½½\n      hasLoadedFilesRef.current = true;\n      loadInProgressRef.current = true;\n      \n      // å¼€å§‹åŠ è½½ï¼Œè¿™æ˜¯åˆå§‹åŠ è½½ï¼Œä½¿ç”¨éª¨æ¶å±\n      startLoading(false);\n      \n      // æ·»åŠ å»¶è¿Ÿï¼Œç¡®ä¿sessionå®Œå…¨åˆå§‹åŒ–\n      setTimeout(() => {\n        // ä¿®æ”¹ä¸ºå…ˆåŠ è½½ç”¨æˆ·èµ„æ–™ï¼ŒæˆåŠŸåå†åŠ è½½æ–‡ä»¶åˆ—è¡¨\n        fetchUserProfile()\n          .then(user-profileData => {\n            if (user-profileData) {\n              console.log('ç”¨æˆ·èµ„æ–™åŠ è½½æˆåŠŸï¼Œç»§ç»­åŠ è½½æ–‡ä»¶åˆ—è¡¨');\n              // åªæœ‰åœ¨ç”¨æˆ·èµ„æ–™åŠ è½½æˆåŠŸåæ‰åŠ è½½æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\n              return loadFiles(currentFolderId, selectedFileType, true)\n                .then(() => {\n                  console.log('æ–‡ä»¶åˆ—è¡¨åŠ è½½æˆåŠŸï¼Œå®Œæˆåˆå§‹åŒ–åŠ è½½');\n                  finishLoading(false);\n                  loadInProgressRef.current = false;\n                })\n                .catch(error => {\n                  console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);\n                  finishLoading(true, 'åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');\n                  loadInProgressRef.current = false;\n                });\n            } else {\n              console.log('ç”¨æˆ·èµ„æ–™ä¸ºç©ºï¼Œå°è¯•é‡æ–°è·å–...');\n              // å¢åŠ é‡è¯•å»¶è¿Ÿï¼Œç¡®ä¿sessionç¨³å®š\n              return new Promise(resolve => setTimeout(resolve, 1000))\n                .then(() => fetchUserProfile(true)) // å¼ºåˆ¶åˆ·æ–°æ¨¡å¼\n                .then(retryProfileData => {\n                  if (retryProfileData) {\n                    console.log('é‡è¯•è·å–ç”¨æˆ·èµ„æ–™æˆåŠŸï¼Œç»§ç»­åŠ è½½æ–‡ä»¶åˆ—è¡¨');\n                    return loadFiles(currentFolderId, selectedFileType, true)\n                      .then(() => {\n                        console.log('æ–‡ä»¶åˆ—è¡¨åŠ è½½æˆåŠŸï¼Œå®Œæˆåˆå§‹åŒ–åŠ è½½');\n                        finishLoading(false);\n                        loadInProgressRef.current = false;\n                      })\n                      .catch(error => {\n                        console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);\n                        finishLoading(true, 'åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');\n                        loadInProgressRef.current = false;\n                      });\n                  } else {\n                    console.error('é‡è¯•è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥');\n                    loadInProgressRef.current = false;\n                    throw new Error(\"è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•\");\n                  }\n                });\n            }\n          })\n          .catch((error) => {\n            console.error('åŠ è½½è¿‡ç¨‹å‡ºé”™:', error);\n            // å†æ¬¡å°è¯•è·å–ç”¨æˆ·èµ„æ–™ï¼ŒåŠ å¼ºå®¹é”™æ€§\n            setTimeout(() => {\n              console.log('æœ€åä¸€æ¬¡å°è¯•è·å–ç”¨æˆ·èµ„æ–™...');\n              fetchUserProfile(true)\n                .then(lastTryProfile => {\n                  if (lastTryProfile) {\n                    console.log('æœ€åå°è¯•æˆåŠŸï¼Œç»§ç»­åŠ è½½æ–‡ä»¶åˆ—è¡¨');\n                    loadFiles(currentFolderId, selectedFileType, true)\n                      .then(() => {\n                        finishLoading(false);\n                        loadInProgressRef.current = false;\n                      })\n                      .catch(err => {\n                        finishLoading(true, 'åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');\n                        loadInProgressRef.current = false;\n                      });\n                  } else {\n                    finishLoading(true, 'è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');\n                    loadInProgressRef.current = false;\n                  }\n                })\n                .catch(err => {\n                  finishLoading(true, err.message || 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•');\n                  loadInProgressRef.current = false;\n                });\n            }, 1500);\n          });\n      }, 500); // çŸ­æš‚å»¶è¿Ÿï¼Œç­‰å¾…sessionç¨³å®š\n    }\n  }, [status, session, currentFolderId, selectedFileType, loadFiles, fetchUserProfile, startLoading, finishLoading]);\n\n  // åˆå§‹åŒ–Lucideå›¾æ ‡\n  useEffect(() => {\n    // @ts-ignore\n    window.lucide?.createIcons();\n  }, []);\n  \n  // è®¡ç®—æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å…¨éƒ¨é€‰ä¸­\n  const areAllFilesSelected = files.length > 0 && selectedFiles.length === files.length;\n\n  // ä½¿ç”¨åˆå§‹åŒ–åŠ è½½çŠ¶æ€æ˜¾ç¤ºéª¨æ¶å±\n  if (isInitialLoading) {\n    console.log('æ˜¾ç¤ºéª¨æ¶å±åŠ è½½çŠ¶æ€');\n    return <SkeletonPageLayout />;\n  }\n\n  // å¦‚æœç”¨æˆ·çŠ¶æ€æ­£åœ¨åŠ è½½ï¼Œæ˜¾ç¤ºæ›´ç®€å•çš„åŠ è½½æç¤º\n  if (status === 'loading') {\n    console.log('æ˜¾ç¤ºç”¨æˆ·è®¤è¯åŠ è½½çŠ¶æ€');\n    return (\n      <div className={styles.loading}>\n        <div className={styles.loadingCard}>\n          <div className={styles.loadingSpinner}></div>\n          <h3 className={styles.loadingTitle}>æ­£åœ¨åŠ è½½</h3>\n          <p className={styles.loadingText}>è¯·ç¨å€™ï¼Œæ­£åœ¨éªŒè¯æ‚¨çš„èº«ä»½...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // ä¿®æ”¹é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä½¿ç”¨æ–°çš„ErrorDisplayç»„ä»¶\n  if (isLoadingError) {\n    console.log('æ˜¾ç¤ºé”™è¯¯çŠ¶æ€ï¼ŒåŸå› :', loadingError);\n    \n    // æ ¹æ®é”™è¯¯ä¿¡æ¯åˆ¤æ–­é”™è¯¯ç±»å‹\n    let errorType: 'network' | 'auth' | 'server' | 'data' | 'timeout' | 'unknown' = 'unknown';\n    \n    if (loadingError) {\n      if (loadingError.includes('ç½‘ç»œ') || loadingError.includes('è¿æ¥')) {\n        errorType = 'network';\n      } else if (loadingError.includes('è¶…æ—¶')) {\n        errorType = 'timeout';\n      } else if (loadingError.includes('æœåŠ¡å™¨')) {\n        errorType = 'server';\n      } else if (loadingError.includes('æ•°æ®') || loadingError.includes('èµ„æ–™')) {\n        errorType = 'data';\n      } else if (loadingError.includes('è®¤è¯') || loadingError.includes('ç™»å½•')) {\n        errorType = 'auth';\n      }\n    }\n    \n    return (\n      <ErrorDisplay \n        errorType={errorType}\n        message={loadingError || \"è¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜\"}\n        onRetry={() => {\n          startLoading(false);\n          fetchUserProfile(true)\n            .then(() => {\n              return loadFiles(currentFolderId, selectedFileType, true);\n            })\n            .then(() => finishLoading())\n            .catch((err) => finishLoading(true, err.message));\n        }}\n      />\n    );\n  }\n\n  // æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ£€æŸ¥ï¼Œå¦‚æœç”¨æˆ·èµ„æ–™ä»åœ¨åŠ è½½ä¸­ï¼Œç»§ç»­æ˜¾ç¤ºéª¨æ¶å±\n  if (profileLoading) {\n    console.log('ç”¨æˆ·èµ„æ–™çŠ¶æ€: ä»åœ¨åŠ è½½ä¸­', { profileLoading });\n    return <SkeletonPageLayout />;\n  }\n  \n  // å•ç‹¬æ£€æŸ¥ç”¨æˆ·èµ„æ–™æ˜¯å¦å­˜åœ¨\n  if (!user-profile) {\n    console.log('ç”¨æˆ·èµ„æ–™çŠ¶æ€: æœªè·å–åˆ°ç”¨æˆ·èµ„æ–™', { hasProfile: false });\n    return <SkeletonPageLayout />;\n  }\n\n  return (\n    <>\n      <Head>\n        <title>æ–‡ä»¶ç®¡ç† - äº‘ç›˜</title>\n      </Head>\n      \n      <div className={styles.file-managementContainer}>\n        {/* Miniä¾§è¾¹æ  */}\n        <MiniSidebar \n          avatarUrl={effectiveAvatarUrl}\n          userName={user-profile?.name}\n          userEmail={user-profile?.email}\n          onHomeClick={handleRootClick}\n          onLogoutClick={handleSignOut}\n          onAvatarClick={() => {\n            router.push('/dashboard');\n          }}\n          currentTheme={currentTheme}\n          onThemeClick={() => {\n            // åˆ‡æ¢ä¸»é¢˜é¢æ¿æ˜¾ç¤ºçŠ¶æ€ï¼ŒåŒæ—¶å…³é—­å…¶ä»–é¢æ¿\n            setShowThemePanel(!showThemePanel);\n            // å¦‚æœæ‰“å¼€ä¸»é¢˜é¢æ¿ï¼Œå…³é—­æœç´¢å’Œæ–‡ä»¶é¢„è§ˆ\n            if (!showThemePanel) {\n              setShowSearchView(false);\n              if (previewFile) {\n                handleClosePreview();\n              }\n            }\n          }}\n        />\n\n        {/* ä¾§è¾¹æ  - ä»…åœ¨éä¸»é¢˜æ¨¡å¼ä¸‹æ˜¾ç¤º */}\n        {sidebarVisible && !showThemePanel && (\n          <div className={styles.sidebarContainer}>\n            <Sidebar\n              selectedFileType={selectedFileType}\n              onTypeClick={(type) => {\n                console.log('ä¾§è¾¹æ ç±»å‹ç‚¹å‡»:', type);\n                \n                // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\n                startLoading(true);\n                \n                // å…ˆæ›´æ–°çŠ¶æ€\n                setSelectedFileType(type);\n                setCurrentFolderId(null);\n                setFolderPath([]);\n                \n                // ä½¿ç”¨æ–°çš„å‚æ•°ä¼ é€’æ–¹å¼ï¼Œç›´æ¥ä¼ å…¥ç‚¹å‡»çš„ç±»å‹\n                loadFiles(null, type)\n                  .finally(() => finishLoading());\n              }}\n              onSearchClick={handleSearchClick}\n            />\n          </div>\n        )}\n\n        {/* æ ¹æ®è§†å›¾çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹ */}\n        {showThemePanel ? (\n          /* ä¸»é¢˜è®¾ç½®è§†å›¾ */\n          <ThemePanel \n            currentTheme={currentTheme}\n            onThemeChange={async (themeId) => {\n              const success = await updateTheme(themeId);\n              return success;\n            }}\n            onClose={() => setShowThemePanel(false)}\n          />\n        ) : (\n          /* æ–‡ä»¶ç®¡ç†è§†å›¾ */\n          <div className={styles.mainContent}>\n            {/* å½“å†…å®¹åˆ·æ–°åŠ è½½æ—¶æ˜¾ç¤ºå±€éƒ¨åŠ è½½çŠ¶æ€ */}\n            {isRefreshing && (\n              <div className={styles.refreshingOverlay}>\n                <Spin tip=\"æ­£åœ¨åˆ·æ–°...\" />\n              </div>\n            )}\n            \n            {/* é¡¶éƒ¨æ“ä½œæ  */}\n            <TopActionBar \n              selectedFiles={selectedFiles}\n              onClearSelection={() => setSelectedFiles([])}\n              onDownload={handleDownload}\n              onRename={() => {\n                // å¦‚æœé€‰ä¸­äº†å¤šä¸ªæ–‡ä»¶ï¼Œæç¤ºç”¨æˆ·ä¸€æ¬¡åªèƒ½é‡å‘½åä¸€ä¸ªæ–‡ä»¶\n                if (selectedFiles.length > 1) {\n                  message.warning('ä¸€æ¬¡åªèƒ½é‡å‘½åä¸€ä¸ªæ–‡ä»¶');\n                  return;\n                }\n                \n                // å¦‚æœé€‰ä¸­äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°è¯¥æ–‡ä»¶å¹¶æ‰“å¼€é‡å‘½åå¯¹è¯æ¡†\n                if (selectedFiles.length === 1) {\n                  const selectedFile = files.find(file => file.id === selectedFiles[0]);\n                  if (selectedFile) {\n                    console.log('æ‰“å¼€é‡å‘½åå¯¹è¯æ¡†ï¼Œæ–‡ä»¶:', {\n                      id: selectedFile.id,\n                      name: selectedFile.name,\n                      isFolder: selectedFile.isFolder\n                    });\n                    handleRenameButtonClick(selectedFile);\n                  } else {\n                    message.warning('æœªæ‰¾åˆ°é€‰ä¸­çš„æ–‡ä»¶');\n                  }\n                } else {\n                  message.warning('è¯·å…ˆé€‰æ‹©è¦é‡å‘½åçš„æ–‡ä»¶');\n                }\n              }}\n              onMove={() => {}}\n              onDelete={handleDelete}\n              onClearFilter={handleClearFilter}\n              onCreateFolder={handleCreateFolderClick}\n              selectedFileType={selectedFileType}\n              showSearchView={showSearchView}\n              isInRootFolder={!currentFolderId && !selectedFileType && !showSearchView}\n              sortOrder={sortOrder}\n              setSortOrder={setSortOrder}\n              showUploadDropdown={showUploadDropdown}\n              setShowUploadDropdown={setShowUploadDropdown}\n              setIsUploadModalOpen={setIsUploadModalOpen}\n              setIsFolderUploadModalOpen={setIsFolderUploadModalOpen}\n              uploadDropdownRef={uploadDropdownRef}\n            />\n            \n            {/* é¢åŒ…å±‘å¯¼èˆªæ  */}\n            <div className={styles.breadcrumbBar}>\n              <Breadcrumb \n                folderPath={folderPath} \n                showHome={true}\n                onPathClick={(folderId) => {\n                  if (folderId === null) {\n                    setCurrentFolderId(null);\n                    setFolderPath([]);\n                    \n                    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\n                    startLoading(true);\n                    \n                    loadFiles(null, selectedFileType)\n                      .finally(() => finishLoading());\n                  } else {\n                    // æŸ¥æ‰¾ç”¨æˆ·ç‚¹å‡»çš„è·¯å¾„ç´¢å¼•\n                    const index = folderPath.findIndex(p => p.id === folderId);\n                    if (index !== -1) {\n                      // åˆ‡æ–­ç´¢å¼•ä¹‹åçš„éƒ¨åˆ†\n                      const newPath = folderPath.slice(0, index + 1);\n                      setFolderPath(newPath);\n                      setCurrentFolderId(folderId);\n                      \n                      // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\n                      startLoading(true);\n                      \n                      loadFiles(folderId, selectedFileType)\n                        .finally(() => finishLoading());\n                    }\n                  }\n                }}\n                onBackClick={() => {\n                  if (folderPath.length > 0) {\n                    handleBackClick();\n                  }\n                }}\n              />\n            </div>\n\n            {/* æœç´¢è§†å›¾æˆ–æ–‡ä»¶åˆ—è¡¨è§†å›¾ */}\n            <div className={styles.fileListWrapper}>\n              {showSearchView ? (\n                <div className=\"search-view-container\">\n                  <SearchView \n                    searchType={searchType}\n                    setSearchType={setSearchType}\n                    searchQuery={searchQuery}\n                    setSearchQuery={setSearchQuery}\n                    searchResults={searchResults}\n                    isLoading={searchLoading}\n                    error={searchError}\n                    handleSearch={handleSearch}\n                    handleFileClick={handleFileItemClick}\n                    enableRealTimeSearch={enableRealTimeSearch}\n                    setEnableRealTimeSearch={setEnableRealTimeSearch}\n                    debounceDelay={debounceDelay}\n                    setDebounceDelay={setDebounceDelay}\n                  />\n                </div>\n              ) : (\n                // æ–‡ä»¶åˆ—è¡¨\n                <>\n                  {isCreatingFolder && (\n                    <NewFolderForm \n                      folderName={newFolderName}\n                      setFolderName={setNewFolderName}\n                      folderTags={newFolderTags}\n                      setFolderTags={setNewFolderTags}\n                      onCreateFolder={() => {\n                        // å…ˆåˆ¤æ–­æ–‡ä»¶å¤¹åç§°æ˜¯å¦ä¸ºç©º\n                        if (!newFolderName || !newFolderName.trim()) {\n                          return; // å¦‚æœä¸ºç©ºï¼Œç›´æ¥è¿”å›\n                        }\n                        \n                        console.log('å¼€å§‹åˆ›å»ºæ–‡ä»¶å¤¹:', newFolderName);\n                        \n                        // ç¡®ä¿ä¼ é€’åç§°å’Œæ ‡ç­¾\n                        handleCreateFolder(newFolderName, currentFolderId, newFolderTags)\n                          .then(folderId => {\n                            console.log('æ–‡ä»¶å¤¹åˆ›å»ºè¿”å›ID:', folderId);\n                            \n                            // åªè¦è¿”å›å€¼ä¸æ˜¯nullï¼Œå°±è®¤ä¸ºæ˜¯æˆåŠŸçš„\n                            if (folderId !== null) {\n                              console.log('æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼Œå‡†å¤‡åˆ·æ–°');\n                              // åˆ›å»ºæˆåŠŸï¼Œå…³é—­è¡¨å•å¹¶åˆ·æ–°\n                              setIsCreatingFolder(false);\n                              setNewFolderName('');\n                              setNewFolderTags([]);\n                              \n                              // åˆ·æ–°å½“å‰æ–‡ä»¶å¤¹\n                              loadFiles(currentFolderId, selectedFileType, true)\n                                .then(() => {\n                                  console.log('æ–‡ä»¶åˆ—è¡¨åˆ·æ–°å®Œæˆ');\n                                })\n                                .catch(err => {\n                                  console.error('åˆ·æ–°æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', err);\n                                });\n                            } else {\n                              console.error('åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥ï¼ŒAPIè¿”å›null');\n                            }\n                          })\n                          .catch(error => {\n                            console.error('åˆ›å»ºæ–‡ä»¶å¤¹è¯·æ±‚å‡ºé”™:', error);\n                          });\n                      }}\n                      onCancel={() => {\n                        setIsCreatingFolder(false);\n                        setNewFolderName('');\n                        setNewFolderTags([]);\n                      }}\n                    />\n                  )}\n\n                  {/* æ–‡ä»¶åˆ—è¡¨ç»„ä»¶ */}\n                  <FileList \n                    files={convertFilesForDisplay(files)}\n                    onFileClick={handleFileItemClick}\n                    onFileSelect={(file, checked) => onFileCheckboxChange(file as FileInfo, checked)}\n                    onSelectAll={onSelectAllFiles}\n                    onDeselectAll={onDeselectAllFiles}\n                    selectedFiles={selectedFiles}\n                    onFileContextMenu={(e, file) => handleFileContextMenu(e, file, setSelectedFile, setSelectedFiles)}\n                    onBackClick={folderPath.length > 0 ? handleBackClick : undefined}\n                    isLoading={filesLoading}\n                    error={filesError}\n                    editingFile={editingFile}\n                    editingName={editingName}\n                    editingTags={editingTags}\n                    onEditNameChange={setEditingName}\n                    onConfirmEdit={handleConfirmEdit}\n                    onCancelEdit={() => setEditingFile(null)}\n                    onAddTag={handleAddTag}\n                    onRemoveTag={handleRemoveTag}\n                    newTag={newTag}\n                    onNewTagChange={setNewTag}\n                    showCheckboxes={true}\n                    areAllSelected={areAllFilesSelected}\n                  />\n                </>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n      \n      {/* ä¸Šä¼ æ¨¡æ€çª—å£ */}\n      <UploadModal \n        isOpen={isUploadModalOpen} \n        onClose={() => setIsUploadModalOpen(false)} \n        onSuccess={handleUploadSuccess}\n        currentFolderId={currentFolderId}\n        isFolderUpload={false}\n      />\n      \n      <UploadModal \n        isOpen={isFolderUploadModalOpen} \n        onClose={() => setIsFolderUploadModalOpen(false)} \n        onSuccess={handleUploadSuccess}\n        currentFolderId={currentFolderId}\n        isFolderUpload={true}\n      />\n\n      {/* é‡å‘½åæ¨¡æ€çª—å£ */}\n      <RenameModal\n        isOpen={isRenameModalOpen}\n        onClose={() => setIsRenameModalOpen(false)}\n        onRename={(newName, tags) => {\n          if (!fileToRename) {\n            message.warning('æœªé€‰æ‹©è¦é‡å‘½åçš„æ–‡ä»¶');\n            return;\n          }\n          \n          console.log('å‡†å¤‡é‡å‘½åæ–‡ä»¶:', {\n            id: fileToRename.id,\n            name: fileToRename.name,\n            newName: newName,\n            tagsCount: tags?.length || 0\n          });\n          \n          // ä½¿ç”¨useFilePreviewçš„renameFileå‡½æ•°\n          handleConfirmEdit(newName, tags)\n            .then(success => {\n              if (success) {\n                console.log('é‡å‘½åæˆåŠŸï¼Œåˆ·æ–°æ–‡ä»¶åˆ—è¡¨');\n              } else {\n                console.error('é‡å‘½åå¤±è´¥');\n              }\n            })\n            .catch(err => {\n              console.error('é‡å‘½åè¿‡ç¨‹å‡ºé”™:', err);\n            });\n        }}\n        initialName={fileToRename?.name || ''}\n        initialTags={fileToRename?.tags || []}\n        fileType={fileToRename?.isFolder ? 'folder' : 'file'}\n      />\n\n      {/* æ–‡ä»¶é¢„è§ˆç»„ä»¶åº”è¯¥ä½äºæ•´ä¸ªåº”ç”¨çš„æœ€å¤–å±‚ï¼Œç¡®ä¿å®ƒè¦†ç›–å…¶ä»–æ‰€æœ‰å†…å®¹ */}\n      {previewFile && (\n        <FilePreview\n          file={previewFile}\n          onClose={handleClosePreview}\n          onDownload={handleDownload}\n        />\n      )}\n    </>\n  );\n}\n       "
  },
  {
    "path": "app\\hooks\\user\\useProfile.ts",
    "newContent": "import { useState, useEffect, useRef, useCallback } from \"react\"\r\nimport { useSession } from \"next-auth/react\"\r\nimport { toast } from 'sonner'\r\nimport { applyTheme as applyThemeService } from \"@/app/shared/themes\"\r\n\r\n/**\r\n * ç”¨æˆ·èµ„æ–™æ¥å£\r\n */\r\nexport interface UserProfile {\r\n  /** ç”¨æˆ·ID */\r\n  id: string\r\n  /** é‚®ç®± */\r\n  email: string\r\n  /** ç”¨æˆ·å */\r\n  name: string | null\r\n  /** å¤´åƒURL */\r\n  avatarUrl?: string | null\r\n  /** ä¸»é¢˜ */\r\n  theme?: string | null\r\n  /** å·²ä½¿ç”¨å­˜å‚¨ç©ºé—´ï¼ˆå­—èŠ‚ï¼‰ */\r\n  storageUsed: number\r\n  /** å­˜å‚¨ç©ºé—´é™åˆ¶ï¼ˆå­—èŠ‚ï¼‰ */\r\n  storageLimit: number\r\n  /** ç”¨æˆ·ç®€ä»‹ */\r\n  bio?: string\r\n  /** ä½ç½® */\r\n  location?: string\r\n  /** ç½‘ç«™ */\r\n  website?: string\r\n  /** å…¬å¸ */\r\n  company?: string\r\n  /** åˆ›å»ºæ—¶é—´ */\r\n  createdAt: string\r\n  /** æ›´æ–°æ—¶é—´ */\r\n  updatedAt: string\r\n}\r\n\r\n/**\r\n * ç”¨æˆ·èµ„æ–™æ›´æ–°è¾“å…¥\r\n */\r\nexport interface UserProfileInput {\r\n  /** æ˜¾ç¤ºåç§° */\r\n  displayName?: string\r\n  /** å¤´åƒURL */\r\n  avatarUrl?: string\r\n  /** ä¸»é¢˜ */\r\n  theme?: string\r\n  /** ç”¨æˆ·ç®€ä»‹ */\r\n  bio?: string\r\n  /** ä½ç½® */\r\n  location?: string\r\n  /** ç½‘ç«™ */\r\n  website?: string\r\n  /** å…¬å¸ */\r\n  company?: string\r\n}\r\n\r\n/**\r\n * ç”¨æˆ·èµ„æ–™APIå“åº”\r\n */\r\nexport interface UserProfileResponse {\r\n  /** æ˜¯å¦æˆåŠŸ */\r\n  success: boolean\r\n  /** ç”¨æˆ·èµ„æ–™ */\r\n  profile?: UserProfile\r\n  /** é”™è¯¯ä¿¡æ¯ */\r\n  error?: string\r\n}\r\n\r\n// é»˜è®¤ç¦»çº¿ç”¨æˆ·é…ç½®ï¼Œå½“APIä¸å¯ç”¨æ—¶ä½¿ç”¨\r\nconst DEFAULT_OFFLINE_PROFILE: UserProfile = {\r\n  id: 'offline-user',\r\n  email: 'offline@example.com',\r\n  name: 'ç¦»çº¿æ¨¡å¼',\r\n  avatarUrl: null,\r\n  theme: 'default',\r\n  storageUsed: 0,\r\n  storageLimit: 1024 * 1024 * 100, // 100MB\r\n  createdAt: new Date().toISOString(),\r\n  updatedAt: new Date().toISOString()\r\n}\r\n\r\n// é‡è¯•é…ç½®\r\nconst RETRY_DELAY = 3000 // 3ç§’\r\nconst MAX_RETRIES = 2 // æœ€å¤§é‡è¯•æ¬¡æ•°\r\nconst MAX_ERROR_COUNT = 3 // è¿ç»­é”™è¯¯é˜ˆå€¼ï¼Œè¶…è¿‡åè¿›å…¥ç¦»çº¿æ¨¡å¼\r\n\r\n/**\r\n * ç”¨æˆ·èµ„æ–™Hook\r\n * æä¾›ç”¨æˆ·èµ„æ–™çš„è·å–ã€æ›´æ–°å’Œç®¡ç†åŠŸèƒ½\r\n * \r\n * @returns ç”¨æˆ·èµ„æ–™å’Œç›¸å…³æ“ä½œæ–¹æ³•\r\n */\r\nexport function useProfile() {\r\n  const { data: session } = useSession()\r\n  const [user-profile, setUserProfile] = useState<UserProfile | null>(null)\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [isOfflineMode, setIsOfflineMode] = useState(false)\r\n  const [consecutiveErrors, setConsecutiveErrors] = useState(0)\r\n  const abortControllerRef = useRef<AbortController | null>(null)\r\n  const lastFetchTimeRef = useRef<number>(0)\r\n  const sessionChangeRef = useRef<number>(0)\r\n\r\n  // æœ‰æ•ˆçš„å¤´åƒURLï¼Œä¼˜å…ˆä½¿ç”¨ç”¨æˆ·èµ„æ–™ä¸­çš„ï¼Œå…¶æ¬¡æ˜¯ä¼šè¯ä¸­çš„\r\n  const effectiveAvatarUrl = user-profile?.avatarUrl || session?.user?.image || null\r\n\r\n  /**\r\n   * è·å–ç”¨æˆ·èµ„æ–™\r\n   * @param showToast æ˜¯å¦æ˜¾ç¤ºåŠ è½½æˆåŠŸçš„æç¤º\r\n   * @param retryCount é‡è¯•æ¬¡æ•°\r\n   * @returns ç”¨æˆ·èµ„æ–™\r\n   */\r\n  const fetchUserProfile = useCallback(async (showToast = false, retryCount = 0) => {\r\n    // åˆ¤æ–­æ˜¯å¦åœ¨çŸ­æ—¶é—´å†…é‡å¤è°ƒç”¨ï¼Œé¿å…é¢‘ç¹è¯·æ±‚\r\n    const now = Date.now()\r\n    const timeSinceLastFetch = now - lastFetchTimeRef.current\r\n    \r\n    if (retryCount === 0 && timeSinceLastFetch < 2000 && lastFetchTimeRef.current > 0) {\r\n      console.log(`è·ä¸Šæ¬¡è¯·æ±‚ä»… ${timeSinceLastFetch}msï¼Œè·³è¿‡æ­¤æ¬¡è¯·æ±‚`)\r\n      return user-profile\r\n    }\r\n    \r\n    lastFetchTimeRef.current = now\r\n\r\n    // æ·»åŠ æ›´è¯¦ç»†çš„ session æ£€æŸ¥æ—¥å¿—\r\n    console.log('è·å–ç”¨æˆ·èµ„æ–™æ£€æŸ¥ session çŠ¶æ€:', { \r\n      sessionExists: !!session, \r\n      hasUser: !!session?.user, \r\n      userEmail: session?.user?.email || 'unknown',\r\n      retryCount \r\n    })\r\n\r\n    if (!session || !session.user) {\r\n      console.log('æœªæ£€æµ‹åˆ°æœ‰æ•ˆä¼šè¯ï¼Œæ— æ³•è·å–ç”¨æˆ·èµ„æ–™')\r\n      setIsLoading(false)\r\n      setError('æœªæ£€æµ‹åˆ°æœ‰æ•ˆä¼šè¯')\r\n      return null\r\n    }\r\n\r\n    // å¦‚æœå·²ç»è¶…è¿‡æœ€å¤§é”™è¯¯æ•°ï¼Œå¹¶ä¸”å·²ç»è¿›å…¥ç¦»çº¿æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨ç¦»çº¿é…ç½®\r\n    if (isOfflineMode && retryCount === 0) {\r\n      console.log('åº”ç”¨æ­£åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œï¼Œä½¿ç”¨é»˜è®¤é…ç½®')\r\n      if (!user-profile) {\r\n        const offlineProfile = {\r\n          ...DEFAULT_OFFLINE_PROFILE,\r\n          email: session.user?.email || DEFAULT_OFFLINE_PROFILE.email,\r\n          name: session.user?.name || DEFAULT_OFFLINE_PROFILE.name,\r\n        }\r\n        setUserProfile(offlineProfile)\r\n        setIsLoading(false)\r\n        return offlineProfile\r\n      }\r\n      setIsLoading(false)\r\n      return user-profile\r\n    }\r\n\r\n    // å¦‚æœå·²ç»æœ‰ç”¨æˆ·èµ„æ–™ä¸”ä¸æ˜¯é‡è¯•æ¨¡å¼ï¼Œåˆ™ç›´æ¥è¿”å›ç°æœ‰èµ„æ–™\r\n    if (user-profile && !showToast && retryCount === 0) {\r\n      console.log('å·²æœ‰ç”¨æˆ·èµ„æ–™ï¼Œç›´æ¥è¿”å›:', user-profile.email)\r\n      return user-profile\r\n    }\r\n\r\n    // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort()\r\n    }\r\n    \r\n    // åˆ›å»ºæ–°çš„AbortController\r\n    abortControllerRef.current = new AbortController()\r\n    const { signal } = abortControllerRef.current\r\n    \r\n    let timeoutId: NodeJS.Timeout | null = null\r\n\r\n    try {\r\n      setIsLoading(true)\r\n      \r\n      if (retryCount === 0) {\r\n        setError(null)\r\n      }\r\n      \r\n      console.log(`è·å–ç”¨æˆ·èµ„æ–™${retryCount > 0 ? `(é‡è¯• ${retryCount}/${MAX_RETRIES})` : ''}...`)\r\n      \r\n      // è®¾ç½®è¯·æ±‚è¶…æ—¶ - 10ç§’ï¼Œå¢å¼ºå®¹é”™æ€§\r\n      timeoutId = setTimeout(() => {\r\n        if (abortControllerRef.current) {\r\n          console.log('ç”¨æˆ·èµ„æ–™è¯·æ±‚è¶…æ—¶ï¼Œä¸­æ­¢è¯·æ±‚')\r\n          abortControllerRef.current.abort()\r\n        }\r\n      }, 10000) // 10ç§’è¶…æ—¶\r\n      \r\n      const response = await fetch('/api/user/profile', {\r\n        signal,\r\n        headers: {\r\n          'Cache-Control': 'no-cache',\r\n          'Pragma': 'no-cache'\r\n        }\r\n      })\r\n      \r\n      if (timeoutId) clearTimeout(timeoutId)\r\n      \r\n      // æ·»åŠ æ›´è¯¦ç»†çš„å“åº”æ—¥å¿—\r\n      console.log('èµ„æ–™è¯·æ±‚å“åº”çŠ¶æ€:', {\r\n        status: response.status,\r\n        ok: response.ok,\r\n        statusText: response.statusText\r\n      })\r\n      \r\n      if (!response.ok) {\r\n        console.error(`èµ„æ–™è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : ${response.status}`)\r\n        throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status} ${response.statusText}`)\r\n      }\r\n      \r\n      const data: UserProfileResponse = await response.json()\r\n      \r\n      console.log('èµ„æ–™è¯·æ±‚è¿”å›æ•°æ®:', {\r\n        success: data.success,\r\n        hasProfile: !!data.profile,\r\n        error: data.error || 'æ— '\r\n      })\r\n      \r\n      if (!data.success) {\r\n        console.error('èµ„æ–™è¯·æ±‚è¿”å›å¤±è´¥çŠ¶æ€:', data.error)\r\n        throw new Error(data.error || 'è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥')\r\n      }\r\n      \r\n      if (!data.profile) {\r\n        console.error('èµ„æ–™è¯·æ±‚æœªè¿”å›ç”¨æˆ·æ•°æ®')\r\n        throw new Error('æœåŠ¡å™¨æœªè¿”å›ç”¨æˆ·èµ„æ–™æ•°æ®')\r\n      }\r\n      \r\n      // è¯·æ±‚æˆåŠŸï¼Œé‡ç½®è¿ç»­é”™è¯¯è®¡æ•°\r\n      setConsecutiveErrors(0)\r\n      setIsOfflineMode(false)\r\n      setUserProfile(data.profile)\r\n      // æ˜ç¡®è®¾ç½®åŠ è½½çŠ¶æ€ä¸ºå®Œæˆ\r\n      setIsLoading(false)\r\n      console.log('ç”¨æˆ·èµ„æ–™è·å–æˆåŠŸ:', data.profile.email)\r\n      \r\n      if (showToast) {\r\n        toast.success('ç”¨æˆ·èµ„æ–™å·²æ›´æ–°')\r\n      }\r\n      \r\n      return data.profile\r\n    } catch (err) {\r\n      if (timeoutId) clearTimeout(timeoutId)\r\n      \r\n      console.error('è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', err)\r\n      setError(err instanceof Error ? err.message : 'æ— æ³•åŠ è½½ç”¨æˆ·èµ„æ–™')\r\n      \r\n      // å¢åŠ è¿ç»­é”™è¯¯è®¡æ•°\r\n      setConsecutiveErrors(prev => {\r\n        const newCount = prev + 1\r\n        console.log(`è¿ç»­é”™è¯¯è®¡æ•°: ${prev} -> ${newCount}`)\r\n        \r\n        // å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œè¿›å…¥ç¦»çº¿æ¨¡å¼\r\n        if (newCount >= MAX_ERROR_COUNT) {\r\n          setIsOfflineMode(true)\r\n          console.log(`é”™è¯¯æ¬¡æ•°(${newCount})è¶…è¿‡é˜ˆå€¼(${MAX_ERROR_COUNT})ï¼Œè¿›å…¥ç¦»çº¿æ¨¡å¼`)\r\n          \r\n          // å‡†å¤‡ç¦»çº¿ç”¨æˆ·èµ„æ–™\r\n          const offlineProfile = {\r\n            ...DEFAULT_OFFLINE_PROFILE,\r\n            email: session?.user?.email || DEFAULT_OFFLINE_PROFILE.email,\r\n            name: session?.user?.name || DEFAULT_OFFLINE_PROFILE.name,\r\n          }\r\n          \r\n          setUserProfile(offlineProfile)\r\n        }\r\n        \r\n        return newCount\r\n      })\r\n      \r\n      // åœ¨é‡è¯•æ¬¡æ•°å†…è¿›è¡Œé‡è¯•\r\n      if (retryCount < MAX_RETRIES) {\r\n        console.log(`${RETRY_DELAY}msåè¿›è¡Œç¬¬${retryCount + 1}æ¬¡é‡è¯•...`)\r\n        setTimeout(() => {\r\n          fetchUserProfile(showToast, retryCount + 1)\r\n        }, RETRY_DELAY)\r\n      } else {\r\n        setIsLoading(false)\r\n      }\r\n      \r\n      return user-profile\r\n    }\r\n  }, [session, user-profile, isOfflineMode, consecutiveErrors])\r\n\r\n  // ç›‘å¬ä¼šè¯å˜æ›´ï¼Œè·å–ç”¨æˆ·èµ„æ–™\r\n  useEffect(() => {\r\n    // ä¼šè¯å˜æ›´æ¬¡æ•°åŠ 1\r\n    sessionChangeRef.current += 1\r\n    const currentSessionChange = sessionChangeRef.current\r\n    \r\n    console.log(`ä¼šè¯å˜åŒ–(${currentSessionChange})ï¼Œé‡æ–°è·å–ç”¨æˆ·èµ„æ–™`)\r\n    \r\n    // é‡ç½®ç¦»çº¿æ¨¡å¼å’Œé”™è¯¯è®¡æ•°\r\n    if (session?.user) {\r\n      setIsOfflineMode(false)\r\n      setConsecutiveErrors(0)\r\n    }\r\n    \r\n    // å»¶è¿Ÿè·å–ç”¨æˆ·èµ„æ–™ï¼Œé¿å…åœ¨ä¼šè¯åˆå§‹åŒ–è¿‡ç¨‹ä¸­é¢‘ç¹è¯·æ±‚\r\n    const timeoutId = setTimeout(() => {\r\n      // ç¡®ä¿åœ¨ä¼šè¯çŠ¶æ€æœªå˜æ›´çš„æƒ…å†µä¸‹æ‰§è¡Œ\r\n      if (sessionChangeRef.current === currentSessionChange) {\r\n        fetchUserProfile()\r\n      }\r\n    }, 100)\r\n    \r\n    return () => clearTimeout(timeoutId)\r\n  }, [session, fetchUserProfile])\r\n\r\n  /**\r\n   * å¼ºåˆ¶åˆ·æ–°ç”¨æˆ·èµ„æ–™\r\n   */\r\n  const forceRefreshProfile = useCallback(() => {\r\n    return fetchUserProfile(true)\r\n  }, [fetchUserProfile])\r\n\r\n  /**\r\n   * æ›´æ–°ç”¨æˆ·èµ„æ–™\r\n   * @param profileData æ›´æ–°çš„èµ„æ–™æ•°æ®\r\n   * @returns æ˜¯å¦æ›´æ–°æˆåŠŸ\r\n   */\r\n  const updateUserProfile = useCallback(async (profileData: UserProfileInput) => {\r\n    if (!session?.user) {\r\n      console.error('ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•æ›´æ–°èµ„æ–™')\r\n      return false\r\n    }\r\n    \r\n    setIsLoading(true)\r\n    setError(null)\r\n    \r\n    try {\r\n      const response = await fetch('/api/user/profile', {\r\n        method: 'PUT',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(profileData),\r\n      })\r\n      \r\n      const data: UserProfileResponse = await response.json()\r\n      \r\n      if (!response.ok || !data.success) {\r\n        throw new Error(data.error || 'æ›´æ–°èµ„æ–™å¤±è´¥')\r\n      }\r\n      \r\n      if (data.profile) {\r\n        setUserProfile(data.profile)\r\n        toast.success('èµ„æ–™æ›´æ–°æˆåŠŸ')\r\n        return true\r\n      } else {\r\n        throw new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ— æ•ˆ')\r\n      }\r\n    } catch (error) {\r\n      console.error('æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥:', error)\r\n      setError(error instanceof Error ? error.message : 'æ›´æ–°èµ„æ–™å¤±è´¥')\r\n      toast.error(error instanceof Error ? error.message : 'æ›´æ–°èµ„æ–™å¤±è´¥')\r\n      return false\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [session])\r\n\r\n  /**\r\n   * æ›´æ–°ç”¨æˆ·ä¸»é¢˜\r\n   * @param theme ä¸»é¢˜ID\r\n   * @returns æ˜¯å¦æ›´æ–°æˆåŠŸ\r\n   */\r\n  const updateTheme = useCallback(async (theme: string) => {\r\n    return updateUserProfile({ theme })\r\n  }, [updateUserProfile])\r\n\r\n  /**\r\n   * åº”ç”¨ä¸»é¢˜\r\n   * @param theme ä¸»é¢˜ID\r\n   */\r\n  const applyTheme = useCallback((theme: string = 'default') => {\r\n    try {\r\n      applyThemeService(theme)\r\n      return true\r\n    } catch (error) {\r\n      console.error('åº”ç”¨ä¸»é¢˜å¤±è´¥:', error)\r\n      return false\r\n    }\r\n  }, [])\r\n\r\n  return {\r\n    user-profile,\r\n    isLoading,\r\n    error,\r\n    isOfflineMode,\r\n    effectiveAvatarUrl,\r\n    fetchUserProfile,\r\n    forceRefreshProfile,\r\n    updateUserProfile,\r\n    updateTheme,\r\n    applyTheme\r\n  }\r\n} "
  },
  {
    "path": "scripts\\fix-imports.js",
    "newContent": "/**\n * è‡ªåŠ¨ä¿®å¤å¯¼å…¥è·¯å¾„è„šæœ¬\n * ç”±rename-helper.jsè‡ªåŠ¨ç”Ÿæˆ\n */\n\nconst fs = require('fs');\nconst path = require('path');\nconst { promisify } = require('util');\nconst writeFile = promisify(fs.writeFile);\n\n// éœ€è¦ä¿®å¤çš„æ–‡ä»¶\nconst filesToFix = [\n  {\n    \"path\": \"app\\\\api\\\\user\\\\avatar\\\\route.ts\",\n    \"newContent\": \"import { NextRequest, NextResponse } from 'next/server';\\r\\nimport { getServerSession } from 'next-auth';\\r\\nimport { prisma } from '@/app/lib/database';\\r\\nimport { authOptions } from '@/app/lib/auth';\\r\\nimport { writeFile, mkdir, unlink } from 'fs/promises';\\r\\nimport { join } from 'path';\\r\\nimport crypto from 'crypto';\\r\\nimport fs from 'fs';\\r\\n\\r\\n// ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨\\r\\nconst ensureUploadDir = async () => {\\r\\n  const uploadDir = join(process.cwd(), 'public', 'uploads', 'avatars');\\r\\n  if (!fs.existsSync(uploadDir)) {\\r\\n    console.log('åˆ›å»ºå¤´åƒä¸Šä¼ ç›®å½•:', uploadDir);\\r\\n    await mkdir(uploadDir, { recursive: true });\\r\\n  }\\r\\n  return uploadDir;\\r\\n};\\r\\n\\r\\n// è·å–ç”¨æˆ·å½“å‰å¤´åƒæ–‡ä»¶è·¯å¾„\\r\\nconst getUserAvatarPath = async (userId: string) => {\\r\\n  const user = await prisma.user-profile.findUnique({\\r\\n    where: { userId },\\r\\n    select: { avatarUrl: true }\\r\\n  });\\r\\n  \\r\\n  if (!user?.avatarUrl) return null;\\r\\n  \\r\\n  // ä»URLæå–æ–‡ä»¶å\\r\\n  const fileName = user.avatarUrl.split('/').pop();\\r\\n  if (!fileName) return null;\\r\\n  \\r\\n  return join(process.cwd(), 'public', 'uploads', 'avatars', fileName);\\r\\n};\\r\\n\\r\\n// è·å–ç”¨æˆ·å½“å‰å¤´åƒ\\r\\nexport async function GET() {\\r\\n  try {\\r\\n    const session = await getServerSession(authOptions);\\r\\n    \\r\\n    if (!session?.user?.email) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\r\\n        { status: 401 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    const user = await prisma.user.findUnique({\\r\\n      where: { email: session.user.email },\\r\\n      include: { profile: true }\\r\\n    });\\r\\n\\r\\n    if (!user) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\r\\n        { status: 404 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    return NextResponse.json({\\r\\n      success: true,\\r\\n      avatarUrl: user.profile?.avatarUrl || session.user.image || null\\r\\n    });\\r\\n  } catch (error) {\\r\\n    console.error('è·å–å¤´åƒå¤±è´¥:', error);\\r\\n    return NextResponse.json(\\r\\n      { success: false, error: 'è·å–å¤´åƒå¤±è´¥' },\\r\\n      { status: 500 }\\r\\n    );\\r\\n  }\\r\\n}\\r\\n\\r\\n// ä¸Šä¼ ç”¨æˆ·å¤´åƒ\\r\\nexport async function POST(request: NextRequest) {\\r\\n  try {\\r\\n    const session = await getServerSession(authOptions);\\r\\n    \\r\\n    if (!session?.user?.email) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\r\\n        { status: 401 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    // è·å–ç”¨æˆ·ID\\r\\n    const user = await prisma.user.findUnique({\\r\\n      where: { email: session.user.email },\\r\\n      select: { id: true }\\r\\n    });\\r\\n\\r\\n    if (!user) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\r\\n        { status: 404 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    // å¤„ç†è¡¨å•æ•°æ®\\r\\n    const formData = await request.formData();\\r\\n    const file = formData.get('avatar') as File;\\r\\n    \\r\\n    if (!file) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æœªæä¾›å¤´åƒæ–‡ä»¶' },\\r\\n        { status: 400 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    // éªŒè¯æ–‡ä»¶ç±»å‹\\r\\n    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\\r\\n    if (!validTypes.includes(file.type)) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œè¯·ä¸Šä¼ JPEGã€PNGã€GIFæˆ–WEBPå›¾ç‰‡' },\\r\\n        { status: 400 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§2MBï¼‰\\r\\n    const maxSize = 2 * 1024 * 1024; // 2MB\\r\\n    if (file.size > maxSize) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆæœ€å¤§2MBï¼‰' },\\r\\n        { status: 400 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å\\r\\n    const fileExt = file.name.split('.').pop() || 'jpg';\\r\\n    const fileName = `${crypto.randomUUID()}.${fileExt}`;\\r\\n    \\r\\n    // ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨\\r\\n    const uploadDir = await ensureUploadDir();\\r\\n    const filePath = join(uploadDir, fileName);\\r\\n    const fileUrl = `/uploads/avatars/${fileName}`;\\r\\n\\r\\n    console.log('å‡†å¤‡å†™å…¥æ–‡ä»¶:', filePath);\\r\\n    console.log('å¯¹åº”çš„URL:', fileUrl);\\r\\n\\r\\n    // è¯»å–æ–‡ä»¶å†…å®¹\\r\\n    const buffer = Buffer.from(await file.arrayBuffer());\\r\\n    \\r\\n    // åˆ é™¤æ—§å¤´åƒæ–‡ä»¶\\r\\n    try {\\r\\n      const oldAvatarPath = await getUserAvatarPath(user.id);\\r\\n      if (oldAvatarPath && fs.existsSync(oldAvatarPath)) {\\r\\n        console.log('åˆ é™¤æ—§å¤´åƒæ–‡ä»¶:', oldAvatarPath);\\r\\n        await unlink(oldAvatarPath);\\r\\n      }\\r\\n    } catch (deleteError) {\\r\\n      console.error('åˆ é™¤æ—§å¤´åƒæ–‡ä»¶å¤±è´¥', deleteError);\\r\\n      // ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­ä¸Šä¼ æµç¨‹\\r\\n    }\\r\\n    \\r\\n    // å†™å…¥æ–‡ä»¶\\r\\n    try {\\r\\n      await writeFile(filePath, buffer);\\r\\n      console.log('æ–‡ä»¶å†™å…¥æˆåŠŸ:', filePath);\\r\\n    } catch (writeError) {\\r\\n      console.error('æ–‡ä»¶å†™å…¥å¤±è´¥:', writeError);\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æ–‡ä»¶ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•' },\\r\\n        { status: 500 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    // æ›´æ–°ç”¨æˆ·èµ„æ–™\\r\\n    await prisma.user-profile.upsert({\\r\\n      where: { userId: user.id },\\r\\n      update: { avatarUrl: fileUrl },\\r\\n      create: {\\r\\n        userId: user.id,\\r\\n        avatarUrl: fileUrl,\\r\\n        displayName: session.user.name || ''\\r\\n      }\\r\\n    });\\r\\n\\r\\n    return NextResponse.json({ \\r\\n      success: true,\\r\\n      avatarUrl: fileUrl\\r\\n    });\\r\\n  } catch (error) {\\r\\n    console.error('å¤´åƒä¸Šä¼ å¤±è´¥:', error);\\r\\n    return NextResponse.json(\\r\\n      { success: false, error: 'å¤´åƒä¸Šä¼ å¤±è´¥' },\\r\\n      { status: 500 }\\r\\n    );\\r\\n  }\\r\\n}\\r\\n\\r\\n// åˆ é™¤è‡ªå®šä¹‰å¤´åƒï¼Œæ¢å¤é»˜è®¤å¤´åƒ\\r\\nexport async function DELETE() {\\r\\n  try {\\r\\n    const session = await getServerSession(authOptions);\\r\\n    \\r\\n    if (!session?.user?.email) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\r\\n        { status: 401 }\\r\\n      );\\r\\n    }\\r\\n\\r\\n    const user = await prisma.user.findUnique({\\r\\n      where: { email: session.user.email },\\r\\n      select: { id: true }\\r\\n    });\\r\\n\\r\\n    if (!user) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\r\\n        { status: 404 }\\r\\n      );\\r\\n    }\\r\\n    \\r\\n    // åˆ é™¤å¤´åƒæ–‡ä»¶\\r\\n    try {\\r\\n      const avatarPath = await getUserAvatarPath(user.id);\\r\\n      if (avatarPath && fs.existsSync(avatarPath)) {\\r\\n        console.log('åˆ é™¤å¤´åƒæ–‡ä»¶:', avatarPath);\\r\\n        await unlink(avatarPath);\\r\\n      }\\r\\n    } catch (deleteError) {\\r\\n      console.error('åˆ é™¤å¤´åƒæ–‡ä»¶å¤±è´¥:', deleteError);\\r\\n      // ç»§ç»­æ‰§è¡Œï¼Œä¸ä¸­æ–­åˆ é™¤æµç¨‹\\r\\n    }\\r\\n\\r\\n    // æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼Œåˆ é™¤è‡ªå®šä¹‰å¤´åƒ\\r\\n    await prisma.user-profile.update({\\r\\n      where: { userId: user.id },\\r\\n      data: { avatarUrl: null }\\r\\n    });\\r\\n\\r\\n    return NextResponse.json({\\r\\n      success: true,\\r\\n      avatarUrl: session.user.image || null\\r\\n    });\\r\\n  } catch (error) {\\r\\n    console.error('åˆ é™¤å¤´åƒå¤±è´¥:', error);\\r\\n    return NextResponse.json(\\r\\n      { success: false, error: 'åˆ é™¤å¤´åƒå¤±è´¥' },\\r\\n      { status: 500 }\\r\\n    );\\r\\n  }\\r\\n} \\r\\n\"\n  },\n  {\n    \"path\": \"app\\\\api\\\\user\\\\profile\\\\route.ts\",\n    \"newContent\": \"import { NextRequest, NextResponse } from 'next/server'\\r\\nimport { getServerSession } from 'next-auth'\\r\\nimport { prisma } from '@/app/lib/database'\\r\\n\\r\\n// è·å–å½“å‰è®¤è¯é…ç½®\\r\\nimport { authOptions } from '@/app/lib/auth'\\r\\n\\r\\n// ä»å‰ç«¯è·å–çš„ç”¨æˆ·èµ„æ–™æ¥å£\\r\\ninterface UserProfileInput {\\r\\n  displayName?: string\\r\\n  bio?: string\\r\\n  location?: string\\r\\n  website?: string\\r\\n  company?: string\\r\\n  avatarUrl?: string\\r\\n  theme?: string\\r\\n}\\r\\n\\r\\n// è¿”å›ç»™å‰ç«¯çš„ç”¨æˆ·èµ„æ–™æ¥å£\\r\\ninterface UserProfileResponse {\\r\\n  id: string\\r\\n  email: string\\r\\n  name: string | null\\r\\n  avatarUrl?: string | null\\r\\n  theme?: string | null\\r\\n  bio?: string | null\\r\\n  location?: string | null\\r\\n  website?: string | null\\r\\n  company?: string | null\\r\\n  storageUsed: number\\r\\n  storageLimit: number\\r\\n  createdAt: string\\r\\n  updatedAt: string\\r\\n}\\r\\n\\r\\n// è·å–ç”¨æˆ·èµ„æ–™\\r\\nexport async function GET() {\\r\\n  console.log('GET /api/user/profile è¯·æ±‚å¼€å§‹')\\r\\n  try {\\r\\n    const session = await getServerSession(authOptions)\\r\\n    console.log('è·å–åˆ°ç”¨æˆ·ä¼šè¯:', session ? 'æˆåŠŸ' : 'å¤±è´¥')\\r\\n    \\r\\n    if (!session?.user?.email) {\\r\\n      console.log('æœªæˆæƒè®¿é—®: æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·é‚®ç®±')\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\r\\n        { status: 401 }\\r\\n      )\\r\\n    }\\r\\n\\r\\n    console.log('æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œé‚®ç®±:', session.user.email)\\r\\n    // æŸ¥è¯¢ç”¨æˆ·ï¼Œå¹¶åŒ…å«ç”¨æˆ·èµ„æ–™\\r\\n    const user = await prisma.user.findUnique({\\r\\n      where: {\\r\\n        email: session.user.email\\r\\n      },\\r\\n      include: {\\r\\n        profile: true\\r\\n      }\\r\\n    })\\r\\n\\r\\n    if (!user) {\\r\\n      console.log('ç”¨æˆ·ä¸å­˜åœ¨:', session.user.email)\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\r\\n        { status: 404 }\\r\\n      )\\r\\n    }\\r\\n\\r\\n    // æ„å»ºç”¨æˆ·èµ„æ–™å“åº”\\r\\n    const user-profile: UserProfileResponse = {\\r\\n      id: user.id,\\r\\n      email: user.email,\\r\\n      name: user.name,\\r\\n      avatarUrl: user.profile?.avatarUrl || null, \\r\\n      theme: user.profile?.theme || null,\\r\\n      bio: user.profile?.bio || null,\\r\\n      location: user.profile?.location || null,\\r\\n      website: user.profile?.website || null,\\r\\n      company: user.profile?.company || null,\\r\\n      storageUsed: user.storageUsed,\\r\\n      storageLimit: user.storageLimit,\\r\\n      createdAt: user.createdAt.toISOString(),\\r\\n      updatedAt: user.updatedAt.toISOString()\\r\\n    }\\r\\n\\r\\n    console.log('æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯:', user.id)\\r\\n    return NextResponse.json({\\r\\n      success: true,\\r\\n      profile: user-profile\\r\\n    })\\r\\n  } catch (error) {\\r\\n    console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\\r\\n    return NextResponse.json(\\r\\n      { success: false, error: 'è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥' },\\r\\n      { status: 500 }\\r\\n    )\\r\\n  }\\r\\n}\\r\\n\\r\\n// æ›´æ–°ç”¨æˆ·èµ„æ–™\\r\\nexport async function PUT(request: NextRequest) {\\r\\n  console.log('PUT /api/user/profile è¯·æ±‚å¼€å§‹')\\r\\n  try {\\r\\n    const session = await getServerSession(authOptions)\\r\\n    console.log('è·å–åˆ°ç”¨æˆ·ä¼šè¯:', session ? 'æˆåŠŸ' : 'å¤±è´¥')\\r\\n    \\r\\n    if (!session?.user?.email) {\\r\\n      console.log('æœªæˆæƒè®¿é—®: æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·é‚®ç®±')\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\r\\n        { status: 401 }\\r\\n      )\\r\\n    }\\r\\n\\r\\n    const data = await request.json() as UserProfileInput\\r\\n    console.log('æ¥æ”¶åˆ°çš„æ•°æ®:', data)\\r\\n\\r\\n    // è·å–ç”¨æˆ·\\r\\n    const user = await prisma.user.findUnique({\\r\\n      where: {\\r\\n        email: session.user.email\\r\\n      },\\r\\n      include: {\\r\\n        profile: true\\r\\n      }\\r\\n    })\\r\\n\\r\\n    if (!user) {\\r\\n      return NextResponse.json(\\r\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\r\\n        { status: 404 }\\r\\n      )\\r\\n    }\\r\\n\\r\\n    // æ›´æ–°ç”¨æˆ·åç§°\\r\\n    const updatedUser = await prisma.user.update({\\r\\n      where: {\\r\\n        id: user.id\\r\\n      },\\r\\n      data: {\\r\\n        name: data.displayName || user.name\\r\\n      }\\r\\n    })\\r\\n\\r\\n    // æ›´æ–°æˆ–åˆ›å»ºç”¨æˆ·èµ„æ–™\\r\\n    console.log('å¼€å§‹æ›´æ–°ç”¨æˆ·èµ„æ–™ï¼Œç”¨æˆ·ID:', user.id);\\r\\n    console.log('å½“å‰ç”¨æˆ·Profileæ•°æ®:', user.profile || 'æ— ');\\r\\n    \\r\\n    const profile = await prisma.user-profile.upsert({\\r\\n      where: {\\r\\n        userId: user.id\\r\\n      },\\r\\n      update: {\\r\\n        avatarUrl: data.avatarUrl !== undefined ? data.avatarUrl : user.profile?.avatarUrl,\\r\\n        theme: data.theme !== undefined ? data.theme : user.profile?.theme,\\r\\n        displayName: data.displayName || user.profile?.displayName || user.name,\\r\\n        bio: data.bio !== undefined ? data.bio : user.profile?.bio,\\r\\n        location: data.location !== undefined ? data.location : user.profile?.location,\\r\\n        website: data.website !== undefined ? data.website : user.profile?.website,\\r\\n        company: data.company !== undefined ? data.company : user.profile?.company\\r\\n      },\\r\\n      create: {\\r\\n        userId: user.id,\\r\\n        displayName: data.displayName || user.name || '',\\r\\n        avatarUrl: data.avatarUrl,\\r\\n        theme: data.theme,\\r\\n        bio: data.bio || '',\\r\\n        location: data.location || '',\\r\\n        website: data.website || '',\\r\\n        company: data.company || ''\\r\\n      }\\r\\n    });\\r\\n    \\r\\n    console.log('ç”¨æˆ·èµ„æ–™æ›´æ–°/åˆ›å»ºæˆåŠŸ:', profile);\\r\\n\\r\\n    // æ„å»ºç”¨æˆ·èµ„æ–™å“åº”\\r\\n    const user-profile: UserProfileResponse = {\\r\\n      id: updatedUser.id,\\r\\n      email: updatedUser.email,\\r\\n      name: updatedUser.name,\\r\\n      avatarUrl: profile.avatarUrl,\\r\\n      theme: profile.theme,\\r\\n      bio: profile.bio,\\r\\n      location: profile.location,\\r\\n      website: profile.website,\\r\\n      company: profile.company,\\r\\n      storageUsed: updatedUser.storageUsed,\\r\\n      storageLimit: updatedUser.storageLimit,\\r\\n      createdAt: updatedUser.createdAt.toISOString(),\\r\\n      updatedAt: updatedUser.updatedAt.toISOString()\\r\\n    }\\r\\n\\r\\n    console.log('æˆåŠŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯:', user.id)\\r\\n    return NextResponse.json({\\r\\n      success: true,\\r\\n      profile: user-profile\\r\\n    })\\r\\n  } catch (error) {\\r\\n    console.error('æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)\\r\\n    return NextResponse.json(\\r\\n      { success: false, error: 'æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥' },\\r\\n      { status: 500 }\\r\\n    )\\r\\n  }\\r\\n} \"\n  },\n  {\n    \"path\": \"app\\\\api\\\\user\\\\theme\\\\route.ts\",\n    \"newContent\": \"import { NextRequest, NextResponse } from 'next/server';\\nimport { getServerSession } from 'next-auth';\\nimport { prisma } from '@/app/lib/database';\\nimport { authOptions } from '@/app/lib/auth';\\n\\n// è·å–ç”¨æˆ·å½“å‰ä¸»é¢˜\\nexport async function GET() {\\n  try {\\n    const session = await getServerSession(authOptions);\\n    \\n    if (!session?.user?.email) {\\n      return NextResponse.json(\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\n        { status: 401 }\\n      );\\n    }\\n\\n    const user = await prisma.user.findUnique({\\n      where: { email: session.user.email },\\n      include: { profile: true }\\n    });\\n\\n    if (!user) {\\n      return NextResponse.json(\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\n        { status: 404 }\\n      );\\n    }\\n\\n    return NextResponse.json({\\n      success: true,\\n      theme: user.profile?.theme || 'default'\\n    });\\n  } catch (error) {\\n    console.error('è·å–ä¸»é¢˜å¤±è´¥:', error);\\n    return NextResponse.json(\\n      { success: false, error: 'è·å–ä¸»é¢˜å¤±è´¥' },\\n      { status: 500 }\\n    );\\n  }\\n}\\n\\n// æ›´æ–°ç”¨æˆ·ä¸»é¢˜\\nexport async function PUT(request: NextRequest) {\\n  try {\\n    const session = await getServerSession(authOptions);\\n    \\n    if (!session?.user?.email) {\\n      return NextResponse.json(\\n        { success: false, error: 'æœªæˆæƒè®¿é—®' },\\n        { status: 401 }\\n      );\\n    }\\n\\n    // è·å–è¯·æ±‚ä½“\\n    const data = await request.json();\\n    const { theme } = data;\\n    \\n    if (!theme) {\\n      return NextResponse.json(\\n        { success: false, error: 'æœªæä¾›ä¸»é¢˜å‚æ•°' },\\n        { status: 400 }\\n      );\\n    }\\n\\n    // éªŒè¯ä¸»é¢˜æ˜¯å¦æœ‰æ•ˆ\\n    const validThemes = [\\n      // åŸºç¡€è‰²å½©ä¸»é¢˜\\n      'default', 'violet', 'emerald', 'amber', 'rose',\\n      // æ¸å˜ä¸»é¢˜\\n      'ocean', 'sunset', 'forest', 'galaxy', \\n      // å­£èŠ‚ä¸»é¢˜\\n      'spring', 'summer', 'autumn', 'winter',\\n      // æŸ”å’Œä¸»é¢˜ - æµ…è‰²ç³»åˆ—\\n      'pastel_pink', 'pastel_blue', 'pastel_lavender', 'pastel_mint', \\n      'pastel_peach', 'pastel_lemon', 'pastel_teal'\\n    ];\\n    if (!validThemes.includes(theme)) {\\n      return NextResponse.json(\\n        { success: false, error: 'æ— æ•ˆçš„ä¸»é¢˜' },\\n        { status: 400 }\\n      );\\n    }\\n\\n    // è·å–ç”¨æˆ·ID\\n    const user = await prisma.user.findUnique({\\n      where: { email: session.user.email },\\n      select: { id: true }\\n    });\\n\\n    if (!user) {\\n      return NextResponse.json(\\n        { success: false, error: 'ç”¨æˆ·ä¸å­˜åœ¨' },\\n        { status: 404 }\\n      );\\n    }\\n\\n    // æ›´æ–°ç”¨æˆ·ä¸»é¢˜\\n    await prisma.user-profile.upsert({\\n      where: { userId: user.id },\\n      update: { theme },\\n      create: {\\n        userId: user.id,\\n        displayName: session.user.name || '',\\n        theme\\n      }\\n    });\\n\\n    return NextResponse.json({\\n      success: true,\\n      theme\\n    });\\n  } catch (error) {\\n    console.error('æ›´æ–°ä¸»é¢˜å¤±è´¥:', error);\\n    return NextResponse.json(\\n      { success: false, error: 'æ›´æ–°ä¸»é¢˜å¤±è´¥' },\\n      { status: 500 }\\n    );\\n  }\\n} \\n\"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\actionBar\\\\TopActionBar\\\\TopActionBar.tsx\",\n    \"newContent\": \"import React from 'react';\\r\\nimport { \\r\\n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \\r\\n} from 'lucide-react';\\r\\nimport styles from '@/app/file-management/styles/shared.module.css';\\r\\nimport { SortDropdown } from '@/app/components/features/file-management/actionBar/SortDropdown';\\r\\nimport { UploadButton } from '@/app/components/features/file-management/upload/UploadButton';\\r\\nimport { FileSortInterface } from '@/app/types';\\r\\n\\r\\ninterface TopActionBarProps {\\r\\n  selectedFiles: string[];\\r\\n  onClearSelection: () => void;\\r\\n  onDownload: () => void;\\r\\n  onRename: () => void;\\r\\n  onMove: () => void;\\r\\n  onDelete: () => void;\\r\\n  onClearFilter: () => void;\\r\\n  onCreateFolder: () => void;\\r\\n  selectedFileType: string | null;\\r\\n  showSearchView: boolean;\\r\\n  isInRootFolder: boolean;\\r\\n  sortOrder: FileSortInterface;\\r\\n  setSortOrder: (order: FileSortInterface) => void;\\r\\n  showUploadDropdown: boolean;\\r\\n  setShowUploadDropdown: (show: boolean) => void;\\r\\n  setIsUploadModalOpen: (open: boolean) => void;\\r\\n  setIsFolderUploadModalOpen: (open: boolean) => void;\\r\\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\\r\\n}\\r\\n\\r\\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\\r\\n  selectedFiles,\\r\\n  onClearSelection,\\r\\n  onDownload,\\r\\n  onRename,\\r\\n  onMove,\\r\\n  onDelete,\\r\\n  onClearFilter,\\r\\n  onCreateFolder,\\r\\n  selectedFileType,\\r\\n  showSearchView,\\r\\n  isInRootFolder,\\r\\n  sortOrder,\\r\\n  setSortOrder,\\r\\n  showUploadDropdown,\\r\\n  setShowUploadDropdown,\\r\\n  setIsUploadModalOpen,\\r\\n  setIsFolderUploadModalOpen,\\r\\n  uploadDropdownRef\\r\\n}) => {\\r\\n  return (\\r\\n    <div className={styles.topBar}>\\r\\n      <div className={styles.buttonGroup}>\\r\\n        {selectedFiles.length > 0 ? (\\r\\n          <>\\r\\n            <button className={styles.topButton} onClick={onClearSelection}>\\r\\n              <X className=\\\"w-4 h-4\\\" />\\r\\n              å–æ¶ˆé€‰æ‹©\\r\\n            </button>\\r\\n            <button className={styles.topButton} onClick={onDownload}>\\r\\n              <Download className=\\\"w-4 h-4\\\" />\\r\\n              ä¸‹è½½\\r\\n            </button>\\r\\n            <button \\r\\n              className={styles.topButton}\\r\\n              onClick={onRename}\\r\\n            >\\r\\n              <Edit className=\\\"w-4 h-4\\\" />\\r\\n              é‡å‘½å\\r\\n            </button>\\r\\n            <button className={styles.topButton} onClick={onMove}>\\r\\n              <Move className=\\\"w-4 h-4\\\" />\\r\\n              ç§»åŠ¨\\r\\n            </button>\\r\\n            <button className={styles.topButton} onClick={onDelete}>\\r\\n              <Trash2 className=\\\"w-4 h-4\\\" />\\r\\n              åˆ é™¤\\r\\n            </button>\\r\\n          </>\\r\\n        ) : (\\r\\n          <>\\r\\n            <button \\r\\n              className={styles.topButton}\\r\\n              onClick={onClearFilter}\\r\\n              disabled={isInRootFolder}\\r\\n            >\\r\\n              <span>ğŸ“</span>\\r\\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\\r\\n            </button>\\r\\n\\r\\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\\r\\n            {selectedFileType && (\\r\\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\\r\\n                {(() => {\\r\\n                  switch(selectedFileType) {\\r\\n                    case 'image': return <ImageIcon className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'document': return <FileText className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'video': return <Video className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'audio': return <Music className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'other': return <File className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    default: return null;\\r\\n                  }\\r\\n                })()}\\r\\n                å½“å‰æµè§ˆï¼š\\r\\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\\r\\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\\r\\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\\r\\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\\r\\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\\r\\n              </div>\\r\\n            )}\\r\\n\\r\\n            {/* æ’åºä¸‹æ‹‰èœå• */}\\r\\n            <SortDropdown \\r\\n              sortOrder={sortOrder}\\r\\n              onSortChange={setSortOrder}\\r\\n            />\\r\\n            \\r\\n            {/* ä¸Šä¼ æŒ‰é’® */}\\r\\n            <UploadButton \\r\\n              showDropdown={showUploadDropdown}\\r\\n              setShowDropdown={setShowUploadDropdown}\\r\\n              setIsModalOpen={setIsUploadModalOpen}\\r\\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\\r\\n              uploadDropdownRef={uploadDropdownRef}\\r\\n            />\\r\\n            \\r\\n            <button \\r\\n              className={styles.folderButton} \\r\\n              onClick={onCreateFolder}\\r\\n            >\\r\\n              <FolderUp className=\\\"w-4 h-4 mr-2\\\" />\\r\\n              æ–°å»ºæ–‡ä»¶å¤¹\\r\\n            </button>\\r\\n          </>\\r\\n        )}\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default TopActionBar; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\MiniSidebar.tsx\",\n    \"newContent\": \"/**\\r\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\r\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/MiniSidebar ç»„ä»¶ã€‚\\r\\n */\\r\\n\\r\\nimport React from 'react';\\r\\nimport Image from 'next/image';\\r\\nimport { Home, LogOut, Palette } from 'lucide-react';\\r\\nimport styles from '../styles/shared.module.css';\\r\\n\\r\\ninterface MiniSidebarProps {\\r\\n  avatarUrl: string | null;\\r\\n  userName: string | null;\\r\\n  userEmail: string | null;\\r\\n  onHomeClick: () => void;\\r\\n  onLogoutClick: () => void;\\r\\n  onAvatarClick: () => void;\\r\\n  currentTheme?: string | null;\\r\\n  onThemeClick: () => void;\\r\\n}\\r\\n\\r\\nconst MiniSidebar: React.FC<MiniSidebarProps> = ({\\r\\n  avatarUrl,\\r\\n  userName,\\r\\n  userEmail,\\r\\n  onHomeClick,\\r\\n  onLogoutClick,\\r\\n  onAvatarClick,\\r\\n  currentTheme = 'default',\\r\\n  onThemeClick\\r\\n}) => {\\r\\n  return (\\r\\n    <div className={styles.miniSidebar}>\\r\\n      <div className={styles.patternOverlay}></div>\\r\\n      <div className={styles.avatarContainer}>\\r\\n        <button \\r\\n          className={styles.miniSidebarButton}\\r\\n          onClick={onAvatarClick}\\r\\n        >\\r\\n          {avatarUrl ? (\\r\\n            <Image\\r\\n              src={`${avatarUrl}?t=${Date.now()}`}\\r\\n              alt=\\\"ç”¨æˆ·å¤´åƒ\\\"\\r\\n              width={38}\\r\\n              height={38}\\r\\n              className=\\\"rounded-full ring-1 ring-white/50 transition-all duration-300 hover:ring-2\\\"\\r\\n            />\\r\\n          ) : (\\r\\n            <div \\r\\n              className={styles.avatarPlaceholder}\\r\\n              style={{ width: '38px', height: '38px', fontSize: '16px' }}\\r\\n            >\\r\\n              {userName?.[0]?.toUpperCase() || userEmail?.[0]?.toUpperCase() || '?'}\\r\\n            </div>\\r\\n          )}\\r\\n        </button>\\r\\n      </div>\\r\\n      <div className={styles.miniSidebarDivider}></div>\\r\\n      <button \\r\\n        className={styles.miniSidebarButton}\\r\\n        onClick={onHomeClick}\\r\\n      >\\r\\n        <Home className=\\\"w-5 h-5 text-white\\\" />\\r\\n      </button>\\r\\n      \\r\\n      {/* ä¸»é¢˜é€‰æ‹©æŒ‰é’® */}\\r\\n      <button \\r\\n        className={styles.miniSidebarButton}\\r\\n        onClick={onThemeClick}\\r\\n        title=\\\"ä¸»é¢˜è®¾ç½®\\\"\\r\\n      >\\r\\n        <Palette className=\\\"w-5 h-5 text-white\\\" />\\r\\n      </button>\\r\\n      \\r\\n      <button \\r\\n        className={styles.miniSidebarButton}\\r\\n        onClick={onLogoutClick}\\r\\n      >\\r\\n        <LogOut className=\\\"w-5 h-5 text-white\\\" />\\r\\n      </button>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default MiniSidebar; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\NewFolderForm.tsx\",\n    \"newContent\": \"/**\\r\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\r\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/folderManagement/NewFolderForm ç»„ä»¶ã€‚\\r\\n */\\r\\n\\r\\nimport React, { useRef, useState, useEffect } from 'react';\\r\\nimport { Folder, AlertCircle } from 'lucide-react';\\r\\nimport styles from '../styles/shared.module.css';\\r\\n\\r\\ninterface NewFolderFormProps {\\r\\n  folderName: string;\\r\\n  setFolderName: (name: string) => void;\\r\\n  folderTags: string[];\\r\\n  setFolderTags: (tags: string[]) => void;\\r\\n  onCreateFolder: () => void;\\r\\n  onCancel: () => void;\\r\\n}\\r\\n\\r\\nconst NewFolderForm: React.FC<NewFolderFormProps> = ({\\r\\n  folderName,\\r\\n  setFolderName,\\r\\n  folderTags,\\r\\n  setFolderTags,\\r\\n  onCreateFolder,\\r\\n  onCancel\\r\\n}) => {\\r\\n  const [newTag, setNewTag] = useState('');\\r\\n  const [nameError, setNameError] = useState<string | null>(null);\\r\\n  const inputRef = useRef<HTMLInputElement>(null);\\r\\n\\r\\n  // æ£€æŸ¥æ–‡ä»¶å¤¹åç§°æ˜¯å¦æœ‰æ•ˆ\\r\\n  useEffect(() => {\\r\\n    const trimmedName = folderName.trim();\\r\\n    \\r\\n    if (trimmedName === '') {\\r\\n      setNameError(null); // ç©ºåç§°ä¸æ˜¾ç¤ºé”™è¯¯ï¼Œä½†åˆ›å»ºæŒ‰é’®ä¼šå¤„ç†\\r\\n      return;\\r\\n    }\\r\\n\\r\\n    // æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦\\r\\n    const invalidChars = /[\\\\/\\\\\\\\:*?\\\"<>|]/;\\r\\n    if (invalidChars.test(trimmedName)) {\\r\\n      setNameError('æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å«ä¸‹åˆ—å­—ç¬¦: / \\\\\\\\ : * ? \\\" < > |');\\r\\n      return;\\r\\n    }\\r\\n\\r\\n    setNameError(null);\\r\\n  }, [folderName]);\\r\\n\\r\\n  // å¤„ç†å›è½¦é”®åˆ›å»ºæ–‡ä»¶å¤¹\\r\\n  const handleKeyDown = (e: React.KeyboardEvent) => {\\r\\n    if (e.key === 'Enter' && !nameError && folderName.trim()) {\\r\\n      onCreateFolder();\\r\\n    }\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    <div className={`${styles.newFolderRow} p-4 border border-gray-200 rounded-lg bg-white shadow-sm mb-4`}>\\r\\n      <div className={`${styles.newFolderForm} flex flex-col space-y-4`}>\\r\\n        <div className={`flex items-center`}>\\r\\n          <Folder className=\\\"w-6 h-6 text-blue-500 flex-shrink-0 mr-3\\\" />\\r\\n          <div className={`${styles.newFolderNameContainer} flex-grow relative`}>\\r\\n            <input\\r\\n              type=\\\"text\\\"\\r\\n              ref={inputRef}\\r\\n              className={`${styles.newFolderInput} h-10 px-3 rounded-md border ${nameError ? 'border-red-500' : 'border-gray-300'} w-full text-base`}\\r\\n              value={folderName}\\r\\n              onChange={(e) => setFolderName(e.target.value)}\\r\\n              placeholder=\\\"æ–°æ–‡ä»¶å¤¹åç§°\\\"\\r\\n              autoFocus\\r\\n              onKeyDown={handleKeyDown}\\r\\n            />\\r\\n            {nameError && (\\r\\n              <div className=\\\"text-red-500 text-xs mt-1 flex items-center\\\">\\r\\n                <AlertCircle className=\\\"w-3 h-3 mr-1\\\" />\\r\\n                <span>{nameError}</span>\\r\\n              </div>\\r\\n            )}\\r\\n            {!nameError && (\\r\\n              <div className=\\\"text-gray-500 text-xs mt-1\\\">\\r\\n                ç›¸åŒç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåæ–‡ä»¶å¤¹\\r\\n              </div>\\r\\n            )}\\r\\n          </div>\\r\\n        </div>\\r\\n        \\r\\n        <div className={`${styles.newFolderTagsContainer} ml-9`}>\\r\\n          <label className=\\\"block text-sm font-medium text-gray-700 mb-1\\\">æ·»åŠ æ ‡ç­¾</label>\\r\\n          <div className={`${styles.tagsWrapper} h-10 flex items-center flex-wrap gap-2 border border-gray-300 rounded-md px-3 py-1 overflow-y-auto`}>\\r\\n            {folderTags.map((tag, index) => (\\r\\n              <div key={index} className={`${styles.tagItem} h-7 flex items-center bg-blue-100 text-blue-800 px-2 rounded-md`}>\\r\\n                <span className=\\\"text-sm\\\">{tag}</span>\\r\\n                <button\\r\\n                  className={`${styles.removeTagButton} ml-1 text-blue-600 hover:text-blue-800 w-5 h-5 flex items-center justify-center rounded-full hover:bg-blue-200`}\\r\\n                  onClick={() => {\\r\\n                    const updatedTags = [...folderTags];\\r\\n                    updatedTags.splice(index, 1);\\r\\n                    setFolderTags(updatedTags);\\r\\n                  }}\\r\\n                >\\r\\n                  Ã—\\r\\n                </button>\\r\\n              </div>\\r\\n            ))}\\r\\n            <input\\r\\n              type=\\\"text\\\"\\r\\n              className={`${styles.tagInput} flex-grow h-7 border-0 outline-none text-sm bg-transparent`}\\r\\n              value={newTag}\\r\\n              onChange={(e) => setNewTag(e.target.value)}\\r\\n              onKeyDown={(e) => {\\r\\n                if (e.key === 'Enter' && newTag.trim()) {\\r\\n                  setFolderTags([...folderTags, newTag.trim()]);\\r\\n                  setNewTag('');\\r\\n                  e.preventDefault();\\r\\n                }\\r\\n              }}\\r\\n              placeholder=\\\"æ·»åŠ æ ‡ç­¾...\\\"\\r\\n            />\\r\\n          </div>\\r\\n        </div>\\r\\n        \\r\\n        <div className={`${styles.newFolderActions} flex items-center gap-3 ml-9`}>\\r\\n          <button \\r\\n            className={`${styles.confirmButton} h-10 px-4 ${nameError || !folderName.trim() ? 'bg-blue-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white rounded-md flex items-center justify-center`}\\r\\n            onClick={onCreateFolder}\\r\\n            disabled={!!nameError || !folderName.trim()}\\r\\n          >\\r\\n            åˆ›å»º\\r\\n          </button>\\r\\n          <button \\r\\n            className={`${styles.cancelButton} h-10 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-md flex items-center justify-center border border-gray-300`}\\r\\n            onClick={onCancel}\\r\\n          >\\r\\n            å–æ¶ˆ\\r\\n          </button>\\r\\n        </div>\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default NewFolderForm; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\RenameModal\\\\index.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileOperations/RenameModal ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useEffect, useRef } from 'react';\\nimport styles from '@/app/shared/themes/components/renameModal.module.css';\\nimport { CloseOutlined, TagOutlined, PlusOutlined } from '@ant-design/icons';\\n\\ninterface RenameModalProps {\\n  isOpen: boolean;\\n  onClose: () => void;\\n  onRename: (newName: string, tags?: string[]) => void;\\n  initialName: string;\\n  initialTags?: string[];\\n  fileType: 'file' | 'folder';\\n}\\n\\nconst RenameModal: React.FC<RenameModalProps> = ({\\n  isOpen,\\n  onClose,\\n  onRename,\\n  initialName,\\n  initialTags = [],\\n  fileType\\n}) => {\\n  const [newName, setNewName] = useState(initialName);\\n  const [tags, setTags] = useState<string[]>(initialTags);\\n  const [tagInput, setTagInput] = useState('');\\n  \\n  const inputRef = useRef<HTMLInputElement>(null);\\n  const tagInputRef = useRef<HTMLInputElement>(null);\\n  const modalRef = useRef<HTMLDivElement>(null);\\n\\n  useEffect(() => {\\n    setNewName(initialName);\\n    // ç¡®ä¿åˆå§‹æ ‡ç­¾ä¸åŒ…å«é‡å¤é¡¹\\n    setTags(Array.from(new Set(initialTags)));\\n  }, [initialName, initialTags]);\\n\\n  useEffect(() => {\\n    if (isOpen && inputRef.current) {\\n      // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†å¹¶é€‰ä¸­æ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰\\n      inputRef.current.focus();\\n      \\n      const extension = fileType === 'file' ? initialName.lastIndexOf('.') : -1;\\n      if (extension !== -1) {\\n        inputRef.current.setSelectionRange(0, extension);\\n      } else {\\n        inputRef.current.select();\\n      }\\n    }\\n  }, [isOpen, initialName, fileType]);\\n\\n  useEffect(() => {\\n    const handleClickOutside = (event: MouseEvent) => {\\n      if (modalRef.current && !modalRef.current.contains(event.target as Node)) {\\n        onClose();\\n      }\\n    };\\n\\n    if (isOpen) {\\n      document.addEventListener('mousedown', handleClickOutside);\\n    }\\n    \\n    return () => {\\n      document.removeEventListener('mousedown', handleClickOutside);\\n    };\\n  }, [isOpen, onClose]);\\n\\n  const handleSubmit = (e: React.FormEvent) => {\\n    e.preventDefault();\\n    // é¦–å…ˆç¡®ä¿æ–°åç§°æ˜¯æœ‰æ•ˆçš„éç©ºå­—ç¬¦ä¸²\\n    if (newName && typeof newName === 'string' && newName.trim() && \\n        (newName !== initialName || JSON.stringify(tags) !== JSON.stringify(initialTags))) {\\n      onRename(newName, tags);\\n    } else if (!newName || !newName.trim()) {\\n      // å¦‚æœåç§°ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä½†ä¸å…³é—­æ¨¡æ€æ¡†\\n      return;\\n    }\\n    onClose();\\n  };\\n\\n  const handleAddTag = () => {\\n    if (!tagInput.trim()) return;\\n    \\n    // é¿å…æ·»åŠ é‡å¤æ ‡ç­¾\\n    if (!tags.includes(tagInput.trim())) {\\n      setTags([...tags, tagInput.trim()]);\\n    }\\n    \\n    setTagInput('');\\n    \\n    // æ·»åŠ åè‡ªåŠ¨èšç„¦å›æ ‡ç­¾è¾“å…¥æ¡†\\n    setTimeout(() => {\\n      if (tagInputRef.current) {\\n        tagInputRef.current.focus();\\n      }\\n    }, 0);\\n  };\\n\\n  const handleRemoveTag = (tagToRemove: string) => {\\n    setTags(tags.filter(tag => tag !== tagToRemove));\\n  };\\n\\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\\n    if (e.key === 'Enter') {\\n      e.preventDefault();\\n      handleAddTag();\\n    }\\n  };\\n\\n  if (!isOpen) return null;\\n\\n  return (\\n    <div className={styles['modal-overlay']}>\\n      <div ref={modalRef} className={`${styles['modal-content']} ${styles['rename-modal']}`}>\\n        <div className={styles['modal-header']}>\\n          <h3 className={styles['modal-title']}>\\n            {fileType === 'folder' ? 'é‡å‘½åæ–‡ä»¶å¤¹' : 'é‡å‘½åæ–‡ä»¶'}\\n          </h3>\\n          <button \\n            className={styles['modal-close']} \\n            onClick={onClose}\\n            aria-label=\\\"å…³é—­\\\"\\n          >\\n            <CloseOutlined />\\n          </button>\\n        </div>\\n        \\n        <form className={styles['rename-form']} onSubmit={handleSubmit}>\\n          <div className={styles['form-group']}>\\n            <label className={styles['form-label']}>åç§°</label>\\n            <input\\n              ref={inputRef}\\n              type=\\\"text\\\"\\n              className={styles['rename-input']}\\n              value={newName}\\n              onChange={(e) => setNewName(e.target.value)}\\n              placeholder=\\\"è¾“å…¥æ–°åç§°\\\"\\n              autoFocus\\n            />\\n          </div>\\n          \\n          <div className={styles['form-group']}>\\n            <label className={styles['form-label']}>æ ‡ç­¾</label>\\n            <div className={styles['tags-container']}>\\n              {tags.map((tag, index) => (\\n                <div key={index} className={styles['tag']}>\\n                  <span>{tag}</span>\\n                  <button \\n                    type=\\\"button\\\"\\n                    className={styles['tag-remove']}\\n                    onClick={() => handleRemoveTag(tag)}\\n                  >\\n                    &times;\\n                  </button>\\n                </div>\\n              ))}\\n            </div>\\n            <div className={styles['tag-input-container']}>\\n              <TagOutlined className={styles['tag-icon']} />\\n              <input\\n                ref={tagInputRef}\\n                type=\\\"text\\\"\\n                className={styles['tag-input']}\\n                value={tagInput}\\n                onChange={(e) => setTagInput(e.target.value)}\\n                onKeyDown={handleTagInputKeyDown}\\n                placeholder=\\\"è¾“å…¥æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ \\\"\\n              />\\n              <button\\n                type=\\\"button\\\"\\n                className={styles['tag-add-button']}\\n                onClick={handleAddTag}\\n                disabled={!tagInput.trim()}\\n              >\\n                <PlusOutlined />\\n              </button>\\n            </div>\\n          </div>\\n\\n          <div className={styles['modal-footer']}>\\n            <button \\n              type=\\\"button\\\" \\n              className={`${styles['modal-button']} ${styles.cancel}`}\\n              onClick={onClose}\\n            >\\n              å–æ¶ˆ\\n            </button>\\n            <button \\n              type=\\\"submit\\\" \\n              className={`${styles['modal-button']} ${styles.confirm}`}\\n              disabled={!newName.trim() || (newName === initialName && JSON.stringify(tags) === JSON.stringify(initialTags))}\\n            >\\n              ç¡®è®¤\\n            </button>\\n          </div>\\n        </form>\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport default RenameModal; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\Breadcrumb.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Breadcrumb ç»„ä»¶ã€‚\\n */\\n\\nimport React from 'react';\\nimport { Home, ChevronRight, ChevronLeft } from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\nimport { FolderPathItem } from '@/app/types';\\n\\ninterface BreadcrumbProps {\\n  folderPath: FolderPathItem[];\\n  showHome?: boolean;\\n  onNavigate?: (folderId: string | null) => void;\\n  onPathClick: (folderId: string | null) => void;\\n  onBackClick?: () => void;\\n}\\n\\nexport function Breadcrumb({ \\n  folderPath, \\n  showHome = true, \\n  onNavigate, \\n  onPathClick,\\n  onBackClick\\n}: BreadcrumbProps) {\\n  // å‘ä¸‹å…¼å®¹ï¼šå¦‚æœæœ‰onNavigateä½†æ²¡æœ‰onPathClickï¼Œå°±ä½¿ç”¨onNavigate\\n  const handlePathClick = onPathClick || onNavigate;\\n\\n  if (!handlePathClick) {\\n    console.error('Breadcrumbç»„ä»¶ç¼ºå°‘å¿…è¦çš„onPathClickæˆ–onNavigateå›è°ƒå‡½æ•°');\\n    return null;\\n  }\\n\\n  return (\\n    <div className={styles.breadcrumb}>\\n      {onBackClick && folderPath.length > 0 && (\\n        <button \\n          className={styles.breadcrumbBackButton}\\n          onClick={onBackClick}\\n          title=\\\"è¿”å›ä¸Šä¸€çº§\\\"\\n        >\\n          <ChevronLeft size={16} />\\n        </button>\\n      )}\\n      \\n      {showHome && (\\n        <div className={styles.breadcrumbItem}>\\n          <button\\n            className={styles.breadcrumbLink}\\n            onClick={() => handlePathClick(null)}\\n          >\\n            <Home size={16} className={styles.breadcrumbIcon} />\\n            æ ¹ç›®å½•\\n          </button>\\n        </div>\\n      )}\\n      \\n      {folderPath.map((folder) => (\\n        <React.Fragment key={folder.id}>\\n          <span className={styles.breadcrumbSeparator}>\\n            <ChevronRight size={14} />\\n          </span>\\n          <div className={styles.breadcrumbItem}>\\n            <button\\n              className={styles.breadcrumbLink}\\n              onClick={() => handlePathClick(folder.id)}\\n            >\\n              {folder.name}\\n            </button>\\n          </div>\\n        </React.Fragment>\\n      ))}\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\ErrorDisplay.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/ErrorDisplay ç»„ä»¶ã€‚\\n */\\n\\n'use client';\\n\\nimport React from 'react';\\nimport { AlertTriangle, RefreshCw, Wifi, Server, CloudOff } from 'lucide-react';\\nimport styles from '../../../../file-management/styles/shared.module.css';\\n\\ninterface ErrorDisplayProps {\\n  title?: string;\\n  message?: string;\\n  errorType?: 'network' | 'auth' | 'server' | 'data' | 'timeout' | 'unknown';\\n  onRetry?: () => void;\\n  retryText?: string;\\n}\\n\\n/**\\n * æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼Œæ”¯æŒä¸åŒç±»å‹çš„é”™è¯¯\\n */\\nexport const ErrorDisplay: React.FC<ErrorDisplayProps> = ({\\n  title,\\n  message = 'è¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜',\\n  errorType = 'unknown',\\n  onRetry,\\n  retryText = 'é‡è¯•'\\n}) => {\\n  // æ ¹æ®é”™è¯¯ç±»å‹è·å–å›¾æ ‡å’Œæ ‡é¢˜\\n  const getErrorInfo = () => {\\n    switch (errorType) {\\n      case 'network':\\n        return {\\n          icon: <Wifi className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'ç½‘ç»œè¿æ¥é”™è¯¯'\\n        };\\n      case 'auth':\\n        return {\\n          icon: <AlertTriangle className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'èº«ä»½éªŒè¯å¤±è´¥'\\n        };\\n      case 'server':\\n        return {\\n          icon: <Server className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'æœåŠ¡å™¨é”™è¯¯'\\n        };\\n      case 'data':\\n        return {\\n          icon: <CloudOff className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'æ•°æ®åŠ è½½å¤±è´¥'\\n        };\\n      case 'timeout':\\n        return {\\n          icon: <AlertTriangle className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'è¯·æ±‚è¶…æ—¶'\\n        };\\n      default:\\n        return {\\n          icon: <AlertTriangle className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'åŠ è½½å‡ºé”™'\\n        };\\n    }\\n  };\\n\\n  const { icon, defaultTitle } = getErrorInfo();\\n  const displayTitle = title || defaultTitle;\\n\\n  return (\\n    <div className={styles.errorContainer}>\\n      <div className={styles.errorCard}>\\n        <div className={styles.errorIcon}>\\n          {icon}\\n        </div>\\n        <h3 className={styles.errorTitle}>{displayTitle}</h3>\\n        <p className={styles.errorText}>{message}</p>\\n        {onRetry && (\\n          <button \\n            className={styles.retryButton}\\n            onClick={onRetry}\\n          >\\n            <RefreshCw className=\\\"w-4 h-4\\\" />\\n            {retryText}\\n          </button>\\n        )}\\n      </div>\\n    </div>\\n  );\\n}; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\FileList.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileList/FileList ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useRef, useEffect } from 'react';\\nimport { \\n  File as FileIcon, \\n  Folder, \\n  Image as ImageIcon, \\n  FileText, \\n  Video, \\n  Music, \\n  MoreVertical,\\n  Tag as TagIcon,\\n  SearchX,\\n  Filter,\\n  Check,\\n  X,\\n  Plus\\n} from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\nimport { getFileType as getFileTypeDisplay } from '@/app/utils/file/type';\\nimport { getFileNameAndExtension } from '@/app/utils/file/path';\\nimport { FileInfo } from '@/app/types';\\n\\ninterface FileListProps {\\n  files: FileInfo[];\\n  selectedFiles: string[];\\n  onFileClick: (file: FileInfo) => void;\\n  onFileDoubleClick?: (file: FileInfo) => void;\\n  onFileContextMenu?: (event: React.MouseEvent, file: FileInfo) => void;\\n  onSelectFiles?: (fileIds: string[]) => void;\\n  onFileSelect?: (file: FileInfo, checked: boolean) => void;\\n  onSelectAll?: () => void;\\n  onDeselectAll?: () => void;\\n  onSelectAllFiles?: () => void;\\n  onDeselectAllFiles?: () => void;\\n  fileTypeFilter?: string | null;\\n  isLoading?: boolean;\\n  error?: string | null;\\n  onBackClick?: () => void;\\n  editingFileId?: string | null;\\n  editingFile?: string | null;\\n  editingName?: string;\\n  editingTags?: string[];\\n  newTag?: string;\\n  onNewTagChange?: (value: string) => void;\\n  onEditNameChange?: (value: string) => void;\\n  onStartEdit?: (file: FileInfo) => void;\\n  onConfirmEdit?: (fileId: string, newName: string, newTags: string[]) => void;\\n  onCancelEdit?: () => void;\\n  onAddTag?: (tag: string) => void;\\n  onRemoveTag?: (tag: string) => void;\\n  showCheckboxes?: boolean;\\n  areAllSelected?: boolean;\\n}\\n\\nexport function FileList({\\n  files,\\n  selectedFiles,\\n  onFileClick,\\n  onFileDoubleClick,\\n  onFileContextMenu,\\n  onSelectFiles,\\n  onFileSelect,\\n  onSelectAll,\\n  onDeselectAll,\\n  onSelectAllFiles,\\n  onDeselectAllFiles,\\n  fileTypeFilter,\\n  isLoading,\\n  error,\\n  onBackClick,\\n  editingFileId,\\n  editingFile,\\n  editingName: providedEditingName,\\n  editingTags: providedEditingTags,\\n  newTag: providedNewTag,\\n  onNewTagChange,\\n  onEditNameChange,\\n  onStartEdit,\\n  onConfirmEdit,\\n  onCancelEdit,\\n  onAddTag,\\n  onRemoveTag,\\n  showCheckboxes = true,\\n  areAllSelected\\n}: FileListProps) {\\n  const actualEditingFileId = editingFileId || editingFile;\\n\\n  const [localEditName, setLocalEditName] = useState<string>('');\\n  const [localEditTags, setLocalEditTags] = useState<string[]>([]);\\n  const [localNewTag, setLocalNewTag] = useState<string>('');\\n  \\n  const editName = providedEditingName !== undefined ? providedEditingName : localEditName;\\n  const editTags = providedEditingTags !== undefined ? providedEditingTags : localEditTags;\\n  const newTagValue = providedNewTag !== undefined ? providedNewTag : localNewTag;\\n  \\n  const setEditName = (value: string) => {\\n    if (onEditNameChange) {\\n      onEditNameChange(value);\\n    } else {\\n      setLocalEditName(value);\\n    }\\n  };\\n  \\n  const setEditTags = (tags: string[]) => {\\n    setLocalEditTags(tags);\\n  };\\n  \\n  const setNewTag = (value: string) => {\\n    if (onNewTagChange) {\\n      onNewTagChange(value);\\n    } else {\\n      setLocalNewTag(value);\\n    }\\n  };\\n\\n  const editNameInputRef = useRef<HTMLInputElement>(null);\\n  const newTagInputRef = useRef<HTMLInputElement>(null);\\n\\n  useEffect(() => {\\n    if (actualEditingFileId && providedEditingName === undefined) {\\n      const file = files.find(f => f.id === actualEditingFileId);\\n      if (file) {\\n        setLocalEditName(file.name);\\n        setLocalEditTags(file.tags || []);\\n      }\\n    }\\n    \\n    if (actualEditingFileId) {\\n      setTimeout(() => {\\n        if (editNameInputRef.current) {\\n          editNameInputRef.current.focus();\\n          editNameInputRef.current.select();\\n        }\\n      }, 0);\\n    }\\n  }, [actualEditingFileId, files, providedEditingName]);\\n\\n  const handleEditKeyDown = (e: React.KeyboardEvent, fileId: string) => {\\n    if (e.key === 'Enter') {\\n      e.preventDefault();\\n      onConfirmEdit && onConfirmEdit(fileId, editName, editTags);\\n    } else if (e.key === 'Escape') {\\n      e.preventDefault();\\n      onCancelEdit && onCancelEdit();\\n    }\\n  };\\n\\n  const handleAddTag = () => {\\n    const trimmedTag = newTagValue.trim();\\n    if (!trimmedTag) return;\\n    \\n    if (!editTags.includes(trimmedTag)) {\\n      if (onAddTag) {\\n        onAddTag(trimmedTag);\\n      } else {\\n        setEditTags([...editTags, trimmedTag]);\\n      }\\n      setNewTag('');\\n      \\n      setTimeout(() => {\\n        if (newTagInputRef.current) {\\n          newTagInputRef.current.focus();\\n        }\\n      }, 0);\\n    }\\n  };\\n\\n  const handleRemoveTag = (tagToRemove: string) => {\\n    if (onRemoveTag) {\\n      onRemoveTag(tagToRemove);\\n    } else {\\n      setEditTags(editTags.filter(tag => tag !== tagToRemove));\\n    }\\n  };\\n\\n  const handleTagKeyDown = (e: React.KeyboardEvent) => {\\n    if (e.key === 'Enter') {\\n      e.preventDefault();\\n      handleAddTag();\\n    }\\n  };\\n\\n  const handleFileCheckboxChange = (file: FileInfo, checked: boolean) => {\\n    if (onFileSelect) {\\n      onFileSelect(file, checked);\\n      return;\\n    }\\n    \\n    if (onSelectFiles) {\\n      if (checked) {\\n        onSelectFiles([...selectedFiles, file.id]);\\n      } else {\\n        onSelectFiles(selectedFiles.filter(id => id !== file.id));\\n      }\\n    } else {\\n      console.error('FileList: ç¼ºå°‘å¿…è¦çš„onSelectFilesæˆ–onFileSelectå›è°ƒå‡½æ•°');\\n    }\\n  };\\n\\n  const handleSelectAll = onSelectAll || onSelectAllFiles;\\n  const handleDeselectAll = onDeselectAll || onDeselectAllFiles;\\n\\n  const renderFileIcon = (type?: string, extension?: string, isFolder?: boolean) => {\\n    if (isFolder) return <Folder className={styles.fileIcon} />;\\n    \\n    const getFileIconType = () => {\\n      if (!type) return 'file';\\n      \\n      if (type.includes('image')) return 'image';\\n      if (type.includes('text') || type.includes('document') || extension?.match(/docx?|pdf|txt|md/i)) return 'file-text';\\n      if (type.includes('video')) return 'video';\\n      if (type.includes('audio')) return 'music';\\n      if (extension?.match(/zip|rar|7z|tar|gz/i)) return 'archive';\\n      if (extension?.match(/js|ts|jsx|tsx|py|java|c|cpp|go|rb|php|html|css/i)) return 'code';\\n      \\n      return 'file';\\n    };\\n    \\n    const iconType = getFileIconType();\\n    const IconComponent = {\\n      'folder': Folder,\\n      'file': FileIcon,\\n      'image': ImageIcon,\\n      'file-text': FileText,\\n      'video': Video,\\n      'music': Music,\\n      'archive': FileIcon,\\n      'code': FileIcon\\n    }[iconType] || FileIcon;\\n\\n    return <IconComponent className={styles.fileIcon} />;\\n  };\\n\\n  const renderTags = (file: FileInfo) => {\\n    const tags = file.tags || [];\\n    \\n    if (actualEditingFileId === file.id) {\\n      return (\\n        <div className={styles.tagEditContainer}>\\n          <div className={styles.editTagsList}>\\n            {editTags.map((tag, index) => (\\n              <div key={index} className={styles.editTag}>\\n                <span>{tag}</span>\\n                <button \\n                  className={styles.removeTagButton}\\n                  onClick={() => handleRemoveTag(tag)}\\n                >\\n                  <X size={12} />\\n                </button>\\n              </div>\\n            ))}\\n          </div>\\n          <div className={styles.addTagInput}>\\n            <input\\n              ref={newTagInputRef}\\n              type=\\\"text\\\"\\n              placeholder=\\\"æ·»åŠ æ ‡ç­¾...\\\"\\n              value={localNewTag}\\n              onChange={(e) => setNewTag(e.target.value)}\\n              onKeyDown={handleTagKeyDown}\\n              className={styles.tagInput}\\n            />\\n            <button \\n              className={styles.addTagButton}\\n              onClick={handleAddTag}\\n            >\\n              <Plus size={14} />\\n            </button>\\n          </div>\\n        </div>\\n      );\\n    }\\n    \\n    if (!tags || tags.length === 0) return <span className={styles.emptyText}>-</span>;\\n    \\n    const maxTagsToShow = 3;\\n    const visibleTags = tags.slice(0, maxTagsToShow);\\n    const extraTagsCount = tags.length - maxTagsToShow;\\n    \\n    return (\\n      <div className={styles.tagContainer}>\\n        {visibleTags.map((tag, index) => (\\n          <span key={index} className={styles.tag}>\\n            {tag}\\n          </span>\\n        ))}\\n        {extraTagsCount > 0 && (\\n          <span className={styles.extraTagsCount}>+{extraTagsCount}</span>\\n        )}\\n      </div>\\n    );\\n  };\\n\\n  const isAllSelected = areAllSelected !== undefined \\n    ? areAllSelected \\n    : (files.length > 0 && selectedFiles.length === files.length);\\n\\n  if (!Array.isArray(files) || files.length === 0) {\\n    const getEmptyStateMessage = () => {\\n      if (fileTypeFilter) {\\n        switch(fileTypeFilter) {\\n          case 'image':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶`;\\n          case 'document':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡æ¡£æ–‡ä»¶`;\\n          case 'video':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°è§†é¢‘æ–‡ä»¶`;\\n          case 'audio':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶`;\\n          case 'other':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å…¶ä»–ç±»å‹çš„æ–‡ä»¶`;\\n          default:\\n            return `æ²¡æœ‰æ‰¾åˆ°${fileTypeFilter}ç±»å‹çš„æ–‡ä»¶`;\\n        }\\n      }\\n      return 'æ²¡æœ‰æ–‡ä»¶';\\n    };\\n\\n    const getEmptyStateIcon = () => {\\n      if (fileTypeFilter) {\\n        return <Filter size={50} stroke=\\\"#CBD5E0\\\" />;\\n      }\\n      return <FileIcon size={50} stroke=\\\"#CBD5E0\\\" />;\\n    };\\n\\n    const getEmptyStateHint = () => {\\n      if (fileTypeFilter) {\\n        return `ç³»ç»Ÿå·²æœç´¢æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œæœªæ‰¾åˆ°${\\n          fileTypeFilter === 'image' ? 'å›¾ç‰‡' : \\n          fileTypeFilter === 'document' ? 'æ–‡æ¡£' : \\n          fileTypeFilter === 'video' ? 'è§†é¢‘' :\\n          fileTypeFilter === 'audio' ? 'éŸ³é¢‘' : 'è¯¥ç±»å‹'\\n        }æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä¸Šä¼ ä¸€äº›ï¼Œæˆ–é€‰æ‹©å…¶ä»–æ–‡ä»¶ç±»å‹æŸ¥çœ‹ã€‚`;\\n      }\\n      return 'ä¸Šä¼ æ–‡ä»¶æˆ–åˆ›å»ºæ–‡ä»¶å¤¹ä»¥å¼€å§‹ç®¡ç†æ‚¨çš„æ–‡ä»¶';\\n    };\\n\\n    return (\\n      <div className={styles.emptyState}>\\n        {getEmptyStateIcon()}\\n        <p className={styles.emptyStateText}>{getEmptyStateMessage()}</p>\\n        <p className={styles.emptyStateHint}>\\n          {getEmptyStateHint()}\\n        </p>\\n      </div>\\n    );\\n  }\\n\\n  return (\\n    <div className={styles.fileListWrapper}>\\n      <div className={styles.fileListContainer}>\\n        <table className={styles.fileTable}>\\n          <thead>\\n            <tr>\\n              <th>\\n                <input\\n                  type=\\\"checkbox\\\"\\n                  checked={isAllSelected}\\n                  onChange={isAllSelected ? \\n                    () => handleDeselectAll && handleDeselectAll() : \\n                    () => handleSelectAll && handleSelectAll()}\\n                  disabled={!showCheckboxes}\\n                />\\n              </th>\\n              <th>åç§°</th>\\n              <th>ç±»å‹</th>\\n              <th>å¤§å°</th>\\n              <th>æ ‡ç­¾</th>\\n              <th>ä¿®æ”¹æ—¥æœŸ</th>\\n              <th>æ“ä½œ</th>\\n            </tr>\\n          </thead>\\n          <tbody>\\n            {files.map((file) => {\\n              const isSelected = selectedFiles.includes(file.id);\\n              const isEditing = actualEditingFileId === file.id;\\n              \\n              return (\\n                <tr\\n                  key={file.id}\\n                  className={`${styles.fileRow} ${isSelected ? styles.selectedRow : ''} ${isEditing ? styles.editingRow : ''}`}\\n                  onClick={() => !isEditing && onFileClick(file)}\\n                  onDoubleClick={() => {\\n                    if (!isEditing && onStartEdit && !file.isFolder) {\\n                      onStartEdit(file);\\n                    } else if (!isEditing && onFileDoubleClick) {\\n                      onFileDoubleClick(file);\\n                    }\\n                  }}\\n                  onContextMenu={(e) => !isEditing && onFileContextMenu && onFileContextMenu(e, file)}\\n                >\\n                  <td>\\n                    {showCheckboxes && (\\n                      <input\\n                        type=\\\"checkbox\\\"\\n                        checked={isSelected}\\n                        onChange={(e) => handleFileCheckboxChange(file, e.target.checked)}\\n                        onClick={(e) => e.stopPropagation()}\\n                        disabled={isEditing}\\n                      />\\n                    )}\\n                  </td>\\n                  <td className={styles.fileNameCell}>\\n                    <span className={styles.fileIcon}>\\n                      {renderFileIcon(file.type, file.extension, file.isFolder)}\\n                    </span>\\n                    {isEditing ? (\\n                      <input\\n                        ref={editNameInputRef}\\n                        type=\\\"text\\\"\\n                        className={styles.fileNameInput}\\n                        value={editName}\\n                        onChange={(e) => setEditName(e.target.value)}\\n                        onKeyDown={(e) => handleEditKeyDown(e, file.id)}\\n                        onClick={(e) => e.stopPropagation()}\\n                        autoComplete=\\\"off\\\"\\n                      />\\n                    ) : (\\n                      <span className={styles.fileName}>{file.name}</span>\\n                    )}\\n                    {isEditing && (\\n                      <div className={styles.editActions}>\\n                        <button \\n                          className={styles.editActionButton}\\n                          onClick={(e) => {\\n                            e.stopPropagation();\\n                            onConfirmEdit && onConfirmEdit(file.id, editName, editTags);\\n                          }}\\n                        >\\n                          <Check size={16} />\\n                        </button>\\n                        <button \\n                          className={styles.editActionButton}\\n                          onClick={(e) => {\\n                            e.stopPropagation();\\n                            onCancelEdit && onCancelEdit();\\n                          }}\\n                        >\\n                          <X size={16} />\\n                        </button>\\n                      </div>\\n                    )}\\n                  </td>\\n                  <td>{file.isFolder ? 'æ–‡ä»¶å¤¹' : \\n                     file.type === 'document' ? 'æ–‡æ¡£' : \\n                     getFileTypeDisplay(file.type || null, file.extension)}</td>\\n                  <td>{file.size ? `${Math.round(file.size / 1024)} KB` : '-'}</td>\\n                  <td className={styles.tagsCell}>{renderTags(file)}</td>\\n                  <td>\\n                    {file.createdAt \\n                      ? new Date(file.createdAt).toLocaleString() \\n                      : '-'\\n                    }\\n                  </td>\\n                  <td>\\n                    {!isEditing ? (\\n                      <button \\n                        className={styles.actionButton}\\n                        onClick={(e) => {\\n                          e.stopPropagation();\\n                          if (onStartEdit) {\\n                            onStartEdit(file);\\n                          } else if (onFileContextMenu) {\\n                            onFileContextMenu(e, file);\\n                          }\\n                        }}\\n                      >\\n                        <MoreVertical size={16} />\\n                      </button>\\n                    ) : (\\n                      <span className={styles.editingMessage}>ç¼–è¾‘ä¸­</span>\\n                    )}\\n                  </td>\\n                </tr>\\n              );\\n            })}\\n          </tbody>\\n        </table>\\n      </div>\\n    </div>\\n  );\\n}\"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\index.ts\",\n    \"newContent\": \"export * from './Sidebar';\\nexport * from './Breadcrumb';\\nexport * from './FileList';\\n// export * from './UploadModal'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadModal\\n// export * from './UploadButton'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadButton\\nexport * from './Skeleton';\\nexport * from './ErrorDisplay'; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\Sidebar.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Sidebar ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useEffect } from 'react';\\nimport { \\n  Folder, Files, Image as ImageIcon, FileText, \\n  Video, Music, File, Search, ChevronDown, \\n  Star, Clock, Tag, Download, Settings,\\n  CheckCircle\\n} from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\n\\nexport type FileType = 'image' | 'document' | 'video' | 'audio' | 'other' | null;\\n\\ninterface SidebarProps {\\n  selectedFileType: FileType;\\n  onTypeClick: (type: FileType) => void;\\n  onSearchClick?: () => void;\\n}\\n\\nexport function Sidebar({ selectedFileType, onTypeClick, onSearchClick }: SidebarProps) {\\n  const fileTypes: { type: FileType; label: string; icon: React.ElementType }[] = [\\n    { type: null, label: 'å…¨éƒ¨æ–‡ä»¶', icon: Files },\\n    { type: 'image', label: 'å›¾ç‰‡', icon: ImageIcon },\\n    { type: 'document', label: 'æ–‡æ¡£', icon: FileText },\\n    { type: 'video', label: 'è§†é¢‘', icon: Video },\\n    { type: 'audio', label: 'éŸ³é¢‘', icon: Music },\\n    { type: 'other', label: 'å…¶ä»–', icon: File }\\n  ];\\n\\n  const [quickAccessExpanded, setQuickAccessExpanded] = React.useState(true);\\n  const [myFilesExpanded, setMyFilesExpanded] = React.useState(true);\\n  const [settingsExpanded, setSettingsExpanded] = React.useState(false);\\n\\n  // ç›‘å¬æ–‡ä»¶ç±»å‹å˜åŒ–å¹¶è®°å½•æ—¥å¿—\\n  useEffect(() => {\\n    console.log('ä¾§è¾¹æ ï¼šå½“å‰é€‰æ‹©çš„æ–‡ä»¶ç±»å‹:', selectedFileType);\\n  }, [selectedFileType]);\\n\\n  const handleTypeClick = (type: FileType) => {\\n    // ç›´æ¥è°ƒç”¨å›è°ƒï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–é€»è¾‘\\n    console.log('Sidebarç›´æ¥ç‚¹å‡»ç±»å‹:', type);\\n    onTypeClick(type);\\n  };\\n\\n  return (\\n    <div className={styles.sidebar}>\\n      <div className={styles.sidebarSection}>\\n        <div \\n          className={styles.sidebarHeader} \\n          onClick={() => setMyFilesExpanded(!myFilesExpanded)}\\n        >\\n          <Folder className={styles.icon} />\\n          æˆ‘çš„æ–‡ä»¶\\n          <ChevronDown \\n            className={styles.icon} \\n            style={{ \\n              marginLeft: 'auto', \\n              transform: myFilesExpanded ? 'rotate(180deg)' : 'rotate(0)', \\n              transition: 'transform 0.3s' \\n            }} \\n            size={16} \\n          />\\n        </div>\\n        {myFilesExpanded && (\\n          <div className={styles.sidebarSubmenu}>\\n            {fileTypes.map(({ type, label, icon: Icon }) => (\\n              <div\\n                key={type || 'all'}\\n                className={`${styles.sidebarItem} ${selectedFileType === type ? styles.active : ''}`}\\n                onClick={() => handleTypeClick(type)}\\n              >\\n                <Icon className={styles.icon} />\\n                {label}\\n                {selectedFileType === type && (\\n                  <CheckCircle \\n                    className={styles.icon} \\n                    style={{ \\n                      marginLeft: 'auto', \\n                      color: 'var(--theme-primary, #3b82f6)',\\n                      fill: 'var(--theme-primary, #3b82f6)',\\n                      stroke: '#fff',\\n                      opacity: 0.9,\\n                    }} \\n                    size={16} \\n                  />\\n                )}\\n              </div>\\n            ))}\\n          </div>\\n        )}\\n      </div>\\n\\n      <div className={styles.sidebarSection}>\\n        <div \\n          className={styles.sidebarHeader}\\n          onClick={() => setQuickAccessExpanded(!quickAccessExpanded)}\\n        >\\n          <Search className={styles.icon} />\\n          å¿«æ·æŸ¥è¯¢\\n          <ChevronDown \\n            className={styles.icon} \\n            style={{ \\n              marginLeft: 'auto', \\n              transform: quickAccessExpanded ? 'rotate(180deg)' : 'rotate(0)', \\n              transition: 'transform 0.3s' \\n            }} \\n            size={16} \\n          />\\n        </div>\\n        {quickAccessExpanded && (\\n          <div className={styles.sidebarSubmenu}>\\n            <div \\n              className={styles.sidebarItem}\\n              onClick={onSearchClick}\\n            >\\n              <Search className={styles.icon} />\\n              æœç´¢æ–‡ä»¶\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Star className={styles.icon} />\\n              æ”¶è—æ–‡ä»¶\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Clock className={styles.icon} />\\n              æœ€è¿‘è®¿é—®\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Tag className={styles.icon} />\\n              æŒ‰æ ‡ç­¾æŸ¥æ‰¾\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Download className={styles.icon} />\\n              ä¸‹è½½è®°å½•\\n            </div>\\n          </div>\\n        )}\\n      </div>\\n\\n      <div className={styles.sidebarSection}>\\n        <div \\n          className={styles.sidebarHeader}\\n          onClick={() => setSettingsExpanded(!settingsExpanded)}\\n        >\\n          <Settings className={styles.icon} />\\n          ç³»ç»Ÿè®¾ç½®\\n          <ChevronDown \\n            className={styles.icon} \\n            style={{ \\n              marginLeft: 'auto', \\n              transform: settingsExpanded ? 'rotate(180deg)' : 'rotate(0)', \\n              transition: 'transform 0.3s' \\n            }} \\n            size={16} \\n          />\\n        </div>\\n        {settingsExpanded && (\\n          <div className={styles.sidebarSubmenu}>\\n            <div className={styles.sidebarItem}>\\n              <Settings className={styles.icon} />\\n              å­˜å‚¨ç®¡ç†\\n            </div>\\n          </div>\\n        )}\\n      </div>\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\Skeleton.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/Skeleton ç»„ä»¶ã€‚\\n */\\n\\n'use client';\\n\\nimport React from 'react';\\nimport styles from './Skeleton.module.css';\\n\\ninterface SkeletonProps {\\n  variant?: 'sidebar' | 'file' | 'avatar' | 'text' | 'button' | 'card';\\n  width?: string | number;\\n  height?: string | number;\\n  animation?: 'pulse' | 'wave' | 'none';\\n  count?: number;\\n  className?: string;\\n  borderRadius?: string;\\n}\\n\\nexport const Skeleton: React.FC<SkeletonProps> = ({ \\n  variant = 'text', \\n  width, \\n  height, \\n  animation = 'pulse',\\n  count = 1,\\n  className = '',\\n  borderRadius\\n}) => {\\n  const getVariantStyles = () => {\\n    switch (variant) {\\n      case 'sidebar':\\n        return {\\n          width: width || '100%',\\n          height: height || '40px',\\n          borderRadius: borderRadius || '8px'\\n        };\\n      case 'file':\\n        return {\\n          width: width || '100%',\\n          height: height || '56px',\\n          borderRadius: borderRadius || '8px'\\n        };\\n      case 'avatar':\\n        return {\\n          width: width || '40px',\\n          height: height || '40px',\\n          borderRadius: borderRadius || '50%'\\n        };\\n      case 'text':\\n        return {\\n          width: width || '100%',\\n          height: height || '16px',\\n          borderRadius: borderRadius || '4px'\\n        };\\n      case 'button':\\n        return {\\n          width: width || '120px',\\n          height: height || '36px',\\n          borderRadius: borderRadius || '6px'\\n        };\\n      case 'card':\\n        return {\\n          width: width || '100%',\\n          height: height || '200px',\\n          borderRadius: borderRadius || '12px'\\n        };\\n      default:\\n        return {\\n          width: width || '100%',\\n          height: height || '16px',\\n          borderRadius: borderRadius || '4px'\\n        };\\n    }\\n  };\\n\\n  const renderSkeleton = () => {\\n    const items = [];\\n    const baseStyles = getVariantStyles();\\n    \\n    for (let i = 0; i < count; i++) {\\n      items.push(\\n        <div \\n          key={i}\\n          className={`${styles.skeleton} ${styles[`animation-${animation}`]} ${className}`}\\n          style={{\\n            ...baseStyles,\\n            marginBottom: count > 1 && i < count - 1 ? '8px' : '0'\\n          }}\\n        />\\n      );\\n    }\\n    \\n    return items;\\n  };\\n\\n  return <>{renderSkeleton()}</>;\\n};\\n\\nexport const SkeletonFileList: React.FC = () => {\\n  return (\\n    <div className={styles.fileListSkeleton}>\\n      <div className={styles.fileListHeader}>\\n        <Skeleton variant=\\\"text\\\" width=\\\"15%\\\" height=\\\"24px\\\" />\\n        <div className={styles.headerActions}>\\n          <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n          <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n        </div>\\n      </div>\\n      \\n      <div className={styles.fileItems}>\\n        {[...Array(8)].map((_, index) => (\\n          <div key={index} className={styles.fileItemSkeleton}>\\n            <div className={styles.fileIcon}>\\n              <Skeleton variant=\\\"avatar\\\" width=\\\"32px\\\" height=\\\"32px\\\" borderRadius=\\\"6px\\\" />\\n            </div>\\n            <div className={styles.fileDetails}>\\n              <Skeleton variant=\\\"text\\\" width=\\\"60%\\\" height=\\\"18px\\\" />\\n              <Skeleton variant=\\\"text\\\" width=\\\"40%\\\" height=\\\"14px\\\" />\\n            </div>\\n            <div className={styles.fileActions}>\\n              <Skeleton variant=\\\"button\\\" width=\\\"70px\\\" />\\n            </div>\\n          </div>\\n        ))}\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport const SkeletonSidebar: React.FC = () => {\\n  return (\\n    <div className={styles.sidebarSkeleton}>\\n      <div className={styles.sidebarHeader}>\\n        <Skeleton variant=\\\"text\\\" width=\\\"70%\\\" height=\\\"24px\\\" />\\n      </div>\\n      <div className={styles.sidebarContent}>\\n        <Skeleton variant=\\\"sidebar\\\" count={5} />\\n        <div className={styles.sidebarSection}>\\n          <Skeleton variant=\\\"text\\\" width=\\\"50%\\\" height=\\\"18px\\\" />\\n          <Skeleton variant=\\\"sidebar\\\" count={3} />\\n        </div>\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport const SkeletonPageLayout: React.FC = () => {\\n  return (\\n    <div className={styles.pageLayoutSkeleton}>\\n      <div className={styles.miniSidebarSkeleton}>\\n        <Skeleton variant=\\\"avatar\\\" width=\\\"40px\\\" height=\\\"40px\\\" />\\n        <Skeleton variant=\\\"button\\\" width=\\\"40px\\\" height=\\\"40px\\\" borderRadius=\\\"12px\\\" />\\n        <Skeleton variant=\\\"button\\\" width=\\\"40px\\\" height=\\\"40px\\\" borderRadius=\\\"12px\\\" />\\n      </div>\\n      \\n      <div className={styles.sidebarContainerSkeleton}>\\n        <SkeletonSidebar />\\n      </div>\\n      \\n      <div className={styles.mainContentSkeleton}>\\n        <div className={styles.topBarSkeleton}>\\n          <div className={styles.breadcrumbSkeleton}>\\n            <Skeleton variant=\\\"text\\\" width=\\\"180px\\\" height=\\\"20px\\\" />\\n          </div>\\n          <div className={styles.actionButtonsSkeleton}>\\n            <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n            <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n          </div>\\n        </div>\\n        \\n        <SkeletonFileList />\\n      </div>\\n    </div>\\n  );\\n}; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\UploadButton.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadButton ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useRef, useEffect } from 'react';\\nimport { Upload, Folder, ChevronDown } from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\nimport { UploadModal } from './UploadModal';\\n\\ninterface UploadButtonProps {\\n  showDropdown: boolean;\\n  setShowDropdown: (show: boolean) => void;\\n  setIsModalOpen: (open: boolean) => void;\\n  setIsFolderModalOpen: (open: boolean) => void;\\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\\n}\\n\\nexport function UploadButton({ \\n  showDropdown, \\n  setShowDropdown, \\n  setIsModalOpen, \\n  setIsFolderModalOpen,\\n  uploadDropdownRef \\n}: UploadButtonProps) {\\n  \\n  // å¤„ç†ä¸Šä¼ æŒ‰é’®ç‚¹å‡»\\n  const handleUploadClick = (type: 'file' | 'folder') => {\\n    if (type === 'file') {\\n      setIsModalOpen(true);\\n    } else {\\n      setIsFolderModalOpen(true);\\n    }\\n    setShowDropdown(false);\\n  };\\n\\n  return (\\n    <div className={styles.uploadOptionsContainer} ref={uploadDropdownRef}>\\n      <button\\n        className={`${styles.uploadButton} ${showDropdown ? styles.activeButton : ''}`}\\n        onClick={() => setShowDropdown(!showDropdown)}\\n      >\\n        <Upload size={18} className={styles.buttonIcon} />\\n        ä¸Šä¼ æ–‡ä»¶\\n        <ChevronDown size={16} className={styles.dropdownIcon} />\\n      </button>\\n      \\n      {showDropdown && (\\n        <div className={styles.dropdownMenu}>\\n          <div \\n            className={styles.dropdownItem}\\n            onClick={() => handleUploadClick('file')}\\n          >\\n            <Upload size={16} className=\\\"mr-2\\\" />\\n            <span>ä¸Šä¼ æ–‡ä»¶</span>\\n          </div>\\n          <div \\n            className={styles.dropdownItem}\\n            onClick={() => handleUploadClick('folder')}\\n          >\\n            <Folder size={16} className=\\\"mr-2\\\" />\\n            <span>ä¸Šä¼ æ–‡ä»¶å¤¹</span>\\n          </div>\\n        </div>\\n      )}\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\UploadModal.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadModal ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useEffect, useRef, KeyboardEvent } from 'react';\\nimport { InboxOutlined, CloseCircleOutlined, TagOutlined, CloseOutlined } from '@ant-design/icons';\\nimport { Modal, Upload, Input, message, Button, Tag } from 'antd';\\nimport type { RcFile, UploadFile } from 'antd/es/upload/interface';\\nimport type { UploadProps } from 'antd';\\nimport type { InputRef } from 'antd/es/input';\\nimport { FileInfo, FileResponse } from '@/app/types';\\nimport styles from '../../styles/shared.module.css';\\nimport { useSession } from 'next-auth/react';\\nimport { API_PATHS } from '@/app/lib/api/paths';\\n\\nconst { Dragger } = Upload;\\n\\ninterface UploadModalProps {\\n  isOpen: boolean;\\n  onClose: () => void;\\n  onSuccess: (files?: FileInfo[]) => void;\\n  isFolderUpload?: boolean;\\n  currentFolderId?: string | null;\\n}\\n\\n// æ‰©å±•UploadFileç±»å‹ï¼Œæ·»åŠ webkitRelativePathå±æ€§\\ninterface ExtendedUploadFile extends UploadFile<any> {\\n  webkitRelativePath?: string;\\n}\\n\\nexport function UploadModal({\\n  isOpen,\\n  onClose,\\n  onSuccess,\\n  isFolderUpload = false,\\n  currentFolderId\\n}: UploadModalProps) {\\n  const [fileList, setFileList] = useState<ExtendedUploadFile[]>([]);\\n  const [tagInput, setTagInput] = useState<string>('');\\n  const [tagList, setTagList] = useState<string[]>([]);\\n  const [uploading, setUploading] = useState(false);\\n  const fileInputRef = useRef<HTMLInputElement>(null);\\n  const tagInputRef = useRef<InputRef>(null);\\n  const { data: session } = useSession();\\n\\n  useEffect(() => {\\n    // å½“æ¨¡æ€æ¡†æ‰“å¼€æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€\\n    if (isOpen && !session) {\\n      message.error('è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶');\\n      onClose();\\n    }\\n  }, [isOpen, session, onClose]);\\n\\n  // å¤„ç†æ–‡ä»¶é€‰æ‹©\\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\\n    const selectedFiles = e.target.files;\\n    if (!selectedFiles || selectedFiles.length === 0) return;\\n\\n    const newFiles: ExtendedUploadFile[] = [];\\n    for (let i = 0; i < selectedFiles.length; i++) {\\n      const file = selectedFiles[i];\\n      newFiles.push({\\n        uid: `file-${Date.now()}-${i}`,\\n        name: file.name,\\n        size: file.size,\\n        type: file.type,\\n        originFileObj: file as any,\\n        webkitRelativePath: file.webkitRelativePath, // æ·»åŠ ç›¸å¯¹è·¯å¾„\\n      });\\n    }\\n\\n    setFileList(prev => [...prev, ...newFiles]);\\n    \\n    // æ¸…ç©ºinputä»¥å…è®¸å†æ¬¡é€‰æ‹©ç›¸åŒçš„æ–‡ä»¶\\n    if (fileInputRef.current) {\\n      fileInputRef.current.value = '';\\n    }\\n  };\\n\\n  // å¤„ç†æ ‡ç­¾è¾“å…¥\\n  const handleTagInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\\n    setTagInput(e.target.value);\\n  };\\n\\n  // å¤„ç†æ ‡ç­¾è¾“å…¥çš„å›è½¦äº‹ä»¶\\n  const handleTagInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\\n    if (e.key === 'Enter' && tagInput.trim()) {\\n      e.preventDefault();\\n      addTag(tagInput.trim());\\n    }\\n  };\\n\\n  // æ·»åŠ æ ‡ç­¾\\n  const addTag = (tag: string) => {\\n    if (!tag) return;\\n    \\n    // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨\\n    if (!tagList.includes(tag)) {\\n      setTagList(prev => [...prev, tag]);\\n    }\\n    \\n    // æ¸…ç©ºè¾“å…¥æ¡†\\n    setTagInput('');\\n    \\n    // èšç„¦å›è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ç»§ç»­è¾“å…¥\\n    if (tagInputRef.current) {\\n      setTimeout(() => {\\n        tagInputRef.current?.focus();\\n      }, 0);\\n    }\\n  };\\n\\n  // åˆ é™¤æ ‡ç­¾\\n  const removeTag = (tagToRemove: string) => {\\n    setTagList(tagList.filter(tag => tag !== tagToRemove));\\n  };\\n\\n  const handleUpload = async () => {\\n    if (fileList.length === 0) {\\n      message.warning('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');\\n      return;\\n    }\\n\\n    setUploading(true);\\n\\n    try {\\n      const formData = new FormData();\\n      \\n      // æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°FormData\\n      let filesAdded = 0;\\n      fileList.forEach((file, index) => {\\n        const rawFile = file.originFileObj;\\n        if (rawFile instanceof File) {\\n          // ä½¿ç”¨'file'å­—æ®µåï¼Œä¸åç«¯å¯¹åº”\\n          formData.append('file', rawFile);\\n          \\n          // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæ·»åŠ ç›¸å¯¹è·¯å¾„ä¿¡æ¯\\n          if (isFolderUpload && file.webkitRelativePath) {\\n            // ä½¿ç”¨æ•°å­—ç´¢å¼•ä½œä¸ºé”®ï¼Œç¡®ä¿åç«¯å¯ä»¥æ­£ç¡®è§£æ\\n            formData.append(`paths_${index}`, file.webkitRelativePath);\\n            console.log(`æ–‡ä»¶ ${index}: ${file.name} - è·¯å¾„: ${file.webkitRelativePath}`);\\n          }\\n          \\n          filesAdded++;\\n          console.log(`æ·»åŠ æ–‡ä»¶ ${index+1}: ${file.name}, å¤§å°: ${file.size} å­—èŠ‚`);\\n        } else {\\n          console.warn(`æ— æ³•è·å–æ–‡ä»¶ ${index+1}: ${file.name} çš„åŸå§‹Fileå¯¹è±¡`);\\n        }\\n      });\\n      \\n      if (filesAdded === 0) {\\n        throw new Error('æ— æ³•å¤„ç†ä¸Šä¼ æ–‡ä»¶ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶');\\n      }\\n      \\n      // æ·»åŠ æ ‡å¿—è¡¨æ˜è¿™æ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ \\n      if (isFolderUpload) {\\n        formData.append('isFolderUpload', 'true');\\n        console.log('æ–‡ä»¶å¤¹ä¸Šä¼ æ¨¡å¼å·²å¯ç”¨');\\n      }\\n      \\n      // å°†æ ‡ç­¾æ•°ç»„è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²\\n      if (tagList.length > 0) {\\n        formData.append('tags', JSON.stringify(tagList));\\n        console.log('æ·»åŠ æ ‡ç­¾:', tagList);\\n      }\\n\\n      if (currentFolderId) {\\n        formData.append('folderId', currentFolderId);\\n        console.log('å½“å‰æ–‡ä»¶å¤¹ID:', currentFolderId);\\n      }\\n\\n      console.log(`å‡†å¤‡ä¸Šä¼  ${filesAdded} ä¸ªæ–‡ä»¶...`);\\n      \\n      // æ˜¾ç¤ºä¸Šä¼ å¼€å§‹æ¶ˆæ¯\\n      const uploadKey = `upload-${Date.now()}`;\\n      message.loading({ content: 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...', key: uploadKey, duration: 0 });\\n\\n      // ä½¿ç”¨fetchå‘é€è¯·æ±‚\\n      const response = await fetch(API_PATHS.STORAGE.FILES.UPLOAD, {\\n        method: 'POST',\\n        body: formData,\\n      });\\n\\n      // è·å–å“åº”\\n      const contentType = response.headers.get(\\\"content-type\\\");\\n      let data;\\n      \\n      if (contentType && contentType.includes(\\\"application/json\\\")) {\\n        data = await response.json();\\n      } else {\\n        // å¦‚æœä¸æ˜¯JSONå“åº”ï¼Œå°è¯•è·å–æ–‡æœ¬\\n        const text = await response.text();\\n        console.error('æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”:', text);\\n        throw new Error('æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”æ ¼å¼');\\n      }\\n      \\n      // æ£€æŸ¥å“åº”çŠ¶æ€\\n      if (!response.ok) {\\n        console.error('ä¸Šä¼ å“åº”é”™è¯¯:', data);\\n        \\n        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯\\n        message.error({ \\n          content: `ä¸Šä¼ å¤±è´¥: ${data.details || data.error || 'æœåŠ¡å™¨é”™è¯¯'}`, \\n          key: uploadKey,\\n          duration: 5 \\n        });\\n        \\n        throw new Error(data.details || data.error || 'ä¸Šä¼ å¤±è´¥');\\n      }\\n\\n      // ä¸Šä¼ æˆåŠŸå¤„ç†\\n      console.log('ä¸Šä¼ æˆåŠŸ:', data);\\n      message.success({ content: 'ä¸Šä¼ æˆåŠŸ', key: uploadKey, duration: 3 });\\n      \\n      // å…³é—­æ¨¡æ€æ¡†å¹¶é€šçŸ¥çˆ¶ç»„ä»¶\\n      handleClose();\\n      if (typeof onSuccess === 'function') {\\n        onSuccess(data.files || (data.file ? [data.file] : undefined));\\n      } else {\\n        console.warn('onSuccessä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ— æ³•é€šçŸ¥ä¸Šä¼ æˆåŠŸ');\\n      }\\n    } catch (error) {\\n      console.error('ä¸Šä¼ è¿‡ç¨‹ä¸­å‡ºé”™:', error);\\n      message.error(`ä¸Šä¼ å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\\n    } finally {\\n      setUploading(false);\\n    }\\n  };\\n\\n  const handleClose = () => {\\n    setFileList([]);\\n    setTagInput('');\\n    setTagList([]);\\n    onClose();\\n  };\\n  \\n  // ç›´æ¥ä½¿ç”¨åŸç”Ÿæ–‡ä»¶è¾“å…¥\\n  const triggerFileInput = () => {\\n    if (fileInputRef.current) {\\n      fileInputRef.current.click();\\n    }\\n  };\\n  \\n  const removeFile = (index: number) => {\\n    setFileList(prev => prev.filter((_, i) => i !== index));\\n  };\\n\\n  return (\\n    <Modal\\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\\n      open={isOpen}\\n      onCancel={handleClose}\\n      onOk={handleUpload}\\n      okText=\\\"ä¸Šä¼ \\\"\\n      cancelText=\\\"å–æ¶ˆ\\\"\\n      confirmLoading={uploading}\\n      width={600}\\n    >\\n      <div className={styles.uploadContainer || ''}>\\n        <input\\n          type=\\\"file\\\"\\n          ref={fileInputRef}\\n          onChange={handleFileChange}\\n          style={{ display: 'none' }}\\n          multiple={true}\\n          {...(isFolderUpload ? { webkitdirectory: '', directory: '', mozdirectory: '', msdirectory: '' } : {})}\\n        />\\n        \\n        <div \\n          className={styles.dropzone || ''}\\n          onClick={triggerFileInput}\\n          style={{ \\n            border: '2px dashed #d9d9d9',\\n            borderRadius: '4px',\\n            padding: '20px',\\n            textAlign: 'center',\\n            cursor: 'pointer',\\n            marginBottom: '16px'\\n          }}\\n        >\\n          <p><InboxOutlined style={{ fontSize: '48px', color: '#40a9ff' }} /></p>\\n          <p style={{ marginTop: '8px', fontWeight: 'bold' }}>\\n            ç‚¹å‡»æˆ–æ‹–æ‹½{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}åˆ°æ­¤åŒºåŸŸä¸Šä¼ \\n          </p>\\n          <p style={{ color: '#888' }}>\\n            {isFolderUpload\\n              ? 'æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å†…éƒ¨æ–‡ä»¶ï¼Œä¿ç•™æ–‡ä»¶å¤¹ç»“æ„'\\n              : 'æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡ä¸Šä¼ æ–‡ä»¶ï¼Œæœ€å¤§æ”¯æŒåŒæ—¶é€‰æ‹©50ä¸ªæ–‡ä»¶'}\\n          </p>\\n          <Button type=\\\"primary\\\" onClick={(e) => { e.stopPropagation(); triggerFileInput(); }}>\\n            é€‰æ‹©{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}\\n          </Button>\\n        </div>\\n        \\n        {fileList.length > 0 && (\\n          <div style={{ marginBottom: '16px' }}>\\n            <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\\n              å·²é€‰æ‹© {fileList.length} ä¸ªæ–‡ä»¶:\\n            </div>\\n            <ul style={{ maxHeight: '150px', overflowY: 'auto', padding: '0 0 0 20px' }}>\\n              {fileList.map((file, index) => (\\n                <li key={file.uid} style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>\\n                  <span>\\n                    {file.name} \\n                    {isFolderUpload && file.webkitRelativePath && (\\n                      <span style={{ fontSize: '12px', color: '#8c8c8c', marginLeft: '4px' }}>\\n                        (è·¯å¾„: {file.webkitRelativePath.split('/').slice(0, -1).join('/')})\\n                      </span>\\n                    )}\\n                    ({((file.size || 0) / 1024).toFixed(2)} KB)\\n                  </span>\\n                  <Button \\n                    type=\\\"text\\\" \\n                    danger \\n                    onClick={() => removeFile(index)}\\n                    style={{ padding: '0 4px' }}\\n                  >\\n                    åˆ é™¤\\n                  </Button>\\n                </li>\\n              ))}\\n            </ul>\\n          </div>\\n        )}\\n\\n        <div style={{ marginTop: 16 }}>\\n          <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\\n            <span style={{ fontWeight: 'bold', marginRight: '8px' }}>æ·»åŠ æ ‡ç­¾:</span>\\n            <span style={{ fontSize: '12px', color: '#8c8c8c' }}>\\n              (è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ )\\n            </span>\\n          </div>\\n          \\n          <div className={styles.tagsInputWrapper}>\\n            <Input\\n              ref={tagInputRef}\\n              placeholder=\\\"è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ \\\"\\n              value={tagInput}\\n              onChange={handleTagInputChange}\\n              onKeyDown={handleTagInputKeyDown}\\n              prefix={<TagOutlined style={{ color: '#bfbfbf' }} />}\\n              suffix={\\n                <span style={{ color: '#bfbfbf', fontSize: '12px' }}>\\n                  æŒ‰å›è½¦æ·»åŠ \\n                </span>\\n              }\\n            />\\n          </div>\\n          \\n          <div className={styles.tagsContainer}>\\n            {tagList.length > 0 ? (\\n              <div className={styles.tagsList}>\\n                {tagList.map((tag, index) => (\\n                  <Tag\\n                    key={index}\\n                    closable\\n                    onClose={() => removeTag(tag)}\\n                    className={styles.interactiveTag}\\n                  >\\n                    {tag}\\n                  </Tag>\\n                ))}\\n              </div>\\n            ) : (\\n              <div className={styles.emptyTagsHint}>\\n                æ·»åŠ ä¸€äº›æ ‡ç­¾æ¥å¸®åŠ©ç®¡ç†æ‚¨çš„æ–‡ä»¶\\n              </div>\\n            )}\\n          </div>\\n        </div>\\n\\n        <div style={{ marginTop: '16px', padding: '12px', background: '#f5f5f5', borderRadius: '8px', fontSize: '13px', color: '#555' }}>\\n          <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\\n            {isFolderUpload ? 'æ–‡ä»¶å¤¹ä¸Šä¼ è¯´æ˜:' : 'æ–‡ä»¶ä¸Šä¼ è¯´æ˜:'}\\n          </div>\\n          <ul style={{ paddingLeft: '16px', margin: '0' }}>\\n            {isFolderUpload ? (\\n              <>\\n                <li>æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹ç»“æ„</li>\\n                <li>ä¿ç•™å®Œæ•´çš„æ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„</li>\\n                <li>ç›®å‰ä»…Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©</li>\\n                <li>å¦‚æœæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©ï¼Œè¯·é€‰æ‹©å•ä¸ªæ–‡ä»¶æ¨¡å¼</li>\\n              </>\\n            ) : (\\n              <>\\n                <li>æ”¯æŒæ‰¹é‡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</li>\\n                <li>æ”¯æŒå¸¸è§çš„æ–‡ä»¶æ ¼å¼ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰</li>\\n                <li>æ¯ä¸ªæ–‡ä»¶å¤§å°é™åˆ¶ä¸º50MB</li>\\n                <li>ä¸€æ¬¡æœ€å¤šå¯é€‰æ‹©50ä¸ªæ–‡ä»¶</li>\\n              </>\\n            )}\\n            <li>æ‚¨å¯ä»¥ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ·»åŠ æ ‡ç­¾ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»„ç»‡å’ŒæŸ¥æ‰¾</li>\\n          </ul>\\n        </div>\\n      </div>\\n    </Modal>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\SortDropdown.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/SortDropdown ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useRef, useEffect } from 'react';\\nimport styles from '../styles/SortDropdown.module.css';\\nimport { FileSortInterface, SortDirectionEnum } from '@/app/types';\\n\\ninterface SortDropdownProps {\\n  sortOrder: FileSortInterface;\\n  onSortChange: (order: FileSortInterface) => void;\\n}\\n\\nexport const SortDropdown: React.FC<SortDropdownProps> = ({\\n  sortOrder,\\n  onSortChange\\n}) => {\\n  const [showDropdown, setShowDropdown] = useState(false);\\n  const dropdownRef = useRef<HTMLDivElement>(null);\\n\\n  useEffect(() => {\\n    const handleClickOutside = (event: MouseEvent) => {\\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\\n        setShowDropdown(false);\\n      }\\n    };\\n\\n    document.addEventListener('mousedown', handleClickOutside);\\n    return () => document.removeEventListener('mousedown', handleClickOutside);\\n  }, []);\\n\\n  // æ ¹æ®å½“å‰æ’åºå­—æ®µè·å–æ˜¾ç¤ºæ–‡æœ¬\\n  const getSortFieldText = () => {\\n    switch(sortOrder.field) {\\n      case 'name': return 'æ–‡ä»¶å';\\n      case 'size': return 'å¤§å°';\\n      case 'createdAt': return 'æ—¶é—´';\\n      default: return 'é»˜è®¤';\\n    }\\n  };\\n\\n  return (\\n    <div className={styles.sortDropdown} ref={dropdownRef}>\\n      <button \\n        className={styles.topButton}\\n        onClick={() => setShowDropdown(!showDropdown)}\\n        style={{ \\n          background: showDropdown ? '#f0f7ff' : 'white',\\n          borderColor: showDropdown ? '#60a5fa' : '#e8e8e8'\\n        }}\\n      >\\n        <span>â†•ï¸</span>\\n        æ’åº: {getSortFieldText()} {sortOrder.direction === SortDirectionEnum.ASC ? 'â†‘' : 'â†“'}\\n      </button>\\n      {showDropdown && (\\n        <div className={styles.dropdownMenu}>\\n          <button \\n            className={styles.dropdownItem}\\n            onClick={() => {\\n              const newSortOrder: FileSortInterface = {\\n                field: 'name',\\n                direction: sortOrder.field === 'name' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\\n              };\\n              onSortChange(newSortOrder);\\n              setShowDropdown(false);\\n            }}\\n            style={{ \\n              fontWeight: sortOrder.field === 'name' ? 'bold' : 'normal',\\n              background: sortOrder.field === 'name' ? '#f0f7ff' : 'transparent'\\n            }}\\n          >\\n            <span>ğŸ“</span>\\n            æŒ‰æ–‡ä»¶å{sortOrder.field === 'name' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\\n          </button>\\n          <button \\n            className={styles.dropdownItem}\\n            onClick={() => {\\n              const newSortOrder: FileSortInterface = {\\n                field: 'size',\\n                direction: sortOrder.field === 'size' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\\n              };\\n              onSortChange(newSortOrder);\\n              setShowDropdown(false);\\n            }}\\n            style={{ \\n              fontWeight: sortOrder.field === 'size' ? 'bold' : 'normal',\\n              background: sortOrder.field === 'size' ? '#f0f7ff' : 'transparent'\\n            }}\\n          >\\n            <span>ğŸ“Š</span>\\n            æŒ‰å¤§å°{sortOrder.field === 'size' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\\n          </button>\\n          <button \\n            className={styles.dropdownItem}\\n            onClick={() => {\\n              const newSortOrder: FileSortInterface = {\\n                field: 'createdAt',\\n                direction: sortOrder.field === 'createdAt' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\\n              };\\n              onSortChange(newSortOrder);\\n              setShowDropdown(false);\\n            }}\\n            style={{ \\n              fontWeight: sortOrder.field === 'createdAt' ? 'bold' : 'normal',\\n              background: sortOrder.field === 'createdAt' ? '#f0f7ff' : 'transparent'\\n            }}\\n          >\\n            <span>ğŸ•’</span>\\n            æŒ‰æ—¶é—´{sortOrder.field === 'createdAt' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\\n          </button>\\n        </div>\\n      )}\\n    </div>\\n  );\\n};\\n\\nexport default SortDropdown; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\Toolbar.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/toolbar/Toolbar ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useRef, useState } from 'react';\\nimport { useFileContext } from '../context/FileContext';\\nimport { X, Download, Edit, Move } from 'lucide-react';\\nimport { message } from 'antd';\\nimport styles from './Toolbar.module.css';\\nimport commonStyles from '../styles/common.module.css';\\n\\ninterface ToolbarProps {\\n  onUploadClick: () => void;\\n  onFolderUploadClick: () => void;\\n  onCreateFolderClick: () => void;\\n}\\n\\nexport function Toolbar({ onUploadClick, onFolderUploadClick, onCreateFolderClick }: ToolbarProps) {\\n  const {\\n    selectedFiles,\\n    clearSelection,\\n    files\\n  } = useFileContext();\\n\\n  const [showUploadDropdown, setShowUploadDropdown] = useState(false);\\n  const dropdownRef = useRef<HTMLDivElement>(null);\\n\\n  const handleDownload = () => {\\n    // TODO: å®ç°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½\\n    message.info('ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­');\\n  };\\n\\n  const handleRename = () => {\\n    if (selectedFiles.length !== 1) {\\n      message.warning('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé‡å‘½å');\\n      return;\\n    }\\n    const selectedFile = files.find(file => file.id === selectedFiles[0]);\\n    if (selectedFile) {\\n      // TODO: å®ç°é‡å‘½ååŠŸèƒ½\\n      message.info('é‡å‘½ååŠŸèƒ½å¼€å‘ä¸­');\\n    }\\n  };\\n\\n  return (\\n    <div className={styles.topBar}>\\n      <div className={styles.buttonGroup}>\\n        {selectedFiles.length > 0 ? (\\n          <>\\n            <button className={styles.topButton} onClick={() => clearSelection()}>\\n              <X className={commonStyles.icon} />\\n              å–æ¶ˆé€‰æ‹©\\n            </button>\\n            <button className={styles.topButton} onClick={handleDownload}>\\n              <Download className={commonStyles.icon} />\\n              ä¸‹è½½\\n            </button>\\n            <button className={styles.topButton} onClick={handleRename}>\\n              <Edit className={commonStyles.icon} />\\n              é‡å‘½å\\n            </button>\\n            <button className={styles.topButton}>\\n              <Move className={commonStyles.icon} />\\n              ç§»åŠ¨\\n            </button>\\n          </>\\n        ) : (\\n          <>\\n            <div className={styles.uploadDropdown} ref={dropdownRef}>\\n              <button\\n                className={styles.topButton}\\n                onClick={() => setShowUploadDropdown(!showUploadDropdown)}\\n              >\\n                <span className={styles.buttonIcon}>â¬†ï¸</span>\\n                ä¸Šä¼ \\n                <span className={styles.dropdownArrow}>â–¼</span>\\n              </button>\\n              {showUploadDropdown && (\\n                <div className={styles.dropdownMenu}>\\n                  <button\\n                    className={styles.dropdownItem}\\n                    onClick={() => {\\n                      onUploadClick();\\n                      setShowUploadDropdown(false);\\n                    }}\\n                  >\\n                    <span className={styles.buttonIcon}>ğŸ“„</span>\\n                    ä¸Šä¼ æ–‡ä»¶\\n                  </button>\\n                  <button\\n                    className={styles.dropdownItem}\\n                    onClick={() => {\\n                      onFolderUploadClick();\\n                      setShowUploadDropdown(false);\\n                    }}\\n                  >\\n                    <span className={styles.buttonIcon}>ğŸ“</span>\\n                    ä¸Šä¼ æ–‡ä»¶å¤¹\\n                  </button>\\n                </div>\\n              )}\\n            </div>\\n            <button\\n              className={styles.topButton}\\n              onClick={onCreateFolderClick}\\n            >\\n              <span className={styles.buttonIcon}>ğŸ“</span>\\n              æ–°å»ºæ–‡ä»¶å¤¹\\n            </button>\\n          </>\\n        )}\\n      </div>\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\TopActionBar.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/TopActionBar ç»„ä»¶ã€‚\\n */\\n\\nimport React from 'react';\\nimport { \\n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \\n} from 'lucide-react';\\nimport styles from '../styles/shared.module.css';\\nimport SortDropdown from './SortDropdown';\\nimport { UploadButton } from '../components/shared';\\nimport { FileSortInterface } from '@/app/types';\\n\\ninterface TopActionBarProps {\\n  selectedFiles: string[];\\n  onClearSelection: () => void;\\n  onDownload: () => void;\\n  onRename: () => void;\\n  onMove: () => void;\\n  onDelete: () => void;\\n  onClearFilter: () => void;\\n  onCreateFolder: () => void;\\n  selectedFileType: string | null;\\n  showSearchView: boolean;\\n  isInRootFolder: boolean;\\n  sortOrder: FileSortInterface;\\n  setSortOrder: (order: FileSortInterface) => void;\\n  showUploadDropdown: boolean;\\n  setShowUploadDropdown: (show: boolean) => void;\\n  setIsUploadModalOpen: (open: boolean) => void;\\n  setIsFolderUploadModalOpen: (open: boolean) => void;\\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\\n}\\n\\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\\n  selectedFiles,\\n  onClearSelection,\\n  onDownload,\\n  onRename,\\n  onMove,\\n  onDelete,\\n  onClearFilter,\\n  onCreateFolder,\\n  selectedFileType,\\n  showSearchView,\\n  isInRootFolder,\\n  sortOrder,\\n  setSortOrder,\\n  showUploadDropdown,\\n  setShowUploadDropdown,\\n  setIsUploadModalOpen,\\n  setIsFolderUploadModalOpen,\\n  uploadDropdownRef\\n}) => {\\n  return (\\n    <div className={styles.topBar}>\\n      <div className={styles.buttonGroup}>\\n        {selectedFiles.length > 0 ? (\\n          <>\\n            <button className={styles.topButton} onClick={onClearSelection}>\\n              <X className=\\\"w-4 h-4\\\" />\\n              å–æ¶ˆé€‰æ‹©\\n            </button>\\n            <button className={styles.topButton} onClick={onDownload}>\\n              <Download className=\\\"w-4 h-4\\\" />\\n              ä¸‹è½½\\n            </button>\\n            <button \\n              className={styles.topButton}\\n              onClick={onRename}\\n            >\\n              <Edit className=\\\"w-4 h-4\\\" />\\n              é‡å‘½å\\n            </button>\\n            <button className={styles.topButton} onClick={onMove}>\\n              <Move className=\\\"w-4 h-4\\\" />\\n              ç§»åŠ¨\\n            </button>\\n            <button className={styles.topButton} onClick={onDelete}>\\n              <Trash2 className=\\\"w-4 h-4\\\" />\\n              åˆ é™¤\\n            </button>\\n          </>\\n        ) : (\\n          <>\\n            <button \\n              className={styles.topButton}\\n              onClick={onClearFilter}\\n              disabled={isInRootFolder}\\n            >\\n              <span>ğŸ“</span>\\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\\n            </button>\\n\\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\\n            {selectedFileType && (\\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\\n                {(() => {\\n                  switch(selectedFileType) {\\n                    case 'image': return <ImageIcon className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'document': return <FileText className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'video': return <Video className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'audio': return <Music className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'other': return <File className=\\\"w-4 h-4 mr-2\\\" />;\\n                    default: return null;\\n                  }\\n                })()}\\n                å½“å‰æµè§ˆï¼š\\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\\n              </div>\\n            )}\\n\\n            {/* æ’åºä¸‹æ‹‰èœå• */}\\n            <SortDropdown \\n              sortOrder={sortOrder}\\n              onSortChange={setSortOrder}\\n            />\\n            \\n            {/* ä¸Šä¼ æŒ‰é’® */}\\n            <UploadButton \\n              showDropdown={showUploadDropdown}\\n              setShowDropdown={setShowUploadDropdown}\\n              setIsModalOpen={setIsUploadModalOpen}\\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\\n              uploadDropdownRef={uploadDropdownRef}\\n            />\\n            \\n            <button \\n              className={styles.folderButton} \\n              onClick={onCreateFolder}\\n            >\\n              <FolderUp className=\\\"w-4 h-4 mr-2\\\" />\\n              æ–°å»ºæ–‡ä»¶å¤¹\\n            </button>\\n          </>\\n        )}\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport default TopActionBar; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\upload\\\\UploadModal\\\\UploadModal.tsx\",\n    \"newContent\": \"'use client';\\r\\n\\r\\nimport React, { useState, useRef, useEffect } from 'react';\\r\\nimport { Modal, Button, Space, Tag, Input, message, Progress } from 'antd';\\r\\nimport { UploadOutlined, FolderOutlined } from '@ant-design/icons';\\r\\nimport { UploadModalProps } from '@/app/types/domains/file-management';\\r\\nimport { FileTreeNode } from '@/app/types/domains/fileTypes';\\r\\nimport { formatFileSize } from '@/app/lib/utils/file';\\r\\nimport { uploadFile, uploadFolder, processSelectedFiles } from '@/app/lib/uploadService';\\r\\n\\r\\n// æ„å»ºæ–‡ä»¶æ ‘èŠ‚ç‚¹\\r\\nfunction createFileTreeNode(name: string, type: 'file' | 'folder', size: number = 0, file?: File): FileTreeNode {\\r\\n  return {\\r\\n    name,\\r\\n    type,\\r\\n    size,\\r\\n    children: type === 'folder' ? [] : undefined,\\r\\n    file: file as any\\r\\n  };\\r\\n}\\r\\n\\r\\n// æ›´æ–°æ–‡ä»¶å¤¹å¤§å°\\r\\nfunction updateFolderSize(node: FileTreeNode, fileSize: number) {\\r\\n  let currentNode = node;\\r\\n  while (currentNode) {\\r\\n    currentNode.size += fileSize;\\r\\n    currentNode = currentNode.children?.find(child => \\r\\n      child.type === 'folder'\\r\\n    ) as FileTreeNode;\\r\\n  }\\r\\n}\\r\\n\\r\\n// æ„å»ºæ–‡ä»¶æ ‘ç»“æ„\\r\\nfunction buildFileTree(files: File[], rootName: string): FileTreeNode {\\r\\n  const root = createFileTreeNode(rootName, 'folder');\\r\\n  \\r\\n  files.forEach(file => {\\r\\n    const paths = (file as any).webkitRelativePath.split('/');\\r\\n    let currentNode = root;\\r\\n    \\r\\n    for (let i = 1; i < paths.length; i++) {\\r\\n      const pathPart = paths[i];\\r\\n      const isFile = i === paths.length - 1;\\r\\n\\r\\n      if (isFile) {\\r\\n        const fileNode = createFileTreeNode(pathPart, 'file', file.size, file);\\r\\n        currentNode.children?.push(fileNode);\\r\\n        updateFolderSize(currentNode, file.size);\\r\\n      } else {\\r\\n        let folderNode = currentNode.children?.find(\\r\\n          child => child.name === pathPart && child.type === 'folder'\\r\\n        );\\r\\n        \\r\\n        if (!folderNode) {\\r\\n          folderNode = createFileTreeNode(pathPart, 'folder');\\r\\n          currentNode.children?.push(folderNode);\\r\\n        }\\r\\n        currentNode = folderNode;\\r\\n      }\\r\\n    }\\r\\n  });\\r\\n\\r\\n  return root;\\r\\n}\\r\\n\\r\\n/**\\r\\n * æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†ç»„ä»¶\\r\\n * æ”¯æŒæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæä¾›æ‹–æ”¾å’Œé€‰æ‹©ç•Œé¢\\r\\n */\\r\\nconst UploadModal: React.FC<UploadModalProps> = ({\\r\\n  isOpen,\\r\\n  onClose,\\r\\n  onUploadSuccess,\\r\\n  currentFolderId,\\r\\n  isFolderUpload,\\r\\n  withTags\\r\\n}) => {\\r\\n  const [isDragging, setIsDragging] = useState(false);\\r\\n  const [files, setFiles] = useState<File[]>([]);\\r\\n  const [isUploading, setIsUploading] = useState(false);\\r\\n  const [uploadProgress, setUploadProgress] = useState(0);\\r\\n  const [tags, setTags] = useState<string[]>([]);\\r\\n  const [tagInput, setTagInput] = useState('');\\r\\n  const [folderName, setFolderName] = useState<string | null>(null);\\r\\n  const [fileTree, setFileTree] = useState<FileTreeNode | null>(null);\\r\\n  const fileInputRef = useRef<HTMLInputElement>(null);\\r\\n\\r\\n  // é‡ç½®æ‰€æœ‰çŠ¶æ€\\r\\n  const resetState = () => {\\r\\n    setFiles([]);\\r\\n    setIsDragging(false);\\r\\n    setTags([]);\\r\\n    setTagInput('');\\r\\n    setFolderName(null);\\r\\n    setFileTree(null);\\r\\n    setUploadProgress(0);\\r\\n  };\\r\\n\\r\\n  // ç›‘å¬ isOpen å˜åŒ–ï¼Œå½“å¼¹çª—å…³é—­æ—¶é‡ç½®çŠ¶æ€\\r\\n  useEffect(() => {\\r\\n    if (!isOpen) {\\r\\n      resetState();\\r\\n    }\\r\\n  }, [isOpen]);\\r\\n\\r\\n  const handleClose = () => {\\r\\n    resetState();\\r\\n    onClose();\\r\\n  };\\r\\n\\r\\n  const handleDragOver = (e: React.DragEvent) => {\\r\\n    e.preventDefault();\\r\\n    setIsDragging(true);\\r\\n  };\\r\\n\\r\\n  const handleDragLeave = () => {\\r\\n    setIsDragging(false);\\r\\n  };\\r\\n\\r\\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\\r\\n    e.preventDefault();\\r\\n    setIsDragging(false);\\r\\n    \\r\\n    const droppedFiles = Array.from(e.dataTransfer.files);\\r\\n    if (droppedFiles.length > 0) {\\r\\n      const { files: processedFiles, folderName } = processSelectedFiles(droppedFiles, isFolderUpload);\\r\\n      setFiles(processedFiles);\\r\\n      setFolderName(folderName);\\r\\n      \\r\\n      if (isFolderUpload && folderName) {\\r\\n        setFileTree(buildFileTree(processedFiles, folderName));\\r\\n      }\\r\\n    }\\r\\n  };\\r\\n\\r\\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\\r\\n    const selectedFiles = Array.from(e.target.files || []);\\r\\n    if (selectedFiles.length > 0) {\\r\\n      const { files: processedFiles, folderName } = processSelectedFiles(selectedFiles, isFolderUpload);\\r\\n      setFiles(processedFiles);\\r\\n      setFolderName(folderName);\\r\\n      \\r\\n      if (isFolderUpload && folderName) {\\r\\n        setFileTree(buildFileTree(processedFiles, folderName));\\r\\n      }\\r\\n    }\\r\\n  };\\r\\n\\r\\n  const removeFile = (fileName: string) => {\\r\\n    setFiles(prev => prev.filter(file => file.name !== fileName));\\r\\n  };\\r\\n\\r\\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\\r\\n    if (e.key === 'Enter' && tagInput.trim()) {\\r\\n      e.preventDefault();\\r\\n      const newTag = tagInput.trim();\\r\\n      if (!tags.includes(newTag)) {\\r\\n        setTags([...tags, newTag]);\\r\\n      }\\r\\n      setTagInput('');\\r\\n    }\\r\\n  };\\r\\n\\r\\n  const removeTag = (tagToRemove: string) => {\\r\\n    setTags(tags.filter(tag => tag !== tagToRemove));\\r\\n  };\\r\\n\\r\\n  // é€’å½’æ¸²æŸ“æ–‡ä»¶æ ‘ç»„ä»¶\\r\\n  const renderFileTree = (node: FileTreeNode, level: number = 0) => {\\r\\n    return (\\r\\n      <div key={node.name} style={{ marginLeft: `${level * 20}px` }}>\\r\\n        <div className=\\\"file-item\\\">\\r\\n          <div className=\\\"file-info\\\">\\r\\n            <span className=\\\"file-type-icon\\\">\\r\\n              {node.type === 'folder' ? 'ğŸ“' : \\r\\n               node.file?.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\\r\\n               node.file?.type.includes('pdf') ? 'ğŸ“„' :\\r\\n               node.file?.type.includes('word') ? 'ğŸ“' :\\r\\n               'ğŸ“„'}\\r\\n            </span>\\r\\n            <div>\\r\\n              <p className=\\\"file-name\\\">{node.name}</p>\\r\\n              <p className=\\\"file-size\\\">\\r\\n                {formatFileSize(node.size)}\\r\\n                {node.type === 'folder' && ` (${node.children?.length || 0} ä¸ªæ–‡ä»¶)`}\\r\\n              </p>\\r\\n            </div>\\r\\n          </div>\\r\\n        </div>\\r\\n        {node.children && node.children.length > 0 && (\\r\\n          <div className=\\\"file-children\\\">\\r\\n            {node.children.map(child => renderFileTree(child, level + 1))}\\r\\n          </div>\\r\\n        )}\\r\\n      </div>\\r\\n    );\\r\\n  };\\r\\n\\r\\n  // ä¸Šä¼ å¤„ç†å‡½æ•°\\r\\n  const handleUpload = async () => {\\r\\n    if (files.length === 0) return;\\r\\n    \\r\\n    setIsUploading(true);\\r\\n    setUploadProgress(0);\\r\\n    \\r\\n    try {\\r\\n      // å¤„ç†æ–‡ä»¶å¤¹ä¸Šä¼ \\r\\n      if (isFolderUpload && folderName) {\\r\\n        await uploadFolder(files, folderName, {\\r\\n          folderId: currentFolderId || undefined,\\r\\n          tags,\\r\\n          onProgress: (progress) => {\\r\\n            setUploadProgress(progress);\\r\\n          },\\r\\n          onSuccess: (response) => {\\r\\n            message.success(`æ–‡ä»¶å¤¹ \\\"${folderName}\\\" ä¸Šä¼ æˆåŠŸ`);\\r\\n            setIsUploading(false);\\r\\n            onUploadSuccess();\\r\\n            handleClose();\\r\\n          },\\r\\n          onError: (error) => {\\r\\n            message.error(`ä¸Šä¼ å¤±è´¥: ${error.message}`);\\r\\n            setIsUploading(false);\\r\\n          }\\r\\n        });\\r\\n      } else {\\r\\n        // å•æ–‡ä»¶æˆ–å¤šæ–‡ä»¶ä¸Šä¼ \\r\\n        let uploadedCount = 0;\\r\\n        const totalFiles = files.length;\\r\\n        \\r\\n        for (const file of files) {\\r\\n          await uploadFile(file, {\\r\\n            folderId: currentFolderId || undefined,\\r\\n            tags,\\r\\n            onProgress: (fileProgress) => {\\r\\n              // è®¡ç®—æ€»ä½“è¿›åº¦ï¼šå·²å®Œæˆæ–‡ä»¶ + å½“å‰æ–‡ä»¶è¿›åº¦\\r\\n              const totalProgress = Math.round(\\r\\n                (uploadedCount * 100 + fileProgress) / totalFiles\\r\\n              );\\r\\n              setUploadProgress(totalProgress);\\r\\n            },\\r\\n            onSuccess: () => {\\r\\n              uploadedCount++;\\r\\n              \\r\\n              // æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ\\r\\n              if (uploadedCount === totalFiles) {\\r\\n                message.success(totalFiles > 1 \\r\\n                  ? `${totalFiles}ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸ` \\r\\n                  : 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');\\r\\n                \\r\\n                setIsUploading(false);\\r\\n                onUploadSuccess();\\r\\n                handleClose();\\r\\n              }\\r\\n            },\\r\\n            onError: (error) => {\\r\\n              message.error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${error.message}`);\\r\\n              setIsUploading(false);\\r\\n            }\\r\\n          });\\r\\n        }\\r\\n      }\\r\\n    } catch (error) {\\r\\n      const errorMessage = error instanceof Error ? error.message : 'ä¸Šä¼ å¤±è´¥';\\r\\n      message.error(errorMessage);\\r\\n      setIsUploading(false);\\r\\n    }\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    <Modal\\r\\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\\r\\n      open={isOpen}\\r\\n      onCancel={handleClose}\\r\\n      footer={[\\r\\n        <Button key=\\\"cancel\\\" onClick={handleClose} disabled={isUploading}>\\r\\n          å–æ¶ˆ\\r\\n        </Button>,\\r\\n        <Button \\r\\n          key=\\\"upload\\\" \\r\\n          type=\\\"primary\\\" \\r\\n          onClick={handleUpload} \\r\\n          disabled={files.length === 0 || isUploading}\\r\\n          loading={isUploading}\\r\\n        >\\r\\n          ä¸Šä¼ \\r\\n        </Button>,\\r\\n      ]}\\r\\n      width={800}\\r\\n    >\\r\\n      {isUploading ? (\\r\\n        <div className=\\\"text-center py-8\\\">\\r\\n          <div className=\\\"my-4\\\">\\r\\n            <Progress percent={uploadProgress} status=\\\"active\\\" />\\r\\n            <div className=\\\"mt-2\\\">{`ä¸Šä¼ ä¸­...${uploadProgress}%`}</div>\\r\\n          </div>\\r\\n        </div>\\r\\n      ) : (\\r\\n        <div className=\\\"upload-content\\\">\\r\\n          {/* æ‹–æ”¾åŒºåŸŸ */}\\r\\n          <div\\r\\n            onDragOver={handleDragOver}\\r\\n            onDragLeave={handleDragLeave}\\r\\n            onDrop={handleDrop}\\r\\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\\r\\n              isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-500'\\r\\n            }`}\\r\\n          >\\r\\n            <div className=\\\"upload-icon mb-4\\\">\\r\\n              {isFolderUpload ? <FolderOutlined style={{ fontSize: 48 }} /> : <UploadOutlined style={{ fontSize: 48 }} />}\\r\\n            </div>\\r\\n            <p className=\\\"text-lg mb-2\\\">\\r\\n              {isDragging\\r\\n                ? isFolderUpload\\r\\n                  ? 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶å¤¹'\\r\\n                  : 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶'\\r\\n                : isFolderUpload\\r\\n                ? 'æ‹–æ”¾æ–‡ä»¶å¤¹è‡³æ­¤å¤„ï¼Œæˆ–'\\r\\n                : 'æ‹–æ”¾æ–‡ä»¶è‡³æ­¤å¤„ï¼Œæˆ–'}\\r\\n            </p>\\r\\n            <Button\\r\\n              onClick={() => fileInputRef.current?.click()}\\r\\n              type=\\\"primary\\\"\\r\\n              icon={isFolderUpload ? <FolderOutlined /> : <UploadOutlined />}\\r\\n            >\\r\\n              {isFolderUpload ? 'é€‰æ‹©æ–‡ä»¶å¤¹' : 'é€‰æ‹©æ–‡ä»¶'}\\r\\n            </Button>\\r\\n            <input\\r\\n              ref={fileInputRef}\\r\\n              type=\\\"file\\\"\\r\\n              multiple={!isFolderUpload}\\r\\n              style={{ display: 'none' }}\\r\\n              onChange={handleFileSelect}\\r\\n              {...(isFolderUpload ? { webkitdirectory: \\\"\\\", directory: \\\"\\\" } : {})}\\r\\n            />\\r\\n          </div>\\r\\n\\r\\n          {/* æ ‡ç­¾è¾“å…¥åŒºåŸŸ */}\\r\\n          {withTags && (\\r\\n            <div className=\\\"tags-section mt-6\\\">\\r\\n              <h4 className=\\\"text-base font-medium mb-2\\\">æ·»åŠ æ ‡ç­¾</h4>\\r\\n              <div className=\\\"tag-input\\\">\\r\\n                <Input\\r\\n                  placeholder=\\\"è¾“å…¥æ ‡ç­¾å¹¶æŒ‰Enteræ·»åŠ \\\"\\r\\n                  value={tagInput}\\r\\n                  onChange={(e) => setTagInput(e.target.value)}\\r\\n                  onKeyDown={handleTagInputKeyDown}\\r\\n                />\\r\\n              </div>\\r\\n              {tags.length > 0 && (\\r\\n                <div className=\\\"tags-list mt-2 flex flex-wrap gap-1\\\">\\r\\n                  {tags.map((tag) => (\\r\\n                    <Tag\\r\\n                      key={tag}\\r\\n                      closable\\r\\n                      onClose={() => removeTag(tag)}\\r\\n                    >\\r\\n                      {tag}\\r\\n                    </Tag>\\r\\n                  ))}\\r\\n                </div>\\r\\n              )}\\r\\n            </div>\\r\\n          )}\\r\\n\\r\\n          {/* æ–‡ä»¶åˆ—è¡¨æˆ–æ–‡ä»¶æ ‘ */}\\r\\n          {files.length > 0 && (\\r\\n            <div className=\\\"file-list mt-6\\\">\\r\\n              <h4 className=\\\"text-base font-medium mb-2\\\">\\r\\n                {isFolderUpload \\r\\n                  ? `æ–‡ä»¶å¤¹: ${folderName} (${files.length}ä¸ªæ–‡ä»¶)` \\r\\n                  : `é€‰æ‹©çš„æ–‡ä»¶ (${files.length})`}\\r\\n              </h4>\\r\\n              \\r\\n              {isFolderUpload && fileTree ? (\\r\\n                <div className=\\\"folder-tree border rounded p-3\\\">\\r\\n                  {renderFileTree(fileTree)}\\r\\n                </div>\\r\\n              ) : (\\r\\n                <div className=\\\"file-items space-y-2\\\">\\r\\n                  {files.map((file) => (\\r\\n                    <div\\r\\n                      key={file.name}\\r\\n                      className=\\\"file-item flex justify-between items-center border rounded p-2\\\"\\r\\n                    >\\r\\n                      <div className=\\\"file-details flex items-center\\\">\\r\\n                        <span className=\\\"file-icon mr-2\\\">\\r\\n                          {file.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\\r\\n                           file.type.includes('pdf') ? 'ğŸ“„' :\\r\\n                           file.type.includes('word') ? 'ğŸ“' :\\r\\n                           'ğŸ“„'}\\r\\n                        </span>\\r\\n                        <div>\\r\\n                          <div className=\\\"file-name font-medium\\\">{file.name}</div>\\r\\n                          <div className=\\\"file-meta text-xs text-gray-500\\\">\\r\\n                            {formatFileSize(file.size)}\\r\\n                          </div>\\r\\n                        </div>\\r\\n                      </div>\\r\\n                      <Button\\r\\n                        type=\\\"text\\\"\\r\\n                        size=\\\"small\\\"\\r\\n                        danger\\r\\n                        onClick={() => removeFile(file.name)}\\r\\n                      >\\r\\n                        ç§»é™¤\\r\\n                      </Button>\\r\\n                    </div>\\r\\n                  ))}\\r\\n                </div>\\r\\n              )}\\r\\n            </div>\\r\\n          )}\\r\\n        </div>\\r\\n      )}\\r\\n    </Modal>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default UploadModal; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\actionBar\\\\TopActionBar\\\\TopActionBar.tsx\",\n    \"newContent\": \"import React from 'react';\\r\\nimport { \\r\\n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \\r\\n} from 'lucide-react';\\r\\nimport styles from '@/app/file-management/styles/shared.module.css';\\r\\nimport { SortDropdown } from '@/app/components/features/file-management/actionBar/SortDropdown';\\r\\nimport { UploadButton } from '@/app/components/features/file-management/upload/UploadButton';\\r\\nimport { FileSortInterface } from '@/app/types';\\r\\n\\r\\ninterface TopActionBarProps {\\r\\n  selectedFiles: string[];\\r\\n  onClearSelection: () => void;\\r\\n  onDownload: () => void;\\r\\n  onRename: () => void;\\r\\n  onMove: () => void;\\r\\n  onDelete: () => void;\\r\\n  onClearFilter: () => void;\\r\\n  onCreateFolder: () => void;\\r\\n  selectedFileType: string | null;\\r\\n  showSearchView: boolean;\\r\\n  isInRootFolder: boolean;\\r\\n  sortOrder: FileSortInterface;\\r\\n  setSortOrder: (order: FileSortInterface) => void;\\r\\n  showUploadDropdown: boolean;\\r\\n  setShowUploadDropdown: (show: boolean) => void;\\r\\n  setIsUploadModalOpen: (open: boolean) => void;\\r\\n  setIsFolderUploadModalOpen: (open: boolean) => void;\\r\\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\\r\\n}\\r\\n\\r\\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\\r\\n  selectedFiles,\\r\\n  onClearSelection,\\r\\n  onDownload,\\r\\n  onRename,\\r\\n  onMove,\\r\\n  onDelete,\\r\\n  onClearFilter,\\r\\n  onCreateFolder,\\r\\n  selectedFileType,\\r\\n  showSearchView,\\r\\n  isInRootFolder,\\r\\n  sortOrder,\\r\\n  setSortOrder,\\r\\n  showUploadDropdown,\\r\\n  setShowUploadDropdown,\\r\\n  setIsUploadModalOpen,\\r\\n  setIsFolderUploadModalOpen,\\r\\n  uploadDropdownRef\\r\\n}) => {\\r\\n  return (\\r\\n    <div className={styles.topBar}>\\r\\n      <div className={styles.buttonGroup}>\\r\\n        {selectedFiles.length > 0 ? (\\r\\n          <>\\r\\n            <button className={styles.topButton} onClick={onClearSelection}>\\r\\n              <X className=\\\"w-4 h-4\\\" />\\r\\n              å–æ¶ˆé€‰æ‹©\\r\\n            </button>\\r\\n            <button className={styles.topButton} onClick={onDownload}>\\r\\n              <Download className=\\\"w-4 h-4\\\" />\\r\\n              ä¸‹è½½\\r\\n            </button>\\r\\n            <button \\r\\n              className={styles.topButton}\\r\\n              onClick={onRename}\\r\\n            >\\r\\n              <Edit className=\\\"w-4 h-4\\\" />\\r\\n              é‡å‘½å\\r\\n            </button>\\r\\n            <button className={styles.topButton} onClick={onMove}>\\r\\n              <Move className=\\\"w-4 h-4\\\" />\\r\\n              ç§»åŠ¨\\r\\n            </button>\\r\\n            <button className={styles.topButton} onClick={onDelete}>\\r\\n              <Trash2 className=\\\"w-4 h-4\\\" />\\r\\n              åˆ é™¤\\r\\n            </button>\\r\\n          </>\\r\\n        ) : (\\r\\n          <>\\r\\n            <button \\r\\n              className={styles.topButton}\\r\\n              onClick={onClearFilter}\\r\\n              disabled={isInRootFolder}\\r\\n            >\\r\\n              <span>ğŸ“</span>\\r\\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\\r\\n            </button>\\r\\n\\r\\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\\r\\n            {selectedFileType && (\\r\\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\\r\\n                {(() => {\\r\\n                  switch(selectedFileType) {\\r\\n                    case 'image': return <ImageIcon className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'document': return <FileText className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'video': return <Video className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'audio': return <Music className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    case 'other': return <File className=\\\"w-4 h-4 mr-2\\\" />;\\r\\n                    default: return null;\\r\\n                  }\\r\\n                })()}\\r\\n                å½“å‰æµè§ˆï¼š\\r\\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\\r\\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\\r\\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\\r\\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\\r\\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\\r\\n              </div>\\r\\n            )}\\r\\n\\r\\n            {/* æ’åºä¸‹æ‹‰èœå• */}\\r\\n            <SortDropdown \\r\\n              sortOrder={sortOrder}\\r\\n              onSortChange={setSortOrder}\\r\\n            />\\r\\n            \\r\\n            {/* ä¸Šä¼ æŒ‰é’® */}\\r\\n            <UploadButton \\r\\n              showDropdown={showUploadDropdown}\\r\\n              setShowDropdown={setShowUploadDropdown}\\r\\n              setIsModalOpen={setIsUploadModalOpen}\\r\\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\\r\\n              uploadDropdownRef={uploadDropdownRef}\\r\\n            />\\r\\n            \\r\\n            <button \\r\\n              className={styles.folderButton} \\r\\n              onClick={onCreateFolder}\\r\\n            >\\r\\n              <FolderUp className=\\\"w-4 h-4 mr-2\\\" />\\r\\n              æ–°å»ºæ–‡ä»¶å¤¹\\r\\n            </button>\\r\\n          </>\\r\\n        )}\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default TopActionBar; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\MiniSidebar.tsx\",\n    \"newContent\": \"/**\\r\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\r\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/MiniSidebar ç»„ä»¶ã€‚\\r\\n */\\r\\n\\r\\nimport React from 'react';\\r\\nimport Image from 'next/image';\\r\\nimport { Home, LogOut, Palette } from 'lucide-react';\\r\\nimport styles from '../styles/shared.module.css';\\r\\n\\r\\ninterface MiniSidebarProps {\\r\\n  avatarUrl: string | null;\\r\\n  userName: string | null;\\r\\n  userEmail: string | null;\\r\\n  onHomeClick: () => void;\\r\\n  onLogoutClick: () => void;\\r\\n  onAvatarClick: () => void;\\r\\n  currentTheme?: string | null;\\r\\n  onThemeClick: () => void;\\r\\n}\\r\\n\\r\\nconst MiniSidebar: React.FC<MiniSidebarProps> = ({\\r\\n  avatarUrl,\\r\\n  userName,\\r\\n  userEmail,\\r\\n  onHomeClick,\\r\\n  onLogoutClick,\\r\\n  onAvatarClick,\\r\\n  currentTheme = 'default',\\r\\n  onThemeClick\\r\\n}) => {\\r\\n  return (\\r\\n    <div className={styles.miniSidebar}>\\r\\n      <div className={styles.patternOverlay}></div>\\r\\n      <div className={styles.avatarContainer}>\\r\\n        <button \\r\\n          className={styles.miniSidebarButton}\\r\\n          onClick={onAvatarClick}\\r\\n        >\\r\\n          {avatarUrl ? (\\r\\n            <Image\\r\\n              src={`${avatarUrl}?t=${Date.now()}`}\\r\\n              alt=\\\"ç”¨æˆ·å¤´åƒ\\\"\\r\\n              width={38}\\r\\n              height={38}\\r\\n              className=\\\"rounded-full ring-1 ring-white/50 transition-all duration-300 hover:ring-2\\\"\\r\\n            />\\r\\n          ) : (\\r\\n            <div \\r\\n              className={styles.avatarPlaceholder}\\r\\n              style={{ width: '38px', height: '38px', fontSize: '16px' }}\\r\\n            >\\r\\n              {userName?.[0]?.toUpperCase() || userEmail?.[0]?.toUpperCase() || '?'}\\r\\n            </div>\\r\\n          )}\\r\\n        </button>\\r\\n      </div>\\r\\n      <div className={styles.miniSidebarDivider}></div>\\r\\n      <button \\r\\n        className={styles.miniSidebarButton}\\r\\n        onClick={onHomeClick}\\r\\n      >\\r\\n        <Home className=\\\"w-5 h-5 text-white\\\" />\\r\\n      </button>\\r\\n      \\r\\n      {/* ä¸»é¢˜é€‰æ‹©æŒ‰é’® */}\\r\\n      <button \\r\\n        className={styles.miniSidebarButton}\\r\\n        onClick={onThemeClick}\\r\\n        title=\\\"ä¸»é¢˜è®¾ç½®\\\"\\r\\n      >\\r\\n        <Palette className=\\\"w-5 h-5 text-white\\\" />\\r\\n      </button>\\r\\n      \\r\\n      <button \\r\\n        className={styles.miniSidebarButton}\\r\\n        onClick={onLogoutClick}\\r\\n      >\\r\\n        <LogOut className=\\\"w-5 h-5 text-white\\\" />\\r\\n      </button>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default MiniSidebar; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\NewFolderForm.tsx\",\n    \"newContent\": \"/**\\r\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\r\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/folderManagement/NewFolderForm ç»„ä»¶ã€‚\\r\\n */\\r\\n\\r\\nimport React, { useRef, useState, useEffect } from 'react';\\r\\nimport { Folder, AlertCircle } from 'lucide-react';\\r\\nimport styles from '../styles/shared.module.css';\\r\\n\\r\\ninterface NewFolderFormProps {\\r\\n  folderName: string;\\r\\n  setFolderName: (name: string) => void;\\r\\n  folderTags: string[];\\r\\n  setFolderTags: (tags: string[]) => void;\\r\\n  onCreateFolder: () => void;\\r\\n  onCancel: () => void;\\r\\n}\\r\\n\\r\\nconst NewFolderForm: React.FC<NewFolderFormProps> = ({\\r\\n  folderName,\\r\\n  setFolderName,\\r\\n  folderTags,\\r\\n  setFolderTags,\\r\\n  onCreateFolder,\\r\\n  onCancel\\r\\n}) => {\\r\\n  const [newTag, setNewTag] = useState('');\\r\\n  const [nameError, setNameError] = useState<string | null>(null);\\r\\n  const inputRef = useRef<HTMLInputElement>(null);\\r\\n\\r\\n  // æ£€æŸ¥æ–‡ä»¶å¤¹åç§°æ˜¯å¦æœ‰æ•ˆ\\r\\n  useEffect(() => {\\r\\n    const trimmedName = folderName.trim();\\r\\n    \\r\\n    if (trimmedName === '') {\\r\\n      setNameError(null); // ç©ºåç§°ä¸æ˜¾ç¤ºé”™è¯¯ï¼Œä½†åˆ›å»ºæŒ‰é’®ä¼šå¤„ç†\\r\\n      return;\\r\\n    }\\r\\n\\r\\n    // æ£€æŸ¥ç‰¹æ®Šå­—ç¬¦\\r\\n    const invalidChars = /[\\\\/\\\\\\\\:*?\\\"<>|]/;\\r\\n    if (invalidChars.test(trimmedName)) {\\r\\n      setNameError('æ–‡ä»¶å¤¹åç§°ä¸èƒ½åŒ…å«ä¸‹åˆ—å­—ç¬¦: / \\\\\\\\ : * ? \\\" < > |');\\r\\n      return;\\r\\n    }\\r\\n\\r\\n    setNameError(null);\\r\\n  }, [folderName]);\\r\\n\\r\\n  // å¤„ç†å›è½¦é”®åˆ›å»ºæ–‡ä»¶å¤¹\\r\\n  const handleKeyDown = (e: React.KeyboardEvent) => {\\r\\n    if (e.key === 'Enter' && !nameError && folderName.trim()) {\\r\\n      onCreateFolder();\\r\\n    }\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    <div className={`${styles.newFolderRow} p-4 border border-gray-200 rounded-lg bg-white shadow-sm mb-4`}>\\r\\n      <div className={`${styles.newFolderForm} flex flex-col space-y-4`}>\\r\\n        <div className={`flex items-center`}>\\r\\n          <Folder className=\\\"w-6 h-6 text-blue-500 flex-shrink-0 mr-3\\\" />\\r\\n          <div className={`${styles.newFolderNameContainer} flex-grow relative`}>\\r\\n            <input\\r\\n              type=\\\"text\\\"\\r\\n              ref={inputRef}\\r\\n              className={`${styles.newFolderInput} h-10 px-3 rounded-md border ${nameError ? 'border-red-500' : 'border-gray-300'} w-full text-base`}\\r\\n              value={folderName}\\r\\n              onChange={(e) => setFolderName(e.target.value)}\\r\\n              placeholder=\\\"æ–°æ–‡ä»¶å¤¹åç§°\\\"\\r\\n              autoFocus\\r\\n              onKeyDown={handleKeyDown}\\r\\n            />\\r\\n            {nameError && (\\r\\n              <div className=\\\"text-red-500 text-xs mt-1 flex items-center\\\">\\r\\n                <AlertCircle className=\\\"w-3 h-3 mr-1\\\" />\\r\\n                <span>{nameError}</span>\\r\\n              </div>\\r\\n            )}\\r\\n            {!nameError && (\\r\\n              <div className=\\\"text-gray-500 text-xs mt-1\\\">\\r\\n                ç›¸åŒç›®å½•ä¸‹ä¸èƒ½å­˜åœ¨åŒåæ–‡ä»¶å¤¹\\r\\n              </div>\\r\\n            )}\\r\\n          </div>\\r\\n        </div>\\r\\n        \\r\\n        <div className={`${styles.newFolderTagsContainer} ml-9`}>\\r\\n          <label className=\\\"block text-sm font-medium text-gray-700 mb-1\\\">æ·»åŠ æ ‡ç­¾</label>\\r\\n          <div className={`${styles.tagsWrapper} h-10 flex items-center flex-wrap gap-2 border border-gray-300 rounded-md px-3 py-1 overflow-y-auto`}>\\r\\n            {folderTags.map((tag, index) => (\\r\\n              <div key={index} className={`${styles.tagItem} h-7 flex items-center bg-blue-100 text-blue-800 px-2 rounded-md`}>\\r\\n                <span className=\\\"text-sm\\\">{tag}</span>\\r\\n                <button\\r\\n                  className={`${styles.removeTagButton} ml-1 text-blue-600 hover:text-blue-800 w-5 h-5 flex items-center justify-center rounded-full hover:bg-blue-200`}\\r\\n                  onClick={() => {\\r\\n                    const updatedTags = [...folderTags];\\r\\n                    updatedTags.splice(index, 1);\\r\\n                    setFolderTags(updatedTags);\\r\\n                  }}\\r\\n                >\\r\\n                  Ã—\\r\\n                </button>\\r\\n              </div>\\r\\n            ))}\\r\\n            <input\\r\\n              type=\\\"text\\\"\\r\\n              className={`${styles.tagInput} flex-grow h-7 border-0 outline-none text-sm bg-transparent`}\\r\\n              value={newTag}\\r\\n              onChange={(e) => setNewTag(e.target.value)}\\r\\n              onKeyDown={(e) => {\\r\\n                if (e.key === 'Enter' && newTag.trim()) {\\r\\n                  setFolderTags([...folderTags, newTag.trim()]);\\r\\n                  setNewTag('');\\r\\n                  e.preventDefault();\\r\\n                }\\r\\n              }}\\r\\n              placeholder=\\\"æ·»åŠ æ ‡ç­¾...\\\"\\r\\n            />\\r\\n          </div>\\r\\n        </div>\\r\\n        \\r\\n        <div className={`${styles.newFolderActions} flex items-center gap-3 ml-9`}>\\r\\n          <button \\r\\n            className={`${styles.confirmButton} h-10 px-4 ${nameError || !folderName.trim() ? 'bg-blue-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600'} text-white rounded-md flex items-center justify-center`}\\r\\n            onClick={onCreateFolder}\\r\\n            disabled={!!nameError || !folderName.trim()}\\r\\n          >\\r\\n            åˆ›å»º\\r\\n          </button>\\r\\n          <button \\r\\n            className={`${styles.cancelButton} h-10 px-4 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-md flex items-center justify-center border border-gray-300`}\\r\\n            onClick={onCancel}\\r\\n          >\\r\\n            å–æ¶ˆ\\r\\n          </button>\\r\\n        </div>\\r\\n      </div>\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default NewFolderForm; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\RenameModal\\\\index.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileOperations/RenameModal ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useEffect, useRef } from 'react';\\nimport styles from '@/app/shared/themes/components/renameModal.module.css';\\nimport { CloseOutlined, TagOutlined, PlusOutlined } from '@ant-design/icons';\\n\\ninterface RenameModalProps {\\n  isOpen: boolean;\\n  onClose: () => void;\\n  onRename: (newName: string, tags?: string[]) => void;\\n  initialName: string;\\n  initialTags?: string[];\\n  fileType: 'file' | 'folder';\\n}\\n\\nconst RenameModal: React.FC<RenameModalProps> = ({\\n  isOpen,\\n  onClose,\\n  onRename,\\n  initialName,\\n  initialTags = [],\\n  fileType\\n}) => {\\n  const [newName, setNewName] = useState(initialName);\\n  const [tags, setTags] = useState<string[]>(initialTags);\\n  const [tagInput, setTagInput] = useState('');\\n  \\n  const inputRef = useRef<HTMLInputElement>(null);\\n  const tagInputRef = useRef<HTMLInputElement>(null);\\n  const modalRef = useRef<HTMLDivElement>(null);\\n\\n  useEffect(() => {\\n    setNewName(initialName);\\n    // ç¡®ä¿åˆå§‹æ ‡ç­¾ä¸åŒ…å«é‡å¤é¡¹\\n    setTags(Array.from(new Set(initialTags)));\\n  }, [initialName, initialTags]);\\n\\n  useEffect(() => {\\n    if (isOpen && inputRef.current) {\\n      // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†å¹¶é€‰ä¸­æ–‡ä»¶åï¼ˆä¸åŒ…æ‹¬æ‰©å±•åï¼‰\\n      inputRef.current.focus();\\n      \\n      const extension = fileType === 'file' ? initialName.lastIndexOf('.') : -1;\\n      if (extension !== -1) {\\n        inputRef.current.setSelectionRange(0, extension);\\n      } else {\\n        inputRef.current.select();\\n      }\\n    }\\n  }, [isOpen, initialName, fileType]);\\n\\n  useEffect(() => {\\n    const handleClickOutside = (event: MouseEvent) => {\\n      if (modalRef.current && !modalRef.current.contains(event.target as Node)) {\\n        onClose();\\n      }\\n    };\\n\\n    if (isOpen) {\\n      document.addEventListener('mousedown', handleClickOutside);\\n    }\\n    \\n    return () => {\\n      document.removeEventListener('mousedown', handleClickOutside);\\n    };\\n  }, [isOpen, onClose]);\\n\\n  const handleSubmit = (e: React.FormEvent) => {\\n    e.preventDefault();\\n    // é¦–å…ˆç¡®ä¿æ–°åç§°æ˜¯æœ‰æ•ˆçš„éç©ºå­—ç¬¦ä¸²\\n    if (newName && typeof newName === 'string' && newName.trim() && \\n        (newName !== initialName || JSON.stringify(tags) !== JSON.stringify(initialTags))) {\\n      onRename(newName, tags);\\n    } else if (!newName || !newName.trim()) {\\n      // å¦‚æœåç§°ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä½†ä¸å…³é—­æ¨¡æ€æ¡†\\n      return;\\n    }\\n    onClose();\\n  };\\n\\n  const handleAddTag = () => {\\n    if (!tagInput.trim()) return;\\n    \\n    // é¿å…æ·»åŠ é‡å¤æ ‡ç­¾\\n    if (!tags.includes(tagInput.trim())) {\\n      setTags([...tags, tagInput.trim()]);\\n    }\\n    \\n    setTagInput('');\\n    \\n    // æ·»åŠ åè‡ªåŠ¨èšç„¦å›æ ‡ç­¾è¾“å…¥æ¡†\\n    setTimeout(() => {\\n      if (tagInputRef.current) {\\n        tagInputRef.current.focus();\\n      }\\n    }, 0);\\n  };\\n\\n  const handleRemoveTag = (tagToRemove: string) => {\\n    setTags(tags.filter(tag => tag !== tagToRemove));\\n  };\\n\\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\\n    if (e.key === 'Enter') {\\n      e.preventDefault();\\n      handleAddTag();\\n    }\\n  };\\n\\n  if (!isOpen) return null;\\n\\n  return (\\n    <div className={styles['modal-overlay']}>\\n      <div ref={modalRef} className={`${styles['modal-content']} ${styles['rename-modal']}`}>\\n        <div className={styles['modal-header']}>\\n          <h3 className={styles['modal-title']}>\\n            {fileType === 'folder' ? 'é‡å‘½åæ–‡ä»¶å¤¹' : 'é‡å‘½åæ–‡ä»¶'}\\n          </h3>\\n          <button \\n            className={styles['modal-close']} \\n            onClick={onClose}\\n            aria-label=\\\"å…³é—­\\\"\\n          >\\n            <CloseOutlined />\\n          </button>\\n        </div>\\n        \\n        <form className={styles['rename-form']} onSubmit={handleSubmit}>\\n          <div className={styles['form-group']}>\\n            <label className={styles['form-label']}>åç§°</label>\\n            <input\\n              ref={inputRef}\\n              type=\\\"text\\\"\\n              className={styles['rename-input']}\\n              value={newName}\\n              onChange={(e) => setNewName(e.target.value)}\\n              placeholder=\\\"è¾“å…¥æ–°åç§°\\\"\\n              autoFocus\\n            />\\n          </div>\\n          \\n          <div className={styles['form-group']}>\\n            <label className={styles['form-label']}>æ ‡ç­¾</label>\\n            <div className={styles['tags-container']}>\\n              {tags.map((tag, index) => (\\n                <div key={index} className={styles['tag']}>\\n                  <span>{tag}</span>\\n                  <button \\n                    type=\\\"button\\\"\\n                    className={styles['tag-remove']}\\n                    onClick={() => handleRemoveTag(tag)}\\n                  >\\n                    &times;\\n                  </button>\\n                </div>\\n              ))}\\n            </div>\\n            <div className={styles['tag-input-container']}>\\n              <TagOutlined className={styles['tag-icon']} />\\n              <input\\n                ref={tagInputRef}\\n                type=\\\"text\\\"\\n                className={styles['tag-input']}\\n                value={tagInput}\\n                onChange={(e) => setTagInput(e.target.value)}\\n                onKeyDown={handleTagInputKeyDown}\\n                placeholder=\\\"è¾“å…¥æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ \\\"\\n              />\\n              <button\\n                type=\\\"button\\\"\\n                className={styles['tag-add-button']}\\n                onClick={handleAddTag}\\n                disabled={!tagInput.trim()}\\n              >\\n                <PlusOutlined />\\n              </button>\\n            </div>\\n          </div>\\n\\n          <div className={styles['modal-footer']}>\\n            <button \\n              type=\\\"button\\\" \\n              className={`${styles['modal-button']} ${styles.cancel}`}\\n              onClick={onClose}\\n            >\\n              å–æ¶ˆ\\n            </button>\\n            <button \\n              type=\\\"submit\\\" \\n              className={`${styles['modal-button']} ${styles.confirm}`}\\n              disabled={!newName.trim() || (newName === initialName && JSON.stringify(tags) === JSON.stringify(initialTags))}\\n            >\\n              ç¡®è®¤\\n            </button>\\n          </div>\\n        </form>\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport default RenameModal; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\Breadcrumb.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Breadcrumb ç»„ä»¶ã€‚\\n */\\n\\nimport React from 'react';\\nimport { Home, ChevronRight, ChevronLeft } from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\nimport { FolderPathItem } from '@/app/types';\\n\\ninterface BreadcrumbProps {\\n  folderPath: FolderPathItem[];\\n  showHome?: boolean;\\n  onNavigate?: (folderId: string | null) => void;\\n  onPathClick: (folderId: string | null) => void;\\n  onBackClick?: () => void;\\n}\\n\\nexport function Breadcrumb({ \\n  folderPath, \\n  showHome = true, \\n  onNavigate, \\n  onPathClick,\\n  onBackClick\\n}: BreadcrumbProps) {\\n  // å‘ä¸‹å…¼å®¹ï¼šå¦‚æœæœ‰onNavigateä½†æ²¡æœ‰onPathClickï¼Œå°±ä½¿ç”¨onNavigate\\n  const handlePathClick = onPathClick || onNavigate;\\n\\n  if (!handlePathClick) {\\n    console.error('Breadcrumbç»„ä»¶ç¼ºå°‘å¿…è¦çš„onPathClickæˆ–onNavigateå›è°ƒå‡½æ•°');\\n    return null;\\n  }\\n\\n  return (\\n    <div className={styles.breadcrumb}>\\n      {onBackClick && folderPath.length > 0 && (\\n        <button \\n          className={styles.breadcrumbBackButton}\\n          onClick={onBackClick}\\n          title=\\\"è¿”å›ä¸Šä¸€çº§\\\"\\n        >\\n          <ChevronLeft size={16} />\\n        </button>\\n      )}\\n      \\n      {showHome && (\\n        <div className={styles.breadcrumbItem}>\\n          <button\\n            className={styles.breadcrumbLink}\\n            onClick={() => handlePathClick(null)}\\n          >\\n            <Home size={16} className={styles.breadcrumbIcon} />\\n            æ ¹ç›®å½•\\n          </button>\\n        </div>\\n      )}\\n      \\n      {folderPath.map((folder) => (\\n        <React.Fragment key={folder.id}>\\n          <span className={styles.breadcrumbSeparator}>\\n            <ChevronRight size={14} />\\n          </span>\\n          <div className={styles.breadcrumbItem}>\\n            <button\\n              className={styles.breadcrumbLink}\\n              onClick={() => handlePathClick(folder.id)}\\n            >\\n              {folder.name}\\n            </button>\\n          </div>\\n        </React.Fragment>\\n      ))}\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\ErrorDisplay.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/ErrorDisplay ç»„ä»¶ã€‚\\n */\\n\\n'use client';\\n\\nimport React from 'react';\\nimport { AlertTriangle, RefreshCw, Wifi, Server, CloudOff } from 'lucide-react';\\nimport styles from '../../../../file-management/styles/shared.module.css';\\n\\ninterface ErrorDisplayProps {\\n  title?: string;\\n  message?: string;\\n  errorType?: 'network' | 'auth' | 'server' | 'data' | 'timeout' | 'unknown';\\n  onRetry?: () => void;\\n  retryText?: string;\\n}\\n\\n/**\\n * æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼Œæ”¯æŒä¸åŒç±»å‹çš„é”™è¯¯\\n */\\nexport const ErrorDisplay: React.FC<ErrorDisplayProps> = ({\\n  title,\\n  message = 'è¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜',\\n  errorType = 'unknown',\\n  onRetry,\\n  retryText = 'é‡è¯•'\\n}) => {\\n  // æ ¹æ®é”™è¯¯ç±»å‹è·å–å›¾æ ‡å’Œæ ‡é¢˜\\n  const getErrorInfo = () => {\\n    switch (errorType) {\\n      case 'network':\\n        return {\\n          icon: <Wifi className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'ç½‘ç»œè¿æ¥é”™è¯¯'\\n        };\\n      case 'auth':\\n        return {\\n          icon: <AlertTriangle className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'èº«ä»½éªŒè¯å¤±è´¥'\\n        };\\n      case 'server':\\n        return {\\n          icon: <Server className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'æœåŠ¡å™¨é”™è¯¯'\\n        };\\n      case 'data':\\n        return {\\n          icon: <CloudOff className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'æ•°æ®åŠ è½½å¤±è´¥'\\n        };\\n      case 'timeout':\\n        return {\\n          icon: <AlertTriangle className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'è¯·æ±‚è¶…æ—¶'\\n        };\\n      default:\\n        return {\\n          icon: <AlertTriangle className=\\\"w-12 h-12 text-red-500\\\" />,\\n          defaultTitle: 'åŠ è½½å‡ºé”™'\\n        };\\n    }\\n  };\\n\\n  const { icon, defaultTitle } = getErrorInfo();\\n  const displayTitle = title || defaultTitle;\\n\\n  return (\\n    <div className={styles.errorContainer}>\\n      <div className={styles.errorCard}>\\n        <div className={styles.errorIcon}>\\n          {icon}\\n        </div>\\n        <h3 className={styles.errorTitle}>{displayTitle}</h3>\\n        <p className={styles.errorText}>{message}</p>\\n        {onRetry && (\\n          <button \\n            className={styles.retryButton}\\n            onClick={onRetry}\\n          >\\n            <RefreshCw className=\\\"w-4 h-4\\\" />\\n            {retryText}\\n          </button>\\n        )}\\n      </div>\\n    </div>\\n  );\\n}; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\FileList.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/fileList/FileList ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useRef, useEffect } from 'react';\\nimport { \\n  File as FileIcon, \\n  Folder, \\n  Image as ImageIcon, \\n  FileText, \\n  Video, \\n  Music, \\n  MoreVertical,\\n  Tag as TagIcon,\\n  SearchX,\\n  Filter,\\n  Check,\\n  X,\\n  Plus\\n} from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\nimport { getFileType as getFileTypeDisplay } from '@/app/utils/file/type';\\nimport { getFileNameAndExtension } from '@/app/utils/file/path';\\nimport { FileInfo } from '@/app/types';\\n\\ninterface FileListProps {\\n  files: FileInfo[];\\n  selectedFiles: string[];\\n  onFileClick: (file: FileInfo) => void;\\n  onFileDoubleClick?: (file: FileInfo) => void;\\n  onFileContextMenu?: (event: React.MouseEvent, file: FileInfo) => void;\\n  onSelectFiles?: (fileIds: string[]) => void;\\n  onFileSelect?: (file: FileInfo, checked: boolean) => void;\\n  onSelectAll?: () => void;\\n  onDeselectAll?: () => void;\\n  onSelectAllFiles?: () => void;\\n  onDeselectAllFiles?: () => void;\\n  fileTypeFilter?: string | null;\\n  isLoading?: boolean;\\n  error?: string | null;\\n  onBackClick?: () => void;\\n  editingFileId?: string | null;\\n  editingFile?: string | null;\\n  editingName?: string;\\n  editingTags?: string[];\\n  newTag?: string;\\n  onNewTagChange?: (value: string) => void;\\n  onEditNameChange?: (value: string) => void;\\n  onStartEdit?: (file: FileInfo) => void;\\n  onConfirmEdit?: (fileId: string, newName: string, newTags: string[]) => void;\\n  onCancelEdit?: () => void;\\n  onAddTag?: (tag: string) => void;\\n  onRemoveTag?: (tag: string) => void;\\n  showCheckboxes?: boolean;\\n  areAllSelected?: boolean;\\n}\\n\\nexport function FileList({\\n  files,\\n  selectedFiles,\\n  onFileClick,\\n  onFileDoubleClick,\\n  onFileContextMenu,\\n  onSelectFiles,\\n  onFileSelect,\\n  onSelectAll,\\n  onDeselectAll,\\n  onSelectAllFiles,\\n  onDeselectAllFiles,\\n  fileTypeFilter,\\n  isLoading,\\n  error,\\n  onBackClick,\\n  editingFileId,\\n  editingFile,\\n  editingName: providedEditingName,\\n  editingTags: providedEditingTags,\\n  newTag: providedNewTag,\\n  onNewTagChange,\\n  onEditNameChange,\\n  onStartEdit,\\n  onConfirmEdit,\\n  onCancelEdit,\\n  onAddTag,\\n  onRemoveTag,\\n  showCheckboxes = true,\\n  areAllSelected\\n}: FileListProps) {\\n  const actualEditingFileId = editingFileId || editingFile;\\n\\n  const [localEditName, setLocalEditName] = useState<string>('');\\n  const [localEditTags, setLocalEditTags] = useState<string[]>([]);\\n  const [localNewTag, setLocalNewTag] = useState<string>('');\\n  \\n  const editName = providedEditingName !== undefined ? providedEditingName : localEditName;\\n  const editTags = providedEditingTags !== undefined ? providedEditingTags : localEditTags;\\n  const newTagValue = providedNewTag !== undefined ? providedNewTag : localNewTag;\\n  \\n  const setEditName = (value: string) => {\\n    if (onEditNameChange) {\\n      onEditNameChange(value);\\n    } else {\\n      setLocalEditName(value);\\n    }\\n  };\\n  \\n  const setEditTags = (tags: string[]) => {\\n    setLocalEditTags(tags);\\n  };\\n  \\n  const setNewTag = (value: string) => {\\n    if (onNewTagChange) {\\n      onNewTagChange(value);\\n    } else {\\n      setLocalNewTag(value);\\n    }\\n  };\\n\\n  const editNameInputRef = useRef<HTMLInputElement>(null);\\n  const newTagInputRef = useRef<HTMLInputElement>(null);\\n\\n  useEffect(() => {\\n    if (actualEditingFileId && providedEditingName === undefined) {\\n      const file = files.find(f => f.id === actualEditingFileId);\\n      if (file) {\\n        setLocalEditName(file.name);\\n        setLocalEditTags(file.tags || []);\\n      }\\n    }\\n    \\n    if (actualEditingFileId) {\\n      setTimeout(() => {\\n        if (editNameInputRef.current) {\\n          editNameInputRef.current.focus();\\n          editNameInputRef.current.select();\\n        }\\n      }, 0);\\n    }\\n  }, [actualEditingFileId, files, providedEditingName]);\\n\\n  const handleEditKeyDown = (e: React.KeyboardEvent, fileId: string) => {\\n    if (e.key === 'Enter') {\\n      e.preventDefault();\\n      onConfirmEdit && onConfirmEdit(fileId, editName, editTags);\\n    } else if (e.key === 'Escape') {\\n      e.preventDefault();\\n      onCancelEdit && onCancelEdit();\\n    }\\n  };\\n\\n  const handleAddTag = () => {\\n    const trimmedTag = newTagValue.trim();\\n    if (!trimmedTag) return;\\n    \\n    if (!editTags.includes(trimmedTag)) {\\n      if (onAddTag) {\\n        onAddTag(trimmedTag);\\n      } else {\\n        setEditTags([...editTags, trimmedTag]);\\n      }\\n      setNewTag('');\\n      \\n      setTimeout(() => {\\n        if (newTagInputRef.current) {\\n          newTagInputRef.current.focus();\\n        }\\n      }, 0);\\n    }\\n  };\\n\\n  const handleRemoveTag = (tagToRemove: string) => {\\n    if (onRemoveTag) {\\n      onRemoveTag(tagToRemove);\\n    } else {\\n      setEditTags(editTags.filter(tag => tag !== tagToRemove));\\n    }\\n  };\\n\\n  const handleTagKeyDown = (e: React.KeyboardEvent) => {\\n    if (e.key === 'Enter') {\\n      e.preventDefault();\\n      handleAddTag();\\n    }\\n  };\\n\\n  const handleFileCheckboxChange = (file: FileInfo, checked: boolean) => {\\n    if (onFileSelect) {\\n      onFileSelect(file, checked);\\n      return;\\n    }\\n    \\n    if (onSelectFiles) {\\n      if (checked) {\\n        onSelectFiles([...selectedFiles, file.id]);\\n      } else {\\n        onSelectFiles(selectedFiles.filter(id => id !== file.id));\\n      }\\n    } else {\\n      console.error('FileList: ç¼ºå°‘å¿…è¦çš„onSelectFilesæˆ–onFileSelectå›è°ƒå‡½æ•°');\\n    }\\n  };\\n\\n  const handleSelectAll = onSelectAll || onSelectAllFiles;\\n  const handleDeselectAll = onDeselectAll || onDeselectAllFiles;\\n\\n  const renderFileIcon = (type?: string, extension?: string, isFolder?: boolean) => {\\n    if (isFolder) return <Folder className={styles.fileIcon} />;\\n    \\n    const getFileIconType = () => {\\n      if (!type) return 'file';\\n      \\n      if (type.includes('image')) return 'image';\\n      if (type.includes('text') || type.includes('document') || extension?.match(/docx?|pdf|txt|md/i)) return 'file-text';\\n      if (type.includes('video')) return 'video';\\n      if (type.includes('audio')) return 'music';\\n      if (extension?.match(/zip|rar|7z|tar|gz/i)) return 'archive';\\n      if (extension?.match(/js|ts|jsx|tsx|py|java|c|cpp|go|rb|php|html|css/i)) return 'code';\\n      \\n      return 'file';\\n    };\\n    \\n    const iconType = getFileIconType();\\n    const IconComponent = {\\n      'folder': Folder,\\n      'file': FileIcon,\\n      'image': ImageIcon,\\n      'file-text': FileText,\\n      'video': Video,\\n      'music': Music,\\n      'archive': FileIcon,\\n      'code': FileIcon\\n    }[iconType] || FileIcon;\\n\\n    return <IconComponent className={styles.fileIcon} />;\\n  };\\n\\n  const renderTags = (file: FileInfo) => {\\n    const tags = file.tags || [];\\n    \\n    if (actualEditingFileId === file.id) {\\n      return (\\n        <div className={styles.tagEditContainer}>\\n          <div className={styles.editTagsList}>\\n            {editTags.map((tag, index) => (\\n              <div key={index} className={styles.editTag}>\\n                <span>{tag}</span>\\n                <button \\n                  className={styles.removeTagButton}\\n                  onClick={() => handleRemoveTag(tag)}\\n                >\\n                  <X size={12} />\\n                </button>\\n              </div>\\n            ))}\\n          </div>\\n          <div className={styles.addTagInput}>\\n            <input\\n              ref={newTagInputRef}\\n              type=\\\"text\\\"\\n              placeholder=\\\"æ·»åŠ æ ‡ç­¾...\\\"\\n              value={localNewTag}\\n              onChange={(e) => setNewTag(e.target.value)}\\n              onKeyDown={handleTagKeyDown}\\n              className={styles.tagInput}\\n            />\\n            <button \\n              className={styles.addTagButton}\\n              onClick={handleAddTag}\\n            >\\n              <Plus size={14} />\\n            </button>\\n          </div>\\n        </div>\\n      );\\n    }\\n    \\n    if (!tags || tags.length === 0) return <span className={styles.emptyText}>-</span>;\\n    \\n    const maxTagsToShow = 3;\\n    const visibleTags = tags.slice(0, maxTagsToShow);\\n    const extraTagsCount = tags.length - maxTagsToShow;\\n    \\n    return (\\n      <div className={styles.tagContainer}>\\n        {visibleTags.map((tag, index) => (\\n          <span key={index} className={styles.tag}>\\n            {tag}\\n          </span>\\n        ))}\\n        {extraTagsCount > 0 && (\\n          <span className={styles.extraTagsCount}>+{extraTagsCount}</span>\\n        )}\\n      </div>\\n    );\\n  };\\n\\n  const isAllSelected = areAllSelected !== undefined \\n    ? areAllSelected \\n    : (files.length > 0 && selectedFiles.length === files.length);\\n\\n  if (!Array.isArray(files) || files.length === 0) {\\n    const getEmptyStateMessage = () => {\\n      if (fileTypeFilter) {\\n        switch(fileTypeFilter) {\\n          case 'image':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶`;\\n          case 'document':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡æ¡£æ–‡ä»¶`;\\n          case 'video':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°è§†é¢‘æ–‡ä»¶`;\\n          case 'audio':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶`;\\n          case 'other':\\n            return `æ‚¨çš„å­˜å‚¨ç©ºé—´ä¸­æ²¡æœ‰æ‰¾åˆ°å…¶ä»–ç±»å‹çš„æ–‡ä»¶`;\\n          default:\\n            return `æ²¡æœ‰æ‰¾åˆ°${fileTypeFilter}ç±»å‹çš„æ–‡ä»¶`;\\n        }\\n      }\\n      return 'æ²¡æœ‰æ–‡ä»¶';\\n    };\\n\\n    const getEmptyStateIcon = () => {\\n      if (fileTypeFilter) {\\n        return <Filter size={50} stroke=\\\"#CBD5E0\\\" />;\\n      }\\n      return <FileIcon size={50} stroke=\\\"#CBD5E0\\\" />;\\n    };\\n\\n    const getEmptyStateHint = () => {\\n      if (fileTypeFilter) {\\n        return `ç³»ç»Ÿå·²æœç´¢æ‰€æœ‰æ–‡ä»¶å¤¹ï¼Œæœªæ‰¾åˆ°${\\n          fileTypeFilter === 'image' ? 'å›¾ç‰‡' : \\n          fileTypeFilter === 'document' ? 'æ–‡æ¡£' : \\n          fileTypeFilter === 'video' ? 'è§†é¢‘' :\\n          fileTypeFilter === 'audio' ? 'éŸ³é¢‘' : 'è¯¥ç±»å‹'\\n        }æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä¸Šä¼ ä¸€äº›ï¼Œæˆ–é€‰æ‹©å…¶ä»–æ–‡ä»¶ç±»å‹æŸ¥çœ‹ã€‚`;\\n      }\\n      return 'ä¸Šä¼ æ–‡ä»¶æˆ–åˆ›å»ºæ–‡ä»¶å¤¹ä»¥å¼€å§‹ç®¡ç†æ‚¨çš„æ–‡ä»¶';\\n    };\\n\\n    return (\\n      <div className={styles.emptyState}>\\n        {getEmptyStateIcon()}\\n        <p className={styles.emptyStateText}>{getEmptyStateMessage()}</p>\\n        <p className={styles.emptyStateHint}>\\n          {getEmptyStateHint()}\\n        </p>\\n      </div>\\n    );\\n  }\\n\\n  return (\\n    <div className={styles.fileListWrapper}>\\n      <div className={styles.fileListContainer}>\\n        <table className={styles.fileTable}>\\n          <thead>\\n            <tr>\\n              <th>\\n                <input\\n                  type=\\\"checkbox\\\"\\n                  checked={isAllSelected}\\n                  onChange={isAllSelected ? \\n                    () => handleDeselectAll && handleDeselectAll() : \\n                    () => handleSelectAll && handleSelectAll()}\\n                  disabled={!showCheckboxes}\\n                />\\n              </th>\\n              <th>åç§°</th>\\n              <th>ç±»å‹</th>\\n              <th>å¤§å°</th>\\n              <th>æ ‡ç­¾</th>\\n              <th>ä¿®æ”¹æ—¥æœŸ</th>\\n              <th>æ“ä½œ</th>\\n            </tr>\\n          </thead>\\n          <tbody>\\n            {files.map((file) => {\\n              const isSelected = selectedFiles.includes(file.id);\\n              const isEditing = actualEditingFileId === file.id;\\n              \\n              return (\\n                <tr\\n                  key={file.id}\\n                  className={`${styles.fileRow} ${isSelected ? styles.selectedRow : ''} ${isEditing ? styles.editingRow : ''}`}\\n                  onClick={() => !isEditing && onFileClick(file)}\\n                  onDoubleClick={() => {\\n                    if (!isEditing && onStartEdit && !file.isFolder) {\\n                      onStartEdit(file);\\n                    } else if (!isEditing && onFileDoubleClick) {\\n                      onFileDoubleClick(file);\\n                    }\\n                  }}\\n                  onContextMenu={(e) => !isEditing && onFileContextMenu && onFileContextMenu(e, file)}\\n                >\\n                  <td>\\n                    {showCheckboxes && (\\n                      <input\\n                        type=\\\"checkbox\\\"\\n                        checked={isSelected}\\n                        onChange={(e) => handleFileCheckboxChange(file, e.target.checked)}\\n                        onClick={(e) => e.stopPropagation()}\\n                        disabled={isEditing}\\n                      />\\n                    )}\\n                  </td>\\n                  <td className={styles.fileNameCell}>\\n                    <span className={styles.fileIcon}>\\n                      {renderFileIcon(file.type, file.extension, file.isFolder)}\\n                    </span>\\n                    {isEditing ? (\\n                      <input\\n                        ref={editNameInputRef}\\n                        type=\\\"text\\\"\\n                        className={styles.fileNameInput}\\n                        value={editName}\\n                        onChange={(e) => setEditName(e.target.value)}\\n                        onKeyDown={(e) => handleEditKeyDown(e, file.id)}\\n                        onClick={(e) => e.stopPropagation()}\\n                        autoComplete=\\\"off\\\"\\n                      />\\n                    ) : (\\n                      <span className={styles.fileName}>{file.name}</span>\\n                    )}\\n                    {isEditing && (\\n                      <div className={styles.editActions}>\\n                        <button \\n                          className={styles.editActionButton}\\n                          onClick={(e) => {\\n                            e.stopPropagation();\\n                            onConfirmEdit && onConfirmEdit(file.id, editName, editTags);\\n                          }}\\n                        >\\n                          <Check size={16} />\\n                        </button>\\n                        <button \\n                          className={styles.editActionButton}\\n                          onClick={(e) => {\\n                            e.stopPropagation();\\n                            onCancelEdit && onCancelEdit();\\n                          }}\\n                        >\\n                          <X size={16} />\\n                        </button>\\n                      </div>\\n                    )}\\n                  </td>\\n                  <td>{file.isFolder ? 'æ–‡ä»¶å¤¹' : \\n                     file.type === 'document' ? 'æ–‡æ¡£' : \\n                     getFileTypeDisplay(file.type || null, file.extension)}</td>\\n                  <td>{file.size ? `${Math.round(file.size / 1024)} KB` : '-'}</td>\\n                  <td className={styles.tagsCell}>{renderTags(file)}</td>\\n                  <td>\\n                    {file.createdAt \\n                      ? new Date(file.createdAt).toLocaleString() \\n                      : '-'\\n                    }\\n                  </td>\\n                  <td>\\n                    {!isEditing ? (\\n                      <button \\n                        className={styles.actionButton}\\n                        onClick={(e) => {\\n                          e.stopPropagation();\\n                          if (onStartEdit) {\\n                            onStartEdit(file);\\n                          } else if (onFileContextMenu) {\\n                            onFileContextMenu(e, file);\\n                          }\\n                        }}\\n                      >\\n                        <MoreVertical size={16} />\\n                      </button>\\n                    ) : (\\n                      <span className={styles.editingMessage}>ç¼–è¾‘ä¸­</span>\\n                    )}\\n                  </td>\\n                </tr>\\n              );\\n            })}\\n          </tbody>\\n        </table>\\n      </div>\\n    </div>\\n  );\\n}\"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\index.ts\",\n    \"newContent\": \"export * from './Sidebar';\\nexport * from './Breadcrumb';\\nexport * from './FileList';\\n// export * from './UploadModal'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadModal\\n// export * from './UploadButton'; // å·²è¿ç§»åˆ° @/app/components/features/file-management/upload/UploadButton\\nexport * from './Skeleton';\\nexport * from './ErrorDisplay'; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\Sidebar.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/navigation/Sidebar ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useEffect } from 'react';\\nimport { \\n  Folder, Files, Image as ImageIcon, FileText, \\n  Video, Music, File, Search, ChevronDown, \\n  Star, Clock, Tag, Download, Settings,\\n  CheckCircle\\n} from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\n\\nexport type FileType = 'image' | 'document' | 'video' | 'audio' | 'other' | null;\\n\\ninterface SidebarProps {\\n  selectedFileType: FileType;\\n  onTypeClick: (type: FileType) => void;\\n  onSearchClick?: () => void;\\n}\\n\\nexport function Sidebar({ selectedFileType, onTypeClick, onSearchClick }: SidebarProps) {\\n  const fileTypes: { type: FileType; label: string; icon: React.ElementType }[] = [\\n    { type: null, label: 'å…¨éƒ¨æ–‡ä»¶', icon: Files },\\n    { type: 'image', label: 'å›¾ç‰‡', icon: ImageIcon },\\n    { type: 'document', label: 'æ–‡æ¡£', icon: FileText },\\n    { type: 'video', label: 'è§†é¢‘', icon: Video },\\n    { type: 'audio', label: 'éŸ³é¢‘', icon: Music },\\n    { type: 'other', label: 'å…¶ä»–', icon: File }\\n  ];\\n\\n  const [quickAccessExpanded, setQuickAccessExpanded] = React.useState(true);\\n  const [myFilesExpanded, setMyFilesExpanded] = React.useState(true);\\n  const [settingsExpanded, setSettingsExpanded] = React.useState(false);\\n\\n  // ç›‘å¬æ–‡ä»¶ç±»å‹å˜åŒ–å¹¶è®°å½•æ—¥å¿—\\n  useEffect(() => {\\n    console.log('ä¾§è¾¹æ ï¼šå½“å‰é€‰æ‹©çš„æ–‡ä»¶ç±»å‹:', selectedFileType);\\n  }, [selectedFileType]);\\n\\n  const handleTypeClick = (type: FileType) => {\\n    // ç›´æ¥è°ƒç”¨å›è°ƒï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–é€»è¾‘\\n    console.log('Sidebarç›´æ¥ç‚¹å‡»ç±»å‹:', type);\\n    onTypeClick(type);\\n  };\\n\\n  return (\\n    <div className={styles.sidebar}>\\n      <div className={styles.sidebarSection}>\\n        <div \\n          className={styles.sidebarHeader} \\n          onClick={() => setMyFilesExpanded(!myFilesExpanded)}\\n        >\\n          <Folder className={styles.icon} />\\n          æˆ‘çš„æ–‡ä»¶\\n          <ChevronDown \\n            className={styles.icon} \\n            style={{ \\n              marginLeft: 'auto', \\n              transform: myFilesExpanded ? 'rotate(180deg)' : 'rotate(0)', \\n              transition: 'transform 0.3s' \\n            }} \\n            size={16} \\n          />\\n        </div>\\n        {myFilesExpanded && (\\n          <div className={styles.sidebarSubmenu}>\\n            {fileTypes.map(({ type, label, icon: Icon }) => (\\n              <div\\n                key={type || 'all'}\\n                className={`${styles.sidebarItem} ${selectedFileType === type ? styles.active : ''}`}\\n                onClick={() => handleTypeClick(type)}\\n              >\\n                <Icon className={styles.icon} />\\n                {label}\\n                {selectedFileType === type && (\\n                  <CheckCircle \\n                    className={styles.icon} \\n                    style={{ \\n                      marginLeft: 'auto', \\n                      color: 'var(--theme-primary, #3b82f6)',\\n                      fill: 'var(--theme-primary, #3b82f6)',\\n                      stroke: '#fff',\\n                      opacity: 0.9,\\n                    }} \\n                    size={16} \\n                  />\\n                )}\\n              </div>\\n            ))}\\n          </div>\\n        )}\\n      </div>\\n\\n      <div className={styles.sidebarSection}>\\n        <div \\n          className={styles.sidebarHeader}\\n          onClick={() => setQuickAccessExpanded(!quickAccessExpanded)}\\n        >\\n          <Search className={styles.icon} />\\n          å¿«æ·æŸ¥è¯¢\\n          <ChevronDown \\n            className={styles.icon} \\n            style={{ \\n              marginLeft: 'auto', \\n              transform: quickAccessExpanded ? 'rotate(180deg)' : 'rotate(0)', \\n              transition: 'transform 0.3s' \\n            }} \\n            size={16} \\n          />\\n        </div>\\n        {quickAccessExpanded && (\\n          <div className={styles.sidebarSubmenu}>\\n            <div \\n              className={styles.sidebarItem}\\n              onClick={onSearchClick}\\n            >\\n              <Search className={styles.icon} />\\n              æœç´¢æ–‡ä»¶\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Star className={styles.icon} />\\n              æ”¶è—æ–‡ä»¶\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Clock className={styles.icon} />\\n              æœ€è¿‘è®¿é—®\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Tag className={styles.icon} />\\n              æŒ‰æ ‡ç­¾æŸ¥æ‰¾\\n            </div>\\n            <div className={styles.sidebarItem}>\\n              <Download className={styles.icon} />\\n              ä¸‹è½½è®°å½•\\n            </div>\\n          </div>\\n        )}\\n      </div>\\n\\n      <div className={styles.sidebarSection}>\\n        <div \\n          className={styles.sidebarHeader}\\n          onClick={() => setSettingsExpanded(!settingsExpanded)}\\n        >\\n          <Settings className={styles.icon} />\\n          ç³»ç»Ÿè®¾ç½®\\n          <ChevronDown \\n            className={styles.icon} \\n            style={{ \\n              marginLeft: 'auto', \\n              transform: settingsExpanded ? 'rotate(180deg)' : 'rotate(0)', \\n              transition: 'transform 0.3s' \\n            }} \\n            size={16} \\n          />\\n        </div>\\n        {settingsExpanded && (\\n          <div className={styles.sidebarSubmenu}>\\n            <div className={styles.sidebarItem}>\\n              <Settings className={styles.icon} />\\n              å­˜å‚¨ç®¡ç†\\n            </div>\\n          </div>\\n        )}\\n      </div>\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\Skeleton.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/shared/Skeleton ç»„ä»¶ã€‚\\n */\\n\\n'use client';\\n\\nimport React from 'react';\\nimport styles from './Skeleton.module.css';\\n\\ninterface SkeletonProps {\\n  variant?: 'sidebar' | 'file' | 'avatar' | 'text' | 'button' | 'card';\\n  width?: string | number;\\n  height?: string | number;\\n  animation?: 'pulse' | 'wave' | 'none';\\n  count?: number;\\n  className?: string;\\n  borderRadius?: string;\\n}\\n\\nexport const Skeleton: React.FC<SkeletonProps> = ({ \\n  variant = 'text', \\n  width, \\n  height, \\n  animation = 'pulse',\\n  count = 1,\\n  className = '',\\n  borderRadius\\n}) => {\\n  const getVariantStyles = () => {\\n    switch (variant) {\\n      case 'sidebar':\\n        return {\\n          width: width || '100%',\\n          height: height || '40px',\\n          borderRadius: borderRadius || '8px'\\n        };\\n      case 'file':\\n        return {\\n          width: width || '100%',\\n          height: height || '56px',\\n          borderRadius: borderRadius || '8px'\\n        };\\n      case 'avatar':\\n        return {\\n          width: width || '40px',\\n          height: height || '40px',\\n          borderRadius: borderRadius || '50%'\\n        };\\n      case 'text':\\n        return {\\n          width: width || '100%',\\n          height: height || '16px',\\n          borderRadius: borderRadius || '4px'\\n        };\\n      case 'button':\\n        return {\\n          width: width || '120px',\\n          height: height || '36px',\\n          borderRadius: borderRadius || '6px'\\n        };\\n      case 'card':\\n        return {\\n          width: width || '100%',\\n          height: height || '200px',\\n          borderRadius: borderRadius || '12px'\\n        };\\n      default:\\n        return {\\n          width: width || '100%',\\n          height: height || '16px',\\n          borderRadius: borderRadius || '4px'\\n        };\\n    }\\n  };\\n\\n  const renderSkeleton = () => {\\n    const items = [];\\n    const baseStyles = getVariantStyles();\\n    \\n    for (let i = 0; i < count; i++) {\\n      items.push(\\n        <div \\n          key={i}\\n          className={`${styles.skeleton} ${styles[`animation-${animation}`]} ${className}`}\\n          style={{\\n            ...baseStyles,\\n            marginBottom: count > 1 && i < count - 1 ? '8px' : '0'\\n          }}\\n        />\\n      );\\n    }\\n    \\n    return items;\\n  };\\n\\n  return <>{renderSkeleton()}</>;\\n};\\n\\nexport const SkeletonFileList: React.FC = () => {\\n  return (\\n    <div className={styles.fileListSkeleton}>\\n      <div className={styles.fileListHeader}>\\n        <Skeleton variant=\\\"text\\\" width=\\\"15%\\\" height=\\\"24px\\\" />\\n        <div className={styles.headerActions}>\\n          <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n          <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n        </div>\\n      </div>\\n      \\n      <div className={styles.fileItems}>\\n        {[...Array(8)].map((_, index) => (\\n          <div key={index} className={styles.fileItemSkeleton}>\\n            <div className={styles.fileIcon}>\\n              <Skeleton variant=\\\"avatar\\\" width=\\\"32px\\\" height=\\\"32px\\\" borderRadius=\\\"6px\\\" />\\n            </div>\\n            <div className={styles.fileDetails}>\\n              <Skeleton variant=\\\"text\\\" width=\\\"60%\\\" height=\\\"18px\\\" />\\n              <Skeleton variant=\\\"text\\\" width=\\\"40%\\\" height=\\\"14px\\\" />\\n            </div>\\n            <div className={styles.fileActions}>\\n              <Skeleton variant=\\\"button\\\" width=\\\"70px\\\" />\\n            </div>\\n          </div>\\n        ))}\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport const SkeletonSidebar: React.FC = () => {\\n  return (\\n    <div className={styles.sidebarSkeleton}>\\n      <div className={styles.sidebarHeader}>\\n        <Skeleton variant=\\\"text\\\" width=\\\"70%\\\" height=\\\"24px\\\" />\\n      </div>\\n      <div className={styles.sidebarContent}>\\n        <Skeleton variant=\\\"sidebar\\\" count={5} />\\n        <div className={styles.sidebarSection}>\\n          <Skeleton variant=\\\"text\\\" width=\\\"50%\\\" height=\\\"18px\\\" />\\n          <Skeleton variant=\\\"sidebar\\\" count={3} />\\n        </div>\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport const SkeletonPageLayout: React.FC = () => {\\n  return (\\n    <div className={styles.pageLayoutSkeleton}>\\n      <div className={styles.miniSidebarSkeleton}>\\n        <Skeleton variant=\\\"avatar\\\" width=\\\"40px\\\" height=\\\"40px\\\" />\\n        <Skeleton variant=\\\"button\\\" width=\\\"40px\\\" height=\\\"40px\\\" borderRadius=\\\"12px\\\" />\\n        <Skeleton variant=\\\"button\\\" width=\\\"40px\\\" height=\\\"40px\\\" borderRadius=\\\"12px\\\" />\\n      </div>\\n      \\n      <div className={styles.sidebarContainerSkeleton}>\\n        <SkeletonSidebar />\\n      </div>\\n      \\n      <div className={styles.mainContentSkeleton}>\\n        <div className={styles.topBarSkeleton}>\\n          <div className={styles.breadcrumbSkeleton}>\\n            <Skeleton variant=\\\"text\\\" width=\\\"180px\\\" height=\\\"20px\\\" />\\n          </div>\\n          <div className={styles.actionButtonsSkeleton}>\\n            <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n            <Skeleton variant=\\\"button\\\" width=\\\"100px\\\" />\\n          </div>\\n        </div>\\n        \\n        <SkeletonFileList />\\n      </div>\\n    </div>\\n  );\\n}; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\UploadButton.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadButton ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useRef, useEffect } from 'react';\\nimport { Upload, Folder, ChevronDown } from 'lucide-react';\\nimport styles from '../../styles/shared.module.css';\\nimport { UploadModal } from './UploadModal';\\n\\ninterface UploadButtonProps {\\n  showDropdown: boolean;\\n  setShowDropdown: (show: boolean) => void;\\n  setIsModalOpen: (open: boolean) => void;\\n  setIsFolderModalOpen: (open: boolean) => void;\\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\\n}\\n\\nexport function UploadButton({ \\n  showDropdown, \\n  setShowDropdown, \\n  setIsModalOpen, \\n  setIsFolderModalOpen,\\n  uploadDropdownRef \\n}: UploadButtonProps) {\\n  \\n  // å¤„ç†ä¸Šä¼ æŒ‰é’®ç‚¹å‡»\\n  const handleUploadClick = (type: 'file' | 'folder') => {\\n    if (type === 'file') {\\n      setIsModalOpen(true);\\n    } else {\\n      setIsFolderModalOpen(true);\\n    }\\n    setShowDropdown(false);\\n  };\\n\\n  return (\\n    <div className={styles.uploadOptionsContainer} ref={uploadDropdownRef}>\\n      <button\\n        className={`${styles.uploadButton} ${showDropdown ? styles.activeButton : ''}`}\\n        onClick={() => setShowDropdown(!showDropdown)}\\n      >\\n        <Upload size={18} className={styles.buttonIcon} />\\n        ä¸Šä¼ æ–‡ä»¶\\n        <ChevronDown size={16} className={styles.dropdownIcon} />\\n      </button>\\n      \\n      {showDropdown && (\\n        <div className={styles.dropdownMenu}>\\n          <div \\n            className={styles.dropdownItem}\\n            onClick={() => handleUploadClick('file')}\\n          >\\n            <Upload size={16} className=\\\"mr-2\\\" />\\n            <span>ä¸Šä¼ æ–‡ä»¶</span>\\n          </div>\\n          <div \\n            className={styles.dropdownItem}\\n            onClick={() => handleUploadClick('folder')}\\n          >\\n            <Folder size={16} className=\\\"mr-2\\\" />\\n            <span>ä¸Šä¼ æ–‡ä»¶å¤¹</span>\\n          </div>\\n        </div>\\n      )}\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\shared\\\\UploadModal.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/upload/UploadModal ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useEffect, useRef, KeyboardEvent } from 'react';\\nimport { InboxOutlined, CloseCircleOutlined, TagOutlined, CloseOutlined } from '@ant-design/icons';\\nimport { Modal, Upload, Input, message, Button, Tag } from 'antd';\\nimport type { RcFile, UploadFile } from 'antd/es/upload/interface';\\nimport type { UploadProps } from 'antd';\\nimport type { InputRef } from 'antd/es/input';\\nimport { FileInfo, FileResponse } from '@/app/types';\\nimport styles from '../../styles/shared.module.css';\\nimport { useSession } from 'next-auth/react';\\nimport { API_PATHS } from '@/app/lib/api/paths';\\n\\nconst { Dragger } = Upload;\\n\\ninterface UploadModalProps {\\n  isOpen: boolean;\\n  onClose: () => void;\\n  onSuccess: (files?: FileInfo[]) => void;\\n  isFolderUpload?: boolean;\\n  currentFolderId?: string | null;\\n}\\n\\n// æ‰©å±•UploadFileç±»å‹ï¼Œæ·»åŠ webkitRelativePathå±æ€§\\ninterface ExtendedUploadFile extends UploadFile<any> {\\n  webkitRelativePath?: string;\\n}\\n\\nexport function UploadModal({\\n  isOpen,\\n  onClose,\\n  onSuccess,\\n  isFolderUpload = false,\\n  currentFolderId\\n}: UploadModalProps) {\\n  const [fileList, setFileList] = useState<ExtendedUploadFile[]>([]);\\n  const [tagInput, setTagInput] = useState<string>('');\\n  const [tagList, setTagList] = useState<string[]>([]);\\n  const [uploading, setUploading] = useState(false);\\n  const fileInputRef = useRef<HTMLInputElement>(null);\\n  const tagInputRef = useRef<InputRef>(null);\\n  const { data: session } = useSession();\\n\\n  useEffect(() => {\\n    // å½“æ¨¡æ€æ¡†æ‰“å¼€æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€\\n    if (isOpen && !session) {\\n      message.error('è¯·å…ˆç™»å½•åå†ä¸Šä¼ æ–‡ä»¶');\\n      onClose();\\n    }\\n  }, [isOpen, session, onClose]);\\n\\n  // å¤„ç†æ–‡ä»¶é€‰æ‹©\\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\\n    const selectedFiles = e.target.files;\\n    if (!selectedFiles || selectedFiles.length === 0) return;\\n\\n    const newFiles: ExtendedUploadFile[] = [];\\n    for (let i = 0; i < selectedFiles.length; i++) {\\n      const file = selectedFiles[i];\\n      newFiles.push({\\n        uid: `file-${Date.now()}-${i}`,\\n        name: file.name,\\n        size: file.size,\\n        type: file.type,\\n        originFileObj: file as any,\\n        webkitRelativePath: file.webkitRelativePath, // æ·»åŠ ç›¸å¯¹è·¯å¾„\\n      });\\n    }\\n\\n    setFileList(prev => [...prev, ...newFiles]);\\n    \\n    // æ¸…ç©ºinputä»¥å…è®¸å†æ¬¡é€‰æ‹©ç›¸åŒçš„æ–‡ä»¶\\n    if (fileInputRef.current) {\\n      fileInputRef.current.value = '';\\n    }\\n  };\\n\\n  // å¤„ç†æ ‡ç­¾è¾“å…¥\\n  const handleTagInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\\n    setTagInput(e.target.value);\\n  };\\n\\n  // å¤„ç†æ ‡ç­¾è¾“å…¥çš„å›è½¦äº‹ä»¶\\n  const handleTagInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\\n    if (e.key === 'Enter' && tagInput.trim()) {\\n      e.preventDefault();\\n      addTag(tagInput.trim());\\n    }\\n  };\\n\\n  // æ·»åŠ æ ‡ç­¾\\n  const addTag = (tag: string) => {\\n    if (!tag) return;\\n    \\n    // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨\\n    if (!tagList.includes(tag)) {\\n      setTagList(prev => [...prev, tag]);\\n    }\\n    \\n    // æ¸…ç©ºè¾“å…¥æ¡†\\n    setTagInput('');\\n    \\n    // èšç„¦å›è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ç»§ç»­è¾“å…¥\\n    if (tagInputRef.current) {\\n      setTimeout(() => {\\n        tagInputRef.current?.focus();\\n      }, 0);\\n    }\\n  };\\n\\n  // åˆ é™¤æ ‡ç­¾\\n  const removeTag = (tagToRemove: string) => {\\n    setTagList(tagList.filter(tag => tag !== tagToRemove));\\n  };\\n\\n  const handleUpload = async () => {\\n    if (fileList.length === 0) {\\n      message.warning('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');\\n      return;\\n    }\\n\\n    setUploading(true);\\n\\n    try {\\n      const formData = new FormData();\\n      \\n      // æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°FormData\\n      let filesAdded = 0;\\n      fileList.forEach((file, index) => {\\n        const rawFile = file.originFileObj;\\n        if (rawFile instanceof File) {\\n          // ä½¿ç”¨'file'å­—æ®µåï¼Œä¸åç«¯å¯¹åº”\\n          formData.append('file', rawFile);\\n          \\n          // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæ·»åŠ ç›¸å¯¹è·¯å¾„ä¿¡æ¯\\n          if (isFolderUpload && file.webkitRelativePath) {\\n            // ä½¿ç”¨æ•°å­—ç´¢å¼•ä½œä¸ºé”®ï¼Œç¡®ä¿åç«¯å¯ä»¥æ­£ç¡®è§£æ\\n            formData.append(`paths_${index}`, file.webkitRelativePath);\\n            console.log(`æ–‡ä»¶ ${index}: ${file.name} - è·¯å¾„: ${file.webkitRelativePath}`);\\n          }\\n          \\n          filesAdded++;\\n          console.log(`æ·»åŠ æ–‡ä»¶ ${index+1}: ${file.name}, å¤§å°: ${file.size} å­—èŠ‚`);\\n        } else {\\n          console.warn(`æ— æ³•è·å–æ–‡ä»¶ ${index+1}: ${file.name} çš„åŸå§‹Fileå¯¹è±¡`);\\n        }\\n      });\\n      \\n      if (filesAdded === 0) {\\n        throw new Error('æ— æ³•å¤„ç†ä¸Šä¼ æ–‡ä»¶ï¼Œè¯·é‡æ–°é€‰æ‹©æ–‡ä»¶');\\n      }\\n      \\n      // æ·»åŠ æ ‡å¿—è¡¨æ˜è¿™æ˜¯æ–‡ä»¶å¤¹ä¸Šä¼ \\n      if (isFolderUpload) {\\n        formData.append('isFolderUpload', 'true');\\n        console.log('æ–‡ä»¶å¤¹ä¸Šä¼ æ¨¡å¼å·²å¯ç”¨');\\n      }\\n      \\n      // å°†æ ‡ç­¾æ•°ç»„è½¬æ¢ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²\\n      if (tagList.length > 0) {\\n        formData.append('tags', JSON.stringify(tagList));\\n        console.log('æ·»åŠ æ ‡ç­¾:', tagList);\\n      }\\n\\n      if (currentFolderId) {\\n        formData.append('folderId', currentFolderId);\\n        console.log('å½“å‰æ–‡ä»¶å¤¹ID:', currentFolderId);\\n      }\\n\\n      console.log(`å‡†å¤‡ä¸Šä¼  ${filesAdded} ä¸ªæ–‡ä»¶...`);\\n      \\n      // æ˜¾ç¤ºä¸Šä¼ å¼€å§‹æ¶ˆæ¯\\n      const uploadKey = `upload-${Date.now()}`;\\n      message.loading({ content: 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...', key: uploadKey, duration: 0 });\\n\\n      // ä½¿ç”¨fetchå‘é€è¯·æ±‚\\n      const response = await fetch(API_PATHS.STORAGE.FILES.UPLOAD, {\\n        method: 'POST',\\n        body: formData,\\n      });\\n\\n      // è·å–å“åº”\\n      const contentType = response.headers.get(\\\"content-type\\\");\\n      let data;\\n      \\n      if (contentType && contentType.includes(\\\"application/json\\\")) {\\n        data = await response.json();\\n      } else {\\n        // å¦‚æœä¸æ˜¯JSONå“åº”ï¼Œå°è¯•è·å–æ–‡æœ¬\\n        const text = await response.text();\\n        console.error('æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”:', text);\\n        throw new Error('æœåŠ¡å™¨è¿”å›äº†æ— æ•ˆçš„å“åº”æ ¼å¼');\\n      }\\n      \\n      // æ£€æŸ¥å“åº”çŠ¶æ€\\n      if (!response.ok) {\\n        console.error('ä¸Šä¼ å“åº”é”™è¯¯:', data);\\n        \\n        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯\\n        message.error({ \\n          content: `ä¸Šä¼ å¤±è´¥: ${data.details || data.error || 'æœåŠ¡å™¨é”™è¯¯'}`, \\n          key: uploadKey,\\n          duration: 5 \\n        });\\n        \\n        throw new Error(data.details || data.error || 'ä¸Šä¼ å¤±è´¥');\\n      }\\n\\n      // ä¸Šä¼ æˆåŠŸå¤„ç†\\n      console.log('ä¸Šä¼ æˆåŠŸ:', data);\\n      message.success({ content: 'ä¸Šä¼ æˆåŠŸ', key: uploadKey, duration: 3 });\\n      \\n      // å…³é—­æ¨¡æ€æ¡†å¹¶é€šçŸ¥çˆ¶ç»„ä»¶\\n      handleClose();\\n      if (typeof onSuccess === 'function') {\\n        onSuccess(data.files || (data.file ? [data.file] : undefined));\\n      } else {\\n        console.warn('onSuccessä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ— æ³•é€šçŸ¥ä¸Šä¼ æˆåŠŸ');\\n      }\\n    } catch (error) {\\n      console.error('ä¸Šä¼ è¿‡ç¨‹ä¸­å‡ºé”™:', error);\\n      message.error(`ä¸Šä¼ å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);\\n    } finally {\\n      setUploading(false);\\n    }\\n  };\\n\\n  const handleClose = () => {\\n    setFileList([]);\\n    setTagInput('');\\n    setTagList([]);\\n    onClose();\\n  };\\n  \\n  // ç›´æ¥ä½¿ç”¨åŸç”Ÿæ–‡ä»¶è¾“å…¥\\n  const triggerFileInput = () => {\\n    if (fileInputRef.current) {\\n      fileInputRef.current.click();\\n    }\\n  };\\n  \\n  const removeFile = (index: number) => {\\n    setFileList(prev => prev.filter((_, i) => i !== index));\\n  };\\n\\n  return (\\n    <Modal\\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\\n      open={isOpen}\\n      onCancel={handleClose}\\n      onOk={handleUpload}\\n      okText=\\\"ä¸Šä¼ \\\"\\n      cancelText=\\\"å–æ¶ˆ\\\"\\n      confirmLoading={uploading}\\n      width={600}\\n    >\\n      <div className={styles.uploadContainer || ''}>\\n        <input\\n          type=\\\"file\\\"\\n          ref={fileInputRef}\\n          onChange={handleFileChange}\\n          style={{ display: 'none' }}\\n          multiple={true}\\n          {...(isFolderUpload ? { webkitdirectory: '', directory: '', mozdirectory: '', msdirectory: '' } : {})}\\n        />\\n        \\n        <div \\n          className={styles.dropzone || ''}\\n          onClick={triggerFileInput}\\n          style={{ \\n            border: '2px dashed #d9d9d9',\\n            borderRadius: '4px',\\n            padding: '20px',\\n            textAlign: 'center',\\n            cursor: 'pointer',\\n            marginBottom: '16px'\\n          }}\\n        >\\n          <p><InboxOutlined style={{ fontSize: '48px', color: '#40a9ff' }} /></p>\\n          <p style={{ marginTop: '8px', fontWeight: 'bold' }}>\\n            ç‚¹å‡»æˆ–æ‹–æ‹½{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}åˆ°æ­¤åŒºåŸŸä¸Šä¼ \\n          </p>\\n          <p style={{ color: '#888' }}>\\n            {isFolderUpload\\n              ? 'æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å†…éƒ¨æ–‡ä»¶ï¼Œä¿ç•™æ–‡ä»¶å¤¹ç»“æ„'\\n              : 'æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡ä¸Šä¼ æ–‡ä»¶ï¼Œæœ€å¤§æ”¯æŒåŒæ—¶é€‰æ‹©50ä¸ªæ–‡ä»¶'}\\n          </p>\\n          <Button type=\\\"primary\\\" onClick={(e) => { e.stopPropagation(); triggerFileInput(); }}>\\n            é€‰æ‹©{isFolderUpload ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶'}\\n          </Button>\\n        </div>\\n        \\n        {fileList.length > 0 && (\\n          <div style={{ marginBottom: '16px' }}>\\n            <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\\n              å·²é€‰æ‹© {fileList.length} ä¸ªæ–‡ä»¶:\\n            </div>\\n            <ul style={{ maxHeight: '150px', overflowY: 'auto', padding: '0 0 0 20px' }}>\\n              {fileList.map((file, index) => (\\n                <li key={file.uid} style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>\\n                  <span>\\n                    {file.name} \\n                    {isFolderUpload && file.webkitRelativePath && (\\n                      <span style={{ fontSize: '12px', color: '#8c8c8c', marginLeft: '4px' }}>\\n                        (è·¯å¾„: {file.webkitRelativePath.split('/').slice(0, -1).join('/')})\\n                      </span>\\n                    )}\\n                    ({((file.size || 0) / 1024).toFixed(2)} KB)\\n                  </span>\\n                  <Button \\n                    type=\\\"text\\\" \\n                    danger \\n                    onClick={() => removeFile(index)}\\n                    style={{ padding: '0 4px' }}\\n                  >\\n                    åˆ é™¤\\n                  </Button>\\n                </li>\\n              ))}\\n            </ul>\\n          </div>\\n        )}\\n\\n        <div style={{ marginTop: 16 }}>\\n          <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\\n            <span style={{ fontWeight: 'bold', marginRight: '8px' }}>æ·»åŠ æ ‡ç­¾:</span>\\n            <span style={{ fontSize: '12px', color: '#8c8c8c' }}>\\n              (è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ )\\n            </span>\\n          </div>\\n          \\n          <div className={styles.tagsInputWrapper}>\\n            <Input\\n              ref={tagInputRef}\\n              placeholder=\\\"è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ \\\"\\n              value={tagInput}\\n              onChange={handleTagInputChange}\\n              onKeyDown={handleTagInputKeyDown}\\n              prefix={<TagOutlined style={{ color: '#bfbfbf' }} />}\\n              suffix={\\n                <span style={{ color: '#bfbfbf', fontSize: '12px' }}>\\n                  æŒ‰å›è½¦æ·»åŠ \\n                </span>\\n              }\\n            />\\n          </div>\\n          \\n          <div className={styles.tagsContainer}>\\n            {tagList.length > 0 ? (\\n              <div className={styles.tagsList}>\\n                {tagList.map((tag, index) => (\\n                  <Tag\\n                    key={index}\\n                    closable\\n                    onClose={() => removeTag(tag)}\\n                    className={styles.interactiveTag}\\n                  >\\n                    {tag}\\n                  </Tag>\\n                ))}\\n              </div>\\n            ) : (\\n              <div className={styles.emptyTagsHint}>\\n                æ·»åŠ ä¸€äº›æ ‡ç­¾æ¥å¸®åŠ©ç®¡ç†æ‚¨çš„æ–‡ä»¶\\n              </div>\\n            )}\\n          </div>\\n        </div>\\n\\n        <div style={{ marginTop: '16px', padding: '12px', background: '#f5f5f5', borderRadius: '8px', fontSize: '13px', color: '#555' }}>\\n          <div style={{ fontWeight: 'bold', marginBottom: '8px' }}>\\n            {isFolderUpload ? 'æ–‡ä»¶å¤¹ä¸Šä¼ è¯´æ˜:' : 'æ–‡ä»¶ä¸Šä¼ è¯´æ˜:'}\\n          </div>\\n          <ul style={{ paddingLeft: '16px', margin: '0' }}>\\n            {isFolderUpload ? (\\n              <>\\n                <li>æ”¯æŒä¸Šä¼ æ•´ä¸ªæ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹ç»“æ„</li>\\n                <li>ä¿ç•™å®Œæ•´çš„æ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„</li>\\n                <li>ç›®å‰ä»…Chromeã€Edgeç­‰ç°ä»£æµè§ˆå™¨æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©</li>\\n                <li>å¦‚æœæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©ï¼Œè¯·é€‰æ‹©å•ä¸ªæ–‡ä»¶æ¨¡å¼</li>\\n              </>\\n            ) : (\\n              <>\\n                <li>æ”¯æŒæ‰¹é‡ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</li>\\n                <li>æ”¯æŒå¸¸è§çš„æ–‡ä»¶æ ¼å¼ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰</li>\\n                <li>æ¯ä¸ªæ–‡ä»¶å¤§å°é™åˆ¶ä¸º50MB</li>\\n                <li>ä¸€æ¬¡æœ€å¤šå¯é€‰æ‹©50ä¸ªæ–‡ä»¶</li>\\n              </>\\n            )}\\n            <li>æ‚¨å¯ä»¥ä¸ºä¸Šä¼ çš„æ–‡ä»¶æ·»åŠ æ ‡ç­¾ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç»„ç»‡å’ŒæŸ¥æ‰¾</li>\\n          </ul>\\n        </div>\\n      </div>\\n    </Modal>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\SortDropdown.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/SortDropdown ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useState, useRef, useEffect } from 'react';\\nimport styles from '../styles/SortDropdown.module.css';\\nimport { FileSortInterface, SortDirectionEnum } from '@/app/types';\\n\\ninterface SortDropdownProps {\\n  sortOrder: FileSortInterface;\\n  onSortChange: (order: FileSortInterface) => void;\\n}\\n\\nexport const SortDropdown: React.FC<SortDropdownProps> = ({\\n  sortOrder,\\n  onSortChange\\n}) => {\\n  const [showDropdown, setShowDropdown] = useState(false);\\n  const dropdownRef = useRef<HTMLDivElement>(null);\\n\\n  useEffect(() => {\\n    const handleClickOutside = (event: MouseEvent) => {\\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\\n        setShowDropdown(false);\\n      }\\n    };\\n\\n    document.addEventListener('mousedown', handleClickOutside);\\n    return () => document.removeEventListener('mousedown', handleClickOutside);\\n  }, []);\\n\\n  // æ ¹æ®å½“å‰æ’åºå­—æ®µè·å–æ˜¾ç¤ºæ–‡æœ¬\\n  const getSortFieldText = () => {\\n    switch(sortOrder.field) {\\n      case 'name': return 'æ–‡ä»¶å';\\n      case 'size': return 'å¤§å°';\\n      case 'createdAt': return 'æ—¶é—´';\\n      default: return 'é»˜è®¤';\\n    }\\n  };\\n\\n  return (\\n    <div className={styles.sortDropdown} ref={dropdownRef}>\\n      <button \\n        className={styles.topButton}\\n        onClick={() => setShowDropdown(!showDropdown)}\\n        style={{ \\n          background: showDropdown ? '#f0f7ff' : 'white',\\n          borderColor: showDropdown ? '#60a5fa' : '#e8e8e8'\\n        }}\\n      >\\n        <span>â†•ï¸</span>\\n        æ’åº: {getSortFieldText()} {sortOrder.direction === SortDirectionEnum.ASC ? 'â†‘' : 'â†“'}\\n      </button>\\n      {showDropdown && (\\n        <div className={styles.dropdownMenu}>\\n          <button \\n            className={styles.dropdownItem}\\n            onClick={() => {\\n              const newSortOrder: FileSortInterface = {\\n                field: 'name',\\n                direction: sortOrder.field === 'name' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\\n              };\\n              onSortChange(newSortOrder);\\n              setShowDropdown(false);\\n            }}\\n            style={{ \\n              fontWeight: sortOrder.field === 'name' ? 'bold' : 'normal',\\n              background: sortOrder.field === 'name' ? '#f0f7ff' : 'transparent'\\n            }}\\n          >\\n            <span>ğŸ“</span>\\n            æŒ‰æ–‡ä»¶å{sortOrder.field === 'name' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\\n          </button>\\n          <button \\n            className={styles.dropdownItem}\\n            onClick={() => {\\n              const newSortOrder: FileSortInterface = {\\n                field: 'size',\\n                direction: sortOrder.field === 'size' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\\n              };\\n              onSortChange(newSortOrder);\\n              setShowDropdown(false);\\n            }}\\n            style={{ \\n              fontWeight: sortOrder.field === 'size' ? 'bold' : 'normal',\\n              background: sortOrder.field === 'size' ? '#f0f7ff' : 'transparent'\\n            }}\\n          >\\n            <span>ğŸ“Š</span>\\n            æŒ‰å¤§å°{sortOrder.field === 'size' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\\n          </button>\\n          <button \\n            className={styles.dropdownItem}\\n            onClick={() => {\\n              const newSortOrder: FileSortInterface = {\\n                field: 'createdAt',\\n                direction: sortOrder.field === 'createdAt' && sortOrder.direction === SortDirectionEnum.ASC ? SortDirectionEnum.DESC : SortDirectionEnum.ASC\\n              };\\n              onSortChange(newSortOrder);\\n              setShowDropdown(false);\\n            }}\\n            style={{ \\n              fontWeight: sortOrder.field === 'createdAt' ? 'bold' : 'normal',\\n              background: sortOrder.field === 'createdAt' ? '#f0f7ff' : 'transparent'\\n            }}\\n          >\\n            <span>ğŸ•’</span>\\n            æŒ‰æ—¶é—´{sortOrder.field === 'createdAt' ? (sortOrder.direction === SortDirectionEnum.ASC ? ' â†‘' : ' â†“') : ''}\\n          </button>\\n        </div>\\n      )}\\n    </div>\\n  );\\n};\\n\\nexport default SortDropdown; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\Toolbar.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/toolbar/Toolbar ç»„ä»¶ã€‚\\n */\\n\\nimport React, { useRef, useState } from 'react';\\nimport { useFileContext } from '../context/FileContext';\\nimport { X, Download, Edit, Move } from 'lucide-react';\\nimport { message } from 'antd';\\nimport styles from './Toolbar.module.css';\\nimport commonStyles from '../styles/common.module.css';\\n\\ninterface ToolbarProps {\\n  onUploadClick: () => void;\\n  onFolderUploadClick: () => void;\\n  onCreateFolderClick: () => void;\\n}\\n\\nexport function Toolbar({ onUploadClick, onFolderUploadClick, onCreateFolderClick }: ToolbarProps) {\\n  const {\\n    selectedFiles,\\n    clearSelection,\\n    files\\n  } = useFileContext();\\n\\n  const [showUploadDropdown, setShowUploadDropdown] = useState(false);\\n  const dropdownRef = useRef<HTMLDivElement>(null);\\n\\n  const handleDownload = () => {\\n    // TODO: å®ç°æ–‡ä»¶ä¸‹è½½åŠŸèƒ½\\n    message.info('ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­');\\n  };\\n\\n  const handleRename = () => {\\n    if (selectedFiles.length !== 1) {\\n      message.warning('è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé‡å‘½å');\\n      return;\\n    }\\n    const selectedFile = files.find(file => file.id === selectedFiles[0]);\\n    if (selectedFile) {\\n      // TODO: å®ç°é‡å‘½ååŠŸèƒ½\\n      message.info('é‡å‘½ååŠŸèƒ½å¼€å‘ä¸­');\\n    }\\n  };\\n\\n  return (\\n    <div className={styles.topBar}>\\n      <div className={styles.buttonGroup}>\\n        {selectedFiles.length > 0 ? (\\n          <>\\n            <button className={styles.topButton} onClick={() => clearSelection()}>\\n              <X className={commonStyles.icon} />\\n              å–æ¶ˆé€‰æ‹©\\n            </button>\\n            <button className={styles.topButton} onClick={handleDownload}>\\n              <Download className={commonStyles.icon} />\\n              ä¸‹è½½\\n            </button>\\n            <button className={styles.topButton} onClick={handleRename}>\\n              <Edit className={commonStyles.icon} />\\n              é‡å‘½å\\n            </button>\\n            <button className={styles.topButton}>\\n              <Move className={commonStyles.icon} />\\n              ç§»åŠ¨\\n            </button>\\n          </>\\n        ) : (\\n          <>\\n            <div className={styles.uploadDropdown} ref={dropdownRef}>\\n              <button\\n                className={styles.topButton}\\n                onClick={() => setShowUploadDropdown(!showUploadDropdown)}\\n              >\\n                <span className={styles.buttonIcon}>â¬†ï¸</span>\\n                ä¸Šä¼ \\n                <span className={styles.dropdownArrow}>â–¼</span>\\n              </button>\\n              {showUploadDropdown && (\\n                <div className={styles.dropdownMenu}>\\n                  <button\\n                    className={styles.dropdownItem}\\n                    onClick={() => {\\n                      onUploadClick();\\n                      setShowUploadDropdown(false);\\n                    }}\\n                  >\\n                    <span className={styles.buttonIcon}>ğŸ“„</span>\\n                    ä¸Šä¼ æ–‡ä»¶\\n                  </button>\\n                  <button\\n                    className={styles.dropdownItem}\\n                    onClick={() => {\\n                      onFolderUploadClick();\\n                      setShowUploadDropdown(false);\\n                    }}\\n                  >\\n                    <span className={styles.buttonIcon}>ğŸ“</span>\\n                    ä¸Šä¼ æ–‡ä»¶å¤¹\\n                  </button>\\n                </div>\\n              )}\\n            </div>\\n            <button\\n              className={styles.topButton}\\n              onClick={onCreateFolderClick}\\n            >\\n              <span className={styles.buttonIcon}>ğŸ“</span>\\n              æ–°å»ºæ–‡ä»¶å¤¹\\n            </button>\\n          </>\\n        )}\\n      </div>\\n    </div>\\n  );\\n} \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\TopActionBar.tsx\",\n    \"newContent\": \"/**\\n * @deprecated æ­¤ç»„ä»¶å·²è¿ç§»åˆ°æ–°çš„ç»„ä»¶æ¶æ„ä¸­ã€‚\\n * è¯·ä½¿ç”¨ @/app/components/features/file-management/actionBar/TopActionBar ç»„ä»¶ã€‚\\n */\\n\\nimport React from 'react';\\nimport { \\n  X, Download, Edit, Move, Trash2, FolderUp, Image as ImageIcon, FileText, Video, Music, File \\n} from 'lucide-react';\\nimport styles from '../styles/shared.module.css';\\nimport SortDropdown from './SortDropdown';\\nimport { UploadButton } from '../components/shared';\\nimport { FileSortInterface } from '@/app/types';\\n\\ninterface TopActionBarProps {\\n  selectedFiles: string[];\\n  onClearSelection: () => void;\\n  onDownload: () => void;\\n  onRename: () => void;\\n  onMove: () => void;\\n  onDelete: () => void;\\n  onClearFilter: () => void;\\n  onCreateFolder: () => void;\\n  selectedFileType: string | null;\\n  showSearchView: boolean;\\n  isInRootFolder: boolean;\\n  sortOrder: FileSortInterface;\\n  setSortOrder: (order: FileSortInterface) => void;\\n  showUploadDropdown: boolean;\\n  setShowUploadDropdown: (show: boolean) => void;\\n  setIsUploadModalOpen: (open: boolean) => void;\\n  setIsFolderUploadModalOpen: (open: boolean) => void;\\n  uploadDropdownRef: React.RefObject<HTMLDivElement>;\\n}\\n\\nexport const TopActionBar: React.FC<TopActionBarProps> = ({\\n  selectedFiles,\\n  onClearSelection,\\n  onDownload,\\n  onRename,\\n  onMove,\\n  onDelete,\\n  onClearFilter,\\n  onCreateFolder,\\n  selectedFileType,\\n  showSearchView,\\n  isInRootFolder,\\n  sortOrder,\\n  setSortOrder,\\n  showUploadDropdown,\\n  setShowUploadDropdown,\\n  setIsUploadModalOpen,\\n  setIsFolderUploadModalOpen,\\n  uploadDropdownRef\\n}) => {\\n  return (\\n    <div className={styles.topBar}>\\n      <div className={styles.buttonGroup}>\\n        {selectedFiles.length > 0 ? (\\n          <>\\n            <button className={styles.topButton} onClick={onClearSelection}>\\n              <X className=\\\"w-4 h-4\\\" />\\n              å–æ¶ˆé€‰æ‹©\\n            </button>\\n            <button className={styles.topButton} onClick={onDownload}>\\n              <Download className=\\\"w-4 h-4\\\" />\\n              ä¸‹è½½\\n            </button>\\n            <button \\n              className={styles.topButton}\\n              onClick={onRename}\\n            >\\n              <Edit className=\\\"w-4 h-4\\\" />\\n              é‡å‘½å\\n            </button>\\n            <button className={styles.topButton} onClick={onMove}>\\n              <Move className=\\\"w-4 h-4\\\" />\\n              ç§»åŠ¨\\n            </button>\\n            <button className={styles.topButton} onClick={onDelete}>\\n              <Trash2 className=\\\"w-4 h-4\\\" />\\n              åˆ é™¤\\n            </button>\\n          </>\\n        ) : (\\n          <>\\n            <button \\n              className={styles.topButton}\\n              onClick={onClearFilter}\\n              disabled={isInRootFolder}\\n            >\\n              <span>ğŸ“</span>\\n              {showSearchView ? 'è¿”å›æ–‡ä»¶åˆ—è¡¨' : (selectedFileType ? 'æ¸…é™¤è¿‡æ»¤' : 'æ ¹ç›®å½•')}\\n            </button>\\n\\n            {/* æ·»åŠ å½“å‰è¿‡æ»¤çŠ¶æ€æŒ‡ç¤ºå™¨ */}\\n            {selectedFileType && (\\n              <div className={styles.topButton} style={{ cursor: 'default', background: '#f0f7ff', borderColor: '#60a5fa' }}>\\n                {(() => {\\n                  switch(selectedFileType) {\\n                    case 'image': return <ImageIcon className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'document': return <FileText className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'video': return <Video className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'audio': return <Music className=\\\"w-4 h-4 mr-2\\\" />;\\n                    case 'other': return <File className=\\\"w-4 h-4 mr-2\\\" />;\\n                    default: return null;\\n                  }\\n                })()}\\n                å½“å‰æµè§ˆï¼š\\n                {selectedFileType === 'image' && 'ä»…å›¾ç‰‡'}\\n                {selectedFileType === 'document' && 'ä»…æ–‡æ¡£'}\\n                {selectedFileType === 'video' && 'ä»…è§†é¢‘'}\\n                {selectedFileType === 'audio' && 'ä»…éŸ³é¢‘'}\\n                {selectedFileType === 'other' && 'å…¶ä»–æ–‡ä»¶'}\\n              </div>\\n            )}\\n\\n            {/* æ’åºä¸‹æ‹‰èœå• */}\\n            <SortDropdown \\n              sortOrder={sortOrder}\\n              onSortChange={setSortOrder}\\n            />\\n            \\n            {/* ä¸Šä¼ æŒ‰é’® */}\\n            <UploadButton \\n              showDropdown={showUploadDropdown}\\n              setShowDropdown={setShowUploadDropdown}\\n              setIsModalOpen={setIsUploadModalOpen}\\n              setIsFolderModalOpen={setIsFolderUploadModalOpen}\\n              uploadDropdownRef={uploadDropdownRef}\\n            />\\n            \\n            <button \\n              className={styles.folderButton} \\n              onClick={onCreateFolder}\\n            >\\n              <FolderUp className=\\\"w-4 h-4 mr-2\\\" />\\n              æ–°å»ºæ–‡ä»¶å¤¹\\n            </button>\\n          </>\\n        )}\\n      </div>\\n    </div>\\n  );\\n};\\n\\nexport default TopActionBar; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\file-management\\\\upload\\\\UploadModal\\\\UploadModal.tsx\",\n    \"newContent\": \"'use client';\\r\\n\\r\\nimport React, { useState, useRef, useEffect } from 'react';\\r\\nimport { Modal, Button, Space, Tag, Input, message, Progress } from 'antd';\\r\\nimport { UploadOutlined, FolderOutlined } from '@ant-design/icons';\\r\\nimport { UploadModalProps } from '@/app/types/domains/file-management';\\r\\nimport { FileTreeNode } from '@/app/types/domains/fileTypes';\\r\\nimport { formatFileSize } from '@/app/lib/utils/file';\\r\\nimport { uploadFile, uploadFolder, processSelectedFiles } from '@/app/lib/uploadService';\\r\\n\\r\\n// æ„å»ºæ–‡ä»¶æ ‘èŠ‚ç‚¹\\r\\nfunction createFileTreeNode(name: string, type: 'file' | 'folder', size: number = 0, file?: File): FileTreeNode {\\r\\n  return {\\r\\n    name,\\r\\n    type,\\r\\n    size,\\r\\n    children: type === 'folder' ? [] : undefined,\\r\\n    file: file as any\\r\\n  };\\r\\n}\\r\\n\\r\\n// æ›´æ–°æ–‡ä»¶å¤¹å¤§å°\\r\\nfunction updateFolderSize(node: FileTreeNode, fileSize: number) {\\r\\n  let currentNode = node;\\r\\n  while (currentNode) {\\r\\n    currentNode.size += fileSize;\\r\\n    currentNode = currentNode.children?.find(child => \\r\\n      child.type === 'folder'\\r\\n    ) as FileTreeNode;\\r\\n  }\\r\\n}\\r\\n\\r\\n// æ„å»ºæ–‡ä»¶æ ‘ç»“æ„\\r\\nfunction buildFileTree(files: File[], rootName: string): FileTreeNode {\\r\\n  const root = createFileTreeNode(rootName, 'folder');\\r\\n  \\r\\n  files.forEach(file => {\\r\\n    const paths = (file as any).webkitRelativePath.split('/');\\r\\n    let currentNode = root;\\r\\n    \\r\\n    for (let i = 1; i < paths.length; i++) {\\r\\n      const pathPart = paths[i];\\r\\n      const isFile = i === paths.length - 1;\\r\\n\\r\\n      if (isFile) {\\r\\n        const fileNode = createFileTreeNode(pathPart, 'file', file.size, file);\\r\\n        currentNode.children?.push(fileNode);\\r\\n        updateFolderSize(currentNode, file.size);\\r\\n      } else {\\r\\n        let folderNode = currentNode.children?.find(\\r\\n          child => child.name === pathPart && child.type === 'folder'\\r\\n        );\\r\\n        \\r\\n        if (!folderNode) {\\r\\n          folderNode = createFileTreeNode(pathPart, 'folder');\\r\\n          currentNode.children?.push(folderNode);\\r\\n        }\\r\\n        currentNode = folderNode;\\r\\n      }\\r\\n    }\\r\\n  });\\r\\n\\r\\n  return root;\\r\\n}\\r\\n\\r\\n/**\\r\\n * æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†ç»„ä»¶\\r\\n * æ”¯æŒæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ ï¼Œæä¾›æ‹–æ”¾å’Œé€‰æ‹©ç•Œé¢\\r\\n */\\r\\nconst UploadModal: React.FC<UploadModalProps> = ({\\r\\n  isOpen,\\r\\n  onClose,\\r\\n  onUploadSuccess,\\r\\n  currentFolderId,\\r\\n  isFolderUpload,\\r\\n  withTags\\r\\n}) => {\\r\\n  const [isDragging, setIsDragging] = useState(false);\\r\\n  const [files, setFiles] = useState<File[]>([]);\\r\\n  const [isUploading, setIsUploading] = useState(false);\\r\\n  const [uploadProgress, setUploadProgress] = useState(0);\\r\\n  const [tags, setTags] = useState<string[]>([]);\\r\\n  const [tagInput, setTagInput] = useState('');\\r\\n  const [folderName, setFolderName] = useState<string | null>(null);\\r\\n  const [fileTree, setFileTree] = useState<FileTreeNode | null>(null);\\r\\n  const fileInputRef = useRef<HTMLInputElement>(null);\\r\\n\\r\\n  // é‡ç½®æ‰€æœ‰çŠ¶æ€\\r\\n  const resetState = () => {\\r\\n    setFiles([]);\\r\\n    setIsDragging(false);\\r\\n    setTags([]);\\r\\n    setTagInput('');\\r\\n    setFolderName(null);\\r\\n    setFileTree(null);\\r\\n    setUploadProgress(0);\\r\\n  };\\r\\n\\r\\n  // ç›‘å¬ isOpen å˜åŒ–ï¼Œå½“å¼¹çª—å…³é—­æ—¶é‡ç½®çŠ¶æ€\\r\\n  useEffect(() => {\\r\\n    if (!isOpen) {\\r\\n      resetState();\\r\\n    }\\r\\n  }, [isOpen]);\\r\\n\\r\\n  const handleClose = () => {\\r\\n    resetState();\\r\\n    onClose();\\r\\n  };\\r\\n\\r\\n  const handleDragOver = (e: React.DragEvent) => {\\r\\n    e.preventDefault();\\r\\n    setIsDragging(true);\\r\\n  };\\r\\n\\r\\n  const handleDragLeave = () => {\\r\\n    setIsDragging(false);\\r\\n  };\\r\\n\\r\\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\\r\\n    e.preventDefault();\\r\\n    setIsDragging(false);\\r\\n    \\r\\n    const droppedFiles = Array.from(e.dataTransfer.files);\\r\\n    if (droppedFiles.length > 0) {\\r\\n      const { files: processedFiles, folderName } = processSelectedFiles(droppedFiles, isFolderUpload);\\r\\n      setFiles(processedFiles);\\r\\n      setFolderName(folderName);\\r\\n      \\r\\n      if (isFolderUpload && folderName) {\\r\\n        setFileTree(buildFileTree(processedFiles, folderName));\\r\\n      }\\r\\n    }\\r\\n  };\\r\\n\\r\\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\\r\\n    const selectedFiles = Array.from(e.target.files || []);\\r\\n    if (selectedFiles.length > 0) {\\r\\n      const { files: processedFiles, folderName } = processSelectedFiles(selectedFiles, isFolderUpload);\\r\\n      setFiles(processedFiles);\\r\\n      setFolderName(folderName);\\r\\n      \\r\\n      if (isFolderUpload && folderName) {\\r\\n        setFileTree(buildFileTree(processedFiles, folderName));\\r\\n      }\\r\\n    }\\r\\n  };\\r\\n\\r\\n  const removeFile = (fileName: string) => {\\r\\n    setFiles(prev => prev.filter(file => file.name !== fileName));\\r\\n  };\\r\\n\\r\\n  const handleTagInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\\r\\n    if (e.key === 'Enter' && tagInput.trim()) {\\r\\n      e.preventDefault();\\r\\n      const newTag = tagInput.trim();\\r\\n      if (!tags.includes(newTag)) {\\r\\n        setTags([...tags, newTag]);\\r\\n      }\\r\\n      setTagInput('');\\r\\n    }\\r\\n  };\\r\\n\\r\\n  const removeTag = (tagToRemove: string) => {\\r\\n    setTags(tags.filter(tag => tag !== tagToRemove));\\r\\n  };\\r\\n\\r\\n  // é€’å½’æ¸²æŸ“æ–‡ä»¶æ ‘ç»„ä»¶\\r\\n  const renderFileTree = (node: FileTreeNode, level: number = 0) => {\\r\\n    return (\\r\\n      <div key={node.name} style={{ marginLeft: `${level * 20}px` }}>\\r\\n        <div className=\\\"file-item\\\">\\r\\n          <div className=\\\"file-info\\\">\\r\\n            <span className=\\\"file-type-icon\\\">\\r\\n              {node.type === 'folder' ? 'ğŸ“' : \\r\\n               node.file?.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\\r\\n               node.file?.type.includes('pdf') ? 'ğŸ“„' :\\r\\n               node.file?.type.includes('word') ? 'ğŸ“' :\\r\\n               'ğŸ“„'}\\r\\n            </span>\\r\\n            <div>\\r\\n              <p className=\\\"file-name\\\">{node.name}</p>\\r\\n              <p className=\\\"file-size\\\">\\r\\n                {formatFileSize(node.size)}\\r\\n                {node.type === 'folder' && ` (${node.children?.length || 0} ä¸ªæ–‡ä»¶)`}\\r\\n              </p>\\r\\n            </div>\\r\\n          </div>\\r\\n        </div>\\r\\n        {node.children && node.children.length > 0 && (\\r\\n          <div className=\\\"file-children\\\">\\r\\n            {node.children.map(child => renderFileTree(child, level + 1))}\\r\\n          </div>\\r\\n        )}\\r\\n      </div>\\r\\n    );\\r\\n  };\\r\\n\\r\\n  // ä¸Šä¼ å¤„ç†å‡½æ•°\\r\\n  const handleUpload = async () => {\\r\\n    if (files.length === 0) return;\\r\\n    \\r\\n    setIsUploading(true);\\r\\n    setUploadProgress(0);\\r\\n    \\r\\n    try {\\r\\n      // å¤„ç†æ–‡ä»¶å¤¹ä¸Šä¼ \\r\\n      if (isFolderUpload && folderName) {\\r\\n        await uploadFolder(files, folderName, {\\r\\n          folderId: currentFolderId || undefined,\\r\\n          tags,\\r\\n          onProgress: (progress) => {\\r\\n            setUploadProgress(progress);\\r\\n          },\\r\\n          onSuccess: (response) => {\\r\\n            message.success(`æ–‡ä»¶å¤¹ \\\"${folderName}\\\" ä¸Šä¼ æˆåŠŸ`);\\r\\n            setIsUploading(false);\\r\\n            onUploadSuccess();\\r\\n            handleClose();\\r\\n          },\\r\\n          onError: (error) => {\\r\\n            message.error(`ä¸Šä¼ å¤±è´¥: ${error.message}`);\\r\\n            setIsUploading(false);\\r\\n          }\\r\\n        });\\r\\n      } else {\\r\\n        // å•æ–‡ä»¶æˆ–å¤šæ–‡ä»¶ä¸Šä¼ \\r\\n        let uploadedCount = 0;\\r\\n        const totalFiles = files.length;\\r\\n        \\r\\n        for (const file of files) {\\r\\n          await uploadFile(file, {\\r\\n            folderId: currentFolderId || undefined,\\r\\n            tags,\\r\\n            onProgress: (fileProgress) => {\\r\\n              // è®¡ç®—æ€»ä½“è¿›åº¦ï¼šå·²å®Œæˆæ–‡ä»¶ + å½“å‰æ–‡ä»¶è¿›åº¦\\r\\n              const totalProgress = Math.round(\\r\\n                (uploadedCount * 100 + fileProgress) / totalFiles\\r\\n              );\\r\\n              setUploadProgress(totalProgress);\\r\\n            },\\r\\n            onSuccess: () => {\\r\\n              uploadedCount++;\\r\\n              \\r\\n              // æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ\\r\\n              if (uploadedCount === totalFiles) {\\r\\n                message.success(totalFiles > 1 \\r\\n                  ? `${totalFiles}ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸ` \\r\\n                  : 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');\\r\\n                \\r\\n                setIsUploading(false);\\r\\n                onUploadSuccess();\\r\\n                handleClose();\\r\\n              }\\r\\n            },\\r\\n            onError: (error) => {\\r\\n              message.error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${error.message}`);\\r\\n              setIsUploading(false);\\r\\n            }\\r\\n          });\\r\\n        }\\r\\n      }\\r\\n    } catch (error) {\\r\\n      const errorMessage = error instanceof Error ? error.message : 'ä¸Šä¼ å¤±è´¥';\\r\\n      message.error(errorMessage);\\r\\n      setIsUploading(false);\\r\\n    }\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    <Modal\\r\\n      title={isFolderUpload ? 'ä¸Šä¼ æ–‡ä»¶å¤¹' : 'ä¸Šä¼ æ–‡ä»¶'}\\r\\n      open={isOpen}\\r\\n      onCancel={handleClose}\\r\\n      footer={[\\r\\n        <Button key=\\\"cancel\\\" onClick={handleClose} disabled={isUploading}>\\r\\n          å–æ¶ˆ\\r\\n        </Button>,\\r\\n        <Button \\r\\n          key=\\\"upload\\\" \\r\\n          type=\\\"primary\\\" \\r\\n          onClick={handleUpload} \\r\\n          disabled={files.length === 0 || isUploading}\\r\\n          loading={isUploading}\\r\\n        >\\r\\n          ä¸Šä¼ \\r\\n        </Button>,\\r\\n      ]}\\r\\n      width={800}\\r\\n    >\\r\\n      {isUploading ? (\\r\\n        <div className=\\\"text-center py-8\\\">\\r\\n          <div className=\\\"my-4\\\">\\r\\n            <Progress percent={uploadProgress} status=\\\"active\\\" />\\r\\n            <div className=\\\"mt-2\\\">{`ä¸Šä¼ ä¸­...${uploadProgress}%`}</div>\\r\\n          </div>\\r\\n        </div>\\r\\n      ) : (\\r\\n        <div className=\\\"upload-content\\\">\\r\\n          {/* æ‹–æ”¾åŒºåŸŸ */}\\r\\n          <div\\r\\n            onDragOver={handleDragOver}\\r\\n            onDragLeave={handleDragLeave}\\r\\n            onDrop={handleDrop}\\r\\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\\r\\n              isDragging ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-500'\\r\\n            }`}\\r\\n          >\\r\\n            <div className=\\\"upload-icon mb-4\\\">\\r\\n              {isFolderUpload ? <FolderOutlined style={{ fontSize: 48 }} /> : <UploadOutlined style={{ fontSize: 48 }} />}\\r\\n            </div>\\r\\n            <p className=\\\"text-lg mb-2\\\">\\r\\n              {isDragging\\r\\n                ? isFolderUpload\\r\\n                  ? 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶å¤¹'\\r\\n                  : 'æ”¾å¼€ä»¥ä¸Šä¼ æ–‡ä»¶'\\r\\n                : isFolderUpload\\r\\n                ? 'æ‹–æ”¾æ–‡ä»¶å¤¹è‡³æ­¤å¤„ï¼Œæˆ–'\\r\\n                : 'æ‹–æ”¾æ–‡ä»¶è‡³æ­¤å¤„ï¼Œæˆ–'}\\r\\n            </p>\\r\\n            <Button\\r\\n              onClick={() => fileInputRef.current?.click()}\\r\\n              type=\\\"primary\\\"\\r\\n              icon={isFolderUpload ? <FolderOutlined /> : <UploadOutlined />}\\r\\n            >\\r\\n              {isFolderUpload ? 'é€‰æ‹©æ–‡ä»¶å¤¹' : 'é€‰æ‹©æ–‡ä»¶'}\\r\\n            </Button>\\r\\n            <input\\r\\n              ref={fileInputRef}\\r\\n              type=\\\"file\\\"\\r\\n              multiple={!isFolderUpload}\\r\\n              style={{ display: 'none' }}\\r\\n              onChange={handleFileSelect}\\r\\n              {...(isFolderUpload ? { webkitdirectory: \\\"\\\", directory: \\\"\\\" } : {})}\\r\\n            />\\r\\n          </div>\\r\\n\\r\\n          {/* æ ‡ç­¾è¾“å…¥åŒºåŸŸ */}\\r\\n          {withTags && (\\r\\n            <div className=\\\"tags-section mt-6\\\">\\r\\n              <h4 className=\\\"text-base font-medium mb-2\\\">æ·»åŠ æ ‡ç­¾</h4>\\r\\n              <div className=\\\"tag-input\\\">\\r\\n                <Input\\r\\n                  placeholder=\\\"è¾“å…¥æ ‡ç­¾å¹¶æŒ‰Enteræ·»åŠ \\\"\\r\\n                  value={tagInput}\\r\\n                  onChange={(e) => setTagInput(e.target.value)}\\r\\n                  onKeyDown={handleTagInputKeyDown}\\r\\n                />\\r\\n              </div>\\r\\n              {tags.length > 0 && (\\r\\n                <div className=\\\"tags-list mt-2 flex flex-wrap gap-1\\\">\\r\\n                  {tags.map((tag) => (\\r\\n                    <Tag\\r\\n                      key={tag}\\r\\n                      closable\\r\\n                      onClose={() => removeTag(tag)}\\r\\n                    >\\r\\n                      {tag}\\r\\n                    </Tag>\\r\\n                  ))}\\r\\n                </div>\\r\\n              )}\\r\\n            </div>\\r\\n          )}\\r\\n\\r\\n          {/* æ–‡ä»¶åˆ—è¡¨æˆ–æ–‡ä»¶æ ‘ */}\\r\\n          {files.length > 0 && (\\r\\n            <div className=\\\"file-list mt-6\\\">\\r\\n              <h4 className=\\\"text-base font-medium mb-2\\\">\\r\\n                {isFolderUpload \\r\\n                  ? `æ–‡ä»¶å¤¹: ${folderName} (${files.length}ä¸ªæ–‡ä»¶)` \\r\\n                  : `é€‰æ‹©çš„æ–‡ä»¶ (${files.length})`}\\r\\n              </h4>\\r\\n              \\r\\n              {isFolderUpload && fileTree ? (\\r\\n                <div className=\\\"folder-tree border rounded p-3\\\">\\r\\n                  {renderFileTree(fileTree)}\\r\\n                </div>\\r\\n              ) : (\\r\\n                <div className=\\\"file-items space-y-2\\\">\\r\\n                  {files.map((file) => (\\r\\n                    <div\\r\\n                      key={file.name}\\r\\n                      className=\\\"file-item flex justify-between items-center border rounded p-2\\\"\\r\\n                    >\\r\\n                      <div className=\\\"file-details flex items-center\\\">\\r\\n                        <span className=\\\"file-icon mr-2\\\">\\r\\n                          {file.type.startsWith('image/') ? 'ğŸ–¼ï¸' :\\r\\n                           file.type.includes('pdf') ? 'ğŸ“„' :\\r\\n                           file.type.includes('word') ? 'ğŸ“' :\\r\\n                           'ğŸ“„'}\\r\\n                        </span>\\r\\n                        <div>\\r\\n                          <div className=\\\"file-name font-medium\\\">{file.name}</div>\\r\\n                          <div className=\\\"file-meta text-xs text-gray-500\\\">\\r\\n                            {formatFileSize(file.size)}\\r\\n                          </div>\\r\\n                        </div>\\r\\n                      </div>\\r\\n                      <Button\\r\\n                        type=\\\"text\\\"\\r\\n                        size=\\\"small\\\"\\r\\n                        danger\\r\\n                        onClick={() => removeFile(file.name)}\\r\\n                      >\\r\\n                        ç§»é™¤\\r\\n                      </Button>\\r\\n                    </div>\\r\\n                  ))}\\r\\n                </div>\\r\\n              )}\\r\\n            </div>\\r\\n          )}\\r\\n        </div>\\r\\n      )}\\r\\n    </Modal>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default UploadModal; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\index.ts\",\n    \"newContent\": \"// å¯¼å‡ºfeaturesç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶\\r\\nexport * from './home';\\r\\nexport * from './dashboard';\\r\\nexport * from './user-profile';\\r\\nexport * from './file-management'; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\user-profile\\\\index.ts\",\n    \"newContent\": \"// å¯¼å‡ºuser-profileç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶\\r\\nexport * from './avatar';\\r\\nexport * from './profileHeader';\\r\\nexport * from './profileContent';\\r\\nexport * from './completeness';\\r\\nexport * from './passwordForm';\\r\\nexport * from './editForm'; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\user-profile\\\\profileHeader\\\\ProfileHeader.tsx\",\n    \"newContent\": \"import React, { useState, useRef, useEffect } from 'react';\\r\\nimport Image from 'next/image';\\r\\nimport { Session } from 'next-auth';\\r\\nimport { UserInfo } from '@/app/dashboard/page';\\r\\nimport { Camera, Upload, Trash2 } from 'lucide-react';\\r\\nimport styles from './ProfileHeader.module.css';\\r\\nimport { AvatarModal } from '@/app/components/features/user-profile/avatar';\\r\\n\\r\\ninterface ProfileHeaderProps {\\r\\n  session: Session;\\r\\n  userInfo: UserInfo;\\r\\n  onEditClick: () => void;\\r\\n  onPasswordClick: () => void;\\r\\n  isLoading: boolean;\\r\\n  onAvatarChange?: (avatarUrl: string) => void;\\r\\n}\\r\\n\\r\\nconst ProfileHeader = ({ \\r\\n  session, \\r\\n  userInfo,\\r\\n  onEditClick, \\r\\n  onPasswordClick, \\r\\n  isLoading,\\r\\n  onAvatarChange\\r\\n}: ProfileHeaderProps) => {\\r\\n  const [avatarError, setAvatarError] = useState(false);\\r\\n  const [showAvatarModal, setShowAvatarModal] = useState(false);\\r\\n  \\r\\n  // ä½¿ç”¨userInfoä¸­çš„displayNameä½œä¸ºé¦–é€‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨sessionä¸­çš„name\\r\\n  const displayName = userInfo.displayName || session.user?.name || 'æœªè®¾ç½®æ˜µç§°';\\r\\n  \\r\\n  // è·å–ç”¨äºå¤´åƒå ä½ç¬¦çš„é¦–å­—æ¯\\r\\n  const nameInitial = displayName[0]?.toUpperCase() || '?';\\r\\n\\r\\n  // ç®€åŒ–å¤´åƒURLé€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨userInfoä¸­çš„å¤´åƒæˆ–sessionå¤´åƒ\\r\\n  const effectiveAvatarUrl = userInfo.avatarUrl || session.user?.image;\\r\\n  \\r\\n  // æ·»åŠ æ—¶é—´æˆ³ä½œä¸ºkeyçš„ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿æ¯æ¬¡å¤´åƒå˜æ›´éƒ½ä¼šé‡æ–°æ¸²æŸ“\\r\\n  const [refreshKey, setRefreshKey] = useState(Date.now());\\r\\n  const avatarKey = `${effectiveAvatarUrl || 'fallback'}-${refreshKey}`;\\r\\n\\r\\n  // æ·»åŠ useEffectç›‘å¬userInfo.avatarUrlçš„å˜åŒ–\\r\\n  useEffect(() => {\\r\\n    setRefreshKey(Date.now()); // å¼ºåˆ¶å¤´åƒé‡æ–°æ¸²æŸ“\\r\\n    setAvatarError(false); // é‡ç½®é”™è¯¯çŠ¶æ€\\r\\n  }, [userInfo.avatarUrl]);\\r\\n\\r\\n  // æ·»åŠ æ·±åº¦è°ƒè¯• - ç›‘æ§propså˜åŒ–\\r\\n  useEffect(() => {\\r\\n    console.log('ProfileHeaderæ”¶åˆ°æ–°çš„userInfo:', \\r\\n      { \\r\\n        avatarUrl: userInfo.avatarUrl,\\r\\n        hasAvatar: !!userInfo.avatarUrl,\\r\\n        displayName: userInfo.displayName\\r\\n      }\\r\\n    );\\r\\n  }, [userInfo]);\\r\\n\\r\\n  // æ‰“å¼€å¤´åƒç®¡ç†å¼¹çª—\\r\\n  const handleAvatarClick = () => {\\r\\n    setShowAvatarModal(true);\\r\\n  };\\r\\n\\r\\n  // å¤„ç†å¤´åƒå˜æ›´\\r\\n  const handleAvatarChange = (newAvatarUrl: string) => {\\r\\n    if (onAvatarChange) {\\r\\n      onAvatarChange(newAvatarUrl);\\r\\n    }\\r\\n    // å¼ºåˆ¶åˆ·æ–°\\r\\n    setRefreshKey(Date.now());\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    <div className={styles.header}>\\r\\n      <div className={styles.avatarContainer}>\\r\\n        <div className={styles.avatar} onClick={handleAvatarClick}>\\r\\n          {effectiveAvatarUrl && !avatarError ? (\\r\\n            <Image\\r\\n              key={avatarKey}\\r\\n              src={`${effectiveAvatarUrl}?t=${refreshKey}`}\\r\\n              alt=\\\"ç”¨æˆ·å¤´åƒ\\\"\\r\\n              width={160}\\r\\n              height={160}\\r\\n              className={styles.avatarImage}\\r\\n              priority\\r\\n              unoptimized={true}\\r\\n              onError={() => setAvatarError(true)}\\r\\n            />\\r\\n          ) : (\\r\\n            <div className={styles.avatarFallback}>\\r\\n              <span>{nameInitial}</span>\\r\\n            </div>\\r\\n          )}\\r\\n          \\r\\n          {/* å¤´åƒæ‚¬åœè¦†ç›–å±‚ */}\\r\\n          <div className={styles.avatarOverlay}>\\r\\n            <button \\r\\n              className={styles.avatarButton} \\r\\n              onClick={handleAvatarClick}\\r\\n              title=\\\"ç®¡ç†å¤´åƒ\\\"\\r\\n            >\\r\\n              <Camera size={24} />\\r\\n            </button>\\r\\n          </div>\\r\\n        </div>\\r\\n        <p className={styles.avatarHint}>ç‚¹å‡»æ›´æ¢å¤´åƒ</p>\\r\\n      </div>\\r\\n      \\r\\n      <div className={styles.info}>\\r\\n        <h1 className={styles.name}>{displayName}</h1>\\r\\n        <p className={styles.email}>{session.user?.email || 'æœªè®¾ç½®é‚®ç®±'}</p>\\r\\n        <div className={styles.buttons}>\\r\\n          <button\\r\\n            onClick={onEditClick}\\r\\n            className={styles.editButton}\\r\\n            disabled={isLoading}\\r\\n          >\\r\\n            ç¼–è¾‘ä¸ªäººä¿¡æ¯\\r\\n          </button>\\r\\n          <button\\r\\n            onClick={onPasswordClick}\\r\\n            className={styles.passwordButton}\\r\\n            disabled={isLoading}\\r\\n          >\\r\\n            è®¾ç½®å¯†ç \\r\\n          </button>\\r\\n        </div>\\r\\n      </div>\\r\\n      \\r\\n      {/* å¤´åƒç®¡ç†å¼¹çª— */}\\r\\n      <AvatarModal \\r\\n        isOpen={showAvatarModal}\\r\\n        onClose={() => setShowAvatarModal(false)}\\r\\n        currentAvatarUrl={effectiveAvatarUrl || null}\\r\\n        userDisplayName={displayName}\\r\\n        onAvatarChange={handleAvatarChange}\\r\\n      />\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default ProfileHeader; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\user-profile\\\\index.ts\",\n    \"newContent\": \"// å¯¼å‡ºuser-profileç›®å½•ä¸‹çš„æ‰€æœ‰ç»„ä»¶\\r\\nexport * from './avatar';\\r\\nexport * from './profileHeader';\\r\\nexport * from './profileContent';\\r\\nexport * from './completeness';\\r\\nexport * from './passwordForm';\\r\\nexport * from './editForm'; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\features\\\\user-profile\\\\profileHeader\\\\ProfileHeader.tsx\",\n    \"newContent\": \"import React, { useState, useRef, useEffect } from 'react';\\r\\nimport Image from 'next/image';\\r\\nimport { Session } from 'next-auth';\\r\\nimport { UserInfo } from '@/app/dashboard/page';\\r\\nimport { Camera, Upload, Trash2 } from 'lucide-react';\\r\\nimport styles from './ProfileHeader.module.css';\\r\\nimport { AvatarModal } from '@/app/components/features/user-profile/avatar';\\r\\n\\r\\ninterface ProfileHeaderProps {\\r\\n  session: Session;\\r\\n  userInfo: UserInfo;\\r\\n  onEditClick: () => void;\\r\\n  onPasswordClick: () => void;\\r\\n  isLoading: boolean;\\r\\n  onAvatarChange?: (avatarUrl: string) => void;\\r\\n}\\r\\n\\r\\nconst ProfileHeader = ({ \\r\\n  session, \\r\\n  userInfo,\\r\\n  onEditClick, \\r\\n  onPasswordClick, \\r\\n  isLoading,\\r\\n  onAvatarChange\\r\\n}: ProfileHeaderProps) => {\\r\\n  const [avatarError, setAvatarError] = useState(false);\\r\\n  const [showAvatarModal, setShowAvatarModal] = useState(false);\\r\\n  \\r\\n  // ä½¿ç”¨userInfoä¸­çš„displayNameä½œä¸ºé¦–é€‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨sessionä¸­çš„name\\r\\n  const displayName = userInfo.displayName || session.user?.name || 'æœªè®¾ç½®æ˜µç§°';\\r\\n  \\r\\n  // è·å–ç”¨äºå¤´åƒå ä½ç¬¦çš„é¦–å­—æ¯\\r\\n  const nameInitial = displayName[0]?.toUpperCase() || '?';\\r\\n\\r\\n  // ç®€åŒ–å¤´åƒURLé€»è¾‘ï¼Œç›´æ¥ä½¿ç”¨userInfoä¸­çš„å¤´åƒæˆ–sessionå¤´åƒ\\r\\n  const effectiveAvatarUrl = userInfo.avatarUrl || session.user?.image;\\r\\n  \\r\\n  // æ·»åŠ æ—¶é—´æˆ³ä½œä¸ºkeyçš„ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿æ¯æ¬¡å¤´åƒå˜æ›´éƒ½ä¼šé‡æ–°æ¸²æŸ“\\r\\n  const [refreshKey, setRefreshKey] = useState(Date.now());\\r\\n  const avatarKey = `${effectiveAvatarUrl || 'fallback'}-${refreshKey}`;\\r\\n\\r\\n  // æ·»åŠ useEffectç›‘å¬userInfo.avatarUrlçš„å˜åŒ–\\r\\n  useEffect(() => {\\r\\n    setRefreshKey(Date.now()); // å¼ºåˆ¶å¤´åƒé‡æ–°æ¸²æŸ“\\r\\n    setAvatarError(false); // é‡ç½®é”™è¯¯çŠ¶æ€\\r\\n  }, [userInfo.avatarUrl]);\\r\\n\\r\\n  // æ·»åŠ æ·±åº¦è°ƒè¯• - ç›‘æ§propså˜åŒ–\\r\\n  useEffect(() => {\\r\\n    console.log('ProfileHeaderæ”¶åˆ°æ–°çš„userInfo:', \\r\\n      { \\r\\n        avatarUrl: userInfo.avatarUrl,\\r\\n        hasAvatar: !!userInfo.avatarUrl,\\r\\n        displayName: userInfo.displayName\\r\\n      }\\r\\n    );\\r\\n  }, [userInfo]);\\r\\n\\r\\n  // æ‰“å¼€å¤´åƒç®¡ç†å¼¹çª—\\r\\n  const handleAvatarClick = () => {\\r\\n    setShowAvatarModal(true);\\r\\n  };\\r\\n\\r\\n  // å¤„ç†å¤´åƒå˜æ›´\\r\\n  const handleAvatarChange = (newAvatarUrl: string) => {\\r\\n    if (onAvatarChange) {\\r\\n      onAvatarChange(newAvatarUrl);\\r\\n    }\\r\\n    // å¼ºåˆ¶åˆ·æ–°\\r\\n    setRefreshKey(Date.now());\\r\\n  };\\r\\n\\r\\n  return (\\r\\n    <div className={styles.header}>\\r\\n      <div className={styles.avatarContainer}>\\r\\n        <div className={styles.avatar} onClick={handleAvatarClick}>\\r\\n          {effectiveAvatarUrl && !avatarError ? (\\r\\n            <Image\\r\\n              key={avatarKey}\\r\\n              src={`${effectiveAvatarUrl}?t=${refreshKey}`}\\r\\n              alt=\\\"ç”¨æˆ·å¤´åƒ\\\"\\r\\n              width={160}\\r\\n              height={160}\\r\\n              className={styles.avatarImage}\\r\\n              priority\\r\\n              unoptimized={true}\\r\\n              onError={() => setAvatarError(true)}\\r\\n            />\\r\\n          ) : (\\r\\n            <div className={styles.avatarFallback}>\\r\\n              <span>{nameInitial}</span>\\r\\n            </div>\\r\\n          )}\\r\\n          \\r\\n          {/* å¤´åƒæ‚¬åœè¦†ç›–å±‚ */}\\r\\n          <div className={styles.avatarOverlay}>\\r\\n            <button \\r\\n              className={styles.avatarButton} \\r\\n              onClick={handleAvatarClick}\\r\\n              title=\\\"ç®¡ç†å¤´åƒ\\\"\\r\\n            >\\r\\n              <Camera size={24} />\\r\\n            </button>\\r\\n          </div>\\r\\n        </div>\\r\\n        <p className={styles.avatarHint}>ç‚¹å‡»æ›´æ¢å¤´åƒ</p>\\r\\n      </div>\\r\\n      \\r\\n      <div className={styles.info}>\\r\\n        <h1 className={styles.name}>{displayName}</h1>\\r\\n        <p className={styles.email}>{session.user?.email || 'æœªè®¾ç½®é‚®ç®±'}</p>\\r\\n        <div className={styles.buttons}>\\r\\n          <button\\r\\n            onClick={onEditClick}\\r\\n            className={styles.editButton}\\r\\n            disabled={isLoading}\\r\\n          >\\r\\n            ç¼–è¾‘ä¸ªäººä¿¡æ¯\\r\\n          </button>\\r\\n          <button\\r\\n            onClick={onPasswordClick}\\r\\n            className={styles.passwordButton}\\r\\n            disabled={isLoading}\\r\\n          >\\r\\n            è®¾ç½®å¯†ç \\r\\n          </button>\\r\\n        </div>\\r\\n      </div>\\r\\n      \\r\\n      {/* å¤´åƒç®¡ç†å¼¹çª— */}\\r\\n      <AvatarModal \\r\\n        isOpen={showAvatarModal}\\r\\n        onClose={() => setShowAvatarModal(false)}\\r\\n        currentAvatarUrl={effectiveAvatarUrl || null}\\r\\n        userDisplayName={displayName}\\r\\n        onAvatarChange={handleAvatarChange}\\r\\n      />\\r\\n    </div>\\r\\n  );\\r\\n};\\r\\n\\r\\nexport default ProfileHeader; \"\n  },\n  {\n    \"path\": \"app\\\\components\\\\index.ts\",\n    \"newContent\": \"/**\\r\\n * ç»„ä»¶åº“ç´¢å¼•æ–‡ä»¶\\r\\n * \\r\\n * æ‰€æœ‰ç»„ä»¶å·²æŒ‰ç…§åŸå­è®¾è®¡æ¨¡å¼è¿›è¡Œé‡ç»„ï¼š\\r\\n * - ui/: åŸºç¡€UIç»„ä»¶\\r\\n *   - atoms/: åŸå­çº§ç»„ä»¶ï¼ˆæŒ‰é’®ã€è¾“å…¥æ¡†ç­‰ï¼‰\\r\\n *   - molecules/: åˆ†å­çº§ç»„ä»¶ï¼ˆå¤åˆUIå…ƒç´ ï¼‰\\r\\n *   - organisms/: æœ‰æœºä½“ç»„ä»¶ï¼ˆå®Œæ•´UIåŒºå—ï¼‰\\r\\n * \\r\\n * - common/: é€šç”¨åŠŸèƒ½ç»„ä»¶\\r\\n *   - feedback/: åé¦ˆç±»ç»„ä»¶ï¼ˆæç¤ºã€é€šçŸ¥ç­‰ï¼‰\\r\\n *   - form/: è¡¨å•ç›¸å…³ç»„ä»¶\\r\\n *   - media/: åª’ä½“ç»„ä»¶ï¼ˆéŸ³è§†é¢‘ç­‰ï¼‰\\r\\n * \\r\\n * - features/: ä¸šåŠ¡åŠŸèƒ½ç»„ä»¶\\r\\n *   - dashboard/: ä»ªè¡¨ç›˜ç›¸å…³ç»„ä»¶\\r\\n *   - file-management/: æ–‡ä»¶ç®¡ç†ç»„ä»¶\\r\\n *   - home/: é¦–é¡µç›¸å…³ç»„ä»¶\\r\\n *   - user-profile/: ç”¨æˆ·èµ„æ–™ç»„ä»¶\\r\\n * \\r\\n * ä¸ºä¿æŒå‘åå…¼å®¹æ€§ï¼Œæ‰€æœ‰ç»„ä»¶å¯ä»¥ä»æ ¹è·¯å¾„ç›´æ¥å¯¼å…¥\\r\\n */\\r\\n\\r\\n// ä»æ–°çš„ç›®å½•ç»“æ„ä¸­é‡æ–°å¯¼å‡ºç»„ä»¶\\r\\n// UIç»„ä»¶\\r\\nexport * from './ui';\\r\\n\\r\\n// å¯¼èˆªç»„ä»¶\\r\\nexport { default as Navbar } from './features/dashboard/navigation/Navbar';\\r\\n\\r\\n// æ–‡ä»¶ç®¡ç†ç»„ä»¶\\r\\nexport { default as UploadModal } from './features/file-management/upload/UploadModal';\\r\\nexport { default as FileUpload } from './features/file-management/upload/FileUpload';\\r\\nexport { default as TopActionBar } from './features/file-management/actionBar/TopActionBar';\\r\\nexport { default as SortDropdown } from './features/file-management/actionBar/SortDropdown';\\r\\nexport { default as NewFolderForm } from './features/file-management/folderManagement/NewFolderForm';\\r\\nexport { default as Toolbar } from './features/file-management/toolbar/Toolbar';\\r\\n\\r\\n// åˆ†æç»„ä»¶\\r\\nexport { default as StorageUsage } from './features/dashboard/analytics/StorageUsage';\\r\\n\\r\\n// åª’ä½“ç»„ä»¶\\r\\nexport { default as AudioVisualizer } from './common/media/AudioVisualizer';\\r\\n\\r\\n// ç”¨æˆ·èµ„æ–™ç»„ä»¶\\r\\nexport { default as ProfileHeader } from './features/user-profile/profileHeader';\\r\\nexport { default as ProfileCompleteness } from './features/user-profile/completeness';\\r\\nexport { default as PasswordForm } from './features/user-profile/passwordForm';\\r\\nexport { default as EditProfileForm } from './features/user-profile/editForm';\\r\\nexport * from './features/user-profile/avatar';\\r\\n\\r\\n// è¡¨å•ç»„ä»¶\\r\\nexport * from './common/form';\\r\\n\\r\\n// åé¦ˆç»„ä»¶\\r\\nexport { default as Toaster } from './common/feedback/toast';\\r\\n\\r\\n// é¦–é¡µç»„ä»¶\\r\\nexport { default as Hero } from './features/home/hero';\\r\\nexport { default as HomeHeader } from './features/home/header';\\r\\nexport { default as Footer } from './features/home/footer';\\r\\nexport { default as Features } from './features/home/features';\\r\\nexport { default as CTA } from './features/home/cta'; \"\n  },\n  {\n    \"path\": \"app\\\\dashboard\\\\page.tsx\",\n    \"newContent\": \"\\\"use client\\\"\\r\\n\\r\\nimport { useSession } from \\\"next-auth/react\\\"\\r\\nimport { useRouter } from 'next/navigation'\\r\\nimport { useState, useEffect, useRef } from \\\"react\\\"\\r\\nimport { ArrowLeft } from 'lucide-react'\\r\\n\\r\\n// å¯¼å…¥è‡ªå®šä¹‰é’©å­\\r\\nimport { useProfile, usePassword, UserProfile, UserProfileInput } from '@/app/hooks'\\r\\nimport { useToast } from '@/app/components/features/dashboard/Toaster'\\r\\nimport { useValidation } from './hooks/useValidation'\\r\\n// å¯¼å…¥ä¸»é¢˜æœåŠ¡\\r\\nimport { applyTheme as applyThemeService } from '@/app/shared/themes'\\r\\n\\r\\n// å¯¼å…¥ç»„ä»¶\\r\\nimport Modal from '@/app/components/features/dashboard/Modal'\\r\\nimport ProfileHeader from '@/app/components/features/dashboard/ProfileHeader'\\r\\nimport ProfileContent from '@/app/components/features/dashboard/ProfileContent'\\r\\nimport EditProfileForm from '@/app/components/features/dashboard/EditProfileForm'\\r\\nimport PasswordForm from '@/app/components/features/dashboard/PasswordForm'\\r\\nimport ProfileCompleteness from '@/app/components/features/dashboard/ProfileCompleteness'\\r\\n\\r\\n// åˆ›å»ºå…¼å®¹æ—§ç»„ä»¶çš„UserInfoæ¥å£\\r\\nexport interface UserInfo {\\r\\n  displayName: string;\\r\\n  bio: string;\\r\\n  location: string;\\r\\n  website: string;\\r\\n  company: string;\\r\\n  avatarUrl?: string | null; \\r\\n  theme?: string | null;     \\r\\n  createdAt?: string;        \\r\\n}\\r\\n\\r\\n// å¯¼å…¥æ ·å¼\\r\\nimport styles from './Dashboard.module.css'\\r\\n\\r\\nexport default function DashboardPage() {\\r\\n  const router = useRouter()\\r\\n  const { data: session, status } = useSession({\\r\\n    required: true,\\r\\n    onUnauthenticated() {\\r\\n      router.push('/auth/login')\\r\\n    },\\r\\n  })\\r\\n  \\r\\n  const [isEditModalOpen, setIsEditModalOpen] = useState(false)\\r\\n  const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false)\\r\\n  \\r\\n  const { \\r\\n    user-profile, \\r\\n    isLoading: profileLoading, \\r\\n    error: profileError, \\r\\n    updateUserProfile,\\r\\n    effectiveAvatarUrl\\r\\n  } = useProfile()\\r\\n  \\r\\n  // åˆ›å»ºä¸€ä¸ªæœ¬åœ°çŠ¶æ€ç”¨äºç¼–è¾‘ï¼Œå…¼å®¹æ—§çš„UserInfoæ ¼å¼\\r\\n  const [userInfo, setUserInfo] = useState<UserInfo>({\\r\\n    displayName: '',\\r\\n    bio: '',\\r\\n    location: '',\\r\\n    website: '',\\r\\n    company: '',\\r\\n    avatarUrl: null,\\r\\n    theme: null\\r\\n  })\\r\\n  \\r\\n  // å½“user-profileæ›´æ–°æ—¶ï¼ŒåŒæ­¥æ›´æ–°userInfo\\r\\n  useEffect(() => {\\r\\n    if (user-profile) {\\r\\n      setUserInfo({\\r\\n        displayName: user-profile.name || '',\\r\\n        bio: user-profile.bio || '',\\r\\n        location: user-profile.location || '',\\r\\n        website: user-profile.website || '',\\r\\n        company: user-profile.company || '',\\r\\n        avatarUrl: user-profile.avatarUrl,\\r\\n        theme: user-profile.theme,\\r\\n        createdAt: user-profile.createdAt\\r\\n      })\\r\\n    }\\r\\n  }, [user-profile])\\r\\n  \\r\\n  const {\\r\\n    passwordInfo,\\r\\n    passwordError,\\r\\n    passwordSuccess,\\r\\n    isLoading: passwordLoading,\\r\\n    showPassword,\\r\\n    showConfirmPassword,\\r\\n    setShowPassword,\\r\\n    setShowConfirmPassword,\\r\\n    handlePasswordChange,\\r\\n    updatePassword,\\r\\n    resetPasswordState\\r\\n  } = usePassword()\\r\\n\\r\\n  const [isSaving, setIsSaving] = useState(false)\\r\\n  const toast = useToast()\\r\\n  const { validateForm } = useValidation()\\r\\n\\r\\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>, field: string) => {\\r\\n    setUserInfo(prev => ({...prev, [field]: e.target.value}))\\r\\n  }\\r\\n\\r\\n  const handleSave = async () => {\\r\\n    try {\\r\\n      console.log('ä¿å­˜ç”¨æˆ·èµ„æ–™:', userInfo);\\r\\n      \\r\\n      // è¡¨å•éªŒè¯\\r\\n      if (!validateForm(userInfo)) {\\r\\n        toast.error('è¯·ä¿®æ­£è¡¨å•ä¸­çš„é”™è¯¯åå†æäº¤');\\r\\n        return;\\r\\n      }\\r\\n      \\r\\n      // ç¦ç”¨ä¿å­˜æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤\\r\\n      setIsSaving(true);\\r\\n      \\r\\n      // è½¬æ¢ä¸ºUserProfileInputæ ¼å¼\\r\\n      const profileInput: UserProfileInput = {\\r\\n        displayName: userInfo.displayName,\\r\\n        bio: userInfo.bio,\\r\\n        location: userInfo.location,\\r\\n        website: userInfo.website,\\r\\n        company: userInfo.company,\\r\\n        // ä»…åœ¨énullæ—¶åŒ…å«avatarUrl\\r\\n        ...(userInfo.avatarUrl && { avatarUrl: userInfo.avatarUrl }),\\r\\n        // ä»…åœ¨énullæ—¶åŒ…å«theme\\r\\n        ...(userInfo.theme && { theme: userInfo.theme })\\r\\n      };\\r\\n      \\r\\n      const success = await updateUserProfile(profileInput);\\r\\n      \\r\\n      if (success) {\\r\\n        setIsEditModalOpen(false);\\r\\n        // ä½¿ç”¨Toasté€šçŸ¥æ›¿ä»£alert\\r\\n        toast.success('ä¸ªäººä¿¡æ¯å·²æˆåŠŸä¿å­˜ï¼');\\r\\n      } else {\\r\\n        // ä¿å­˜å¤±è´¥æç¤º\\r\\n        toast.error('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');\\r\\n      }\\r\\n    } catch (error) {\\r\\n      console.error('ä¿å­˜ç”¨æˆ·èµ„æ–™æ—¶å‡ºé”™:', error);\\r\\n      toast.error('å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');\\r\\n    } finally {\\r\\n      // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½é‡æ–°å¯ç”¨ä¿å­˜æŒ‰é’®\\r\\n      setIsSaving(false);\\r\\n    }\\r\\n  }\\r\\n\\r\\n  const handlePasswordSave = async () => {\\r\\n    const success = await updatePassword()\\r\\n    if (success) {\\r\\n      setIsPasswordModalOpen(false)\\r\\n    }\\r\\n  }\\r\\n\\r\\n  const openPasswordModal = () => {\\r\\n    resetPasswordState()\\r\\n    setIsPasswordModalOpen(true)\\r\\n  }\\r\\n\\r\\n  // åº”ç”¨ä¸»é¢˜\\r\\n  useEffect(() => {\\r\\n    if (user-profile?.theme) {\\r\\n      applyTheme(user-profile.theme);\\r\\n    }\\r\\n  }, [user-profile?.theme]);\\r\\n\\r\\n  // å¤„ç†ä¸»é¢˜æ›´æ”¹\\r\\n  const handleThemeChange = async (themeId: string) => {\\r\\n    // å…ˆç«‹å³åœ¨æœ¬åœ°åº”ç”¨ä¸»é¢˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\\r\\n    applyTheme(themeId);\\r\\n    \\r\\n    // æ›´æ–°ç”¨æˆ·èµ„æ–™ä¸­çš„ä¸»é¢˜\\r\\n    try {\\r\\n      const profileInput: UserProfileInput = {\\r\\n        theme: themeId\\r\\n      };\\r\\n      const success = await updateUserProfile(profileInput);\\r\\n      if (success) {\\r\\n        console.log(`ä¸»é¢˜ ${themeId} å·²æˆåŠŸåº”ç”¨å¹¶ä¿å­˜åˆ°æœåŠ¡å™¨`);\\r\\n      } else {\\r\\n        console.warn(`ä¸»é¢˜ ${themeId} å·²åœ¨æœ¬åœ°åº”ç”¨ï¼Œä½†æœªèƒ½ä¿å­˜åˆ°æœåŠ¡å™¨`);\\r\\n      }\\r\\n      return success;\\r\\n    } catch (error) {\\r\\n      console.error(`ä¸»é¢˜ ${themeId} åº”ç”¨å‘ç”Ÿé”™è¯¯:`, error);\\r\\n      // å³ä½¿ä¿å­˜å¤±è´¥ï¼Œæœ¬åœ°ä¸»é¢˜å·²åº”ç”¨ï¼Œæ‰€ä»¥ä¾ç„¶è¿”å›trueè®©UIä¿æŒå·²é€‰çŠ¶æ€\\r\\n      return true;\\r\\n    }\\r\\n  };\\r\\n\\r\\n  // å°†ä¸»é¢˜åº”ç”¨åˆ°æ–‡æ¡£ - ä½¿ç”¨ç»Ÿä¸€çš„ä¸»é¢˜æœåŠ¡\\r\\n  const applyTheme = (theme: string) => {\\r\\n    applyThemeService(theme);\\r\\n  };\\r\\n\\r\\n  // å¼•ç”¨ProfileHeaderä¸­çš„fileInputRef\\r\\n  const fileInputRef = useRef<HTMLInputElement>(null);\\r\\n\\r\\n  // è§¦å‘å¤´åƒä¸Šä¼ åŠŸèƒ½\\r\\n  const handleAvatarClick = () => {\\r\\n    console.log('èµ„æ–™å®Œæ•´åº¦å¤´åƒç‚¹å‡»è¢«è§¦å‘');\\r\\n    \\r\\n    // é¦–å…ˆå°è¯•ä½¿ç”¨ç‰¹å®šçš„classæŸ¥æ‰¾\\r\\n    const avatarInput = document.querySelector('.avatar-upload-input');\\r\\n    if (avatarInput && avatarInput instanceof HTMLInputElement) {\\r\\n      console.log('é€šè¿‡classæ‰¾åˆ°å¤´åƒä¸Šä¼ inputï¼Œè§¦å‘ç‚¹å‡»');\\r\\n      avatarInput.click();\\r\\n      return;\\r\\n    }\\r\\n    \\r\\n    // å¤‡ç”¨æ–¹æ¡ˆ1ï¼šé€šè¿‡å®¹å™¨classæŸ¥æ‰¾\\r\\n    const containerInput = document.querySelector('.avatarContainer input[type=\\\"file\\\"]');\\r\\n    if (containerInput && containerInput instanceof HTMLInputElement) {\\r\\n      console.log('é€šè¿‡å®¹å™¨æ‰¾åˆ°å¤´åƒä¸Šä¼ inputï¼Œè§¦å‘ç‚¹å‡»');\\r\\n      containerInput.click();\\r\\n      return;\\r\\n    }\\r\\n    \\r\\n    // å¤‡ç”¨æ–¹æ¡ˆ2ï¼šæŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ input\\r\\n    console.error('æœªæ‰¾åˆ°ç²¾ç¡®çš„å¤´åƒä¸Šä¼ inputå…ƒç´ ï¼Œå°è¯•æŸ¥æ‰¾æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ æ§ä»¶');\\r\\n    const fileInputs = document.querySelectorAll('input[type=\\\"file\\\"]');\\r\\n    let found = false;\\r\\n    fileInputs.forEach(input => {\\r\\n      const fileInput = input as HTMLInputElement;\\r\\n      if (fileInput.accept && fileInput.accept.includes('image')) {\\r\\n        console.log('æ‰¾åˆ°å¤‡é€‰å›¾ç‰‡ä¸Šä¼ inputï¼Œè§¦å‘ç‚¹å‡»');\\r\\n        fileInput.click();\\r\\n        found = true;\\r\\n        return;\\r\\n      }\\r\\n    });\\r\\n    \\r\\n    if (!found) {\\r\\n      console.error('æ— æ³•æ‰¾åˆ°ä»»ä½•å›¾ç‰‡ä¸Šä¼ æ§ä»¶');\\r\\n      alert('æ— æ³•æ‰¾åˆ°å¤´åƒä¸Šä¼ æ§ä»¶ï¼Œè¯·å°è¯•ç›´æ¥ç‚¹å‡»å¤´åƒè¿›è¡Œä¸Šä¼ ');\\r\\n    }\\r\\n  };\\r\\n\\r\\n  // åŠ è½½çŠ¶æ€\\r\\n  if (status === 'loading' || profileLoading) {\\r\\n    return (\\r\\n      <div className={styles.loading}>\\r\\n        <div className={styles.loadingCard}>\\r\\n          <div className={styles.loadingSpinner}></div>\\r\\n          <h2 className={styles.loadingTitle}>åŠ è½½ä¸­...</h2>\\r\\n          <p className={styles.loadingText}>æ­£åœ¨è·å–æ‚¨çš„ä¸ªäººä¿¡æ¯</p>\\r\\n        </div>\\r\\n      </div>\\r\\n    )\\r\\n  }\\r\\n\\r\\n  // é”™è¯¯çŠ¶æ€\\r\\n  if (profileError) {\\r\\n    return (\\r\\n      <div className={styles.errorContainer}>\\r\\n        <div className={styles.errorCard}>\\r\\n          <div className={styles.errorIcon}>âš ï¸</div>\\r\\n          <h2 className={styles.errorTitle}>åŠ è½½å¤±è´¥</h2>\\r\\n          <p className={styles.errorText}>{profileError}</p>\\r\\n          <button\\r\\n            onClick={() => window.location.reload()}\\r\\n            className={styles.retryButton}\\r\\n          >\\r\\n            é‡è¯•\\r\\n          </button>\\r\\n        </div>\\r\\n      </div>\\r\\n    )\\r\\n  }\\r\\n\\r\\n  // æœªç™»å½•\\r\\n  if (!session?.user) {\\r\\n    return null\\r\\n  }\\r\\n\\r\\n  // ç¼–è¾‘ä¸ªäººä¿¡æ¯å¼¹çª—åº•éƒ¨æŒ‰é’®\\r\\n  const renderEditFooter = () => (\\r\\n    <div className={styles.modalFooterButtons}>\\r\\n      <button\\r\\n        onClick={() => setIsEditModalOpen(false)}\\r\\n        className={styles.cancelButton}\\r\\n        disabled={isSaving}\\r\\n      >\\r\\n        å–æ¶ˆ\\r\\n      </button>\\r\\n      <button\\r\\n        onClick={handleSave}\\r\\n        className={styles.saveButton}\\r\\n        disabled={isSaving}\\r\\n      >\\r\\n        {isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜æ›´æ”¹'}\\r\\n      </button>\\r\\n    </div>\\r\\n  );\\r\\n\\r\\n  // è®¾ç½®å¯†ç å¼¹çª—åº•éƒ¨æŒ‰é’®\\r\\n  const renderPasswordFooter = () => (\\r\\n    <div className={styles.modalFooterButtons}>\\r\\n      <button\\r\\n        onClick={() => setIsPasswordModalOpen(false)}\\r\\n        className={styles.cancelButton}\\r\\n      >\\r\\n        å–æ¶ˆ\\r\\n      </button>\\r\\n      <button\\r\\n        onClick={handlePasswordSave}\\r\\n        className={styles.saveButton}\\r\\n        disabled={passwordLoading}\\r\\n      >\\r\\n        ä¿å­˜å¯†ç \\r\\n      </button>\\r\\n    </div>\\r\\n  );\\r\\n\\r\\n  return (\\r\\n    <div className={styles.container}>\\r\\n      <div className={styles.profile}>\\r\\n        {/* è¿”å›æŒ‰é’® */}\\r\\n        <button \\r\\n          onClick={() => router.push('/file-management/main')}\\r\\n          className={styles.backButton}\\r\\n          title=\\\"è¿”å›æ–‡ä»¶ç®¡ç†\\\"\\r\\n        >\\r\\n          <ArrowLeft className=\\\"w-5 h-5\\\" />\\r\\n        </button>\\r\\n        \\r\\n        <div className={styles.profileHeader}>\\r\\n          {/* ä¸ªäººèµ„æ–™å¤´éƒ¨ */}\\r\\n          <ProfileHeader \\r\\n            session={session}\\r\\n            userInfo={userInfo}\\r\\n            onEditClick={() => setIsEditModalOpen(true)}\\r\\n            onPasswordClick={openPasswordModal}\\r\\n            isLoading={profileLoading || passwordLoading}\\r\\n            onAvatarChange={async (avatarUrl) => {\\r\\n              console.log('å¤´åƒå˜æ›´è¢«è§¦å‘ï¼Œæ–°URL:', avatarUrl);\\r\\n              \\r\\n              try {\\r\\n                // åˆ›å»ºæ–°çš„userInfoå¯¹è±¡\\r\\n                const updatedInfo = {...userInfo, avatarUrl};\\r\\n                console.log('æ›´æ–°åçš„userInfo:', updatedInfo);\\r\\n                \\r\\n                // æ›´æ–°æœ¬åœ°çŠ¶æ€\\r\\n                setUserInfo(updatedInfo);\\r\\n                \\r\\n                // è½¬æ¢ä¸ºUserProfileInputæ ¼å¼\\r\\n                const profileInput: UserProfileInput = {\\r\\n                  displayName: updatedInfo.displayName,\\r\\n                  bio: updatedInfo.bio,\\r\\n                  location: updatedInfo.location,\\r\\n                  website: updatedInfo.website,\\r\\n                  company: updatedInfo.company,\\r\\n                  avatarUrl: updatedInfo.avatarUrl,\\r\\n                  // ä»…åœ¨themeä¸ä¸ºnullæ—¶åŒ…å«\\r\\n                  ...(updatedInfo.theme && { theme: updatedInfo.theme })\\r\\n                };\\r\\n                \\r\\n                // ä¿å­˜åˆ°æ•°æ®åº“å¹¶ç­‰å¾…å®Œæˆ\\r\\n                const success = await updateUserProfile(profileInput);\\r\\n                console.log('ä¿å­˜å¤´åƒåˆ°æ•°æ®åº“ç»“æœ:', success ? 'æˆåŠŸ' : 'å¤±è´¥');\\r\\n                \\r\\n                // å¦‚æœä¿å­˜å¤±è´¥ï¼Œå¼ºåˆ¶é‡æ–°è·å–ç”¨æˆ·æ•°æ®\\r\\n                if (!success) {\\r\\n                  window.location.reload(); // æœ€åçš„æ‰‹æ®µï¼šåˆ·æ–°æ•´ä¸ªé¡µé¢\\r\\n                }\\r\\n              } catch (error) {\\r\\n                console.error('å¤„ç†å¤´åƒå˜æ›´æ—¶å‡ºé”™:', error);\\r\\n                alert('æ›´æ–°å¤´åƒå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');\\r\\n              }\\r\\n            }}\\r\\n          />\\r\\n        </div>\\r\\n        \\r\\n        {/* èµ„æ–™å®Œæ•´åº¦ */}\\r\\n        <ProfileCompleteness \\r\\n          userInfo={userInfo} \\r\\n          onEditClick={() => setIsEditModalOpen(true)}\\r\\n          onAvatarClick={handleAvatarClick}\\r\\n        />\\r\\n        \\r\\n        {/* ä¸ªäººèµ„æ–™å†…å®¹ */}\\r\\n        <ProfileContent \\r\\n          session={session}\\r\\n          userInfo={userInfo}\\r\\n          isLoading={profileLoading || passwordLoading}\\r\\n        />\\r\\n      </div>\\r\\n\\r\\n      {/* ç¼–è¾‘ä¸ªäººä¿¡æ¯å¼¹çª— */}\\r\\n      <Modal\\r\\n        isOpen={isEditModalOpen}\\r\\n        onClose={() => setIsEditModalOpen(false)}\\r\\n        title=\\\"ç¼–è¾‘ä¸ªäººä¿¡æ¯\\\"\\r\\n        footer={renderEditFooter()}\\r\\n      >\\r\\n        <EditProfileForm \\r\\n          userInfo={userInfo}\\r\\n          onInputChange={handleInputChange}\\r\\n        />\\r\\n      </Modal>\\r\\n\\r\\n      {/* è®¾ç½®å¯†ç å¼¹çª— */}\\r\\n      <Modal\\r\\n        isOpen={isPasswordModalOpen}\\r\\n        onClose={() => setIsPasswordModalOpen(false)}\\r\\n        title=\\\"è®¾ç½®å¯†ç \\\"\\r\\n        footer={renderPasswordFooter()}\\r\\n      >\\r\\n        <PasswordForm\\r\\n          passwordInfo={passwordInfo}\\r\\n          passwordError={passwordError}\\r\\n          passwordSuccess={passwordSuccess}\\r\\n          showPassword={showPassword}\\r\\n          showConfirmPassword={showConfirmPassword}\\r\\n          setShowPassword={setShowPassword}\\r\\n          setShowConfirmPassword={setShowConfirmPassword}\\r\\n          handlePasswordChange={handlePasswordChange}\\r\\n          userEmail={session.user.email}\\r\\n        />\\r\\n      </Modal>\\r\\n    </div>\\r\\n  )\\r\\n} \"\n  },\n  {\n    \"path\": \"app\\\\file-management\\\\main\\\\page.tsx\",\n    \"newContent\": \"// @ts-nocheck\\n'use client';\\n\\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\\nimport { useSession, signOut } from 'next-auth/react';\\nimport { useRouter } from 'next/navigation';\\nimport { message, Spin } from 'antd';\\nimport Head from 'next/head';\\n\\n// å¼•å…¥å…±äº«ç»„ä»¶\\nimport { Sidebar } from '@/app/components/features/file-management/navigation/Sidebar';\\nimport { Breadcrumb } from '@/app/components/features/file-management/navigation/Breadcrumb';\\nimport { FileList } from '@/app/components/features/file-management/fileList/FileList';\\nimport { SkeletonPageLayout } from '@/app/components/features/file-management/shared/Skeleton';\\nimport { ErrorDisplay } from '@/app/components/features/file-management/shared/ErrorDisplay';\\nimport UploadModal from '@/app/components/features/file-management/upload/UploadModal';\\nimport { FilePreview } from '@/app/components/features/file-management/filePreview/FilePreview';\\nimport { RenameModal } from '@/app/components/features/file-management/fileOperations/RenameModal';\\nimport ThemePanel from '@/app/shared/themes/components/ThemePanel';\\n\\n// å¯¼å…¥è‡ªå®šä¹‰ç»„ä»¶\\nimport MiniSidebar from '@/app/components/features/file-management/navigation/MiniSidebar';\\nimport { TopActionBar } from '@/app/components/features/file-management/actionBar/TopActionBar';\\nimport NewFolderForm from '@/app/components/features/file-management/folderManagement/NewFolderForm';\\nimport { SearchView } from '@/app/components/features/file-management/SearchView';\\n\\n// å¯¼å…¥è‡ªå®šä¹‰ hooks\\nimport { \\n  useFiles, \\n  useFileOperations, \\n  useFileUpload, \\n  useFileSearch, \\n  useFilePreview,\\n  useLoadingState, \\n  useUIState, \\n  useThemeManager, \\n  useProfile \\n} from '@/app/hooks';\\n// å¯¼å…¥ç±»å‹å’Œå·¥å…·å‡½æ•°\\nimport { SortOrder, FileInfo } from '@/app/types';\\nimport { convertFilesForDisplay } from '@/app/utils/file/converter';\\n\\n// å¯¼å…¥æ ·å¼\\nimport styles from '../styles/shared.module.css';\\n\\nexport default function FileManagementPage() {\\n  const router = useRouter();\\n  const { data: session, status } = useSession();\\n  \\n  // è·å–ç”¨æˆ·èµ„æ–™ç›¸å…³çŠ¶æ€ï¼ŒåŒ…æ‹¬åŠ è½½çŠ¶æ€\\n  const { \\n    user-profile, \\n    isLoading: profileLoading, \\n    error: profileError,\\n    fetchUserProfile, \\n    forceRefreshProfile,\\n    effectiveAvatarUrl\\n  } = useProfile();\\n\\n  // ä½¿ç”¨ä¸»é¢˜ç®¡ç†hook\\n  const { currentTheme, updateTheme } = useThemeManager();\\n\\n  // ä½¿ç”¨åŒçŠ¶æ€åŠ è½½ç®¡ç†\\n  const {\\n    loadingState,\\n    error: loadingError,\\n    isInitialLoading,\\n    isRefreshing,\\n    isError: isLoadingError,\\n    startLoading,\\n    finishLoading\\n  } = useLoadingState({\\n    initialLoad: true,\\n    minLoadingTime: 800\\n  });\\n  \\n  // ä½¿ç”¨useFilesé’©å­è·å–æ–‡ä»¶åˆ—è¡¨å’Œç›¸å…³æ“ä½œ\\n  const {\\n    files,\\n    isLoading: filesLoading,\\n    error: filesError,\\n    currentFolderId,\\n    folderPath,\\n    selectedFileType,\\n    selectedFiles,\\n    sortOrder,\\n    loadFiles,\\n    toggleSelectFile: handleSelectFile,\\n    toggleSelectAll,\\n    changeSort,\\n    filterByFileType,\\n    openFolder,\\n    refreshCurrentFolder,\\n    handleFileClick,\\n    handleBackClick,\\n    handleFileUpdate,\\n    setCurrentFolderId,\\n    setFolderPath,\\n    setSelectedFileType,\\n    setSelectedFiles,\\n    setSortOrder\\n  } = useFiles();\\n\\n  // UIçŠ¶æ€ç®¡ç†\\n  const {\\n    sidebarVisible,\\n    myFilesExpanded,\\n    quickAccessExpanded,\\n    isUploadModalOpen,\\n    isFolderUploadModalOpen,\\n    showUploadDropdown,\\n    setSidebarVisible,\\n    setMyFilesExpanded,\\n    setQuickAccessExpanded,\\n    setIsUploadModalOpen,\\n    setIsFolderUploadModalOpen,\\n    setShowUploadDropdown,\\n    uploadDropdownRef\\n  } = useUIState();\\n\\n  // æ·»åŠ ä¸»é¢˜é¢æ¿çŠ¶æ€\\n  const [showThemePanel, setShowThemePanel] = useState(false);\\n\\n  // æ–‡ä»¶æ“ä½œé’©å­\\n  const {\\n    createFolder: handleCreateFolder,\\n    downloadFiles: handleDownload,\\n    deleteFiles: handleDelete,\\n    renameFile: handleRenameFile,\\n    isLoading: fileOperationsLoading,\\n    error: fileOperationsError\\n  } = useFileOperations([]);\\n\\n  // å…ˆè°ƒç”¨æ–‡ä»¶æœç´¢é’©å­ï¼Œç¡®ä¿updateFileInResultså¯ç”¨\\n  const {\\n    searchQuery,\\n    setSearchQuery,\\n    searchResults,\\n    isLoading: searchLoading,\\n    error: searchError,\\n    showSearchView,\\n    setShowSearchView,\\n    searchType,\\n    setSearchType,\\n    enableRealTimeSearch,\\n    setEnableRealTimeSearch,\\n    debounceDelay,\\n    setDebounceDelay,\\n    handleSearch,\\n    updateFileInResults\\n  } = useFileSearch();\\n\\n  // æ–‡ä»¶é¢„è§ˆå’Œé‡å‘½å - ä¼ å…¥selectedFileTypeå‚æ•°\\n  const {\\n    previewFile,\\n    setPreviewFile,\\n    handlePreview: handlePreviewFile,\\n    closePreview: handleClosePreview,\\n    isRenameModalOpen,\\n    setIsRenameModalOpen,\\n    fileToRename,\\n    setFileToRename,\\n    openRename: handleRenameButtonClick,\\n    renameFile: handleConfirmEdit\\n  } = useFilePreview({\\n    onRefresh: () => loadFiles(currentFolderId, selectedFileType, true),\\n    onFileUpdate: handleFileUpdate,  // ä¼ å…¥æ–‡ä»¶æ›´æ–°å¤„ç†å‡½æ•°\\n    onSearchResultsUpdate: updateFileInResults,  // ä¼ å…¥æœç´¢ç»“æœæ›´æ–°å‡½æ•°\\n    selectedFileType  // ä¼ å…¥å½“å‰é€‰æ‹©çš„æ–‡ä»¶ç±»å‹\\n  });\\n\\n  // æ·»åŠ åˆ›å»ºæ–‡ä»¶å¤¹ç›¸å…³çŠ¶æ€\\n  const [isCreatingFolder, setIsCreatingFolder] = useState(false);\\n  const [newFolderName, setNewFolderName] = useState('');\\n  const [newFolderTags, setNewFolderTags] = useState<string[]>([]);\\n  const [editingFile, setEditingFile] = useState<any>(null);\\n  const [editingName, setEditingName] = useState('');\\n  const [editingTags, setEditingTags] = useState<string[]>([]);\\n  const [newTag, setNewTag] = useState('');\\n  const [selectedFile, setSelectedFile] = useState<FileInfo | null>(null);\\n\\n  // æ–‡ä»¶ä¸Šä¸‹æ–‡èœå•å¤„ç† - ç§»è‡³hookså£°æ˜åŒºåŸŸ\\n  const handleFileContextMenu = useCallback((e, file, setSelectedFile, setSelectedFiles) => {\\n    // é˜»æ­¢é»˜è®¤å³é”®èœå•\\n    e?.preventDefault();\\n    e?.stopPropagation();\\n    \\n    if (file) {\\n      // è®¾ç½®å½“å‰é€‰ä¸­çš„æ–‡ä»¶\\n      setSelectedFile?.(file);\\n      \\n      // å¦‚æœæ˜¯å•å‡»é€‰æ‹©ï¼Œåªé€‰æ‹©å½“å‰æ–‡ä»¶\\n      if (e?.type === 'contextmenu') {\\n        setSelectedFiles?.([file.id]);\\n      }\\n      \\n      // å¦‚æœæ˜¯æ–‡ä»¶ï¼ˆä¸æ˜¯æ–‡ä»¶å¤¹ï¼‰ï¼Œå¯ä»¥è®¾ç½®ä¸ºè¦é‡å‘½åçš„æ–‡ä»¶\\n      if (!file.isFolder) {\\n        setFileToRename(file);\\n      }\\n    }\\n  }, [setFileToRename]);\\n\\n  // æ ‡ç­¾ç›¸å…³å¤„ç†å‡½æ•°\\n  const handleAddTag = useCallback((tag: string) => {\\n    if (editingFile) {\\n      setEditingTags(prev => [...prev, tag]);\\n    } else {\\n      setNewFolderTags(prev => [...prev, tag]);\\n    }\\n    setNewTag('');\\n  }, [editingFile]);\\n\\n  const handleRemoveTag = useCallback((tag: string) => {\\n    if (editingFile) {\\n      setEditingTags(prev => prev.filter(t => t !== tag));\\n    } else {\\n      setNewFolderTags(prev => prev.filter(t => t !== tag));\\n    }\\n  }, [editingFile]);\\n\\n  // çŠ¶æ€è·Ÿè¸ªå¼•ç”¨\\n  const hasLoadedFilesRef = React.useRef(false);\\n  const sessionInitializedRef = React.useRef(false);\\n  // æ·»åŠ é˜²æ­¢é‡å¤åŠ è½½çš„æ ‡å¿—ï¼Œæ”¾åœ¨é¡¶å±‚\\n  const loadInProgressRef = useRef(false);\\n\\n  // åœ¨æ–‡ä»¶ä¸Šä¼ æˆ–æ–‡ä»¶å¤¹ä¸Šä¼ æˆåŠŸåè§¦å‘çš„å‡½æ•°\\n  const handleUploadSuccess = useCallback(() => {\\n    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\\n    startLoading(true);\\n    \\n    // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨ï¼Œä¿æŒå½“å‰æ–‡ä»¶ç±»å‹è¿‡æ»¤ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\\n    loadFiles(currentFolderId, selectedFileType, true).finally(() => {\\n      finishLoading();\\n    });\\n  }, [currentFolderId, loadFiles, selectedFileType, startLoading, finishLoading]);\\n\\n  // å¤„ç†åˆ›å»ºæ–‡ä»¶å¤¹æŒ‰é’®ç‚¹å‡»\\n  const handleCreateFolderClick = useCallback(() => {\\n    setIsCreatingFolder(true);\\n  }, [setIsCreatingFolder]);\\n\\n  const handleSignOut = useCallback(async () => {\\n    try {\\n      await signOut({ \\n        callbackUrl: '/',\\n        redirect: true \\n      });\\n    } catch (error) {\\n      console.error('é€€å‡ºæ—¶å‘ç”Ÿé”™è¯¯:', error);\\n      // å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œå°è¯•å¼ºåˆ¶è·³è½¬åˆ°é¦–é¡µ\\n      window.location.href = '/';\\n    }\\n  }, []);\\n\\n  // Sidebarä¸­\\\"æœç´¢æ–‡ä»¶\\\"ç‚¹å‡»å¤„ç†å‡½æ•°\\n  const handleSearchClick = useCallback(() => {\\n    setShowSearchView(true);\\n  }, [setShowSearchView]);\\n\\n  // å¤„ç†æ–‡ä»¶ç‚¹å‡»\\n  const handleFileItemClick = useCallback((file) => {\\n    const localFile = files.find(f => f.id === file.id);\\n    if (!localFile) return;\\n\\n    if (localFile.isFolder) {\\n      // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œç»§ç»­ä½¿ç”¨åŸæœ‰çš„å¯¼èˆªé€»è¾‘\\n      handleFileClick(localFile);\\n    } else {\\n      // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œæ‰“å¼€é¢„è§ˆ\\n      handlePreviewFile(localFile);\\n    }\\n  }, [files, handleFileClick, handlePreviewFile]);\\n\\n  // å¤„ç†å…¨é€‰æ–‡ä»¶\\n  const onSelectAllFiles = useCallback(() => {\\n    setSelectedFiles(files.map(file => file.id));\\n  }, [files, setSelectedFiles]);\\n\\n  // å¤„ç†å–æ¶ˆå…¨é€‰\\n  const onDeselectAllFiles = useCallback(() => {\\n    setSelectedFiles([]);\\n  }, [setSelectedFiles]);\\n\\n  // å¤„ç†æ–‡ä»¶å¤é€‰æ¡†å˜åŒ–\\n  const onFileCheckboxChange = useCallback((file: FileInfo, checked: boolean) => {\\n    handleSelectFile(file.id, checked);\\n  }, [handleSelectFile]);\\n\\n  // å¤„ç†è¿”å›æ ¹ç›®å½•/æ¸…é™¤è¿‡æ»¤å™¨ - ç§»åˆ°è¿™é‡Œ\\n  const handleClearFilter = useCallback(() => {\\n    setShowSearchView(false);\\n    setSelectedFileType(null);\\n    setCurrentFolderId(null);\\n    setFolderPath([]);\\n    \\n    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\\n    startLoading(true);\\n    \\n    // ä¼ é€’nullç±»å‹å‚æ•°ä»¥ç¡®ä¿æ¸…é™¤è¿‡æ»¤ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\\n    loadFiles(null, null, true)\\n      .finally(() => finishLoading());\\n  }, [setShowSearchView, setSelectedFileType, setCurrentFolderId, setFolderPath, startLoading, loadFiles, finishLoading]);\\n\\n  // å¤„ç†æ ¹ç›®å½•ç‚¹å‡» - ç§»åˆ°è¿™é‡Œ\\n  const handleRootClick = useCallback(() => {\\n    setCurrentFolderId(null);\\n    setFolderPath([]);\\n    \\n    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\\n    startLoading(true);\\n    \\n    // ä¿æŒå½“å‰é€‰ä¸­çš„æ–‡ä»¶ç±»å‹ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\\n    loadFiles(null, selectedFileType, true)\\n      .finally(() => finishLoading());\\n  }, [setCurrentFolderId, setFolderPath, startLoading, loadFiles, selectedFileType, finishLoading]);\\n\\n  // é‡å®šå‘é€»è¾‘ä¼˜åŒ–\\n  useEffect(() => {\\n    // åªåœ¨çŠ¶æ€ç¡®å®šæ—¶æ‰§è¡Œï¼Œé¿å…åˆå§‹loadingçŠ¶æ€è§¦å‘é‡å®šå‘\\n    if (status === 'unauthenticated') {\\n      console.log('ç”¨æˆ·æœªè®¤è¯ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢');\\n      router.replace('/auth/login');\\n    } else if (status === 'authenticated') {\\n      console.log('ç”¨æˆ·å·²è®¤è¯ï¼Œç¡®è®¤ä¼šè¯çŠ¶æ€');\\n      sessionInitializedRef.current = true;\\n    }\\n  }, [status, router]);\\n\\n  // æ–‡ä»¶åŠ è½½é€»è¾‘ä¼˜åŒ–\\n  useEffect(() => {\\n    // ç¡®ä¿sessionå­˜åœ¨ä¸”çŠ¶æ€ä¸ºå·²è®¤è¯ï¼Œä¸”æ–‡ä»¶æœªåŠ è½½è¿‡\\n    if (status === 'authenticated' && session?.user && !hasLoadedFilesRef.current && !loadInProgressRef.current) {\\n      console.log('åˆå§‹åŠ è½½æ–‡ä»¶åˆ—è¡¨', { currentFolderId, selectedFileType, session: !!session });\\n      \\n      // æ ‡è®°å·²ç»å¼€å§‹åŠ è½½\\n      hasLoadedFilesRef.current = true;\\n      loadInProgressRef.current = true;\\n      \\n      // å¼€å§‹åŠ è½½ï¼Œè¿™æ˜¯åˆå§‹åŠ è½½ï¼Œä½¿ç”¨éª¨æ¶å±\\n      startLoading(false);\\n      \\n      // æ·»åŠ å»¶è¿Ÿï¼Œç¡®ä¿sessionå®Œå…¨åˆå§‹åŒ–\\n      setTimeout(() => {\\n        // ä¿®æ”¹ä¸ºå…ˆåŠ è½½ç”¨æˆ·èµ„æ–™ï¼ŒæˆåŠŸåå†åŠ è½½æ–‡ä»¶åˆ—è¡¨\\n        fetchUserProfile()\\n          .then(user-profileData => {\\n            if (user-profileData) {\\n              console.log('ç”¨æˆ·èµ„æ–™åŠ è½½æˆåŠŸï¼Œç»§ç»­åŠ è½½æ–‡ä»¶åˆ—è¡¨');\\n              // åªæœ‰åœ¨ç”¨æˆ·èµ„æ–™åŠ è½½æˆåŠŸåæ‰åŠ è½½æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶å¼ºåˆ¶åˆ·æ–°\\n              return loadFiles(currentFolderId, selectedFileType, true)\\n                .then(() => {\\n                  console.log('æ–‡ä»¶åˆ—è¡¨åŠ è½½æˆåŠŸï¼Œå®Œæˆåˆå§‹åŒ–åŠ è½½');\\n                  finishLoading(false);\\n                  loadInProgressRef.current = false;\\n                })\\n                .catch(error => {\\n                  console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);\\n                  finishLoading(true, 'åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');\\n                  loadInProgressRef.current = false;\\n                });\\n            } else {\\n              console.log('ç”¨æˆ·èµ„æ–™ä¸ºç©ºï¼Œå°è¯•é‡æ–°è·å–...');\\n              // å¢åŠ é‡è¯•å»¶è¿Ÿï¼Œç¡®ä¿sessionç¨³å®š\\n              return new Promise(resolve => setTimeout(resolve, 1000))\\n                .then(() => fetchUserProfile(true)) // å¼ºåˆ¶åˆ·æ–°æ¨¡å¼\\n                .then(retryProfileData => {\\n                  if (retryProfileData) {\\n                    console.log('é‡è¯•è·å–ç”¨æˆ·èµ„æ–™æˆåŠŸï¼Œç»§ç»­åŠ è½½æ–‡ä»¶åˆ—è¡¨');\\n                    return loadFiles(currentFolderId, selectedFileType, true)\\n                      .then(() => {\\n                        console.log('æ–‡ä»¶åˆ—è¡¨åŠ è½½æˆåŠŸï¼Œå®Œæˆåˆå§‹åŒ–åŠ è½½');\\n                        finishLoading(false);\\n                        loadInProgressRef.current = false;\\n                      })\\n                      .catch(error => {\\n                        console.error('åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', error);\\n                        finishLoading(true, 'åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');\\n                        loadInProgressRef.current = false;\\n                      });\\n                  } else {\\n                    console.error('é‡è¯•è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥');\\n                    loadInProgressRef.current = false;\\n                    throw new Error(\\\"è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•\\\");\\n                  }\\n                });\\n            }\\n          })\\n          .catch((error) => {\\n            console.error('åŠ è½½è¿‡ç¨‹å‡ºé”™:', error);\\n            // å†æ¬¡å°è¯•è·å–ç”¨æˆ·èµ„æ–™ï¼ŒåŠ å¼ºå®¹é”™æ€§\\n            setTimeout(() => {\\n              console.log('æœ€åä¸€æ¬¡å°è¯•è·å–ç”¨æˆ·èµ„æ–™...');\\n              fetchUserProfile(true)\\n                .then(lastTryProfile => {\\n                  if (lastTryProfile) {\\n                    console.log('æœ€åå°è¯•æˆåŠŸï¼Œç»§ç»­åŠ è½½æ–‡ä»¶åˆ—è¡¨');\\n                    loadFiles(currentFolderId, selectedFileType, true)\\n                      .then(() => {\\n                        finishLoading(false);\\n                        loadInProgressRef.current = false;\\n                      })\\n                      .catch(err => {\\n                        finishLoading(true, 'åŠ è½½æ–‡ä»¶åˆ—è¡¨å¤±è´¥');\\n                        loadInProgressRef.current = false;\\n                      });\\n                  } else {\\n                    finishLoading(true, 'è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');\\n                    loadInProgressRef.current = false;\\n                  }\\n                })\\n                .catch(err => {\\n                  finishLoading(true, err.message || 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•');\\n                  loadInProgressRef.current = false;\\n                });\\n            }, 1500);\\n          });\\n      }, 500); // çŸ­æš‚å»¶è¿Ÿï¼Œç­‰å¾…sessionç¨³å®š\\n    }\\n  }, [status, session, currentFolderId, selectedFileType, loadFiles, fetchUserProfile, startLoading, finishLoading]);\\n\\n  // åˆå§‹åŒ–Lucideå›¾æ ‡\\n  useEffect(() => {\\n    // @ts-ignore\\n    window.lucide?.createIcons();\\n  }, []);\\n  \\n  // è®¡ç®—æ‰€æœ‰æ–‡ä»¶æ˜¯å¦å…¨éƒ¨é€‰ä¸­\\n  const areAllFilesSelected = files.length > 0 && selectedFiles.length === files.length;\\n\\n  // ä½¿ç”¨åˆå§‹åŒ–åŠ è½½çŠ¶æ€æ˜¾ç¤ºéª¨æ¶å±\\n  if (isInitialLoading) {\\n    console.log('æ˜¾ç¤ºéª¨æ¶å±åŠ è½½çŠ¶æ€');\\n    return <SkeletonPageLayout />;\\n  }\\n\\n  // å¦‚æœç”¨æˆ·çŠ¶æ€æ­£åœ¨åŠ è½½ï¼Œæ˜¾ç¤ºæ›´ç®€å•çš„åŠ è½½æç¤º\\n  if (status === 'loading') {\\n    console.log('æ˜¾ç¤ºç”¨æˆ·è®¤è¯åŠ è½½çŠ¶æ€');\\n    return (\\n      <div className={styles.loading}>\\n        <div className={styles.loadingCard}>\\n          <div className={styles.loadingSpinner}></div>\\n          <h3 className={styles.loadingTitle}>æ­£åœ¨åŠ è½½</h3>\\n          <p className={styles.loadingText}>è¯·ç¨å€™ï¼Œæ­£åœ¨éªŒè¯æ‚¨çš„èº«ä»½...</p>\\n        </div>\\n      </div>\\n    );\\n  }\\n\\n  // ä¿®æ”¹é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä½¿ç”¨æ–°çš„ErrorDisplayç»„ä»¶\\n  if (isLoadingError) {\\n    console.log('æ˜¾ç¤ºé”™è¯¯çŠ¶æ€ï¼ŒåŸå› :', loadingError);\\n    \\n    // æ ¹æ®é”™è¯¯ä¿¡æ¯åˆ¤æ–­é”™è¯¯ç±»å‹\\n    let errorType: 'network' | 'auth' | 'server' | 'data' | 'timeout' | 'unknown' = 'unknown';\\n    \\n    if (loadingError) {\\n      if (loadingError.includes('ç½‘ç»œ') || loadingError.includes('è¿æ¥')) {\\n        errorType = 'network';\\n      } else if (loadingError.includes('è¶…æ—¶')) {\\n        errorType = 'timeout';\\n      } else if (loadingError.includes('æœåŠ¡å™¨')) {\\n        errorType = 'server';\\n      } else if (loadingError.includes('æ•°æ®') || loadingError.includes('èµ„æ–™')) {\\n        errorType = 'data';\\n      } else if (loadingError.includes('è®¤è¯') || loadingError.includes('ç™»å½•')) {\\n        errorType = 'auth';\\n      }\\n    }\\n    \\n    return (\\n      <ErrorDisplay \\n        errorType={errorType}\\n        message={loadingError || \\\"è¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–è”ç³»ç®¡ç†å‘˜\\\"}\\n        onRetry={() => {\\n          startLoading(false);\\n          fetchUserProfile(true)\\n            .then(() => {\\n              return loadFiles(currentFolderId, selectedFileType, true);\\n            })\\n            .then(() => finishLoading())\\n            .catch((err) => finishLoading(true, err.message));\\n        }}\\n      />\\n    );\\n  }\\n\\n  // æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ£€æŸ¥ï¼Œå¦‚æœç”¨æˆ·èµ„æ–™ä»åœ¨åŠ è½½ä¸­ï¼Œç»§ç»­æ˜¾ç¤ºéª¨æ¶å±\\n  if (profileLoading) {\\n    console.log('ç”¨æˆ·èµ„æ–™çŠ¶æ€: ä»åœ¨åŠ è½½ä¸­', { profileLoading });\\n    return <SkeletonPageLayout />;\\n  }\\n  \\n  // å•ç‹¬æ£€æŸ¥ç”¨æˆ·èµ„æ–™æ˜¯å¦å­˜åœ¨\\n  if (!user-profile) {\\n    console.log('ç”¨æˆ·èµ„æ–™çŠ¶æ€: æœªè·å–åˆ°ç”¨æˆ·èµ„æ–™', { hasProfile: false });\\n    return <SkeletonPageLayout />;\\n  }\\n\\n  return (\\n    <>\\n      <Head>\\n        <title>æ–‡ä»¶ç®¡ç† - äº‘ç›˜</title>\\n      </Head>\\n      \\n      <div className={styles.file-managementContainer}>\\n        {/* Miniä¾§è¾¹æ  */}\\n        <MiniSidebar \\n          avatarUrl={effectiveAvatarUrl}\\n          userName={user-profile?.name}\\n          userEmail={user-profile?.email}\\n          onHomeClick={handleRootClick}\\n          onLogoutClick={handleSignOut}\\n          onAvatarClick={() => {\\n            router.push('/dashboard');\\n          }}\\n          currentTheme={currentTheme}\\n          onThemeClick={() => {\\n            // åˆ‡æ¢ä¸»é¢˜é¢æ¿æ˜¾ç¤ºçŠ¶æ€ï¼ŒåŒæ—¶å…³é—­å…¶ä»–é¢æ¿\\n            setShowThemePanel(!showThemePanel);\\n            // å¦‚æœæ‰“å¼€ä¸»é¢˜é¢æ¿ï¼Œå…³é—­æœç´¢å’Œæ–‡ä»¶é¢„è§ˆ\\n            if (!showThemePanel) {\\n              setShowSearchView(false);\\n              if (previewFile) {\\n                handleClosePreview();\\n              }\\n            }\\n          }}\\n        />\\n\\n        {/* ä¾§è¾¹æ  - ä»…åœ¨éä¸»é¢˜æ¨¡å¼ä¸‹æ˜¾ç¤º */}\\n        {sidebarVisible && !showThemePanel && (\\n          <div className={styles.sidebarContainer}>\\n            <Sidebar\\n              selectedFileType={selectedFileType}\\n              onTypeClick={(type) => {\\n                console.log('ä¾§è¾¹æ ç±»å‹ç‚¹å‡»:', type);\\n                \\n                // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\\n                startLoading(true);\\n                \\n                // å…ˆæ›´æ–°çŠ¶æ€\\n                setSelectedFileType(type);\\n                setCurrentFolderId(null);\\n                setFolderPath([]);\\n                \\n                // ä½¿ç”¨æ–°çš„å‚æ•°ä¼ é€’æ–¹å¼ï¼Œç›´æ¥ä¼ å…¥ç‚¹å‡»çš„ç±»å‹\\n                loadFiles(null, type)\\n                  .finally(() => finishLoading());\\n              }}\\n              onSearchClick={handleSearchClick}\\n            />\\n          </div>\\n        )}\\n\\n        {/* æ ¹æ®è§†å›¾çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹ */}\\n        {showThemePanel ? (\\n          /* ä¸»é¢˜è®¾ç½®è§†å›¾ */\\n          <ThemePanel \\n            currentTheme={currentTheme}\\n            onThemeChange={async (themeId) => {\\n              const success = await updateTheme(themeId);\\n              return success;\\n            }}\\n            onClose={() => setShowThemePanel(false)}\\n          />\\n        ) : (\\n          /* æ–‡ä»¶ç®¡ç†è§†å›¾ */\\n          <div className={styles.mainContent}>\\n            {/* å½“å†…å®¹åˆ·æ–°åŠ è½½æ—¶æ˜¾ç¤ºå±€éƒ¨åŠ è½½çŠ¶æ€ */}\\n            {isRefreshing && (\\n              <div className={styles.refreshingOverlay}>\\n                <Spin tip=\\\"æ­£åœ¨åˆ·æ–°...\\\" />\\n              </div>\\n            )}\\n            \\n            {/* é¡¶éƒ¨æ“ä½œæ  */}\\n            <TopActionBar \\n              selectedFiles={selectedFiles}\\n              onClearSelection={() => setSelectedFiles([])}\\n              onDownload={handleDownload}\\n              onRename={() => {\\n                // å¦‚æœé€‰ä¸­äº†å¤šä¸ªæ–‡ä»¶ï¼Œæç¤ºç”¨æˆ·ä¸€æ¬¡åªèƒ½é‡å‘½åä¸€ä¸ªæ–‡ä»¶\\n                if (selectedFiles.length > 1) {\\n                  message.warning('ä¸€æ¬¡åªèƒ½é‡å‘½åä¸€ä¸ªæ–‡ä»¶');\\n                  return;\\n                }\\n                \\n                // å¦‚æœé€‰ä¸­äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ°è¯¥æ–‡ä»¶å¹¶æ‰“å¼€é‡å‘½åå¯¹è¯æ¡†\\n                if (selectedFiles.length === 1) {\\n                  const selectedFile = files.find(file => file.id === selectedFiles[0]);\\n                  if (selectedFile) {\\n                    console.log('æ‰“å¼€é‡å‘½åå¯¹è¯æ¡†ï¼Œæ–‡ä»¶:', {\\n                      id: selectedFile.id,\\n                      name: selectedFile.name,\\n                      isFolder: selectedFile.isFolder\\n                    });\\n                    handleRenameButtonClick(selectedFile);\\n                  } else {\\n                    message.warning('æœªæ‰¾åˆ°é€‰ä¸­çš„æ–‡ä»¶');\\n                  }\\n                } else {\\n                  message.warning('è¯·å…ˆé€‰æ‹©è¦é‡å‘½åçš„æ–‡ä»¶');\\n                }\\n              }}\\n              onMove={() => {}}\\n              onDelete={handleDelete}\\n              onClearFilter={handleClearFilter}\\n              onCreateFolder={handleCreateFolderClick}\\n              selectedFileType={selectedFileType}\\n              showSearchView={showSearchView}\\n              isInRootFolder={!currentFolderId && !selectedFileType && !showSearchView}\\n              sortOrder={sortOrder}\\n              setSortOrder={setSortOrder}\\n              showUploadDropdown={showUploadDropdown}\\n              setShowUploadDropdown={setShowUploadDropdown}\\n              setIsUploadModalOpen={setIsUploadModalOpen}\\n              setIsFolderUploadModalOpen={setIsFolderUploadModalOpen}\\n              uploadDropdownRef={uploadDropdownRef}\\n            />\\n            \\n            {/* é¢åŒ…å±‘å¯¼èˆªæ  */}\\n            <div className={styles.breadcrumbBar}>\\n              <Breadcrumb \\n                folderPath={folderPath} \\n                showHome={true}\\n                onPathClick={(folderId) => {\\n                  if (folderId === null) {\\n                    setCurrentFolderId(null);\\n                    setFolderPath([]);\\n                    \\n                    // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\\n                    startLoading(true);\\n                    \\n                    loadFiles(null, selectedFileType)\\n                      .finally(() => finishLoading());\\n                  } else {\\n                    // æŸ¥æ‰¾ç”¨æˆ·ç‚¹å‡»çš„è·¯å¾„ç´¢å¼•\\n                    const index = folderPath.findIndex(p => p.id === folderId);\\n                    if (index !== -1) {\\n                      // åˆ‡æ–­ç´¢å¼•ä¹‹åçš„éƒ¨åˆ†\\n                      const newPath = folderPath.slice(0, index + 1);\\n                      setFolderPath(newPath);\\n                      setCurrentFolderId(folderId);\\n                      \\n                      // å¼€å§‹åˆ·æ–°åŠ è½½çŠ¶æ€\\n                      startLoading(true);\\n                      \\n                      loadFiles(folderId, selectedFileType)\\n                        .finally(() => finishLoading());\\n                    }\\n                  }\\n                }}\\n                onBackClick={() => {\\n                  if (folderPath.length > 0) {\\n                    handleBackClick();\\n                  }\\n                }}\\n              />\\n            </div>\\n\\n            {/* æœç´¢è§†å›¾æˆ–æ–‡ä»¶åˆ—è¡¨è§†å›¾ */}\\n            <div className={styles.fileListWrapper}>\\n              {showSearchView ? (\\n                <div className=\\\"search-view-container\\\">\\n                  <SearchView \\n                    searchType={searchType}\\n                    setSearchType={setSearchType}\\n                    searchQuery={searchQuery}\\n                    setSearchQuery={setSearchQuery}\\n                    searchResults={searchResults}\\n                    isLoading={searchLoading}\\n                    error={searchError}\\n                    handleSearch={handleSearch}\\n                    handleFileClick={handleFileItemClick}\\n                    enableRealTimeSearch={enableRealTimeSearch}\\n                    setEnableRealTimeSearch={setEnableRealTimeSearch}\\n                    debounceDelay={debounceDelay}\\n                    setDebounceDelay={setDebounceDelay}\\n                  />\\n                </div>\\n              ) : (\\n                // æ–‡ä»¶åˆ—è¡¨\\n                <>\\n                  {isCreatingFolder && (\\n                    <NewFolderForm \\n                      folderName={newFolderName}\\n                      setFolderName={setNewFolderName}\\n                      folderTags={newFolderTags}\\n                      setFolderTags={setNewFolderTags}\\n                      onCreateFolder={() => {\\n                        // å…ˆåˆ¤æ–­æ–‡ä»¶å¤¹åç§°æ˜¯å¦ä¸ºç©º\\n                        if (!newFolderName || !newFolderName.trim()) {\\n                          return; // å¦‚æœä¸ºç©ºï¼Œç›´æ¥è¿”å›\\n                        }\\n                        \\n                        console.log('å¼€å§‹åˆ›å»ºæ–‡ä»¶å¤¹:', newFolderName);\\n                        \\n                        // ç¡®ä¿ä¼ é€’åç§°å’Œæ ‡ç­¾\\n                        handleCreateFolder(newFolderName, currentFolderId, newFolderTags)\\n                          .then(folderId => {\\n                            console.log('æ–‡ä»¶å¤¹åˆ›å»ºè¿”å›ID:', folderId);\\n                            \\n                            // åªè¦è¿”å›å€¼ä¸æ˜¯nullï¼Œå°±è®¤ä¸ºæ˜¯æˆåŠŸçš„\\n                            if (folderId !== null) {\\n                              console.log('æ–‡ä»¶å¤¹åˆ›å»ºæˆåŠŸï¼Œå‡†å¤‡åˆ·æ–°');\\n                              // åˆ›å»ºæˆåŠŸï¼Œå…³é—­è¡¨å•å¹¶åˆ·æ–°\\n                              setIsCreatingFolder(false);\\n                              setNewFolderName('');\\n                              setNewFolderTags([]);\\n                              \\n                              // åˆ·æ–°å½“å‰æ–‡ä»¶å¤¹\\n                              loadFiles(currentFolderId, selectedFileType, true)\\n                                .then(() => {\\n                                  console.log('æ–‡ä»¶åˆ—è¡¨åˆ·æ–°å®Œæˆ');\\n                                })\\n                                .catch(err => {\\n                                  console.error('åˆ·æ–°æ–‡ä»¶åˆ—è¡¨å¤±è´¥:', err);\\n                                });\\n                            } else {\\n                              console.error('åˆ›å»ºæ–‡ä»¶å¤¹å¤±è´¥ï¼ŒAPIè¿”å›null');\\n                            }\\n                          })\\n                          .catch(error => {\\n                            console.error('åˆ›å»ºæ–‡ä»¶å¤¹è¯·æ±‚å‡ºé”™:', error);\\n                          });\\n                      }}\\n                      onCancel={() => {\\n                        setIsCreatingFolder(false);\\n                        setNewFolderName('');\\n                        setNewFolderTags([]);\\n                      }}\\n                    />\\n                  )}\\n\\n                  {/* æ–‡ä»¶åˆ—è¡¨ç»„ä»¶ */}\\n                  <FileList \\n                    files={convertFilesForDisplay(files)}\\n                    onFileClick={handleFileItemClick}\\n                    onFileSelect={(file, checked) => onFileCheckboxChange(file as FileInfo, checked)}\\n                    onSelectAll={onSelectAllFiles}\\n                    onDeselectAll={onDeselectAllFiles}\\n                    selectedFiles={selectedFiles}\\n                    onFileContextMenu={(e, file) => handleFileContextMenu(e, file, setSelectedFile, setSelectedFiles)}\\n                    onBackClick={folderPath.length > 0 ? handleBackClick : undefined}\\n                    isLoading={filesLoading}\\n                    error={filesError}\\n                    editingFile={editingFile}\\n                    editingName={editingName}\\n                    editingTags={editingTags}\\n                    onEditNameChange={setEditingName}\\n                    onConfirmEdit={handleConfirmEdit}\\n                    onCancelEdit={() => setEditingFile(null)}\\n                    onAddTag={handleAddTag}\\n                    onRemoveTag={handleRemoveTag}\\n                    newTag={newTag}\\n                    onNewTagChange={setNewTag}\\n                    showCheckboxes={true}\\n                    areAllSelected={areAllFilesSelected}\\n                  />\\n                </>\\n              )}\\n            </div>\\n          </div>\\n        )}\\n      </div>\\n      \\n      {/* ä¸Šä¼ æ¨¡æ€çª—å£ */}\\n      <UploadModal \\n        isOpen={isUploadModalOpen} \\n        onClose={() => setIsUploadModalOpen(false)} \\n        onSuccess={handleUploadSuccess}\\n        currentFolderId={currentFolderId}\\n        isFolderUpload={false}\\n      />\\n      \\n      <UploadModal \\n        isOpen={isFolderUploadModalOpen} \\n        onClose={() => setIsFolderUploadModalOpen(false)} \\n        onSuccess={handleUploadSuccess}\\n        currentFolderId={currentFolderId}\\n        isFolderUpload={true}\\n      />\\n\\n      {/* é‡å‘½åæ¨¡æ€çª—å£ */}\\n      <RenameModal\\n        isOpen={isRenameModalOpen}\\n        onClose={() => setIsRenameModalOpen(false)}\\n        onRename={(newName, tags) => {\\n          if (!fileToRename) {\\n            message.warning('æœªé€‰æ‹©è¦é‡å‘½åçš„æ–‡ä»¶');\\n            return;\\n          }\\n          \\n          console.log('å‡†å¤‡é‡å‘½åæ–‡ä»¶:', {\\n            id: fileToRename.id,\\n            name: fileToRename.name,\\n            newName: newName,\\n            tagsCount: tags?.length || 0\\n          });\\n          \\n          // ä½¿ç”¨useFilePreviewçš„renameFileå‡½æ•°\\n          handleConfirmEdit(newName, tags)\\n            .then(success => {\\n              if (success) {\\n                console.log('é‡å‘½åæˆåŠŸï¼Œåˆ·æ–°æ–‡ä»¶åˆ—è¡¨');\\n              } else {\\n                console.error('é‡å‘½åå¤±è´¥');\\n              }\\n            })\\n            .catch(err => {\\n              console.error('é‡å‘½åè¿‡ç¨‹å‡ºé”™:', err);\\n            });\\n        }}\\n        initialName={fileToRename?.name || ''}\\n        initialTags={fileToRename?.tags || []}\\n        fileType={fileToRename?.isFolder ? 'folder' : 'file'}\\n      />\\n\\n      {/* æ–‡ä»¶é¢„è§ˆç»„ä»¶åº”è¯¥ä½äºæ•´ä¸ªåº”ç”¨çš„æœ€å¤–å±‚ï¼Œç¡®ä¿å®ƒè¦†ç›–å…¶ä»–æ‰€æœ‰å†…å®¹ */}\\n      {previewFile && (\\n        <FilePreview\\n          file={previewFile}\\n          onClose={handleClosePreview}\\n          onDownload={handleDownload}\\n        />\\n      )}\\n    </>\\n  );\\n}\\n       \"\n  },\n  {\n    \"path\": \"app\\\\hooks\\\\user\\\\useProfile.ts\",\n    \"newContent\": \"import { useState, useEffect, useRef, useCallback } from \\\"react\\\"\\r\\nimport { useSession } from \\\"next-auth/react\\\"\\r\\nimport { toast } from 'sonner'\\r\\nimport { applyTheme as applyThemeService } from \\\"@/app/shared/themes\\\"\\r\\n\\r\\n/**\\r\\n * ç”¨æˆ·èµ„æ–™æ¥å£\\r\\n */\\r\\nexport interface UserProfile {\\r\\n  /** ç”¨æˆ·ID */\\r\\n  id: string\\r\\n  /** é‚®ç®± */\\r\\n  email: string\\r\\n  /** ç”¨æˆ·å */\\r\\n  name: string | null\\r\\n  /** å¤´åƒURL */\\r\\n  avatarUrl?: string | null\\r\\n  /** ä¸»é¢˜ */\\r\\n  theme?: string | null\\r\\n  /** å·²ä½¿ç”¨å­˜å‚¨ç©ºé—´ï¼ˆå­—èŠ‚ï¼‰ */\\r\\n  storageUsed: number\\r\\n  /** å­˜å‚¨ç©ºé—´é™åˆ¶ï¼ˆå­—èŠ‚ï¼‰ */\\r\\n  storageLimit: number\\r\\n  /** ç”¨æˆ·ç®€ä»‹ */\\r\\n  bio?: string\\r\\n  /** ä½ç½® */\\r\\n  location?: string\\r\\n  /** ç½‘ç«™ */\\r\\n  website?: string\\r\\n  /** å…¬å¸ */\\r\\n  company?: string\\r\\n  /** åˆ›å»ºæ—¶é—´ */\\r\\n  createdAt: string\\r\\n  /** æ›´æ–°æ—¶é—´ */\\r\\n  updatedAt: string\\r\\n}\\r\\n\\r\\n/**\\r\\n * ç”¨æˆ·èµ„æ–™æ›´æ–°è¾“å…¥\\r\\n */\\r\\nexport interface UserProfileInput {\\r\\n  /** æ˜¾ç¤ºåç§° */\\r\\n  displayName?: string\\r\\n  /** å¤´åƒURL */\\r\\n  avatarUrl?: string\\r\\n  /** ä¸»é¢˜ */\\r\\n  theme?: string\\r\\n  /** ç”¨æˆ·ç®€ä»‹ */\\r\\n  bio?: string\\r\\n  /** ä½ç½® */\\r\\n  location?: string\\r\\n  /** ç½‘ç«™ */\\r\\n  website?: string\\r\\n  /** å…¬å¸ */\\r\\n  company?: string\\r\\n}\\r\\n\\r\\n/**\\r\\n * ç”¨æˆ·èµ„æ–™APIå“åº”\\r\\n */\\r\\nexport interface UserProfileResponse {\\r\\n  /** æ˜¯å¦æˆåŠŸ */\\r\\n  success: boolean\\r\\n  /** ç”¨æˆ·èµ„æ–™ */\\r\\n  profile?: UserProfile\\r\\n  /** é”™è¯¯ä¿¡æ¯ */\\r\\n  error?: string\\r\\n}\\r\\n\\r\\n// é»˜è®¤ç¦»çº¿ç”¨æˆ·é…ç½®ï¼Œå½“APIä¸å¯ç”¨æ—¶ä½¿ç”¨\\r\\nconst DEFAULT_OFFLINE_PROFILE: UserProfile = {\\r\\n  id: 'offline-user',\\r\\n  email: 'offline@example.com',\\r\\n  name: 'ç¦»çº¿æ¨¡å¼',\\r\\n  avatarUrl: null,\\r\\n  theme: 'default',\\r\\n  storageUsed: 0,\\r\\n  storageLimit: 1024 * 1024 * 100, // 100MB\\r\\n  createdAt: new Date().toISOString(),\\r\\n  updatedAt: new Date().toISOString()\\r\\n}\\r\\n\\r\\n// é‡è¯•é…ç½®\\r\\nconst RETRY_DELAY = 3000 // 3ç§’\\r\\nconst MAX_RETRIES = 2 // æœ€å¤§é‡è¯•æ¬¡æ•°\\r\\nconst MAX_ERROR_COUNT = 3 // è¿ç»­é”™è¯¯é˜ˆå€¼ï¼Œè¶…è¿‡åè¿›å…¥ç¦»çº¿æ¨¡å¼\\r\\n\\r\\n/**\\r\\n * ç”¨æˆ·èµ„æ–™Hook\\r\\n * æä¾›ç”¨æˆ·èµ„æ–™çš„è·å–ã€æ›´æ–°å’Œç®¡ç†åŠŸèƒ½\\r\\n * \\r\\n * @returns ç”¨æˆ·èµ„æ–™å’Œç›¸å…³æ“ä½œæ–¹æ³•\\r\\n */\\r\\nexport function useProfile() {\\r\\n  const { data: session } = useSession()\\r\\n  const [user-profile, setUserProfile] = useState<UserProfile | null>(null)\\r\\n  const [isLoading, setIsLoading] = useState(true)\\r\\n  const [error, setError] = useState<string | null>(null)\\r\\n  const [isOfflineMode, setIsOfflineMode] = useState(false)\\r\\n  const [consecutiveErrors, setConsecutiveErrors] = useState(0)\\r\\n  const abortControllerRef = useRef<AbortController | null>(null)\\r\\n  const lastFetchTimeRef = useRef<number>(0)\\r\\n  const sessionChangeRef = useRef<number>(0)\\r\\n\\r\\n  // æœ‰æ•ˆçš„å¤´åƒURLï¼Œä¼˜å…ˆä½¿ç”¨ç”¨æˆ·èµ„æ–™ä¸­çš„ï¼Œå…¶æ¬¡æ˜¯ä¼šè¯ä¸­çš„\\r\\n  const effectiveAvatarUrl = user-profile?.avatarUrl || session?.user?.image || null\\r\\n\\r\\n  /**\\r\\n   * è·å–ç”¨æˆ·èµ„æ–™\\r\\n   * @param showToast æ˜¯å¦æ˜¾ç¤ºåŠ è½½æˆåŠŸçš„æç¤º\\r\\n   * @param retryCount é‡è¯•æ¬¡æ•°\\r\\n   * @returns ç”¨æˆ·èµ„æ–™\\r\\n   */\\r\\n  const fetchUserProfile = useCallback(async (showToast = false, retryCount = 0) => {\\r\\n    // åˆ¤æ–­æ˜¯å¦åœ¨çŸ­æ—¶é—´å†…é‡å¤è°ƒç”¨ï¼Œé¿å…é¢‘ç¹è¯·æ±‚\\r\\n    const now = Date.now()\\r\\n    const timeSinceLastFetch = now - lastFetchTimeRef.current\\r\\n    \\r\\n    if (retryCount === 0 && timeSinceLastFetch < 2000 && lastFetchTimeRef.current > 0) {\\r\\n      console.log(`è·ä¸Šæ¬¡è¯·æ±‚ä»… ${timeSinceLastFetch}msï¼Œè·³è¿‡æ­¤æ¬¡è¯·æ±‚`)\\r\\n      return user-profile\\r\\n    }\\r\\n    \\r\\n    lastFetchTimeRef.current = now\\r\\n\\r\\n    // æ·»åŠ æ›´è¯¦ç»†çš„ session æ£€æŸ¥æ—¥å¿—\\r\\n    console.log('è·å–ç”¨æˆ·èµ„æ–™æ£€æŸ¥ session çŠ¶æ€:', { \\r\\n      sessionExists: !!session, \\r\\n      hasUser: !!session?.user, \\r\\n      userEmail: session?.user?.email || 'unknown',\\r\\n      retryCount \\r\\n    })\\r\\n\\r\\n    if (!session || !session.user) {\\r\\n      console.log('æœªæ£€æµ‹åˆ°æœ‰æ•ˆä¼šè¯ï¼Œæ— æ³•è·å–ç”¨æˆ·èµ„æ–™')\\r\\n      setIsLoading(false)\\r\\n      setError('æœªæ£€æµ‹åˆ°æœ‰æ•ˆä¼šè¯')\\r\\n      return null\\r\\n    }\\r\\n\\r\\n    // å¦‚æœå·²ç»è¶…è¿‡æœ€å¤§é”™è¯¯æ•°ï¼Œå¹¶ä¸”å·²ç»è¿›å…¥ç¦»çº¿æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨ç¦»çº¿é…ç½®\\r\\n    if (isOfflineMode && retryCount === 0) {\\r\\n      console.log('åº”ç”¨æ­£åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œï¼Œä½¿ç”¨é»˜è®¤é…ç½®')\\r\\n      if (!user-profile) {\\r\\n        const offlineProfile = {\\r\\n          ...DEFAULT_OFFLINE_PROFILE,\\r\\n          email: session.user?.email || DEFAULT_OFFLINE_PROFILE.email,\\r\\n          name: session.user?.name || DEFAULT_OFFLINE_PROFILE.name,\\r\\n        }\\r\\n        setUserProfile(offlineProfile)\\r\\n        setIsLoading(false)\\r\\n        return offlineProfile\\r\\n      }\\r\\n      setIsLoading(false)\\r\\n      return user-profile\\r\\n    }\\r\\n\\r\\n    // å¦‚æœå·²ç»æœ‰ç”¨æˆ·èµ„æ–™ä¸”ä¸æ˜¯é‡è¯•æ¨¡å¼ï¼Œåˆ™ç›´æ¥è¿”å›ç°æœ‰èµ„æ–™\\r\\n    if (user-profile && !showToast && retryCount === 0) {\\r\\n      console.log('å·²æœ‰ç”¨æˆ·èµ„æ–™ï¼Œç›´æ¥è¿”å›:', user-profile.email)\\r\\n      return user-profile\\r\\n    }\\r\\n\\r\\n    // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚\\r\\n    if (abortControllerRef.current) {\\r\\n      abortControllerRef.current.abort()\\r\\n    }\\r\\n    \\r\\n    // åˆ›å»ºæ–°çš„AbortController\\r\\n    abortControllerRef.current = new AbortController()\\r\\n    const { signal } = abortControllerRef.current\\r\\n    \\r\\n    let timeoutId: NodeJS.Timeout | null = null\\r\\n\\r\\n    try {\\r\\n      setIsLoading(true)\\r\\n      \\r\\n      if (retryCount === 0) {\\r\\n        setError(null)\\r\\n      }\\r\\n      \\r\\n      console.log(`è·å–ç”¨æˆ·èµ„æ–™${retryCount > 0 ? `(é‡è¯• ${retryCount}/${MAX_RETRIES})` : ''}...`)\\r\\n      \\r\\n      // è®¾ç½®è¯·æ±‚è¶…æ—¶ - 10ç§’ï¼Œå¢å¼ºå®¹é”™æ€§\\r\\n      timeoutId = setTimeout(() => {\\r\\n        if (abortControllerRef.current) {\\r\\n          console.log('ç”¨æˆ·èµ„æ–™è¯·æ±‚è¶…æ—¶ï¼Œä¸­æ­¢è¯·æ±‚')\\r\\n          abortControllerRef.current.abort()\\r\\n        }\\r\\n      }, 10000) // 10ç§’è¶…æ—¶\\r\\n      \\r\\n      const response = await fetch('/api/user/profile', {\\r\\n        signal,\\r\\n        headers: {\\r\\n          'Cache-Control': 'no-cache',\\r\\n          'Pragma': 'no-cache'\\r\\n        }\\r\\n      })\\r\\n      \\r\\n      if (timeoutId) clearTimeout(timeoutId)\\r\\n      \\r\\n      // æ·»åŠ æ›´è¯¦ç»†çš„å“åº”æ—¥å¿—\\r\\n      console.log('èµ„æ–™è¯·æ±‚å“åº”çŠ¶æ€:', {\\r\\n        status: response.status,\\r\\n        ok: response.ok,\\r\\n        statusText: response.statusText\\r\\n      })\\r\\n      \\r\\n      if (!response.ok) {\\r\\n        console.error(`èµ„æ–™è¯·æ±‚å¤±è´¥, çŠ¶æ€ç : ${response.status}`)\\r\\n        throw new Error(`æœåŠ¡å™¨å“åº”é”™è¯¯: ${response.status} ${response.statusText}`)\\r\\n      }\\r\\n      \\r\\n      const data: UserProfileResponse = await response.json()\\r\\n      \\r\\n      console.log('èµ„æ–™è¯·æ±‚è¿”å›æ•°æ®:', {\\r\\n        success: data.success,\\r\\n        hasProfile: !!data.profile,\\r\\n        error: data.error || 'æ— '\\r\\n      })\\r\\n      \\r\\n      if (!data.success) {\\r\\n        console.error('èµ„æ–™è¯·æ±‚è¿”å›å¤±è´¥çŠ¶æ€:', data.error)\\r\\n        throw new Error(data.error || 'è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥')\\r\\n      }\\r\\n      \\r\\n      if (!data.profile) {\\r\\n        console.error('èµ„æ–™è¯·æ±‚æœªè¿”å›ç”¨æˆ·æ•°æ®')\\r\\n        throw new Error('æœåŠ¡å™¨æœªè¿”å›ç”¨æˆ·èµ„æ–™æ•°æ®')\\r\\n      }\\r\\n      \\r\\n      // è¯·æ±‚æˆåŠŸï¼Œé‡ç½®è¿ç»­é”™è¯¯è®¡æ•°\\r\\n      setConsecutiveErrors(0)\\r\\n      setIsOfflineMode(false)\\r\\n      setUserProfile(data.profile)\\r\\n      // æ˜ç¡®è®¾ç½®åŠ è½½çŠ¶æ€ä¸ºå®Œæˆ\\r\\n      setIsLoading(false)\\r\\n      console.log('ç”¨æˆ·èµ„æ–™è·å–æˆåŠŸ:', data.profile.email)\\r\\n      \\r\\n      if (showToast) {\\r\\n        toast.success('ç”¨æˆ·èµ„æ–™å·²æ›´æ–°')\\r\\n      }\\r\\n      \\r\\n      return data.profile\\r\\n    } catch (err) {\\r\\n      if (timeoutId) clearTimeout(timeoutId)\\r\\n      \\r\\n      console.error('è·å–ç”¨æˆ·èµ„æ–™å¤±è´¥:', err)\\r\\n      setError(err instanceof Error ? err.message : 'æ— æ³•åŠ è½½ç”¨æˆ·èµ„æ–™')\\r\\n      \\r\\n      // å¢åŠ è¿ç»­é”™è¯¯è®¡æ•°\\r\\n      setConsecutiveErrors(prev => {\\r\\n        const newCount = prev + 1\\r\\n        console.log(`è¿ç»­é”™è¯¯è®¡æ•°: ${prev} -> ${newCount}`)\\r\\n        \\r\\n        // å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œè¿›å…¥ç¦»çº¿æ¨¡å¼\\r\\n        if (newCount >= MAX_ERROR_COUNT) {\\r\\n          setIsOfflineMode(true)\\r\\n          console.log(`é”™è¯¯æ¬¡æ•°(${newCount})è¶…è¿‡é˜ˆå€¼(${MAX_ERROR_COUNT})ï¼Œè¿›å…¥ç¦»çº¿æ¨¡å¼`)\\r\\n          \\r\\n          // å‡†å¤‡ç¦»çº¿ç”¨æˆ·èµ„æ–™\\r\\n          const offlineProfile = {\\r\\n            ...DEFAULT_OFFLINE_PROFILE,\\r\\n            email: session?.user?.email || DEFAULT_OFFLINE_PROFILE.email,\\r\\n            name: session?.user?.name || DEFAULT_OFFLINE_PROFILE.name,\\r\\n          }\\r\\n          \\r\\n          setUserProfile(offlineProfile)\\r\\n        }\\r\\n        \\r\\n        return newCount\\r\\n      })\\r\\n      \\r\\n      // åœ¨é‡è¯•æ¬¡æ•°å†…è¿›è¡Œé‡è¯•\\r\\n      if (retryCount < MAX_RETRIES) {\\r\\n        console.log(`${RETRY_DELAY}msåè¿›è¡Œç¬¬${retryCount + 1}æ¬¡é‡è¯•...`)\\r\\n        setTimeout(() => {\\r\\n          fetchUserProfile(showToast, retryCount + 1)\\r\\n        }, RETRY_DELAY)\\r\\n      } else {\\r\\n        setIsLoading(false)\\r\\n      }\\r\\n      \\r\\n      return user-profile\\r\\n    }\\r\\n  }, [session, user-profile, isOfflineMode, consecutiveErrors])\\r\\n\\r\\n  // ç›‘å¬ä¼šè¯å˜æ›´ï¼Œè·å–ç”¨æˆ·èµ„æ–™\\r\\n  useEffect(() => {\\r\\n    // ä¼šè¯å˜æ›´æ¬¡æ•°åŠ 1\\r\\n    sessionChangeRef.current += 1\\r\\n    const currentSessionChange = sessionChangeRef.current\\r\\n    \\r\\n    console.log(`ä¼šè¯å˜åŒ–(${currentSessionChange})ï¼Œé‡æ–°è·å–ç”¨æˆ·èµ„æ–™`)\\r\\n    \\r\\n    // é‡ç½®ç¦»çº¿æ¨¡å¼å’Œé”™è¯¯è®¡æ•°\\r\\n    if (session?.user) {\\r\\n      setIsOfflineMode(false)\\r\\n      setConsecutiveErrors(0)\\r\\n    }\\r\\n    \\r\\n    // å»¶è¿Ÿè·å–ç”¨æˆ·èµ„æ–™ï¼Œé¿å…åœ¨ä¼šè¯åˆå§‹åŒ–è¿‡ç¨‹ä¸­é¢‘ç¹è¯·æ±‚\\r\\n    const timeoutId = setTimeout(() => {\\r\\n      // ç¡®ä¿åœ¨ä¼šè¯çŠ¶æ€æœªå˜æ›´çš„æƒ…å†µä¸‹æ‰§è¡Œ\\r\\n      if (sessionChangeRef.current === currentSessionChange) {\\r\\n        fetchUserProfile()\\r\\n      }\\r\\n    }, 100)\\r\\n    \\r\\n    return () => clearTimeout(timeoutId)\\r\\n  }, [session, fetchUserProfile])\\r\\n\\r\\n  /**\\r\\n   * å¼ºåˆ¶åˆ·æ–°ç”¨æˆ·èµ„æ–™\\r\\n   */\\r\\n  const forceRefreshProfile = useCallback(() => {\\r\\n    return fetchUserProfile(true)\\r\\n  }, [fetchUserProfile])\\r\\n\\r\\n  /**\\r\\n   * æ›´æ–°ç”¨æˆ·èµ„æ–™\\r\\n   * @param profileData æ›´æ–°çš„èµ„æ–™æ•°æ®\\r\\n   * @returns æ˜¯å¦æ›´æ–°æˆåŠŸ\\r\\n   */\\r\\n  const updateUserProfile = useCallback(async (profileData: UserProfileInput) => {\\r\\n    if (!session?.user) {\\r\\n      console.error('ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•æ›´æ–°èµ„æ–™')\\r\\n      return false\\r\\n    }\\r\\n    \\r\\n    setIsLoading(true)\\r\\n    setError(null)\\r\\n    \\r\\n    try {\\r\\n      const response = await fetch('/api/user/profile', {\\r\\n        method: 'PUT',\\r\\n        headers: {\\r\\n          'Content-Type': 'application/json',\\r\\n        },\\r\\n        body: JSON.stringify(profileData),\\r\\n      })\\r\\n      \\r\\n      const data: UserProfileResponse = await response.json()\\r\\n      \\r\\n      if (!response.ok || !data.success) {\\r\\n        throw new Error(data.error || 'æ›´æ–°èµ„æ–™å¤±è´¥')\\r\\n      }\\r\\n      \\r\\n      if (data.profile) {\\r\\n        setUserProfile(data.profile)\\r\\n        toast.success('èµ„æ–™æ›´æ–°æˆåŠŸ')\\r\\n        return true\\r\\n      } else {\\r\\n        throw new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ— æ•ˆ')\\r\\n      }\\r\\n    } catch (error) {\\r\\n      console.error('æ›´æ–°ç”¨æˆ·èµ„æ–™å¤±è´¥:', error)\\r\\n      setError(error instanceof Error ? error.message : 'æ›´æ–°èµ„æ–™å¤±è´¥')\\r\\n      toast.error(error instanceof Error ? error.message : 'æ›´æ–°èµ„æ–™å¤±è´¥')\\r\\n      return false\\r\\n    } finally {\\r\\n      setIsLoading(false)\\r\\n    }\\r\\n  }, [session])\\r\\n\\r\\n  /**\\r\\n   * æ›´æ–°ç”¨æˆ·ä¸»é¢˜\\r\\n   * @param theme ä¸»é¢˜ID\\r\\n   * @returns æ˜¯å¦æ›´æ–°æˆåŠŸ\\r\\n   */\\r\\n  const updateTheme = useCallback(async (theme: string) => {\\r\\n    return updateUserProfile({ theme })\\r\\n  }, [updateUserProfile])\\r\\n\\r\\n  /**\\r\\n   * åº”ç”¨ä¸»é¢˜\\r\\n   * @param theme ä¸»é¢˜ID\\r\\n   */\\r\\n  const applyTheme = useCallback((theme: string = 'default') => {\\r\\n    try {\\r\\n      applyThemeService(theme)\\r\\n      return true\\r\\n    } catch (error) {\\r\\n      console.error('åº”ç”¨ä¸»é¢˜å¤±è´¥:', error)\\r\\n      return false\\r\\n    }\\r\\n  }, [])\\r\\n\\r\\n  return {\\r\\n    user-profile,\\r\\n    isLoading,\\r\\n    error,\\r\\n    isOfflineMode,\\r\\n    effectiveAvatarUrl,\\r\\n    fetchUserProfile,\\r\\n    forceRefreshProfile,\\r\\n    updateUserProfile,\\r\\n    updateTheme,\\r\\n    applyTheme\\r\\n  }\\r\\n} \"\n  },\n  {\n    \"path\": \"scripts\\\\rename-helper.js\",\n    \"newContent\": \"/**\\r\\n * ç›®å½•é‡å‘½åè¾…åŠ©è„šæœ¬\\r\\n * ç”¨äºç”Ÿæˆç›®å½•é‡å‘½åå’Œå¯¼å…¥è·¯å¾„ä¿®å¤çš„å‘½ä»¤\\r\\n */\\r\\n\\r\\nconst fs = require('fs');\\r\\nconst path = require('path');\\r\\nconst { promisify } = require('util');\\r\\nconst readdir = promisify(fs.readdir);\\r\\nconst stat = promisify(fs.stat);\\r\\nconst readFile = promisify(fs.readFile);\\r\\nconst writeFile = promisify(fs.writeFile);\\r\\n\\r\\n// éœ€è¦é‡å‘½åçš„ç›®å½•æ˜ å°„\\r\\nconst RENAME_MAPPINGS = [\\r\\n  {\\r\\n    from: 'app/components/features/file-management',\\r\\n    to: 'app/components/features/file-management',\\r\\n    pattern: /file-management/g,\\r\\n    replacement: 'file-management'\\r\\n  },\\r\\n  {\\r\\n    from: 'app/components/features/user-profile',\\r\\n    to: 'app/components/features/user-profile',\\r\\n    pattern: /user-profile/g,\\r\\n    replacement: 'user-profile'\\r\\n  },\\r\\n  // æ·»åŠ å…¶ä»–éœ€è¦é‡å‘½åçš„ç›®å½•\\r\\n];\\r\\n\\r\\n// éœ€è¦é‡å‘½åçš„æ–‡ä»¶æ˜ å°„\\r\\nconst FILE_RENAME_MAPPINGS = [\\r\\n  {\\r\\n    from: 'app/services/storage-service.ts',\\r\\n    to: 'app/services/storageService.ts',\\r\\n    pattern: /storage-service/g,\\r\\n    replacement: 'storageService'\\r\\n  },\\r\\n  // æ·»åŠ å…¶ä»–éœ€è¦é‡å‘½åçš„æ–‡ä»¶\\r\\n];\\r\\n\\r\\n// éœ€è¦åˆ›å»ºçš„æ–‡ä»¶æ˜ å°„\\r\\nconst CREATE_MAPPINGS = [\\r\\n  {\\r\\n    source: 'app/components/features/user-profile/avatar/AvatarCropper.module.css',\\r\\n    target: 'app/components/features/user-profile/avatar/AvatarModal.module.css',\\r\\n    fileUpdate: {\\r\\n      file: 'app/components/features/user-profile/avatar/AvatarModal.tsx',\\r\\n      pattern: /from\\\\s+['\\\"]\\\\.\\\\/AvatarCropper\\\\.module\\\\.css['\\\"]/g,\\r\\n      replacement: `from './AvatarModal.module.css'`\\r\\n    }\\r\\n  },\\r\\n  // æ·»åŠ å…¶ä»–éœ€è¦åˆ›å»ºçš„æ–‡ä»¶\\r\\n];\\r\\n\\r\\n/**\\r\\n * ç”Ÿæˆç›®å½•é‡å‘½åå‘½ä»¤\\r\\n */\\r\\nasync function generateDirectoryRenameCommands() {\\r\\n  console.log('\\\\n===== ç›®å½•é‡å‘½åå‘½ä»¤ =====\\\\n');\\r\\n  \\r\\n  for (const mapping of RENAME_MAPPINGS) {\\r\\n    const { from, to } = mapping;\\r\\n    \\r\\n    // æ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨\\r\\n    try {\\r\\n      await stat(from);\\r\\n      // æ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦å·²å­˜åœ¨\\r\\n      try {\\r\\n        await stat(to);\\r\\n        console.log(`è­¦å‘Š: ç›®æ ‡ç›®å½• ${to} å·²å­˜åœ¨`);\\r\\n      } catch (err) {\\r\\n        // ç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œå¯ä»¥é‡å‘½å\\r\\n        if (process.platform === 'win32') {\\r\\n          console.log(`mkdir -p \\\"${path.dirname(to)}\\\"`);\\r\\n          console.log(`Move-Item -Path \\\"${from}\\\" -Destination \\\"${to}\\\"`);\\r\\n        } else {\\r\\n          console.log(`mkdir -p \\\"${path.dirname(to)}\\\"`);\\r\\n          console.log(`mv \\\"${from}\\\" \\\"${to}\\\"`);\\r\\n        }\\r\\n      }\\r\\n    } catch (err) {\\r\\n      console.log(`è­¦å‘Š: æºç›®å½• ${from} ä¸å­˜åœ¨`);\\r\\n    }\\r\\n  }\\r\\n}\\r\\n\\r\\n/**\\r\\n * ç”Ÿæˆæ–‡ä»¶é‡å‘½åå‘½ä»¤\\r\\n */\\r\\nasync function generateFileRenameCommands() {\\r\\n  console.log('\\\\n===== æ–‡ä»¶é‡å‘½åå‘½ä»¤ =====\\\\n');\\r\\n  \\r\\n  for (const mapping of FILE_RENAME_MAPPINGS) {\\r\\n    const { from, to } = mapping;\\r\\n    \\r\\n    // æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨\\r\\n    try {\\r\\n      await stat(from);\\r\\n      // æ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨\\r\\n      try {\\r\\n        await stat(to);\\r\\n        console.log(`è­¦å‘Š: ç›®æ ‡æ–‡ä»¶ ${to} å·²å­˜åœ¨`);\\r\\n      } catch (err) {\\r\\n        // ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥é‡å‘½å\\r\\n        if (process.platform === 'win32') {\\r\\n          console.log(`mkdir -p \\\"${path.dirname(to)}\\\"`);\\r\\n          console.log(`Move-Item -Path \\\"${from}\\\" -Destination \\\"${to}\\\"`);\\r\\n        } else {\\r\\n          console.log(`mkdir -p \\\"${path.dirname(to)}\\\"`);\\r\\n          console.log(`mv \\\"${from}\\\" \\\"${to}\\\"`);\\r\\n        }\\r\\n      }\\r\\n    } catch (err) {\\r\\n      console.log(`è­¦å‘Š: æºæ–‡ä»¶ ${from} ä¸å­˜åœ¨`);\\r\\n    }\\r\\n  }\\r\\n}\\r\\n\\r\\n/**\\r\\n * ç”Ÿæˆæ–‡ä»¶åˆ›å»ºå‘½ä»¤\\r\\n */\\r\\nasync function generateFileCreateCommands() {\\r\\n  console.log('\\\\n===== æ–‡ä»¶åˆ›å»ºå‘½ä»¤ =====\\\\n');\\r\\n  \\r\\n  for (const mapping of CREATE_MAPPINGS) {\\r\\n    const { source, target } = mapping;\\r\\n    \\r\\n    // æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨\\r\\n    try {\\r\\n      await stat(source);\\r\\n      // æ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨\\r\\n      try {\\r\\n        await stat(target);\\r\\n        console.log(`è­¦å‘Š: ç›®æ ‡æ–‡ä»¶ ${target} å·²å­˜åœ¨`);\\r\\n      } catch (err) {\\r\\n        // ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»º\\r\\n        if (process.platform === 'win32') {\\r\\n          console.log(`mkdir -p \\\"${path.dirname(target)}\\\"`);\\r\\n          console.log(`Copy-Item -Path \\\"${source}\\\" -Destination \\\"${target}\\\"`);\\r\\n        } else {\\r\\n          console.log(`mkdir -p \\\"${path.dirname(target)}\\\"`);\\r\\n          console.log(`cp \\\"${source}\\\" \\\"${target}\\\"`);\\r\\n        }\\r\\n      }\\r\\n    } catch (err) {\\r\\n      console.log(`è­¦å‘Š: æºæ–‡ä»¶ ${source} ä¸å­˜åœ¨`);\\r\\n    }\\r\\n  }\\r\\n}\\r\\n\\r\\n/**\\r\\n * æ‰«æé¡¹ç›®æ–‡ä»¶æŸ¥æ‰¾å¯¼å…¥å¼•ç”¨è·¯å¾„\\r\\n */\\r\\nasync function scanForImportReferences() {\\r\\n  console.log('\\\\n===== å¯¼å…¥è·¯å¾„å¼•ç”¨ä¿®å¤ =====\\\\n');\\r\\n  \\r\\n  // æ‰«ææ–‡ä»¶çš„ç›®å½•\\r\\n  const dirsToScan = ['app', 'scripts', 'prisma'];\\r\\n  \\r\\n  // å­˜å‚¨éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶\\r\\n  const filesToFix = [];\\r\\n  \\r\\n  // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…æ‰€æœ‰éœ€è¦æ›¿æ¢çš„æ¨¡å¼\\r\\n  const patterns = RENAME_MAPPINGS.map(m => m.pattern);\\r\\n  const replacements = RENAME_MAPPINGS.map(m => m.replacement);\\r\\n  \\r\\n  /**\\r\\n   * é€’å½’æ£€æŸ¥ç›®å½•ä¸­çš„æ–‡ä»¶\\r\\n   */\\r\\n  async function scanDirectory(directory) {\\r\\n    try {\\r\\n      const entries = await readdir(directory);\\r\\n      \\r\\n      for (const entry of entries) {\\r\\n        // è·³è¿‡node_moduleså’Œ.gitç›®å½•\\r\\n        if (entry === 'node_modules' || entry === '.git' || entry === '.next' || entry === 'dist') {\\r\\n          continue;\\r\\n        }\\r\\n        \\r\\n        const fullPath = path.join(directory, entry);\\r\\n        const stats = await stat(fullPath);\\r\\n        \\r\\n        if (stats.isDirectory()) {\\r\\n          // é€’å½’æ£€æŸ¥å­ç›®å½•\\r\\n          await scanDirectory(fullPath);\\r\\n        } else if (stats.isFile()) {\\r\\n          // åªæ£€æŸ¥JavaScriptã€TypeScriptå’ŒJSONæ–‡ä»¶\\r\\n          if (/\\\\.(js|jsx|ts|tsx|json)$/.test(entry)) {\\r\\n            try {\\r\\n              const content = await readFile(fullPath, 'utf8');\\r\\n              \\r\\n              // æ£€æŸ¥æ–‡ä»¶å†…å®¹ä¸­æ˜¯å¦åŒ…å«éœ€è¦æ›¿æ¢çš„è·¯å¾„\\r\\n              let hasMatch = false;\\r\\n              let updatedContent = content;\\r\\n              \\r\\n              for (let i = 0; i < patterns.length; i++) {\\r\\n                if (patterns[i].test(content)) {\\r\\n                  hasMatch = true;\\r\\n                  updatedContent = updatedContent.replace(patterns[i], replacements[i]);\\r\\n                }\\r\\n              }\\r\\n              \\r\\n              if (hasMatch) {\\r\\n                filesToFix.push({\\r\\n                  path: fullPath,\\r\\n                  oldContent: content,\\r\\n                  newContent: updatedContent\\r\\n                });\\r\\n              }\\r\\n            } catch (err) {\\r\\n              console.error(`è¯»å–æ–‡ä»¶ ${fullPath} æ—¶å‡ºé”™:`, err);\\r\\n            }\\r\\n          }\\r\\n        }\\r\\n      }\\r\\n    } catch (error) {\\r\\n      console.error(`æ‰«æç›®å½• ${directory} æ—¶å‡ºé”™:`, error);\\r\\n    }\\r\\n  }\\r\\n  \\r\\n  // æ‰«ææŒ‡å®šçš„ç›®å½•\\r\\n  for (const dir of dirsToScan) {\\r\\n    await scanDirectory(dir);\\r\\n  }\\r\\n  \\r\\n  // è¾“å‡ºç»“æœ\\r\\n  console.log(`æ‰¾åˆ° ${filesToFix.length} ä¸ªæ–‡ä»¶éœ€è¦æ›´æ–°å¯¼å…¥è·¯å¾„:`);\\r\\n  \\r\\n  for (const file of filesToFix) {\\r\\n    console.log(`\\\\næ–‡ä»¶: ${file.path}`);\\r\\n    \\r\\n    // ç”Ÿæˆæ›¿æ¢å†…å®¹çš„å·®å¼‚\\r\\n    const oldLines = file.oldContent.split('\\\\n');\\r\\n    const newLines = file.newContent.split('\\\\n');\\r\\n    \\r\\n    for (let i = 0; i < oldLines.length; i++) {\\r\\n      if (oldLines[i] !== newLines[i]) {\\r\\n        console.log(`è¡Œ ${i + 1}:`);\\r\\n        console.log(`- ${oldLines[i]}`);\\r\\n        console.log(`+ ${newLines[i]}`);\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n  \\r\\n  console.log('\\\\n===== è‡ªåŠ¨ä¿®å¤å‘½ä»¤ =====\\\\n');\\r\\n  \\r\\n  if (filesToFix.length > 0) {\\r\\n    console.log('è¦è‡ªåŠ¨ä¿®å¤æ‰€æœ‰æ–‡ä»¶ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:\\\\n');\\r\\n    console.log('node scripts/fix-imports.js');\\r\\n    \\r\\n    // åˆ›å»ºè‡ªåŠ¨ä¿®å¤è„šæœ¬\\r\\n    const fixScript = `/**\\r\\n * è‡ªåŠ¨ä¿®å¤å¯¼å…¥è·¯å¾„è„šæœ¬\\r\\n * ç”±rename-helper.jsè‡ªåŠ¨ç”Ÿæˆ\\r\\n */\\r\\n\\r\\nconst fs = require('fs');\\r\\nconst path = require('path');\\r\\nconst { promisify } = require('util');\\r\\nconst writeFile = promisify(fs.writeFile);\\r\\n\\r\\n// éœ€è¦ä¿®å¤çš„æ–‡ä»¶\\r\\nconst filesToFix = ${JSON.stringify(filesToFix.map(f => ({ path: f.path, newContent: f.newContent })), null, 2)};\\r\\n\\r\\nasync function fixImports() {\\r\\n  console.log('å¼€å§‹ä¿®å¤å¯¼å…¥è·¯å¾„...');\\r\\n  \\r\\n  for (const file of filesToFix) {\\r\\n    try {\\r\\n      await writeFile(file.path, file.newContent, 'utf8');\\r\\n      console.log(\\\\`å·²ä¿®å¤: \\\\${file.path}\\\\`);\\r\\n    } catch (err) {\\r\\n      console.error(\\\\`ä¿®å¤æ–‡ä»¶ \\\\${file.path} æ—¶å‡ºé”™:\\\\`, err);\\r\\n    }\\r\\n  }\\r\\n  \\r\\n  console.log('\\\\\\\\nä¿®å¤å®Œæˆ!');\\r\\n}\\r\\n\\r\\nfixImports().catch(err => {\\r\\n  console.error('ä¿®å¤å¯¼å…¥è·¯å¾„æ—¶å‡ºé”™:', err);\\r\\n  process.exit(1);\\r\\n});\\r\\n`;\\r\\n    \\r\\n    // å†™å…¥ä¿®å¤è„šæœ¬\\r\\n    await writeFile('scripts/fix-imports.js', fixScript, 'utf8');\\r\\n    console.log('å·²åˆ›å»ºè‡ªåŠ¨ä¿®å¤è„šæœ¬: scripts/fix-imports.js');\\r\\n  } else {\\r\\n    console.log('æ²¡æœ‰æ‰¾åˆ°éœ€è¦ä¿®å¤çš„æ–‡ä»¶');\\r\\n  }\\r\\n}\\r\\n\\r\\n/**\\r\\n * ä¸»å‡½æ•°\\r\\n */\\r\\nasync function main() {\\r\\n  console.log('é¡¹ç›®å‘½åè§„èŒƒä¿®å¤è¾…åŠ©å·¥å…·');\\r\\n  console.log('==========================\\\\n');\\r\\n  \\r\\n  await generateDirectoryRenameCommands();\\r\\n  await generateFileRenameCommands();\\r\\n  await generateFileCreateCommands();\\r\\n  await scanForImportReferences();\\r\\n  \\r\\n  console.log('\\\\n===== ä¿®å¤å»ºè®® =====\\\\n');\\r\\n  console.log('1. å…ˆæ‰§è¡Œç›®å½•é‡å‘½åå‘½ä»¤');\\r\\n  console.log('2. åˆ›å»ºç¼ºå¤±çš„æ ·å¼æ–‡ä»¶');\\r\\n  console.log('3. é‡å‘½åé—®é¢˜æ–‡ä»¶');\\r\\n  console.log('4. è¿è¡Œè‡ªåŠ¨ä¿®å¤è„šæœ¬æ›´æ–°å¯¼å…¥è·¯å¾„');\\r\\n  console.log('5. è¿è¡Œé¡¹ç›®ç¡®è®¤æ²¡æœ‰é”™è¯¯');\\r\\n}\\r\\n\\r\\n// è¿è¡Œç¨‹åº\\r\\nmain().catch(error => {\\r\\n  console.error('è„šæœ¬æ‰§è¡Œå‡ºé”™:', error);\\r\\n  process.exit(1);\\r\\n}); \"\n  },\n  {\n    \"path\": \"scripts\\\\reset-db.ts\",\n    \"newContent\": \"import { PrismaClient } from '@prisma/client';\\r\\n\\r\\n/**\\r\\n * æ•°æ®åº“é‡ç½®è„šæœ¬\\r\\n * è¯¥è„šæœ¬ä¼šæ¸…ç©ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä½†ä¿ç•™æ•°æ®åº“ç»“æ„\\r\\n * è¯·è°¨æ…ä½¿ç”¨ï¼\\r\\n */\\r\\n\\r\\nconst prisma = new PrismaClient();\\r\\n\\r\\nasync function main() {\\r\\n  try {\\r\\n    console.log('å¼€å§‹æ¸…ç©ºæ•°æ®åº“...');\\r\\n    \\r\\n    // æŒ‰ç…§å…³ç³»ä¾èµ–é¡ºåºåˆ é™¤æ•°æ®\\r\\n    // é¦–å…ˆåˆ é™¤å…·æœ‰å¤–é”®ä¾èµ–çš„è¡¨\\r\\n    console.log('åˆ é™¤åˆ†äº«è®°å½•...');\\r\\n    await prisma.share.deleteMany();\\r\\n    \\r\\n    console.log('åˆ é™¤æ–‡ä»¶...');\\r\\n    await prisma.file.deleteMany();\\r\\n    \\r\\n    console.log('åˆ é™¤æ–‡ä»¶å¤¹...');\\r\\n    await prisma.folder.deleteMany();\\r\\n    \\r\\n    console.log('åˆ é™¤ç”¨æˆ·èµ„æ–™...');\\r\\n    await prisma.user-profile.deleteMany();\\r\\n    \\r\\n    console.log('åˆ é™¤ç»´æŠ¤æ—¥å¿—...');\\r\\n    await prisma.maintenanceLog.deleteMany();\\r\\n    \\r\\n    console.log('åˆ é™¤ç”¨æˆ·...');\\r\\n    await prisma.user.deleteMany();\\r\\n    \\r\\n    console.log('æ•°æ®åº“æ¸…ç©ºå®Œæˆï¼');\\r\\n  } catch (error) {\\r\\n    console.error('æ¸…ç©ºæ•°æ®åº“è¿‡ç¨‹ä¸­å‡ºé”™:', error);\\r\\n    process.exit(1);\\r\\n  } finally {\\r\\n    await prisma.$disconnect();\\r\\n  }\\r\\n}\\r\\n\\r\\nmain(); \"\n  },\n  {\n    \"path\": \"prisma\\\\check-models.ts\",\n    \"newContent\": \"// è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºæ£€æŸ¥ç”Ÿæˆçš„Prismaå®¢æˆ·ç«¯æ¨¡å‹\\r\\nimport { PrismaClient } from '@prisma/client'\\r\\n\\r\\nconst prisma = new PrismaClient()\\r\\n\\r\\n// è¾“å‡ºprismaå¯¹è±¡çš„æ‰€æœ‰é”®\\r\\nconsole.log('Prisma client models:')\\r\\nconsole.log(Object.keys(prisma))\\r\\n\\r\\n// æ£€æŸ¥user-profileæ¨¡å‹\\r\\nconst hasUserProfile = 'user-profile' in prisma\\r\\nconst hasUserProfileCap = 'UserProfile' in prisma\\r\\nconsole.log('Has user-profile model:', hasUserProfile)\\r\\nconsole.log('Has UserProfile model:', hasUserProfileCap)\\r\\n\\r\\n// ç›´æ¥è®¿é—®æ‰€æœ‰æ¨¡å‹\\r\\ntry {\\r\\n  console.log('Available models:')\\r\\n  // @ts-ignore\\r\\n  const userModelKeys = Object.keys(prisma.$dmmf.datamodel.models).join(', ')\\r\\n  console.log(userModelKeys)\\r\\n} catch (error) {\\r\\n  console.error('Error accessing model metadata:', error)\\r\\n}\\r\\n\\r\\n// å°è¯•ä¸åŒçš„è®¿é—®æ–¹å¼\\r\\ntry {\\r\\n  // @ts-ignore\\r\\n  const models = prisma._dmmf.modelMap\\r\\n  console.log('Models from _dmmf:', Object.keys(models))\\r\\n} catch (error) {\\r\\n  console.error('Error accessing _dmmf:', error)\\r\\n} \"\n  }\n];\n\nasync function fixImports() {\n  console.log('å¼€å§‹ä¿®å¤å¯¼å…¥è·¯å¾„...');\n  \n  for (const file of filesToFix) {\n    try {\n      await writeFile(file.path, file.newContent, 'utf8');\n      console.log(`å·²ä¿®å¤: ${file.path}`);\n    } catch (err) {\n      console.error(`ä¿®å¤æ–‡ä»¶ ${file.path} æ—¶å‡ºé”™:`, err);\n    }\n  }\n  \n  console.log('\\nä¿®å¤å®Œæˆ!');\n}\n\nfixImports().catch(err => {\n  console.error('ä¿®å¤å¯¼å…¥è·¯å¾„æ—¶å‡ºé”™:', err);\n  process.exit(1);\n});\n"
  },
  {
    "path": "scripts\\rename-helper.js",
    "newContent": "/**\r\n * ç›®å½•é‡å‘½åè¾…åŠ©è„šæœ¬\r\n * ç”¨äºç”Ÿæˆç›®å½•é‡å‘½åå’Œå¯¼å…¥è·¯å¾„ä¿®å¤çš„å‘½ä»¤\r\n */\r\n\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst { promisify } = require('util');\r\nconst readdir = promisify(fs.readdir);\r\nconst stat = promisify(fs.stat);\r\nconst readFile = promisify(fs.readFile);\r\nconst writeFile = promisify(fs.writeFile);\r\n\r\n// éœ€è¦é‡å‘½åçš„ç›®å½•æ˜ å°„\r\nconst RENAME_MAPPINGS = [\r\n  {\r\n    from: 'app/components/features/file-management',\r\n    to: 'app/components/features/file-management',\r\n    pattern: /file-management/g,\r\n    replacement: 'file-management'\r\n  },\r\n  {\r\n    from: 'app/components/features/user-profile',\r\n    to: 'app/components/features/user-profile',\r\n    pattern: /user-profile/g,\r\n    replacement: 'user-profile'\r\n  },\r\n  // æ·»åŠ å…¶ä»–éœ€è¦é‡å‘½åçš„ç›®å½•\r\n];\r\n\r\n// éœ€è¦é‡å‘½åçš„æ–‡ä»¶æ˜ å°„\r\nconst FILE_RENAME_MAPPINGS = [\r\n  {\r\n    from: 'app/services/storage-service.ts',\r\n    to: 'app/services/storageService.ts',\r\n    pattern: /storage-service/g,\r\n    replacement: 'storageService'\r\n  },\r\n  // æ·»åŠ å…¶ä»–éœ€è¦é‡å‘½åçš„æ–‡ä»¶\r\n];\r\n\r\n// éœ€è¦åˆ›å»ºçš„æ–‡ä»¶æ˜ å°„\r\nconst CREATE_MAPPINGS = [\r\n  {\r\n    source: 'app/components/features/user-profile/avatar/AvatarCropper.module.css',\r\n    target: 'app/components/features/user-profile/avatar/AvatarModal.module.css',\r\n    fileUpdate: {\r\n      file: 'app/components/features/user-profile/avatar/AvatarModal.tsx',\r\n      pattern: /from\\s+['\"]\\.\\/AvatarCropper\\.module\\.css['\"]/g,\r\n      replacement: `from './AvatarModal.module.css'`\r\n    }\r\n  },\r\n  // æ·»åŠ å…¶ä»–éœ€è¦åˆ›å»ºçš„æ–‡ä»¶\r\n];\r\n\r\n/**\r\n * ç”Ÿæˆç›®å½•é‡å‘½åå‘½ä»¤\r\n */\r\nasync function generateDirectoryRenameCommands() {\r\n  console.log('\\n===== ç›®å½•é‡å‘½åå‘½ä»¤ =====\\n');\r\n  \r\n  for (const mapping of RENAME_MAPPINGS) {\r\n    const { from, to } = mapping;\r\n    \r\n    // æ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨\r\n    try {\r\n      await stat(from);\r\n      // æ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦å·²å­˜åœ¨\r\n      try {\r\n        await stat(to);\r\n        console.log(`è­¦å‘Š: ç›®æ ‡ç›®å½• ${to} å·²å­˜åœ¨`);\r\n      } catch (err) {\r\n        // ç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œå¯ä»¥é‡å‘½å\r\n        if (process.platform === 'win32') {\r\n          console.log(`mkdir -p \"${path.dirname(to)}\"`);\r\n          console.log(`Move-Item -Path \"${from}\" -Destination \"${to}\"`);\r\n        } else {\r\n          console.log(`mkdir -p \"${path.dirname(to)}\"`);\r\n          console.log(`mv \"${from}\" \"${to}\"`);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.log(`è­¦å‘Š: æºç›®å½• ${from} ä¸å­˜åœ¨`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * ç”Ÿæˆæ–‡ä»¶é‡å‘½åå‘½ä»¤\r\n */\r\nasync function generateFileRenameCommands() {\r\n  console.log('\\n===== æ–‡ä»¶é‡å‘½åå‘½ä»¤ =====\\n');\r\n  \r\n  for (const mapping of FILE_RENAME_MAPPINGS) {\r\n    const { from, to } = mapping;\r\n    \r\n    // æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨\r\n    try {\r\n      await stat(from);\r\n      // æ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨\r\n      try {\r\n        await stat(to);\r\n        console.log(`è­¦å‘Š: ç›®æ ‡æ–‡ä»¶ ${to} å·²å­˜åœ¨`);\r\n      } catch (err) {\r\n        // ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥é‡å‘½å\r\n        if (process.platform === 'win32') {\r\n          console.log(`mkdir -p \"${path.dirname(to)}\"`);\r\n          console.log(`Move-Item -Path \"${from}\" -Destination \"${to}\"`);\r\n        } else {\r\n          console.log(`mkdir -p \"${path.dirname(to)}\"`);\r\n          console.log(`mv \"${from}\" \"${to}\"`);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.log(`è­¦å‘Š: æºæ–‡ä»¶ ${from} ä¸å­˜åœ¨`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * ç”Ÿæˆæ–‡ä»¶åˆ›å»ºå‘½ä»¤\r\n */\r\nasync function generateFileCreateCommands() {\r\n  console.log('\\n===== æ–‡ä»¶åˆ›å»ºå‘½ä»¤ =====\\n');\r\n  \r\n  for (const mapping of CREATE_MAPPINGS) {\r\n    const { source, target } = mapping;\r\n    \r\n    // æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨\r\n    try {\r\n      await stat(source);\r\n      // æ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨\r\n      try {\r\n        await stat(target);\r\n        console.log(`è­¦å‘Š: ç›®æ ‡æ–‡ä»¶ ${target} å·²å­˜åœ¨`);\r\n      } catch (err) {\r\n        // ç›®æ ‡æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»º\r\n        if (process.platform === 'win32') {\r\n          console.log(`mkdir -p \"${path.dirname(target)}\"`);\r\n          console.log(`Copy-Item -Path \"${source}\" -Destination \"${target}\"`);\r\n        } else {\r\n          console.log(`mkdir -p \"${path.dirname(target)}\"`);\r\n          console.log(`cp \"${source}\" \"${target}\"`);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.log(`è­¦å‘Š: æºæ–‡ä»¶ ${source} ä¸å­˜åœ¨`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * æ‰«æé¡¹ç›®æ–‡ä»¶æŸ¥æ‰¾å¯¼å…¥å¼•ç”¨è·¯å¾„\r\n */\r\nasync function scanForImportReferences() {\r\n  console.log('\\n===== å¯¼å…¥è·¯å¾„å¼•ç”¨ä¿®å¤ =====\\n');\r\n  \r\n  // æ‰«ææ–‡ä»¶çš„ç›®å½•\r\n  const dirsToScan = ['app', 'scripts', 'prisma'];\r\n  \r\n  // å­˜å‚¨éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶\r\n  const filesToFix = [];\r\n  \r\n  // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…æ‰€æœ‰éœ€è¦æ›¿æ¢çš„æ¨¡å¼\r\n  const patterns = RENAME_MAPPINGS.map(m => m.pattern);\r\n  const replacements = RENAME_MAPPINGS.map(m => m.replacement);\r\n  \r\n  /**\r\n   * é€’å½’æ£€æŸ¥ç›®å½•ä¸­çš„æ–‡ä»¶\r\n   */\r\n  async function scanDirectory(directory) {\r\n    try {\r\n      const entries = await readdir(directory);\r\n      \r\n      for (const entry of entries) {\r\n        // è·³è¿‡node_moduleså’Œ.gitç›®å½•\r\n        if (entry === 'node_modules' || entry === '.git' || entry === '.next' || entry === 'dist') {\r\n          continue;\r\n        }\r\n        \r\n        const fullPath = path.join(directory, entry);\r\n        const stats = await stat(fullPath);\r\n        \r\n        if (stats.isDirectory()) {\r\n          // é€’å½’æ£€æŸ¥å­ç›®å½•\r\n          await scanDirectory(fullPath);\r\n        } else if (stats.isFile()) {\r\n          // åªæ£€æŸ¥JavaScriptã€TypeScriptå’ŒJSONæ–‡ä»¶\r\n          if (/\\.(js|jsx|ts|tsx|json)$/.test(entry)) {\r\n            try {\r\n              const content = await readFile(fullPath, 'utf8');\r\n              \r\n              // æ£€æŸ¥æ–‡ä»¶å†…å®¹ä¸­æ˜¯å¦åŒ…å«éœ€è¦æ›¿æ¢çš„è·¯å¾„\r\n              let hasMatch = false;\r\n              let updatedContent = content;\r\n              \r\n              for (let i = 0; i < patterns.length; i++) {\r\n                if (patterns[i].test(content)) {\r\n                  hasMatch = true;\r\n                  updatedContent = updatedContent.replace(patterns[i], replacements[i]);\r\n                }\r\n              }\r\n              \r\n              if (hasMatch) {\r\n                filesToFix.push({\r\n                  path: fullPath,\r\n                  oldContent: content,\r\n                  newContent: updatedContent\r\n                });\r\n              }\r\n            } catch (err) {\r\n              console.error(`è¯»å–æ–‡ä»¶ ${fullPath} æ—¶å‡ºé”™:`, err);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(`æ‰«æç›®å½• ${directory} æ—¶å‡ºé”™:`, error);\r\n    }\r\n  }\r\n  \r\n  // æ‰«ææŒ‡å®šçš„ç›®å½•\r\n  for (const dir of dirsToScan) {\r\n    await scanDirectory(dir);\r\n  }\r\n  \r\n  // è¾“å‡ºç»“æœ\r\n  console.log(`æ‰¾åˆ° ${filesToFix.length} ä¸ªæ–‡ä»¶éœ€è¦æ›´æ–°å¯¼å…¥è·¯å¾„:`);\r\n  \r\n  for (const file of filesToFix) {\r\n    console.log(`\\næ–‡ä»¶: ${file.path}`);\r\n    \r\n    // ç”Ÿæˆæ›¿æ¢å†…å®¹çš„å·®å¼‚\r\n    const oldLines = file.oldContent.split('\\n');\r\n    const newLines = file.newContent.split('\\n');\r\n    \r\n    for (let i = 0; i < oldLines.length; i++) {\r\n      if (oldLines[i] !== newLines[i]) {\r\n        console.log(`è¡Œ ${i + 1}:`);\r\n        console.log(`- ${oldLines[i]}`);\r\n        console.log(`+ ${newLines[i]}`);\r\n      }\r\n    }\r\n  }\r\n  \r\n  console.log('\\n===== è‡ªåŠ¨ä¿®å¤å‘½ä»¤ =====\\n');\r\n  \r\n  if (filesToFix.length > 0) {\r\n    console.log('è¦è‡ªåŠ¨ä¿®å¤æ‰€æœ‰æ–‡ä»¶ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:\\n');\r\n    console.log('node scripts/fix-imports.js');\r\n    \r\n    // åˆ›å»ºè‡ªåŠ¨ä¿®å¤è„šæœ¬\r\n    const fixScript = `/**\r\n * è‡ªåŠ¨ä¿®å¤å¯¼å…¥è·¯å¾„è„šæœ¬\r\n * ç”±rename-helper.jsè‡ªåŠ¨ç”Ÿæˆ\r\n */\r\n\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst { promisify } = require('util');\r\nconst writeFile = promisify(fs.writeFile);\r\n\r\n// éœ€è¦ä¿®å¤çš„æ–‡ä»¶\r\nconst filesToFix = ${JSON.stringify(filesToFix.map(f => ({ path: f.path, newContent: f.newContent })), null, 2)};\r\n\r\nasync function fixImports() {\r\n  console.log('å¼€å§‹ä¿®å¤å¯¼å…¥è·¯å¾„...');\r\n  \r\n  for (const file of filesToFix) {\r\n    try {\r\n      await writeFile(file.path, file.newContent, 'utf8');\r\n      console.log(\\`å·²ä¿®å¤: \\${file.path}\\`);\r\n    } catch (err) {\r\n      console.error(\\`ä¿®å¤æ–‡ä»¶ \\${file.path} æ—¶å‡ºé”™:\\`, err);\r\n    }\r\n  }\r\n  \r\n  console.log('\\\\nä¿®å¤å®Œæˆ!');\r\n}\r\n\r\nfixImports().catch(err => {\r\n  console.error('ä¿®å¤å¯¼å…¥è·¯å¾„æ—¶å‡ºé”™:', err);\r\n  process.exit(1);\r\n});\r\n`;\r\n    \r\n    // å†™å…¥ä¿®å¤è„šæœ¬\r\n    await writeFile('scripts/fix-imports.js', fixScript, 'utf8');\r\n    console.log('å·²åˆ›å»ºè‡ªåŠ¨ä¿®å¤è„šæœ¬: scripts/fix-imports.js');\r\n  } else {\r\n    console.log('æ²¡æœ‰æ‰¾åˆ°éœ€è¦ä¿®å¤çš„æ–‡ä»¶');\r\n  }\r\n}\r\n\r\n/**\r\n * ä¸»å‡½æ•°\r\n */\r\nasync function main() {\r\n  console.log('é¡¹ç›®å‘½åè§„èŒƒä¿®å¤è¾…åŠ©å·¥å…·');\r\n  console.log('==========================\\n');\r\n  \r\n  await generateDirectoryRenameCommands();\r\n  await generateFileRenameCommands();\r\n  await generateFileCreateCommands();\r\n  await scanForImportReferences();\r\n  \r\n  console.log('\\n===== ä¿®å¤å»ºè®® =====\\n');\r\n  console.log('1. å…ˆæ‰§è¡Œç›®å½•é‡å‘½åå‘½ä»¤');\r\n  console.log('2. åˆ›å»ºç¼ºå¤±çš„æ ·å¼æ–‡ä»¶');\r\n  console.log('3. é‡å‘½åé—®é¢˜æ–‡ä»¶');\r\n  console.log('4. è¿è¡Œè‡ªåŠ¨ä¿®å¤è„šæœ¬æ›´æ–°å¯¼å…¥è·¯å¾„');\r\n  console.log('5. è¿è¡Œé¡¹ç›®ç¡®è®¤æ²¡æœ‰é”™è¯¯');\r\n}\r\n\r\n// è¿è¡Œç¨‹åº\r\nmain().catch(error => {\r\n  console.error('è„šæœ¬æ‰§è¡Œå‡ºé”™:', error);\r\n  process.exit(1);\r\n}); "
  },
  {
    "path": "scripts\\reset-db.ts",
    "newContent": "import { PrismaClient } from '@prisma/client';\r\n\r\n/**\r\n * æ•°æ®åº“é‡ç½®è„šæœ¬\r\n * è¯¥è„šæœ¬ä¼šæ¸…ç©ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä½†ä¿ç•™æ•°æ®åº“ç»“æ„\r\n * è¯·è°¨æ…ä½¿ç”¨ï¼\r\n */\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nasync function main() {\r\n  try {\r\n    console.log('å¼€å§‹æ¸…ç©ºæ•°æ®åº“...');\r\n    \r\n    // æŒ‰ç…§å…³ç³»ä¾èµ–é¡ºåºåˆ é™¤æ•°æ®\r\n    // é¦–å…ˆåˆ é™¤å…·æœ‰å¤–é”®ä¾èµ–çš„è¡¨\r\n    console.log('åˆ é™¤åˆ†äº«è®°å½•...');\r\n    await prisma.share.deleteMany();\r\n    \r\n    console.log('åˆ é™¤æ–‡ä»¶...');\r\n    await prisma.file.deleteMany();\r\n    \r\n    console.log('åˆ é™¤æ–‡ä»¶å¤¹...');\r\n    await prisma.folder.deleteMany();\r\n    \r\n    console.log('åˆ é™¤ç”¨æˆ·èµ„æ–™...');\r\n    await prisma.user-profile.deleteMany();\r\n    \r\n    console.log('åˆ é™¤ç»´æŠ¤æ—¥å¿—...');\r\n    await prisma.maintenanceLog.deleteMany();\r\n    \r\n    console.log('åˆ é™¤ç”¨æˆ·...');\r\n    await prisma.user.deleteMany();\r\n    \r\n    console.log('æ•°æ®åº“æ¸…ç©ºå®Œæˆï¼');\r\n  } catch (error) {\r\n    console.error('æ¸…ç©ºæ•°æ®åº“è¿‡ç¨‹ä¸­å‡ºé”™:', error);\r\n    process.exit(1);\r\n  } finally {\r\n    await prisma.$disconnect();\r\n  }\r\n}\r\n\r\nmain(); "
  },
  {
    "path": "prisma\\check-models.ts",
    "newContent": "// è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œç”¨äºæ£€æŸ¥ç”Ÿæˆçš„Prismaå®¢æˆ·ç«¯æ¨¡å‹\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = new PrismaClient()\r\n\r\n// è¾“å‡ºprismaå¯¹è±¡çš„æ‰€æœ‰é”®\r\nconsole.log('Prisma client models:')\r\nconsole.log(Object.keys(prisma))\r\n\r\n// æ£€æŸ¥user-profileæ¨¡å‹\r\nconst hasUserProfile = 'user-profile' in prisma\r\nconst hasUserProfileCap = 'UserProfile' in prisma\r\nconsole.log('Has user-profile model:', hasUserProfile)\r\nconsole.log('Has UserProfile model:', hasUserProfileCap)\r\n\r\n// ç›´æ¥è®¿é—®æ‰€æœ‰æ¨¡å‹\r\ntry {\r\n  console.log('Available models:')\r\n  // @ts-ignore\r\n  const userModelKeys = Object.keys(prisma.$dmmf.datamodel.models).join(', ')\r\n  console.log(userModelKeys)\r\n} catch (error) {\r\n  console.error('Error accessing model metadata:', error)\r\n}\r\n\r\n// å°è¯•ä¸åŒçš„è®¿é—®æ–¹å¼\r\ntry {\r\n  // @ts-ignore\r\n  const models = prisma._dmmf.modelMap\r\n  console.log('Models from _dmmf:', Object.keys(models))\r\n} catch (error) {\r\n  console.error('Error accessing _dmmf:', error)\r\n} "
  }
];

async function fixImports() {
  console.log('å¼€å§‹ä¿®å¤å¯¼å…¥è·¯å¾„...');
  
  for (const file of filesToFix) {
    try {
      await writeFile(file.path, file.newContent, 'utf8');
      console.log(`å·²ä¿®å¤: ${file.path}`);
    } catch (err) {
      console.error(`ä¿®å¤æ–‡ä»¶ ${file.path} æ—¶å‡ºé”™:`, err);
    }
  }
  
  console.log('\nä¿®å¤å®Œæˆ!');
}

fixImports().catch(err => {
  console.error('ä¿®å¤å¯¼å…¥è·¯å¾„æ—¶å‡ºé”™:', err);
  process.exit(1);
});
